/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 9);
/******/ })
/************************************************************************/
/******/ ({

/***/ "./Modules/Menu/Resources/assets/admin/js/main.js":
/*!********************************************************!*\
  !*** ./Modules/Menu/Resources/assets/admin/js/main.js ***!
  \********************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var nestable2__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! nestable2 */ \"./Modules/Menu/node_modules/nestable2/jquery.nestable.js\");\n/* harmony import */ var nestable2__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(nestable2__WEBPACK_IMPORTED_MODULE_0__);\n\nwindow.admin.removeSubmitButtonOffsetOn('#image');\n$('#type').on('change', function (e) {\n  $('.link-field').addClass('hide');\n  $(\".\".concat(e.currentTarget.value, \"-field\")).removeClass('hide');\n});\n$('.dd').nestable({\n  maxDepth: 15\n});\n$('.dd').on('change', function () {\n  $.ajax({\n    type: 'PUT',\n    url: route('admin.menus.items.order.update'),\n    contentType: 'application/json; charset=utf-8',\n    data: JSON.stringify($('.dd').nestable('serialize')[0]),\n    success: function (_success) {\n      function success() {\n        return _success.apply(this, arguments);\n      }\n\n      success.toString = function () {\n        return _success.toString();\n      };\n\n      return success;\n    }(function () {\n      success(trans('menu::messages.menu_items_order_updated'));\n    }),\n    error: function (_error) {\n      function error(_x) {\n        return _error.apply(this, arguments);\n      }\n\n      error.toString = function () {\n        return _error.toString();\n      };\n\n      return error;\n    }(function (xhr) {\n      error(xhr.responseJSON.message);\n    })\n  });\n});\nvar id;\nvar confirmationModal = $('#confirmation-modal');\n$('.delete-menu-item').on('click', function (e) {\n  id = $(e.currentTarget).closest('.dd-item').data('id');\n  confirmationModal.modal('show');\n});\nconfirmationModal.find('form').on('submit', function (e) {\n  e.preventDefault();\n  confirmationModal.modal('hide');\n  $.ajax({\n    type: 'DELETE',\n    url: route('admin.menus.items.destroy', id),\n    success: function (_success2) {\n      function success() {\n        return _success2.apply(this, arguments);\n      }\n\n      success.toString = function () {\n        return _success2.toString();\n      };\n\n      return success;\n    }(function () {\n      success(trans('menu::messages.menu_item_deleted'));\n      $(\".dd-item[data-id=\\\"\".concat(id, \"\\\"]\")).fadeOut();\n    }),\n    error: function (_error2) {\n      function error(_x2) {\n        return _error2.apply(this, arguments);\n      }\n\n      error.toString = function () {\n        return _error2.toString();\n      };\n\n      return error;\n    }(function (xhr) {\n      error(xhr.responseJSON.message);\n    })\n  });\n});//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9Nb2R1bGVzL01lbnUvUmVzb3VyY2VzL2Fzc2V0cy9hZG1pbi9qcy9tYWluLmpzPzIwYTQiXSwibmFtZXMiOlsid2luZG93IiwiYWRtaW4iLCJyZW1vdmVTdWJtaXRCdXR0b25PZmZzZXRPbiIsIiQiLCJvbiIsImUiLCJhZGRDbGFzcyIsImN1cnJlbnRUYXJnZXQiLCJ2YWx1ZSIsInJlbW92ZUNsYXNzIiwibmVzdGFibGUiLCJtYXhEZXB0aCIsImFqYXgiLCJ0eXBlIiwidXJsIiwicm91dGUiLCJjb250ZW50VHlwZSIsImRhdGEiLCJKU09OIiwic3RyaW5naWZ5Iiwic3VjY2VzcyIsInRyYW5zIiwiZXJyb3IiLCJ4aHIiLCJyZXNwb25zZUpTT04iLCJtZXNzYWdlIiwiaWQiLCJjb25maXJtYXRpb25Nb2RhbCIsImNsb3Nlc3QiLCJtb2RhbCIsImZpbmQiLCJwcmV2ZW50RGVmYXVsdCIsImZhZGVPdXQiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUFBLE1BQU0sQ0FBQ0MsS0FBUCxDQUFhQywwQkFBYixDQUF3QyxRQUF4QztBQUVBQyxDQUFDLENBQUMsT0FBRCxDQUFELENBQVdDLEVBQVgsQ0FBYyxRQUFkLEVBQXdCLFVBQUNDLENBQUQsRUFBTztBQUMzQkYsR0FBQyxDQUFDLGFBQUQsQ0FBRCxDQUFpQkcsUUFBakIsQ0FBMEIsTUFBMUI7QUFDQUgsR0FBQyxZQUFLRSxDQUFDLENBQUNFLGFBQUYsQ0FBZ0JDLEtBQXJCLFlBQUQsQ0FBcUNDLFdBQXJDLENBQWlELE1BQWpEO0FBQ0gsQ0FIRDtBQUtBTixDQUFDLENBQUMsS0FBRCxDQUFELENBQVNPLFFBQVQsQ0FBa0I7QUFBRUMsVUFBUSxFQUFFO0FBQVosQ0FBbEI7QUFFQVIsQ0FBQyxDQUFDLEtBQUQsQ0FBRCxDQUFTQyxFQUFULENBQVksUUFBWixFQUFzQixZQUFNO0FBQ3hCRCxHQUFDLENBQUNTLElBQUYsQ0FBTztBQUNIQyxRQUFJLEVBQUUsS0FESDtBQUVIQyxPQUFHLEVBQUVDLEtBQUssQ0FBQyxnQ0FBRCxDQUZQO0FBR0hDLGVBQVcsRUFBRSxpQ0FIVjtBQUlIQyxRQUFJLEVBQUVDLElBQUksQ0FBQ0MsU0FBTCxDQUFlaEIsQ0FBQyxDQUFDLEtBQUQsQ0FBRCxDQUFTTyxRQUFULENBQWtCLFdBQWxCLEVBQStCLENBQS9CLENBQWYsQ0FKSDtBQUtIVSxXQUxHO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBLGtCQUtPO0FBQ05BLGFBQU8sQ0FBQ0MsS0FBSyxDQUFDLHlDQUFELENBQU4sQ0FBUDtBQUNILEtBUEU7QUFRSEMsU0FSRztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQSxnQkFRR0MsR0FSSCxFQVFRO0FBQ1BELFdBQUssQ0FBQ0MsR0FBRyxDQUFDQyxZQUFKLENBQWlCQyxPQUFsQixDQUFMO0FBQ0gsS0FWRTtBQUFBLEdBQVA7QUFZSCxDQWJEO0FBZUEsSUFBSUMsRUFBSjtBQUNBLElBQUlDLGlCQUFpQixHQUFHeEIsQ0FBQyxDQUFDLHFCQUFELENBQXpCO0FBRUFBLENBQUMsQ0FBQyxtQkFBRCxDQUFELENBQXVCQyxFQUF2QixDQUEwQixPQUExQixFQUFtQyxVQUFDQyxDQUFELEVBQU87QUFDdENxQixJQUFFLEdBQUd2QixDQUFDLENBQUNFLENBQUMsQ0FBQ0UsYUFBSCxDQUFELENBQW1CcUIsT0FBbkIsQ0FBMkIsVUFBM0IsRUFBdUNYLElBQXZDLENBQTRDLElBQTVDLENBQUw7QUFFQVUsbUJBQWlCLENBQUNFLEtBQWxCLENBQXdCLE1BQXhCO0FBQ0gsQ0FKRDtBQU1BRixpQkFBaUIsQ0FBQ0csSUFBbEIsQ0FBdUIsTUFBdkIsRUFBK0IxQixFQUEvQixDQUFrQyxRQUFsQyxFQUE0QyxVQUFDQyxDQUFELEVBQU87QUFDL0NBLEdBQUMsQ0FBQzBCLGNBQUY7QUFFQUosbUJBQWlCLENBQUNFLEtBQWxCLENBQXdCLE1BQXhCO0FBRUExQixHQUFDLENBQUNTLElBQUYsQ0FBTztBQUNIQyxRQUFJLEVBQUUsUUFESDtBQUVIQyxPQUFHLEVBQUVDLEtBQUssQ0FBQywyQkFBRCxFQUE4QlcsRUFBOUIsQ0FGUDtBQUdITixXQUhHO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBLGtCQUdPO0FBQ05BLGFBQU8sQ0FBQ0MsS0FBSyxDQUFDLGtDQUFELENBQU4sQ0FBUDtBQUVBbEIsT0FBQyw4QkFBc0J1QixFQUF0QixTQUFELENBQStCTSxPQUEvQjtBQUNILEtBUEU7QUFRSFYsU0FSRztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQSxnQkFRR0MsR0FSSCxFQVFRO0FBQ1BELFdBQUssQ0FBQ0MsR0FBRyxDQUFDQyxZQUFKLENBQWlCQyxPQUFsQixDQUFMO0FBQ0gsS0FWRTtBQUFBLEdBQVA7QUFZSCxDQWpCRCIsImZpbGUiOiIuL01vZHVsZXMvTWVudS9SZXNvdXJjZXMvYXNzZXRzL2FkbWluL2pzL21haW4uanMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ25lc3RhYmxlMic7XHJcblxyXG53aW5kb3cuYWRtaW4ucmVtb3ZlU3VibWl0QnV0dG9uT2Zmc2V0T24oJyNpbWFnZScpO1xyXG5cclxuJCgnI3R5cGUnKS5vbignY2hhbmdlJywgKGUpID0+IHtcclxuICAgICQoJy5saW5rLWZpZWxkJykuYWRkQ2xhc3MoJ2hpZGUnKTtcclxuICAgICQoYC4ke2UuY3VycmVudFRhcmdldC52YWx1ZX0tZmllbGRgKS5yZW1vdmVDbGFzcygnaGlkZScpO1xyXG59KTtcclxuXHJcbiQoJy5kZCcpLm5lc3RhYmxlKHsgbWF4RGVwdGg6IDE1IH0pO1xyXG5cclxuJCgnLmRkJykub24oJ2NoYW5nZScsICgpID0+IHtcclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdHlwZTogJ1BVVCcsXHJcbiAgICAgICAgdXJsOiByb3V0ZSgnYWRtaW4ubWVudXMuaXRlbXMub3JkZXIudXBkYXRlJyksXHJcbiAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04JyxcclxuICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSgkKCcuZGQnKS5uZXN0YWJsZSgnc2VyaWFsaXplJylbMF0pLFxyXG4gICAgICAgIHN1Y2Nlc3MoKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3ModHJhbnMoJ21lbnU6Om1lc3NhZ2VzLm1lbnVfaXRlbXNfb3JkZXJfdXBkYXRlZCcpKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yKHhocikge1xyXG4gICAgICAgICAgICBlcnJvcih4aHIucmVzcG9uc2VKU09OLm1lc3NhZ2UpO1xyXG4gICAgICAgIH0sXHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5sZXQgaWQ7XHJcbmxldCBjb25maXJtYXRpb25Nb2RhbCA9ICQoJyNjb25maXJtYXRpb24tbW9kYWwnKTtcclxuXHJcbiQoJy5kZWxldGUtbWVudS1pdGVtJykub24oJ2NsaWNrJywgKGUpID0+IHtcclxuICAgIGlkID0gJChlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoJy5kZC1pdGVtJykuZGF0YSgnaWQnKTtcclxuXHJcbiAgICBjb25maXJtYXRpb25Nb2RhbC5tb2RhbCgnc2hvdycpO1xyXG59KTtcclxuXHJcbmNvbmZpcm1hdGlvbk1vZGFsLmZpbmQoJ2Zvcm0nKS5vbignc3VibWl0JywgKGUpID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBjb25maXJtYXRpb25Nb2RhbC5tb2RhbCgnaGlkZScpO1xyXG5cclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdHlwZTogJ0RFTEVURScsXHJcbiAgICAgICAgdXJsOiByb3V0ZSgnYWRtaW4ubWVudXMuaXRlbXMuZGVzdHJveScsIGlkKSxcclxuICAgICAgICBzdWNjZXNzKCkge1xyXG4gICAgICAgICAgICBzdWNjZXNzKHRyYW5zKCdtZW51OjptZXNzYWdlcy5tZW51X2l0ZW1fZGVsZXRlZCcpKTtcclxuXHJcbiAgICAgICAgICAgICQoYC5kZC1pdGVtW2RhdGEtaWQ9XCIke2lkfVwiXWApLmZhZGVPdXQoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yKHhocikge1xyXG4gICAgICAgICAgICBlcnJvcih4aHIucmVzcG9uc2VKU09OLm1lc3NhZ2UpO1xyXG4gICAgICAgIH0sXHJcbiAgICB9KTtcclxufSk7XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./Modules/Menu/Resources/assets/admin/js/main.js\n");

/***/ }),

/***/ "./Modules/Menu/node_modules/nestable2/jquery.nestable.js":
/*!****************************************************************!*\
  !*** ./Modules/Menu/node_modules/nestable2/jquery.nestable.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/*!\r\n * Nestable jQuery Plugin - Copyright (c) 2014 Ramon Smit - https://github.com/RamonSmit/Nestable\r\n */\r\n\r\n(function($, window, document, undefined) {\r\n    var hasTouch = 'ontouchstart' in document;\r\n\r\n    /**\r\n     * Detect CSS pointer-events property\r\n     * events are normally disabled on the dragging element to avoid conflicts\r\n     * https://github.com/ausi/Feature-detection-technique-for-pointer-events/blob/master/modernizr-pointerevents.js\r\n     */\r\n    var hasPointerEvents = (function() {\r\n        var el = document.createElement('div'),\r\n            docEl = document.documentElement;\r\n        if (!('pointerEvents' in el.style)) {\r\n            return false;\r\n        }\r\n        el.style.pointerEvents = 'auto';\r\n        el.style.pointerEvents = 'x';\r\n        docEl.appendChild(el);\r\n        var supports = window.getComputedStyle && window.getComputedStyle(el, '').pointerEvents === 'auto';\r\n        docEl.removeChild(el);\r\n        return !!supports;\r\n    })();\r\n\r\n    var defaults = {\r\n        contentCallback: function(item) {return item.content || '' ? item.content : item.id;},\r\n        listNodeName: 'ol',\r\n        itemNodeName: 'li',\r\n        handleNodeName: 'div',\r\n        contentNodeName: 'span',\r\n        rootClass: 'dd',\r\n        listClass: 'dd-list',\r\n        itemClass: 'dd-item',\r\n        dragClass: 'dd-dragel',\r\n        handleClass: 'dd-handle',\r\n        contentClass: 'dd-content',\r\n        collapsedClass: 'dd-collapsed',\r\n        placeClass: 'dd-placeholder',\r\n        noDragClass: 'dd-nodrag',\r\n        noChildrenClass: 'dd-nochildren',\r\n        emptyClass: 'dd-empty',\r\n        expandBtnHTML: '<button class=\"dd-expand\" data-action=\"expand\" type=\"button\">Expand</button>',\r\n        collapseBtnHTML: '<button class=\"dd-collapse\" data-action=\"collapse\" type=\"button\">Collapse</button>',\r\n        group: 0,\r\n        maxDepth: 5,\r\n        threshold: 20,\r\n        fixedDepth: false, //fixed item's depth\r\n        fixed: false,\r\n        includeContent: false,\r\n        scroll: false,\r\n        scrollSensitivity: 1,\r\n        scrollSpeed: 5,\r\n        scrollTriggers: {\r\n            top: 40,\r\n            left: 40,\r\n            right: -40,\r\n            bottom: -40\r\n        },\r\n        effect: {\r\n            animation: 'none',\r\n            time: 'slow'\r\n        },\r\n        callback: function(l, e, p) {},\r\n        onDragStart: function(l, e, p) {},\r\n        beforeDragStop: function(l, e, p) {},\r\n        listRenderer: function(children, options) {\r\n            var html = '<' + options.listNodeName + ' class=\"' + options.listClass + '\">';\r\n            html += children;\r\n            html += '</' + options.listNodeName + '>';\r\n\r\n            return html;\r\n        },\r\n        itemRenderer: function(item_attrs, content, children, options, item) {\r\n            var item_attrs_string = $.map(item_attrs, function(value, key) {\r\n                return ' ' + key + '=\"' + value + '\"';\r\n            }).join(' ');\r\n\r\n            var html = '<' + options.itemNodeName + item_attrs_string + '>';\r\n            html += '<' + options.handleNodeName + ' class=\"' + options.handleClass + '\">';\r\n            html += '<' + options.contentNodeName + ' class=\"' + options.contentClass + '\">';\r\n            html += content;\r\n            html += '</' + options.contentNodeName + '>';\r\n            html += '</' + options.handleNodeName + '>';\r\n            html += children;\r\n            html += '</' + options.itemNodeName + '>';\r\n\r\n            return html;\r\n        }\r\n    };\r\n\r\n    function Plugin(element, options) {\r\n        this.w  = $(document);\r\n        this.el = $(element);\r\n        options = options || defaults;\r\n\r\n        if (options.rootClass !== undefined && options.rootClass !== 'dd') {\r\n            options.listClass       = options.listClass ? options.listClass : options.rootClass + '-list';\r\n            options.itemClass       = options.itemClass ? options.itemClass : options.rootClass + '-item';\r\n            options.dragClass       = options.dragClass ? options.dragClass : options.rootClass + '-dragel';\r\n            options.handleClass     = options.handleClass ? options.handleClass : options.rootClass + '-handle';\r\n            options.collapsedClass  = options.collapsedClass ? options.collapsedClass : options.rootClass + '-collapsed';\r\n            options.placeClass      = options.placeClass ? options.placeClass : options.rootClass + '-placeholder';\r\n            options.noDragClass     = options.noDragClass ? options.noDragClass : options.rootClass + '-nodrag';\r\n            options.noChildrenClass = options.noChildrenClass ? options.noChildrenClass : options.rootClass + '-nochildren';\r\n            options.emptyClass      = options.emptyClass ? options.emptyClass : options.rootClass + '-empty';\r\n        }\r\n\r\n        this.options = $.extend({}, defaults, options);\r\n\r\n        // build HTML from serialized JSON if passed\r\n        if (this.options.json !== undefined) {\r\n            this._build();\r\n        }\r\n\r\n        this.init();\r\n    }\r\n\r\n    Plugin.prototype = {\r\n\r\n        init: function() {\r\n            var list = this;\r\n\r\n            list.reset();\r\n            list.el.data('nestable-group', this.options.group);\r\n            list.placeEl = $('<div class=\"' + list.options.placeClass + '\"/>');\r\n\r\n            var items = this.el.find(list.options.itemNodeName);\r\n            $.each(items, function(k, el) {\r\n                var item = $(el),\r\n                    parent = item.parent();\r\n                list.setParent(item);\r\n                if (parent.hasClass(list.options.collapsedClass)) {\r\n                    list.collapseItem(parent.parent());\r\n                }\r\n            });\r\n\r\n            // Append the .dd-empty div if the list don't have any items on init\r\n            if (!items.length) {\r\n                this.appendEmptyElement(this.el);\r\n            }\r\n\r\n            list.el.on('click', 'button', function(e) {\r\n                if (list.dragEl) {\r\n                    return;\r\n                }\r\n                var target = $(e.currentTarget),\r\n                    action = target.data('action'),\r\n                    item = target.parents(list.options.itemNodeName).eq(0);\r\n                if (action === 'collapse') {\r\n                    list.collapseItem(item);\r\n                }\r\n                if (action === 'expand') {\r\n                    list.expandItem(item);\r\n                }\r\n            });\r\n\r\n            var onStartEvent = function(e) {\r\n                var handle = $(e.target);\r\n                if (!handle.hasClass(list.options.handleClass)) {\r\n                    if (handle.closest('.' + list.options.noDragClass).length) {\r\n                        return;\r\n                    }\r\n                    handle = handle.closest('.' + list.options.handleClass);\r\n                }\r\n                if (!handle.length || list.dragEl) {\r\n                    return;\r\n                }\r\n\r\n                list.isTouch = /^touch/.test(e.type);\r\n                if (list.isTouch && e.touches.length !== 1) {\r\n                    return;\r\n                }\r\n\r\n                e.preventDefault();\r\n                list.dragStart(e.touches ? e.touches[0] : e);\r\n            };\r\n\r\n            var onMoveEvent = function(e) {\r\n                if (list.dragEl) {\r\n                    e.preventDefault();\r\n                    list.dragMove(e.touches ? e.touches[0] : e);\r\n                }\r\n            };\r\n\r\n            var onEndEvent = function(e) {\r\n                if (list.dragEl) {\r\n                    e.preventDefault();\r\n                    list.dragStop(e.touches ? e.changedTouches[0] : e);\r\n                }\r\n            };\r\n\r\n            if (hasTouch) {\r\n                list.el[0].addEventListener('touchstart', onStartEvent, false);\r\n                window.addEventListener('touchmove', onMoveEvent, false);\r\n                window.addEventListener('touchend', onEndEvent, false);\r\n                window.addEventListener('touchcancel', onEndEvent, false);\r\n            }\r\n\r\n            list.el.on('mousedown', onStartEvent);\r\n            list.w.on('mousemove', onMoveEvent);\r\n            list.w.on('mouseup', onEndEvent);\r\n\r\n            var destroyNestable = function()\r\n            {\r\n                if (hasTouch) {\r\n                    list.el[0].removeEventListener('touchstart', onStartEvent, false);\r\n                    window.removeEventListener('touchmove', onMoveEvent, false);\r\n                    window.removeEventListener('touchend', onEndEvent, false);\r\n                    window.removeEventListener('touchcancel', onEndEvent, false);\r\n                }\r\n\r\n                list.el.off('mousedown', onStartEvent);\r\n                list.w.off('mousemove', onMoveEvent);\r\n                list.w.off('mouseup', onEndEvent);\r\n\r\n                list.el.off('click');\r\n                list.el.unbind('destroy-nestable');\r\n\r\n                list.el.data(\"nestable\", null);\r\n            };\r\n\r\n            list.el.bind('destroy-nestable', destroyNestable);\r\n\r\n        },\r\n\r\n        destroy: function ()\r\n        {\r\n            this.el.trigger('destroy-nestable');\r\n        },\r\n\r\n        add: function (item)\r\n        {\r\n            var listClassSelector = '.' + this.options.listClass;\r\n            var tree = $(this.el).children(listClassSelector);\r\n\r\n            if (item.parent_id !== undefined) {\r\n                tree = tree.find('[data-id=\"' + item.parent_id + '\"]');\r\n                delete item.parent_id;\r\n\r\n                if (tree.children(listClassSelector).length === 0) {\r\n                    tree = tree.append(this.options.listRenderer('', this.options));\r\n                }\r\n\r\n                tree = tree.find(listClassSelector + ':first');\r\n                this.setParent(tree.parent());\r\n            }\r\n\r\n            tree.append(this._buildItem(item, this.options));\r\n        },\r\n\r\n        replace: function (item)\r\n        {\r\n            var html = this._buildItem(item, this.options);\r\n\r\n            this._getItemById(item.id)\r\n                .replaceWith(html);\r\n        },\r\n\r\n        //removes item and additional elements from list\r\n        removeItem: function (item){\r\n            var opts = this.options,\r\n                el   = this.el;\r\n\r\n            // remove item\r\n            item = item || this;\r\n            item.remove();\r\n\r\n            // remove empty children lists\r\n            var emptyListsSelector = '.' + opts.listClass\r\n                + ' .' + opts.listClass + ':not(:has(*))';\r\n            $(el).find(emptyListsSelector).remove();\r\n\r\n            // remove buttons if parents do not have children\r\n            var buttonsSelector = '[data-action=\"expand\"], [data-action=\"collapse\"]';\r\n            $(el).find(buttonsSelector).each(function() {\r\n                var siblings = $(this).siblings('.' + opts.listClass);\r\n                if (siblings.length === 0) {\r\n                    $(this).remove();\r\n                }\r\n            });\r\n        },\r\n\r\n        //removes item by itemId and run callback at the end\r\n        remove: function (itemId, callback)\r\n        {\r\n            var opts = this.options;\r\n            var list = this;\r\n            var item = this._getItemById(itemId);\r\n\r\n            //animation style\r\n            var animation = opts.effect.animation || 'fade';\r\n\r\n            //animation time\r\n            var time = opts.effect.time || 'slow';\r\n\r\n            //add fadeOut effect when removing\r\n            if (animation === 'fade'){\r\n                item.fadeOut(time, function(){\r\n                    list.removeItem(item);\r\n                });\r\n            }\r\n            else {\r\n                this.removeItem(item);\r\n            }\r\n\r\n            if (callback) callback();\r\n        },\r\n\r\n        //removes all items from the list and run callback at the end\r\n        removeAll: function(callback){\r\n\r\n            var list  = this,\r\n                opts  = this.options,\r\n                node  = list.el.find(opts.listNodeName).first(),\r\n                items = node.children(opts.itemNodeName);\r\n\r\n            //animation style\r\n            var animation = opts.effect.animation || 'fade';\r\n\r\n            //animation time\r\n            var time = opts.effect.time || 'slow';\r\n\r\n            function remove(){\r\n                //Removes each item and its children.\r\n                items.each(function() {\r\n                    list.removeItem($(this));\r\n                });\r\n                //Now we can again show our node element\r\n                node.show();\r\n                if (callback) callback();\r\n            }\r\n\r\n            //add fadeOut effect when removing\r\n            if (animation === 'fade'){\r\n                node.fadeOut(time, remove);\r\n            }\r\n            else {\r\n                remove();\r\n            }\r\n        },\r\n\r\n        _getItemById: function(itemId) {\r\n            return $(this.el).children('.' + this.options.listClass)\r\n                .find('[data-id=\"' + itemId + '\"]');\r\n        },\r\n\r\n        _build: function() {\r\n            var json = this.options.json;\r\n\r\n            if (typeof json === 'string') {\r\n                json = JSON.parse(json);\r\n            }\r\n\r\n            $(this.el).html(this._buildList(json, this.options));\r\n        },\r\n\r\n        _buildList: function(items, options) {\r\n            if (!items) {\r\n                return '';\r\n            }\r\n\r\n            var children = '';\r\n            var that = this;\r\n\r\n            $.each(items, function(index, sub) {\r\n                children += that._buildItem(sub, options);\r\n            });\r\n\r\n            return options.listRenderer(children, options);\r\n        },\r\n\r\n        _buildItem: function(item, options) {\r\n            function escapeHtml(text) {\r\n                var map = {\r\n                    '&': '&amp;',\r\n                    '<': '&lt;',\r\n                    '>': '&gt;',\r\n                    '\"': '&quot;',\r\n                    \"'\": '&#039;'\r\n                };\r\n\r\n                return text + \"\".replace(/[&<>\"']/g, function(m) { return map[m]; });\r\n            }\r\n\r\n            function filterClasses(classes) {\r\n                var new_classes = {};\r\n\r\n                for (var k in classes) {\r\n                    // Remove duplicates\r\n                    new_classes[classes[k]] = classes[k];\r\n                }\r\n\r\n                return new_classes;\r\n            }\r\n\r\n            function createClassesString(item, options) {\r\n                var classes = item.classes || {};\r\n\r\n                if (typeof classes === 'string') {\r\n                    classes = [classes];\r\n                }\r\n\r\n                var item_classes = filterClasses(classes);\r\n                item_classes[options.itemClass] = options.itemClass;\r\n\r\n                // create class string\r\n                return $.map(item_classes, function(val) {\r\n                    return val;\r\n                }).join(' ');\r\n            }\r\n\r\n            function createDataAttrs(attr) {\r\n                attr = $.extend({}, attr);\r\n\r\n                delete attr.children;\r\n                delete attr.classes;\r\n                delete attr.content;\r\n\r\n                var data_attrs = {};\r\n\r\n                $.each(attr, function(key, value) {\r\n                    if (typeof value === 'object') {\r\n                        value = JSON.stringify(value);\r\n                    }\r\n\r\n                    data_attrs[\"data-\" + key] = escapeHtml(value);\r\n                });\r\n\r\n                return data_attrs;\r\n            }\r\n\r\n            var item_attrs = createDataAttrs(item);\r\n            item_attrs[\"class\"] = createClassesString(item, options);\r\n\r\n            var content = options.contentCallback(item);\r\n            var children = this._buildList(item.children, options);\r\n            var html = $(options.itemRenderer(item_attrs, content, children, options, item));\r\n\r\n            this.setParent(html);\r\n\r\n            return html[0].outerHTML;\r\n        },\r\n\r\n        serialize: function() {\r\n            var data, list = this, step = function(level) {\r\n                var array = [],\r\n                    items = level.children(list.options.itemNodeName);\r\n                items.each(function() {\r\n                    var li = $(this),\r\n                        item = $.extend({}, li.data()),\r\n                        sub = li.children(list.options.listNodeName);\r\n\r\n                    if (list.options.includeContent) {\r\n                        var content = li.find('.' + list.options.contentClass).html();\r\n\r\n                        if (content) {\r\n                            item.content = content;\r\n                        }\r\n                    }\r\n\r\n                    if (sub.length) {\r\n                        item.children = step(sub);\r\n                    }\r\n                    array.push(item);\r\n                });\r\n                return array;\r\n            };\r\n            data = step(list.el.find(list.options.listNodeName).first());\r\n            return data;\r\n        },\r\n\r\n        asNestedSet: function() {\r\n            var list = this, o = list.options, depth = -1, ret = [], lft = 1;\r\n            var items = list.el.find(o.listNodeName).first().children(o.itemNodeName);\r\n\r\n            items.each(function () {\r\n                lft = traverse(this, depth + 1, lft);\r\n            });\r\n\r\n            ret = ret.sort(function(a,b){ return (a.lft - b.lft); });\r\n            return ret;\r\n\r\n            function traverse(item, depth, lft) {\r\n                var rgt = lft + 1, id, pid;\r\n\r\n                if ($(item).children(o.listNodeName).children(o.itemNodeName).length > 0 ) {\r\n                    depth++;\r\n                    $(item).children(o.listNodeName).children(o.itemNodeName).each(function () {\r\n                        rgt = traverse($(this), depth, rgt);\r\n                    });\r\n                    depth--;\r\n                }\r\n\r\n                id = $(item).attr('data-id');\r\n                if (isInt(id)) {\r\n                    id = parseInt(id);\r\n                }\r\n\r\n                pid = $(item).parent(o.listNodeName).parent(o.itemNodeName).attr('data-id') || '';\r\n                if (isInt(pid)) {\r\n                    id = parseInt(pid);\r\n                }\r\n\r\n                if (id) {\r\n                    ret.push({\"id\": id, \"parent_id\": pid, \"depth\": depth, \"lft\": lft, \"rgt\": rgt});\r\n                }\r\n\r\n                lft = rgt + 1;\r\n                return lft;\r\n            }\r\n\r\n            function isInt(value) {\r\n                return $.isNumeric(value) && Math.floor(value) == value;\r\n            }\r\n        },\r\n\r\n        returnOptions: function() {\r\n            return this.options;\r\n        },\r\n\r\n        serialise: function() {\r\n            return this.serialize();\r\n        },\r\n\r\n        toHierarchy: function(options) {\r\n\r\n            var o = $.extend({}, this.options, options),\r\n                ret = [];\r\n\r\n            $(this.element).children(o.items).each(function() {\r\n                var level = _recursiveItems(this);\r\n                ret.push(level);\r\n            });\r\n\r\n            return ret;\r\n\r\n            function _recursiveItems(item) {\r\n                var id = ($(item).attr(o.attribute || 'id') || '').match(o.expression || (/(.+)[-=_](.+)/));\r\n                if (id) {\r\n                    var currentItem = {\r\n                        \"id\": id[2]\r\n                    };\r\n                    if ($(item).children(o.listType).children(o.items).length > 0) {\r\n                        currentItem.children = [];\r\n                        $(item).children(o.listType).children(o.items).each(function() {\r\n                            var level = _recursiveItems(this);\r\n                            currentItem.children.push(level);\r\n                        });\r\n                    }\r\n                    return currentItem;\r\n                }\r\n            }\r\n        },\r\n\r\n        toArray: function() {\r\n\r\n            var o = $.extend({}, this.options, this),\r\n                sDepth = o.startDepthCount || 0,\r\n                ret = [],\r\n                left = 2,\r\n                list = this,\r\n                element = list.el.find(list.options.listNodeName).first();\r\n\r\n            var items = element.children(list.options.itemNodeName);\r\n            items.each(function() {\r\n                left = _recursiveArray($(this), sDepth + 1, left);\r\n            });\r\n\r\n            ret = ret.sort(function(a, b) {\r\n                return (a.left - b.left);\r\n            });\r\n\r\n            return ret;\r\n\r\n            function _recursiveArray(item, depth, left) {\r\n\r\n                var right = left + 1,\r\n                    id,\r\n                    pid;\r\n\r\n                if (item.children(o.options.listNodeName).children(o.options.itemNodeName).length > 0) {\r\n                    depth++;\r\n                    item.children(o.options.listNodeName).children(o.options.itemNodeName).each(function() {\r\n                        right = _recursiveArray($(this), depth, right);\r\n                    });\r\n                    depth--;\r\n                }\r\n\r\n                id = item.data().id;\r\n\r\n\r\n                if (depth === sDepth + 1) {\r\n                    pid = o.rootID;\r\n                } else {\r\n\r\n                    var parentItem = (item.parent(o.options.listNodeName)\r\n                        .parent(o.options.itemNodeName)\r\n                        .data());\r\n                    pid = parentItem.id;\r\n\r\n                }\r\n\r\n                if (id) {\r\n                    ret.push({\r\n                        \"id\": id,\r\n                        \"parent_id\": pid,\r\n                        \"depth\": depth,\r\n                        \"left\": left,\r\n                        \"right\": right\r\n                    });\r\n                }\r\n\r\n                left = right + 1;\r\n                return left;\r\n            }\r\n\r\n        },\r\n\r\n        reset: function() {\r\n            this.mouse = {\r\n                offsetX: 0,\r\n                offsetY: 0,\r\n                startX: 0,\r\n                startY: 0,\r\n                lastX: 0,\r\n                lastY: 0,\r\n                nowX: 0,\r\n                nowY: 0,\r\n                distX: 0,\r\n                distY: 0,\r\n                dirAx: 0,\r\n                dirX: 0,\r\n                dirY: 0,\r\n                lastDirX: 0,\r\n                lastDirY: 0,\r\n                distAxX: 0,\r\n                distAxY: 0\r\n            };\r\n            this.isTouch = false;\r\n            this.moving = false;\r\n            this.dragEl = null;\r\n            this.dragRootEl = null;\r\n            this.dragDepth = 0;\r\n            this.hasNewRoot = false;\r\n            this.pointEl = null;\r\n        },\r\n\r\n        expandItem: function(li) {\r\n            li.removeClass(this.options.collapsedClass);\r\n        },\r\n\r\n        collapseItem: function(li) {\r\n            var lists = li.children(this.options.listNodeName);\r\n            if (lists.length) {\r\n                li.addClass(this.options.collapsedClass);\r\n            }\r\n        },\r\n\r\n        expandAll: function() {\r\n            var list = this;\r\n            list.el.find(list.options.itemNodeName).each(function() {\r\n                list.expandItem($(this));\r\n            });\r\n        },\r\n\r\n        collapseAll: function() {\r\n            var list = this;\r\n            list.el.find(list.options.itemNodeName).each(function() {\r\n                list.collapseItem($(this));\r\n            });\r\n        },\r\n\r\n        setParent: function(li) {\r\n            //Check if li is an element of itemNodeName type and has children\r\n            if (li.is(this.options.itemNodeName) && li.children(this.options.listNodeName).length) {\r\n                // make sure NOT showing two or more sets data-action buttons\r\n                li.children('[data-action]').remove();\r\n                li.prepend($(this.options.expandBtnHTML));\r\n                li.prepend($(this.options.collapseBtnHTML));\r\n            }\r\n        },\r\n\r\n        unsetParent: function(li) {\r\n            li.removeClass(this.options.collapsedClass);\r\n            li.children('[data-action]').remove();\r\n            li.children(this.options.listNodeName).remove();\r\n        },\r\n\r\n        dragStart: function(e) {\r\n            var mouse = this.mouse,\r\n                target = $(e.target),\r\n                dragItem = target.closest(this.options.itemNodeName),\r\n                position = {\r\n                    top  : e.pageY,\r\n                    left : e.pageX\r\n                };\r\n\r\n            var continueExecution = this.options.onDragStart.call(this, this.el, dragItem, position);\r\n\r\n            if (typeof continueExecution !== 'undefined' && continueExecution === false) {\r\n                return;\r\n            }\r\n\r\n            this.placeEl.css('height', dragItem.height());\r\n\r\n            mouse.offsetX = e.pageX - dragItem.offset().left;\r\n            mouse.offsetY = e.pageY - dragItem.offset().top;\r\n            mouse.startX = mouse.lastX = e.pageX;\r\n            mouse.startY = mouse.lastY = e.pageY;\r\n\r\n            this.dragRootEl = this.el;\r\n            this.dragEl = $(document.createElement(this.options.listNodeName)).addClass(this.options.listClass + ' ' + this.options.dragClass);\r\n            this.dragEl.css('width', dragItem.outerWidth());\r\n\r\n            this.setIndexOfItem(dragItem);\r\n\r\n            // fix for zepto.js\r\n            //dragItem.after(this.placeEl).detach().appendTo(this.dragEl);\r\n            dragItem.after(this.placeEl);\r\n            dragItem[0].parentNode.removeChild(dragItem[0]);\r\n            dragItem.appendTo(this.dragEl);\r\n\r\n            $(document.body).append(this.dragEl);\r\n            this.dragEl.css({\r\n                'left': e.pageX - mouse.offsetX,\r\n                'top': e.pageY - mouse.offsetY\r\n            });\r\n            // total depth of dragging item\r\n            var i, depth,\r\n                items = this.dragEl.find(this.options.itemNodeName);\r\n            for (i = 0; i < items.length; i++) {\r\n                depth = $(items[i]).parents(this.options.listNodeName).length;\r\n                if (depth > this.dragDepth) {\r\n                    this.dragDepth = depth;\r\n                }\r\n            }\r\n        },\r\n\r\n        //Create sublevel.\r\n        //  element : element which become parent\r\n        //  item    : something to place into new sublevel\r\n        createSubLevel: function(element, item) {\r\n            var list = $('<' + this.options.listNodeName + '/>').addClass(this.options.listClass);\r\n            if (item) list.append(item);\r\n            element.append(list);\r\n            this.setParent(element);\r\n            return list;\r\n        },\r\n\r\n        setIndexOfItem: function(item, index) {\r\n            index = index || [];\r\n\r\n            index.unshift(item.index());\r\n\r\n            if ($(item[0].parentNode)[0] !== this.dragRootEl[0]) {\r\n                this.setIndexOfItem($(item[0].parentNode), index);\r\n            }\r\n            else {\r\n                this.dragEl.data('indexOfItem', index);\r\n            }\r\n        },\r\n\r\n        restoreItemAtIndex: function(dragElement, indexArray) {\r\n            var currentEl = this.el,\r\n                lastIndex = indexArray.length - 1;\r\n\r\n            //Put drag element at current element position.\r\n            function placeElement(currentEl, dragElement) {\r\n                if (indexArray[lastIndex] === 0) {\r\n                    $(currentEl).prepend(dragElement.clone(true)); //using true saves added to element events.\r\n                }\r\n                else {\r\n                    $(currentEl.children[indexArray[lastIndex] - 1]).after(dragElement.clone(true)); //using true saves added to element events.\r\n                }\r\n            }\r\n            //Diggin through indexArray to get home for dragElement.\r\n            for (var i = 0; i < indexArray.length; i++) {\r\n                if (lastIndex === parseInt(i)) {\r\n                    placeElement(currentEl, dragElement);\r\n                    return;\r\n                }\r\n                //element can have no indexes, so we have to use conditional here to avoid errors.\r\n                //if element doesn't exist we defenetly need to add new list.\r\n                var element = (currentEl[0]) ? currentEl[0] : currentEl;\r\n                var nextEl  = element.children[indexArray[i]];\r\n                currentEl   = (!nextEl) ? this.createSubLevel($(element)) : nextEl;\r\n            }\r\n        },\r\n\r\n        dragStop: function(e) {\r\n            // fix for zepto.js\r\n            //this.placeEl.replaceWith(this.dragEl.children(this.options.itemNodeName + ':first').detach());\r\n            var position = {\r\n                top  : e.pageY,\r\n                left : e.pageX\r\n            };\r\n            //Get indexArray of item at drag start.\r\n            var srcIndex = this.dragEl.data('indexOfItem');\r\n\r\n            var el = this.dragEl.children(this.options.itemNodeName).first();\r\n\r\n            el[0].parentNode.removeChild(el[0]);\r\n\r\n            this.dragEl.remove(); //Remove dragEl, cause it can affect on indexing in html collection.\r\n\r\n            //Before drag stop callback\r\n            var continueExecution = this.options.beforeDragStop.call(this, this.el, el, this.placeEl.parent());\r\n            if (typeof continueExecution !== 'undefined' && continueExecution === false) {\r\n                var parent = this.placeEl.parent();\r\n                this.placeEl.remove();\r\n                if (!parent.children().length) {\r\n                    this.unsetParent(parent.parent());\r\n                }\r\n                this.restoreItemAtIndex(el, srcIndex);\r\n                this.reset();\r\n                return;\r\n            }\r\n\r\n            this.placeEl.replaceWith(el);\r\n\r\n            if (this.hasNewRoot) {\r\n                if (this.options.fixed === true) {\r\n                    this.restoreItemAtIndex(el, srcIndex);\r\n                }\r\n                else {\r\n                    this.el.trigger('lostItem');\r\n                }\r\n                this.dragRootEl.trigger('gainedItem');\r\n            }\r\n            else {\r\n                this.dragRootEl.trigger('change');\r\n            }\r\n\r\n            this.options.callback.call(this, this.dragRootEl, el, position);\r\n\r\n            this.reset();\r\n        },\r\n\r\n        dragMove: function(e) {\r\n            var list, parent, prev, next, depth,\r\n                opt = this.options,\r\n                mouse = this.mouse;\r\n\r\n            this.dragEl.css({\r\n                'left': e.pageX - mouse.offsetX,\r\n                'top': e.pageY - mouse.offsetY\r\n            });\r\n\r\n            // mouse position last events\r\n            mouse.lastX = mouse.nowX;\r\n            mouse.lastY = mouse.nowY;\r\n            // mouse position this events\r\n            mouse.nowX = e.pageX;\r\n            mouse.nowY = e.pageY;\r\n            // distance mouse moved between events\r\n            mouse.distX = mouse.nowX - mouse.lastX;\r\n            mouse.distY = mouse.nowY - mouse.lastY;\r\n            // direction mouse was moving\r\n            mouse.lastDirX = mouse.dirX;\r\n            mouse.lastDirY = mouse.dirY;\r\n            // direction mouse is now moving (on both axis)\r\n            mouse.dirX = mouse.distX === 0 ? 0 : mouse.distX > 0 ? 1 : -1;\r\n            mouse.dirY = mouse.distY === 0 ? 0 : mouse.distY > 0 ? 1 : -1;\r\n            // axis mouse is now moving on\r\n            var newAx = Math.abs(mouse.distX) > Math.abs(mouse.distY) ? 1 : 0;\r\n\r\n            // do nothing on first move\r\n            if (!mouse.moving) {\r\n                mouse.dirAx = newAx;\r\n                mouse.moving = true;\r\n                return;\r\n            }\r\n\r\n            // do scrolling if enable\r\n            if (opt.scroll) {\r\n                if (typeof window.jQuery.fn.scrollParent !== 'undefined') {\r\n                    var scrolled = false;\r\n                    var scrollParent = this.el.scrollParent()[0];\r\n                    if (scrollParent !== document && scrollParent.tagName !== 'HTML') {\r\n                        if ((opt.scrollTriggers.bottom + scrollParent.offsetHeight) - e.pageY < opt.scrollSensitivity)\r\n                            scrollParent.scrollTop = scrolled = scrollParent.scrollTop + opt.scrollSpeed;\r\n                        else if (e.pageY - opt.scrollTriggers.top < opt.scrollSensitivity)\r\n                            scrollParent.scrollTop = scrolled = scrollParent.scrollTop - opt.scrollSpeed;\r\n\r\n                        if ((opt.scrollTriggers.right + scrollParent.offsetWidth) - e.pageX < opt.scrollSensitivity)\r\n                            scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft + opt.scrollSpeed;\r\n                        else if (e.pageX - opt.scrollTriggers.left < opt.scrollSensitivity)\r\n                            scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft - opt.scrollSpeed;\r\n                    } else {\r\n                        if (e.pageY - $(document).scrollTop() < opt.scrollSensitivity)\r\n                            scrolled = $(document).scrollTop($(document).scrollTop() - opt.scrollSpeed);\r\n                        else if ($(window).height() - (e.pageY - $(document).scrollTop()) < opt.scrollSensitivity)\r\n                            scrolled = $(document).scrollTop($(document).scrollTop() + opt.scrollSpeed);\r\n\r\n                        if (e.pageX - $(document).scrollLeft() < opt.scrollSensitivity)\r\n                            scrolled = $(document).scrollLeft($(document).scrollLeft() - opt.scrollSpeed);\r\n                        else if ($(window).width() - (e.pageX - $(document).scrollLeft()) < opt.scrollSensitivity)\r\n                            scrolled = $(document).scrollLeft($(document).scrollLeft() + opt.scrollSpeed);\r\n                    }\r\n                } else {\r\n                    console.warn('To use scrolling you need to have scrollParent() function, check documentation for more information');\r\n                }\r\n            }\r\n\r\n            if (this.scrollTimer) {\r\n                clearTimeout(this.scrollTimer);\r\n            }\r\n\r\n            if (opt.scroll && scrolled) {\r\n                this.scrollTimer = setTimeout(function() {\r\n                    $(window).trigger(e);\r\n                }, 10);\r\n            }\r\n\r\n            // calc distance moved on this axis (and direction)\r\n            if (mouse.dirAx !== newAx) {\r\n                mouse.distAxX = 0;\r\n                mouse.distAxY = 0;\r\n            }\r\n            else {\r\n                mouse.distAxX += Math.abs(mouse.distX);\r\n                if (mouse.dirX !== 0 && mouse.dirX !== mouse.lastDirX) {\r\n                    mouse.distAxX = 0;\r\n                }\r\n                mouse.distAxY += Math.abs(mouse.distY);\r\n                if (mouse.dirY !== 0 && mouse.dirY !== mouse.lastDirY) {\r\n                    mouse.distAxY = 0;\r\n                }\r\n            }\r\n            mouse.dirAx = newAx;\r\n\r\n            /**\r\n             * move horizontal\r\n             */\r\n            if (mouse.dirAx && mouse.distAxX >= opt.threshold) {\r\n                // reset move distance on x-axis for new phase\r\n                mouse.distAxX = 0;\r\n                prev = this.placeEl.prev(opt.itemNodeName);\r\n                // increase horizontal level if previous sibling exists, is not collapsed, and can have children\r\n                if (mouse.distX > 0 && prev.length && !prev.hasClass(opt.collapsedClass) && !prev.hasClass(opt.noChildrenClass)) {\r\n                    // cannot increase level when item above is collapsed\r\n                    list = prev.find(opt.listNodeName).last();\r\n                    // check if depth limit has reached\r\n                    depth = this.placeEl.parents(opt.listNodeName).length;\r\n                    if (depth + this.dragDepth <= opt.maxDepth) {\r\n                        // create new sub-level if one doesn't exist\r\n                        if (!list.length) {\r\n                            this.createSubLevel(prev, this.placeEl);\r\n                        }\r\n                        else {\r\n                            // else append to next level up\r\n                            list = prev.children(opt.listNodeName).last();\r\n                            list.append(this.placeEl);\r\n                        }\r\n                    }\r\n                }\r\n                // decrease horizontal level\r\n                if (mouse.distX < 0) {\r\n                    // we can't decrease a level if an item preceeds the current one\r\n                    next = this.placeEl.next(opt.itemNodeName);\r\n                    if (!next.length) {\r\n                        parent = this.placeEl.parent();\r\n                        this.placeEl.closest(opt.itemNodeName).after(this.placeEl);\r\n                        if (!parent.children().length) {\r\n                            this.unsetParent(parent.parent());\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            var isEmpty = false;\r\n\r\n            // find list item under cursor\r\n            if (!hasPointerEvents) {\r\n                this.dragEl[0].style.visibility = 'hidden';\r\n            }\r\n            this.pointEl = $(document.elementFromPoint(e.pageX - document.body.scrollLeft, e.pageY - (window.pageYOffset || document.documentElement.scrollTop)));\r\n            if (!hasPointerEvents) {\r\n                this.dragEl[0].style.visibility = 'visible';\r\n            }\r\n            if (this.pointEl.hasClass(opt.handleClass)) {\r\n                this.pointEl = this.pointEl.closest(opt.itemNodeName);\r\n            }\r\n            if (this.pointEl.hasClass(opt.emptyClass)) {\r\n                isEmpty = true;\r\n            }\r\n            else if (!this.pointEl.length || !this.pointEl.hasClass(opt.itemClass)) {\r\n                return;\r\n            }\r\n\r\n            // find parent list of item under cursor\r\n            var pointElRoot = this.pointEl.closest('.' + opt.rootClass),\r\n                isNewRoot = this.dragRootEl.data('nestable-id') !== pointElRoot.data('nestable-id');\r\n\r\n            /**\r\n             * move vertical\r\n             */\r\n            if (!mouse.dirAx || isNewRoot || isEmpty) {\r\n                // check if groups match if dragging over new root\r\n                if (isNewRoot && opt.group !== pointElRoot.data('nestable-group')) {\r\n                    return;\r\n                }\r\n\r\n                // fixed item's depth, use for some list has specific type, eg:'Volume, Section, Chapter ...'\r\n                if (this.options.fixedDepth && this.dragDepth + 1 !== this.pointEl.parents(opt.listNodeName).length) {\r\n                    return;\r\n                }\r\n\r\n                // check depth limit\r\n                depth = this.dragDepth - 1 + this.pointEl.parents(opt.listNodeName).length;\r\n                if (depth > opt.maxDepth) {\r\n                    return;\r\n                }\r\n                var before = e.pageY < (this.pointEl.offset().top + this.pointEl.height() / 2);\r\n                parent = this.placeEl.parent();\r\n                // if empty create new list to replace empty placeholder\r\n                if (isEmpty) {\r\n                    list = $(document.createElement(opt.listNodeName)).addClass(opt.listClass);\r\n                    list.append(this.placeEl);\r\n                    this.pointEl.replaceWith(list);\r\n                }\r\n                else if (before) {\r\n                    this.pointEl.before(this.placeEl);\r\n                }\r\n                else {\r\n                    this.pointEl.after(this.placeEl);\r\n                }\r\n                if (!parent.children().length) {\r\n                    this.unsetParent(parent.parent());\r\n                }\r\n                if (!this.dragRootEl.find(opt.itemNodeName).length) {\r\n                    this.appendEmptyElement(this.dragRootEl);\r\n                }\r\n                // parent root list has changed\r\n                this.dragRootEl = pointElRoot;\r\n                if (isNewRoot) {\r\n                    this.hasNewRoot = this.el[0] !== this.dragRootEl[0];\r\n                }\r\n            }\r\n        },\r\n\r\n        // Append the .dd-empty div to the list so it can be populated and styled\r\n        appendEmptyElement: function(element) {\r\n            element.append('<div class=\"' + this.options.emptyClass + '\"/>');\r\n        }\r\n    };\r\n\r\n    $.fn.nestable = function(params) {\r\n        var lists  = this,\r\n            retval = this,\r\n            args   = arguments;\r\n\r\n        if (!('Nestable' in window)) {\r\n            window.Nestable = {};\r\n            Nestable.counter = 0;\r\n        }\r\n\r\n        lists.each(function() {\r\n            var plugin = $(this).data(\"nestable\");\r\n\r\n            if (!plugin) {\r\n                Nestable.counter++;\r\n                $(this).data(\"nestable\", new Plugin(this, params));\r\n                $(this).data(\"nestable-id\", Nestable.counter);\r\n            }\r\n            else {\r\n                if (typeof params === 'string' && typeof plugin[params] === 'function') {\r\n                    if (args.length > 1){\r\n                        var pluginArgs = [];\r\n                        for (var i = 1; i < args.length; i++) {\r\n                            pluginArgs.push(args[i]);\r\n                        }\r\n                        retval = plugin[params].apply(plugin, pluginArgs);\r\n                    }\r\n                    else {\r\n                        retval = plugin[params]();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        return retval || lists;\r\n    };\r\n\r\n})(window.jQuery || window.Zepto, window, document);\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9Nb2R1bGVzL01lbnUvbm9kZV9tb2R1bGVzL25lc3RhYmxlMi9qcXVlcnkubmVzdGFibGUuanM/Yzg1NiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBLHlDQUF5QyxvREFBb0Q7QUFDN0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULHNDQUFzQztBQUN0Qyx5Q0FBeUM7QUFDekMsNENBQTRDO0FBQzVDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxrQ0FBa0M7O0FBRWxDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUEsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLCtCQUErQjtBQUMvQiw4QkFBOEI7QUFDOUIsOEJBQThCO0FBQzlCLGdDQUFnQztBQUNoQyxnQ0FBZ0M7QUFDaEM7O0FBRUEsa0VBQWtFLGVBQWUsRUFBRTtBQUNuRjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQSxrQ0FBa0M7O0FBRWxDO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDO0FBQzFDOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYix5Q0FBeUMsd0JBQXdCLEVBQUU7QUFDbkU7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsOEJBQThCLG1FQUFtRTtBQUNqRzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDs7QUFFQSwrQkFBK0I7QUFDL0I7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDs7QUFFQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxhQUFhOztBQUViOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBOztBQUVBOzs7QUFHQTtBQUNBO0FBQ0EsaUJBQWlCOztBQUVqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGtCQUFrQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esa0VBQWtFO0FBQ2xFO0FBQ0E7QUFDQSxvR0FBb0c7QUFDcEc7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHVCQUF1QjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBLGlDQUFpQzs7QUFFakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxpQkFBaUI7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBLENBQUMiLCJmaWxlIjoiLi9Nb2R1bGVzL01lbnUvbm9kZV9tb2R1bGVzL25lc3RhYmxlMi9qcXVlcnkubmVzdGFibGUuanMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcclxuICogTmVzdGFibGUgalF1ZXJ5IFBsdWdpbiAtIENvcHlyaWdodCAoYykgMjAxNCBSYW1vbiBTbWl0IC0gaHR0cHM6Ly9naXRodWIuY29tL1JhbW9uU21pdC9OZXN0YWJsZVxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHtcclxuICAgIHZhciBoYXNUb3VjaCA9ICdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogRGV0ZWN0IENTUyBwb2ludGVyLWV2ZW50cyBwcm9wZXJ0eVxyXG4gICAgICogZXZlbnRzIGFyZSBub3JtYWxseSBkaXNhYmxlZCBvbiB0aGUgZHJhZ2dpbmcgZWxlbWVudCB0byBhdm9pZCBjb25mbGljdHNcclxuICAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9hdXNpL0ZlYXR1cmUtZGV0ZWN0aW9uLXRlY2huaXF1ZS1mb3ItcG9pbnRlci1ldmVudHMvYmxvYi9tYXN0ZXIvbW9kZXJuaXpyLXBvaW50ZXJldmVudHMuanNcclxuICAgICAqL1xyXG4gICAgdmFyIGhhc1BvaW50ZXJFdmVudHMgPSAoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksXHJcbiAgICAgICAgICAgIGRvY0VsID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xyXG4gICAgICAgIGlmICghKCdwb2ludGVyRXZlbnRzJyBpbiBlbC5zdHlsZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbC5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ2F1dG8nO1xyXG4gICAgICAgIGVsLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAneCc7XHJcbiAgICAgICAgZG9jRWwuYXBwZW5kQ2hpbGQoZWwpO1xyXG4gICAgICAgIHZhciBzdXBwb3J0cyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlICYmIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsLCAnJykucG9pbnRlckV2ZW50cyA9PT0gJ2F1dG8nO1xyXG4gICAgICAgIGRvY0VsLnJlbW92ZUNoaWxkKGVsKTtcclxuICAgICAgICByZXR1cm4gISFzdXBwb3J0cztcclxuICAgIH0pKCk7XHJcblxyXG4gICAgdmFyIGRlZmF1bHRzID0ge1xyXG4gICAgICAgIGNvbnRlbnRDYWxsYmFjazogZnVuY3Rpb24oaXRlbSkge3JldHVybiBpdGVtLmNvbnRlbnQgfHwgJycgPyBpdGVtLmNvbnRlbnQgOiBpdGVtLmlkO30sXHJcbiAgICAgICAgbGlzdE5vZGVOYW1lOiAnb2wnLFxyXG4gICAgICAgIGl0ZW1Ob2RlTmFtZTogJ2xpJyxcclxuICAgICAgICBoYW5kbGVOb2RlTmFtZTogJ2RpdicsXHJcbiAgICAgICAgY29udGVudE5vZGVOYW1lOiAnc3BhbicsXHJcbiAgICAgICAgcm9vdENsYXNzOiAnZGQnLFxyXG4gICAgICAgIGxpc3RDbGFzczogJ2RkLWxpc3QnLFxyXG4gICAgICAgIGl0ZW1DbGFzczogJ2RkLWl0ZW0nLFxyXG4gICAgICAgIGRyYWdDbGFzczogJ2RkLWRyYWdlbCcsXHJcbiAgICAgICAgaGFuZGxlQ2xhc3M6ICdkZC1oYW5kbGUnLFxyXG4gICAgICAgIGNvbnRlbnRDbGFzczogJ2RkLWNvbnRlbnQnLFxyXG4gICAgICAgIGNvbGxhcHNlZENsYXNzOiAnZGQtY29sbGFwc2VkJyxcclxuICAgICAgICBwbGFjZUNsYXNzOiAnZGQtcGxhY2Vob2xkZXInLFxyXG4gICAgICAgIG5vRHJhZ0NsYXNzOiAnZGQtbm9kcmFnJyxcclxuICAgICAgICBub0NoaWxkcmVuQ2xhc3M6ICdkZC1ub2NoaWxkcmVuJyxcclxuICAgICAgICBlbXB0eUNsYXNzOiAnZGQtZW1wdHknLFxyXG4gICAgICAgIGV4cGFuZEJ0bkhUTUw6ICc8YnV0dG9uIGNsYXNzPVwiZGQtZXhwYW5kXCIgZGF0YS1hY3Rpb249XCJleHBhbmRcIiB0eXBlPVwiYnV0dG9uXCI+RXhwYW5kPC9idXR0b24+JyxcclxuICAgICAgICBjb2xsYXBzZUJ0bkhUTUw6ICc8YnV0dG9uIGNsYXNzPVwiZGQtY29sbGFwc2VcIiBkYXRhLWFjdGlvbj1cImNvbGxhcHNlXCIgdHlwZT1cImJ1dHRvblwiPkNvbGxhcHNlPC9idXR0b24+JyxcclxuICAgICAgICBncm91cDogMCxcclxuICAgICAgICBtYXhEZXB0aDogNSxcclxuICAgICAgICB0aHJlc2hvbGQ6IDIwLFxyXG4gICAgICAgIGZpeGVkRGVwdGg6IGZhbHNlLCAvL2ZpeGVkIGl0ZW0ncyBkZXB0aFxyXG4gICAgICAgIGZpeGVkOiBmYWxzZSxcclxuICAgICAgICBpbmNsdWRlQ29udGVudDogZmFsc2UsXHJcbiAgICAgICAgc2Nyb2xsOiBmYWxzZSxcclxuICAgICAgICBzY3JvbGxTZW5zaXRpdml0eTogMSxcclxuICAgICAgICBzY3JvbGxTcGVlZDogNSxcclxuICAgICAgICBzY3JvbGxUcmlnZ2Vyczoge1xyXG4gICAgICAgICAgICB0b3A6IDQwLFxyXG4gICAgICAgICAgICBsZWZ0OiA0MCxcclxuICAgICAgICAgICAgcmlnaHQ6IC00MCxcclxuICAgICAgICAgICAgYm90dG9tOiAtNDBcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVmZmVjdDoge1xyXG4gICAgICAgICAgICBhbmltYXRpb246ICdub25lJyxcclxuICAgICAgICAgICAgdGltZTogJ3Nsb3cnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24obCwgZSwgcCkge30sXHJcbiAgICAgICAgb25EcmFnU3RhcnQ6IGZ1bmN0aW9uKGwsIGUsIHApIHt9LFxyXG4gICAgICAgIGJlZm9yZURyYWdTdG9wOiBmdW5jdGlvbihsLCBlLCBwKSB7fSxcclxuICAgICAgICBsaXN0UmVuZGVyZXI6IGZ1bmN0aW9uKGNoaWxkcmVuLCBvcHRpb25zKSB7XHJcbiAgICAgICAgICAgIHZhciBodG1sID0gJzwnICsgb3B0aW9ucy5saXN0Tm9kZU5hbWUgKyAnIGNsYXNzPVwiJyArIG9wdGlvbnMubGlzdENsYXNzICsgJ1wiPic7XHJcbiAgICAgICAgICAgIGh0bWwgKz0gY2hpbGRyZW47XHJcbiAgICAgICAgICAgIGh0bWwgKz0gJzwvJyArIG9wdGlvbnMubGlzdE5vZGVOYW1lICsgJz4nO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGh0bWw7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBpdGVtUmVuZGVyZXI6IGZ1bmN0aW9uKGl0ZW1fYXR0cnMsIGNvbnRlbnQsIGNoaWxkcmVuLCBvcHRpb25zLCBpdGVtKSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtX2F0dHJzX3N0cmluZyA9ICQubWFwKGl0ZW1fYXR0cnMsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnICcgKyBrZXkgKyAnPVwiJyArIHZhbHVlICsgJ1wiJztcclxuICAgICAgICAgICAgfSkuam9pbignICcpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGh0bWwgPSAnPCcgKyBvcHRpb25zLml0ZW1Ob2RlTmFtZSArIGl0ZW1fYXR0cnNfc3RyaW5nICsgJz4nO1xyXG4gICAgICAgICAgICBodG1sICs9ICc8JyArIG9wdGlvbnMuaGFuZGxlTm9kZU5hbWUgKyAnIGNsYXNzPVwiJyArIG9wdGlvbnMuaGFuZGxlQ2xhc3MgKyAnXCI+JztcclxuICAgICAgICAgICAgaHRtbCArPSAnPCcgKyBvcHRpb25zLmNvbnRlbnROb2RlTmFtZSArICcgY2xhc3M9XCInICsgb3B0aW9ucy5jb250ZW50Q2xhc3MgKyAnXCI+JztcclxuICAgICAgICAgICAgaHRtbCArPSBjb250ZW50O1xyXG4gICAgICAgICAgICBodG1sICs9ICc8LycgKyBvcHRpb25zLmNvbnRlbnROb2RlTmFtZSArICc+JztcclxuICAgICAgICAgICAgaHRtbCArPSAnPC8nICsgb3B0aW9ucy5oYW5kbGVOb2RlTmFtZSArICc+JztcclxuICAgICAgICAgICAgaHRtbCArPSBjaGlsZHJlbjtcclxuICAgICAgICAgICAgaHRtbCArPSAnPC8nICsgb3B0aW9ucy5pdGVtTm9kZU5hbWUgKyAnPic7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gaHRtbDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIFBsdWdpbihlbGVtZW50LCBvcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy53ICA9ICQoZG9jdW1lbnQpO1xyXG4gICAgICAgIHRoaXMuZWwgPSAkKGVsZW1lbnQpO1xyXG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IGRlZmF1bHRzO1xyXG5cclxuICAgICAgICBpZiAob3B0aW9ucy5yb290Q2xhc3MgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLnJvb3RDbGFzcyAhPT0gJ2RkJykge1xyXG4gICAgICAgICAgICBvcHRpb25zLmxpc3RDbGFzcyAgICAgICA9IG9wdGlvbnMubGlzdENsYXNzID8gb3B0aW9ucy5saXN0Q2xhc3MgOiBvcHRpb25zLnJvb3RDbGFzcyArICctbGlzdCc7XHJcbiAgICAgICAgICAgIG9wdGlvbnMuaXRlbUNsYXNzICAgICAgID0gb3B0aW9ucy5pdGVtQ2xhc3MgPyBvcHRpb25zLml0ZW1DbGFzcyA6IG9wdGlvbnMucm9vdENsYXNzICsgJy1pdGVtJztcclxuICAgICAgICAgICAgb3B0aW9ucy5kcmFnQ2xhc3MgICAgICAgPSBvcHRpb25zLmRyYWdDbGFzcyA/IG9wdGlvbnMuZHJhZ0NsYXNzIDogb3B0aW9ucy5yb290Q2xhc3MgKyAnLWRyYWdlbCc7XHJcbiAgICAgICAgICAgIG9wdGlvbnMuaGFuZGxlQ2xhc3MgICAgID0gb3B0aW9ucy5oYW5kbGVDbGFzcyA/IG9wdGlvbnMuaGFuZGxlQ2xhc3MgOiBvcHRpb25zLnJvb3RDbGFzcyArICctaGFuZGxlJztcclxuICAgICAgICAgICAgb3B0aW9ucy5jb2xsYXBzZWRDbGFzcyAgPSBvcHRpb25zLmNvbGxhcHNlZENsYXNzID8gb3B0aW9ucy5jb2xsYXBzZWRDbGFzcyA6IG9wdGlvbnMucm9vdENsYXNzICsgJy1jb2xsYXBzZWQnO1xyXG4gICAgICAgICAgICBvcHRpb25zLnBsYWNlQ2xhc3MgICAgICA9IG9wdGlvbnMucGxhY2VDbGFzcyA/IG9wdGlvbnMucGxhY2VDbGFzcyA6IG9wdGlvbnMucm9vdENsYXNzICsgJy1wbGFjZWhvbGRlcic7XHJcbiAgICAgICAgICAgIG9wdGlvbnMubm9EcmFnQ2xhc3MgICAgID0gb3B0aW9ucy5ub0RyYWdDbGFzcyA/IG9wdGlvbnMubm9EcmFnQ2xhc3MgOiBvcHRpb25zLnJvb3RDbGFzcyArICctbm9kcmFnJztcclxuICAgICAgICAgICAgb3B0aW9ucy5ub0NoaWxkcmVuQ2xhc3MgPSBvcHRpb25zLm5vQ2hpbGRyZW5DbGFzcyA/IG9wdGlvbnMubm9DaGlsZHJlbkNsYXNzIDogb3B0aW9ucy5yb290Q2xhc3MgKyAnLW5vY2hpbGRyZW4nO1xyXG4gICAgICAgICAgICBvcHRpb25zLmVtcHR5Q2xhc3MgICAgICA9IG9wdGlvbnMuZW1wdHlDbGFzcyA/IG9wdGlvbnMuZW1wdHlDbGFzcyA6IG9wdGlvbnMucm9vdENsYXNzICsgJy1lbXB0eSc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdHMsIG9wdGlvbnMpO1xyXG5cclxuICAgICAgICAvLyBidWlsZCBIVE1MIGZyb20gc2VyaWFsaXplZCBKU09OIGlmIHBhc3NlZFxyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuanNvbiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2J1aWxkKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmluaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBQbHVnaW4ucHJvdG90eXBlID0ge1xyXG5cclxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGxpc3QgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgbGlzdC5yZXNldCgpO1xyXG4gICAgICAgICAgICBsaXN0LmVsLmRhdGEoJ25lc3RhYmxlLWdyb3VwJywgdGhpcy5vcHRpb25zLmdyb3VwKTtcclxuICAgICAgICAgICAgbGlzdC5wbGFjZUVsID0gJCgnPGRpdiBjbGFzcz1cIicgKyBsaXN0Lm9wdGlvbnMucGxhY2VDbGFzcyArICdcIi8+Jyk7XHJcblxyXG4gICAgICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLmVsLmZpbmQobGlzdC5vcHRpb25zLml0ZW1Ob2RlTmFtZSk7XHJcbiAgICAgICAgICAgICQuZWFjaChpdGVtcywgZnVuY3Rpb24oaywgZWwpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gJChlbCksXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gaXRlbS5wYXJlbnQoKTtcclxuICAgICAgICAgICAgICAgIGxpc3Quc2V0UGFyZW50KGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudC5oYXNDbGFzcyhsaXN0Lm9wdGlvbnMuY29sbGFwc2VkQ2xhc3MpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5jb2xsYXBzZUl0ZW0ocGFyZW50LnBhcmVudCgpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBBcHBlbmQgdGhlIC5kZC1lbXB0eSBkaXYgaWYgdGhlIGxpc3QgZG9uJ3QgaGF2ZSBhbnkgaXRlbXMgb24gaW5pdFxyXG4gICAgICAgICAgICBpZiAoIWl0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRFbXB0eUVsZW1lbnQodGhpcy5lbCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxpc3QuZWwub24oJ2NsaWNrJywgJ2J1dHRvbicsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChsaXN0LmRyYWdFbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKGUuY3VycmVudFRhcmdldCksXHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gdGFyZ2V0LmRhdGEoJ2FjdGlvbicpLFxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0gPSB0YXJnZXQucGFyZW50cyhsaXN0Lm9wdGlvbnMuaXRlbU5vZGVOYW1lKS5lcSgwKTtcclxuICAgICAgICAgICAgICAgIGlmIChhY3Rpb24gPT09ICdjb2xsYXBzZScpIHtcclxuICAgICAgICAgICAgICAgICAgICBsaXN0LmNvbGxhcHNlSXRlbShpdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChhY3Rpb24gPT09ICdleHBhbmQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5leHBhbmRJdGVtKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBvblN0YXJ0RXZlbnQgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGFuZGxlID0gJChlLnRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWhhbmRsZS5oYXNDbGFzcyhsaXN0Lm9wdGlvbnMuaGFuZGxlQ2xhc3MpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZS5jbG9zZXN0KCcuJyArIGxpc3Qub3B0aW9ucy5ub0RyYWdDbGFzcykubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlID0gaGFuZGxlLmNsb3Nlc3QoJy4nICsgbGlzdC5vcHRpb25zLmhhbmRsZUNsYXNzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghaGFuZGxlLmxlbmd0aCB8fCBsaXN0LmRyYWdFbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBsaXN0LmlzVG91Y2ggPSAvXnRvdWNoLy50ZXN0KGUudHlwZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAobGlzdC5pc1RvdWNoICYmIGUudG91Y2hlcy5sZW5ndGggIT09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgbGlzdC5kcmFnU3RhcnQoZS50b3VjaGVzID8gZS50b3VjaGVzWzBdIDogZSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2YXIgb25Nb3ZlRXZlbnQgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobGlzdC5kcmFnRWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5kcmFnTW92ZShlLnRvdWNoZXMgPyBlLnRvdWNoZXNbMF0gOiBlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciBvbkVuZEV2ZW50ID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGxpc3QuZHJhZ0VsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxpc3QuZHJhZ1N0b3AoZS50b3VjaGVzID8gZS5jaGFuZ2VkVG91Y2hlc1swXSA6IGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgaWYgKGhhc1RvdWNoKSB7XHJcbiAgICAgICAgICAgICAgICBsaXN0LmVsWzBdLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBvblN0YXJ0RXZlbnQsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBvbk1vdmVFdmVudCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgb25FbmRFdmVudCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJywgb25FbmRFdmVudCwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsaXN0LmVsLm9uKCdtb3VzZWRvd24nLCBvblN0YXJ0RXZlbnQpO1xyXG4gICAgICAgICAgICBsaXN0Lncub24oJ21vdXNlbW92ZScsIG9uTW92ZUV2ZW50KTtcclxuICAgICAgICAgICAgbGlzdC53Lm9uKCdtb3VzZXVwJywgb25FbmRFdmVudCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgZGVzdHJveU5lc3RhYmxlID0gZnVuY3Rpb24oKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaGFzVG91Y2gpIHtcclxuICAgICAgICAgICAgICAgICAgICBsaXN0LmVsWzBdLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBvblN0YXJ0RXZlbnQsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgb25Nb3ZlRXZlbnQsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBvbkVuZEV2ZW50LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJywgb25FbmRFdmVudCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGxpc3QuZWwub2ZmKCdtb3VzZWRvd24nLCBvblN0YXJ0RXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgbGlzdC53Lm9mZignbW91c2Vtb3ZlJywgb25Nb3ZlRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgbGlzdC53Lm9mZignbW91c2V1cCcsIG9uRW5kRXZlbnQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGxpc3QuZWwub2ZmKCdjbGljaycpO1xyXG4gICAgICAgICAgICAgICAgbGlzdC5lbC51bmJpbmQoJ2Rlc3Ryb3ktbmVzdGFibGUnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsaXN0LmVsLmRhdGEoXCJuZXN0YWJsZVwiLCBudWxsKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGxpc3QuZWwuYmluZCgnZGVzdHJveS1uZXN0YWJsZScsIGRlc3Ryb3lOZXN0YWJsZSk7XHJcblxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uICgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLmVsLnRyaWdnZXIoJ2Rlc3Ryb3ktbmVzdGFibGUnKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBhZGQ6IGZ1bmN0aW9uIChpdGVtKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGxpc3RDbGFzc1NlbGVjdG9yID0gJy4nICsgdGhpcy5vcHRpb25zLmxpc3RDbGFzcztcclxuICAgICAgICAgICAgdmFyIHRyZWUgPSAkKHRoaXMuZWwpLmNoaWxkcmVuKGxpc3RDbGFzc1NlbGVjdG9yKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpdGVtLnBhcmVudF9pZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0cmVlID0gdHJlZS5maW5kKCdbZGF0YS1pZD1cIicgKyBpdGVtLnBhcmVudF9pZCArICdcIl0nKTtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnBhcmVudF9pZDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodHJlZS5jaGlsZHJlbihsaXN0Q2xhc3NTZWxlY3RvcikubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJlZSA9IHRyZWUuYXBwZW5kKHRoaXMub3B0aW9ucy5saXN0UmVuZGVyZXIoJycsIHRoaXMub3B0aW9ucykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRyZWUgPSB0cmVlLmZpbmQobGlzdENsYXNzU2VsZWN0b3IgKyAnOmZpcnN0Jyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFBhcmVudCh0cmVlLnBhcmVudCgpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdHJlZS5hcHBlbmQodGhpcy5fYnVpbGRJdGVtKGl0ZW0sIHRoaXMub3B0aW9ucykpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHJlcGxhY2U6IGZ1bmN0aW9uIChpdGVtKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGh0bWwgPSB0aGlzLl9idWlsZEl0ZW0oaXRlbSwgdGhpcy5vcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX2dldEl0ZW1CeUlkKGl0ZW0uaWQpXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZVdpdGgoaHRtbCk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLy9yZW1vdmVzIGl0ZW0gYW5kIGFkZGl0aW9uYWwgZWxlbWVudHMgZnJvbSBsaXN0XHJcbiAgICAgICAgcmVtb3ZlSXRlbTogZnVuY3Rpb24gKGl0ZW0pe1xyXG4gICAgICAgICAgICB2YXIgb3B0cyA9IHRoaXMub3B0aW9ucyxcclxuICAgICAgICAgICAgICAgIGVsICAgPSB0aGlzLmVsO1xyXG5cclxuICAgICAgICAgICAgLy8gcmVtb3ZlIGl0ZW1cclxuICAgICAgICAgICAgaXRlbSA9IGl0ZW0gfHwgdGhpcztcclxuICAgICAgICAgICAgaXRlbS5yZW1vdmUoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHJlbW92ZSBlbXB0eSBjaGlsZHJlbiBsaXN0c1xyXG4gICAgICAgICAgICB2YXIgZW1wdHlMaXN0c1NlbGVjdG9yID0gJy4nICsgb3B0cy5saXN0Q2xhc3NcclxuICAgICAgICAgICAgICAgICsgJyAuJyArIG9wdHMubGlzdENsYXNzICsgJzpub3QoOmhhcygqKSknO1xyXG4gICAgICAgICAgICAkKGVsKS5maW5kKGVtcHR5TGlzdHNTZWxlY3RvcikucmVtb3ZlKCk7XHJcblxyXG4gICAgICAgICAgICAvLyByZW1vdmUgYnV0dG9ucyBpZiBwYXJlbnRzIGRvIG5vdCBoYXZlIGNoaWxkcmVuXHJcbiAgICAgICAgICAgIHZhciBidXR0b25zU2VsZWN0b3IgPSAnW2RhdGEtYWN0aW9uPVwiZXhwYW5kXCJdLCBbZGF0YS1hY3Rpb249XCJjb2xsYXBzZVwiXSc7XHJcbiAgICAgICAgICAgICQoZWwpLmZpbmQoYnV0dG9uc1NlbGVjdG9yKS5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNpYmxpbmdzID0gJCh0aGlzKS5zaWJsaW5ncygnLicgKyBvcHRzLmxpc3RDbGFzcyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2libGluZ3MubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLy9yZW1vdmVzIGl0ZW0gYnkgaXRlbUlkIGFuZCBydW4gY2FsbGJhY2sgYXQgdGhlIGVuZFxyXG4gICAgICAgIHJlbW92ZTogZnVuY3Rpb24gKGl0ZW1JZCwgY2FsbGJhY2spXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgb3B0cyA9IHRoaXMub3B0aW9ucztcclxuICAgICAgICAgICAgdmFyIGxpc3QgPSB0aGlzO1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXMuX2dldEl0ZW1CeUlkKGl0ZW1JZCk7XHJcblxyXG4gICAgICAgICAgICAvL2FuaW1hdGlvbiBzdHlsZVxyXG4gICAgICAgICAgICB2YXIgYW5pbWF0aW9uID0gb3B0cy5lZmZlY3QuYW5pbWF0aW9uIHx8ICdmYWRlJztcclxuXHJcbiAgICAgICAgICAgIC8vYW5pbWF0aW9uIHRpbWVcclxuICAgICAgICAgICAgdmFyIHRpbWUgPSBvcHRzLmVmZmVjdC50aW1lIHx8ICdzbG93JztcclxuXHJcbiAgICAgICAgICAgIC8vYWRkIGZhZGVPdXQgZWZmZWN0IHdoZW4gcmVtb3ZpbmdcclxuICAgICAgICAgICAgaWYgKGFuaW1hdGlvbiA9PT0gJ2ZhZGUnKXtcclxuICAgICAgICAgICAgICAgIGl0ZW0uZmFkZU91dCh0aW1lLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIGxpc3QucmVtb3ZlSXRlbShpdGVtKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVJdGVtKGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLy9yZW1vdmVzIGFsbCBpdGVtcyBmcm9tIHRoZSBsaXN0IGFuZCBydW4gY2FsbGJhY2sgYXQgdGhlIGVuZFxyXG4gICAgICAgIHJlbW92ZUFsbDogZnVuY3Rpb24oY2FsbGJhY2spe1xyXG5cclxuICAgICAgICAgICAgdmFyIGxpc3QgID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIG9wdHMgID0gdGhpcy5vcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgbm9kZSAgPSBsaXN0LmVsLmZpbmQob3B0cy5saXN0Tm9kZU5hbWUpLmZpcnN0KCksXHJcbiAgICAgICAgICAgICAgICBpdGVtcyA9IG5vZGUuY2hpbGRyZW4ob3B0cy5pdGVtTm9kZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgLy9hbmltYXRpb24gc3R5bGVcclxuICAgICAgICAgICAgdmFyIGFuaW1hdGlvbiA9IG9wdHMuZWZmZWN0LmFuaW1hdGlvbiB8fCAnZmFkZSc7XHJcblxyXG4gICAgICAgICAgICAvL2FuaW1hdGlvbiB0aW1lXHJcbiAgICAgICAgICAgIHZhciB0aW1lID0gb3B0cy5lZmZlY3QudGltZSB8fCAnc2xvdyc7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiByZW1vdmUoKXtcclxuICAgICAgICAgICAgICAgIC8vUmVtb3ZlcyBlYWNoIGl0ZW0gYW5kIGl0cyBjaGlsZHJlbi5cclxuICAgICAgICAgICAgICAgIGl0ZW1zLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5yZW1vdmVJdGVtKCQodGhpcykpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvL05vdyB3ZSBjYW4gYWdhaW4gc2hvdyBvdXIgbm9kZSBlbGVtZW50XHJcbiAgICAgICAgICAgICAgICBub2RlLnNob3coKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9hZGQgZmFkZU91dCBlZmZlY3Qgd2hlbiByZW1vdmluZ1xyXG4gICAgICAgICAgICBpZiAoYW5pbWF0aW9uID09PSAnZmFkZScpe1xyXG4gICAgICAgICAgICAgICAgbm9kZS5mYWRlT3V0KHRpbWUsIHJlbW92ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZW1vdmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIF9nZXRJdGVtQnlJZDogZnVuY3Rpb24oaXRlbUlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMuZWwpLmNoaWxkcmVuKCcuJyArIHRoaXMub3B0aW9ucy5saXN0Q2xhc3MpXHJcbiAgICAgICAgICAgICAgICAuZmluZCgnW2RhdGEtaWQ9XCInICsgaXRlbUlkICsgJ1wiXScpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIF9idWlsZDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBqc29uID0gdGhpcy5vcHRpb25zLmpzb247XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGpzb24gPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICBqc29uID0gSlNPTi5wYXJzZShqc29uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJCh0aGlzLmVsKS5odG1sKHRoaXMuX2J1aWxkTGlzdChqc29uLCB0aGlzLm9wdGlvbnMpKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBfYnVpbGRMaXN0OiBmdW5jdGlvbihpdGVtcywgb3B0aW9ucykge1xyXG4gICAgICAgICAgICBpZiAoIWl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9ICcnO1xyXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG4gICAgICAgICAgICAkLmVhY2goaXRlbXMsIGZ1bmN0aW9uKGluZGV4LCBzdWIpIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuICs9IHRoYXQuX2J1aWxkSXRlbShzdWIsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmxpc3RSZW5kZXJlcihjaGlsZHJlbiwgb3B0aW9ucyk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgX2J1aWxkSXRlbTogZnVuY3Rpb24oaXRlbSwgb3B0aW9ucykge1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBlc2NhcGVIdG1sKHRleHQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtYXAgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJyYnOiAnJmFtcDsnLFxyXG4gICAgICAgICAgICAgICAgICAgICc8JzogJyZsdDsnLFxyXG4gICAgICAgICAgICAgICAgICAgICc+JzogJyZndDsnLFxyXG4gICAgICAgICAgICAgICAgICAgICdcIic6ICcmcXVvdDsnLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiJ1wiOiAnJiMwMzk7J1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGV4dCArIFwiXCIucmVwbGFjZSgvWyY8PlwiJ10vZywgZnVuY3Rpb24obSkgeyByZXR1cm4gbWFwW21dOyB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZmlsdGVyQ2xhc3NlcyhjbGFzc2VzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV3X2NsYXNzZXMgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBrIGluIGNsYXNzZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlc1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld19jbGFzc2VzW2NsYXNzZXNba11dID0gY2xhc3Nlc1trXTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3X2NsYXNzZXM7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUNsYXNzZXNTdHJpbmcoaXRlbSwgb3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNsYXNzZXMgPSBpdGVtLmNsYXNzZXMgfHwge307XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjbGFzc2VzID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzZXMgPSBbY2xhc3Nlc107XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1fY2xhc3NlcyA9IGZpbHRlckNsYXNzZXMoY2xhc3Nlcyk7XHJcbiAgICAgICAgICAgICAgICBpdGVtX2NsYXNzZXNbb3B0aW9ucy5pdGVtQ2xhc3NdID0gb3B0aW9ucy5pdGVtQ2xhc3M7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIGNsYXNzIHN0cmluZ1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICQubWFwKGl0ZW1fY2xhc3NlcywgZnVuY3Rpb24odmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDtcclxuICAgICAgICAgICAgICAgIH0pLmpvaW4oJyAnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlRGF0YUF0dHJzKGF0dHIpIHtcclxuICAgICAgICAgICAgICAgIGF0dHIgPSAkLmV4dGVuZCh7fSwgYXR0cik7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVsZXRlIGF0dHIuY2hpbGRyZW47XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgYXR0ci5jbGFzc2VzO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIGF0dHIuY29udGVudDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YV9hdHRycyA9IHt9O1xyXG5cclxuICAgICAgICAgICAgICAgICQuZWFjaChhdHRyLCBmdW5jdGlvbihrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBkYXRhX2F0dHJzW1wiZGF0YS1cIiArIGtleV0gPSBlc2NhcGVIdG1sKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhX2F0dHJzO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgaXRlbV9hdHRycyA9IGNyZWF0ZURhdGFBdHRycyhpdGVtKTtcclxuICAgICAgICAgICAgaXRlbV9hdHRyc1tcImNsYXNzXCJdID0gY3JlYXRlQ2xhc3Nlc1N0cmluZyhpdGVtLCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBjb250ZW50ID0gb3B0aW9ucy5jb250ZW50Q2FsbGJhY2soaXRlbSk7XHJcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuX2J1aWxkTGlzdChpdGVtLmNoaWxkcmVuLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgdmFyIGh0bWwgPSAkKG9wdGlvbnMuaXRlbVJlbmRlcmVyKGl0ZW1fYXR0cnMsIGNvbnRlbnQsIGNoaWxkcmVuLCBvcHRpb25zLCBpdGVtKSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNldFBhcmVudChodG1sKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBodG1sWzBdLm91dGVySFRNTDtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBzZXJpYWxpemU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgZGF0YSwgbGlzdCA9IHRoaXMsIHN0ZXAgPSBmdW5jdGlvbihsZXZlbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFycmF5ID0gW10sXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXMgPSBsZXZlbC5jaGlsZHJlbihsaXN0Lm9wdGlvbnMuaXRlbU5vZGVOYW1lKTtcclxuICAgICAgICAgICAgICAgIGl0ZW1zLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpID0gJCh0aGlzKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9ICQuZXh0ZW5kKHt9LCBsaS5kYXRhKCkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWIgPSBsaS5jaGlsZHJlbihsaXN0Lm9wdGlvbnMubGlzdE5vZGVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3Qub3B0aW9ucy5pbmNsdWRlQ29udGVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IGxpLmZpbmQoJy4nICsgbGlzdC5vcHRpb25zLmNvbnRlbnRDbGFzcykuaHRtbCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY29udGVudCA9IGNvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdWIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY2hpbGRyZW4gPSBzdGVwKHN1Yik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGFycmF5LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhcnJheTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgZGF0YSA9IHN0ZXAobGlzdC5lbC5maW5kKGxpc3Qub3B0aW9ucy5saXN0Tm9kZU5hbWUpLmZpcnN0KCkpO1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBhc05lc3RlZFNldDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBsaXN0ID0gdGhpcywgbyA9IGxpc3Qub3B0aW9ucywgZGVwdGggPSAtMSwgcmV0ID0gW10sIGxmdCA9IDE7XHJcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IGxpc3QuZWwuZmluZChvLmxpc3ROb2RlTmFtZSkuZmlyc3QoKS5jaGlsZHJlbihvLml0ZW1Ob2RlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICBpdGVtcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGxmdCA9IHRyYXZlcnNlKHRoaXMsIGRlcHRoICsgMSwgbGZ0KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXQgPSByZXQuc29ydChmdW5jdGlvbihhLGIpeyByZXR1cm4gKGEubGZ0IC0gYi5sZnQpOyB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHRyYXZlcnNlKGl0ZW0sIGRlcHRoLCBsZnQpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZ3QgPSBsZnQgKyAxLCBpZCwgcGlkO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkKGl0ZW0pLmNoaWxkcmVuKG8ubGlzdE5vZGVOYW1lKS5jaGlsZHJlbihvLml0ZW1Ob2RlTmFtZSkubGVuZ3RoID4gMCApIHtcclxuICAgICAgICAgICAgICAgICAgICBkZXB0aCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICQoaXRlbSkuY2hpbGRyZW4oby5saXN0Tm9kZU5hbWUpLmNoaWxkcmVuKG8uaXRlbU5vZGVOYW1lKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmd0ID0gdHJhdmVyc2UoJCh0aGlzKSwgZGVwdGgsIHJndCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVwdGgtLTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZCA9ICQoaXRlbSkuYXR0cignZGF0YS1pZCcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzSW50KGlkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkID0gcGFyc2VJbnQoaWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHBpZCA9ICQoaXRlbSkucGFyZW50KG8ubGlzdE5vZGVOYW1lKS5wYXJlbnQoby5pdGVtTm9kZU5hbWUpLmF0dHIoJ2RhdGEtaWQnKSB8fCAnJztcclxuICAgICAgICAgICAgICAgIGlmIChpc0ludChwaWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQgPSBwYXJzZUludChwaWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldC5wdXNoKHtcImlkXCI6IGlkLCBcInBhcmVudF9pZFwiOiBwaWQsIFwiZGVwdGhcIjogZGVwdGgsIFwibGZ0XCI6IGxmdCwgXCJyZ3RcIjogcmd0fSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbGZ0ID0gcmd0ICsgMTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBsZnQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGlzSW50KHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJC5pc051bWVyaWModmFsdWUpICYmIE1hdGguZmxvb3IodmFsdWUpID09IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgcmV0dXJuT3B0aW9uczogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnM7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgc2VyaWFsaXNlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VyaWFsaXplKCk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgdG9IaWVyYXJjaHk6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBvID0gJC5leHRlbmQoe30sIHRoaXMub3B0aW9ucywgb3B0aW9ucyksXHJcbiAgICAgICAgICAgICAgICByZXQgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICQodGhpcy5lbGVtZW50KS5jaGlsZHJlbihvLml0ZW1zKS5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxldmVsID0gX3JlY3Vyc2l2ZUl0ZW1zKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgcmV0LnB1c2gobGV2ZWwpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXQ7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBfcmVjdXJzaXZlSXRlbXMoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGlkID0gKCQoaXRlbSkuYXR0cihvLmF0dHJpYnV0ZSB8fCAnaWQnKSB8fCAnJykubWF0Y2goby5leHByZXNzaW9uIHx8ICgvKC4rKVstPV9dKC4rKS8pKTtcclxuICAgICAgICAgICAgICAgIGlmIChpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50SXRlbSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiOiBpZFsyXVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoaXRlbSkuY2hpbGRyZW4oby5saXN0VHlwZSkuY2hpbGRyZW4oby5pdGVtcykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50SXRlbS5jaGlsZHJlbiA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKGl0ZW0pLmNoaWxkcmVuKG8ubGlzdFR5cGUpLmNoaWxkcmVuKG8uaXRlbXMpLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGV2ZWwgPSBfcmVjdXJzaXZlSXRlbXModGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50SXRlbS5jaGlsZHJlbi5wdXNoKGxldmVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50SXRlbTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHRvQXJyYXk6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIG8gPSAkLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLCB0aGlzKSxcclxuICAgICAgICAgICAgICAgIHNEZXB0aCA9IG8uc3RhcnREZXB0aENvdW50IHx8IDAsXHJcbiAgICAgICAgICAgICAgICByZXQgPSBbXSxcclxuICAgICAgICAgICAgICAgIGxlZnQgPSAyLFxyXG4gICAgICAgICAgICAgICAgbGlzdCA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gbGlzdC5lbC5maW5kKGxpc3Qub3B0aW9ucy5saXN0Tm9kZU5hbWUpLmZpcnN0KCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgaXRlbXMgPSBlbGVtZW50LmNoaWxkcmVuKGxpc3Qub3B0aW9ucy5pdGVtTm9kZU5hbWUpO1xyXG4gICAgICAgICAgICBpdGVtcy5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgbGVmdCA9IF9yZWN1cnNpdmVBcnJheSgkKHRoaXMpLCBzRGVwdGggKyAxLCBsZWZ0KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXQgPSByZXQuc29ydChmdW5jdGlvbihhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKGEubGVmdCAtIGIubGVmdCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIF9yZWN1cnNpdmVBcnJheShpdGVtLCBkZXB0aCwgbGVmdCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByaWdodCA9IGxlZnQgKyAxLFxyXG4gICAgICAgICAgICAgICAgICAgIGlkLFxyXG4gICAgICAgICAgICAgICAgICAgIHBpZDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5jaGlsZHJlbihvLm9wdGlvbnMubGlzdE5vZGVOYW1lKS5jaGlsZHJlbihvLm9wdGlvbnMuaXRlbU5vZGVOYW1lKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVwdGgrKztcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLmNoaWxkcmVuKG8ub3B0aW9ucy5saXN0Tm9kZU5hbWUpLmNoaWxkcmVuKG8ub3B0aW9ucy5pdGVtTm9kZU5hbWUpLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0gX3JlY3Vyc2l2ZUFycmF5KCQodGhpcyksIGRlcHRoLCByaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVwdGgtLTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZCA9IGl0ZW0uZGF0YSgpLmlkO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZGVwdGggPT09IHNEZXB0aCArIDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBwaWQgPSBvLnJvb3RJRDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnRJdGVtID0gKGl0ZW0ucGFyZW50KG8ub3B0aW9ucy5saXN0Tm9kZU5hbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wYXJlbnQoby5vcHRpb25zLml0ZW1Ob2RlTmFtZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGlkID0gcGFyZW50SXRlbS5pZDtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImlkXCI6IGlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInBhcmVudF9pZFwiOiBwaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVwdGhcIjogZGVwdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGVmdFwiOiBsZWZ0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJpZ2h0XCI6IHJpZ2h0XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbGVmdCA9IHJpZ2h0ICsgMTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBsZWZ0O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdGhpcy5tb3VzZSA9IHtcclxuICAgICAgICAgICAgICAgIG9mZnNldFg6IDAsXHJcbiAgICAgICAgICAgICAgICBvZmZzZXRZOiAwLFxyXG4gICAgICAgICAgICAgICAgc3RhcnRYOiAwLFxyXG4gICAgICAgICAgICAgICAgc3RhcnRZOiAwLFxyXG4gICAgICAgICAgICAgICAgbGFzdFg6IDAsXHJcbiAgICAgICAgICAgICAgICBsYXN0WTogMCxcclxuICAgICAgICAgICAgICAgIG5vd1g6IDAsXHJcbiAgICAgICAgICAgICAgICBub3dZOiAwLFxyXG4gICAgICAgICAgICAgICAgZGlzdFg6IDAsXHJcbiAgICAgICAgICAgICAgICBkaXN0WTogMCxcclxuICAgICAgICAgICAgICAgIGRpckF4OiAwLFxyXG4gICAgICAgICAgICAgICAgZGlyWDogMCxcclxuICAgICAgICAgICAgICAgIGRpclk6IDAsXHJcbiAgICAgICAgICAgICAgICBsYXN0RGlyWDogMCxcclxuICAgICAgICAgICAgICAgIGxhc3REaXJZOiAwLFxyXG4gICAgICAgICAgICAgICAgZGlzdEF4WDogMCxcclxuICAgICAgICAgICAgICAgIGRpc3RBeFk6IDBcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5pc1RvdWNoID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMubW92aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuZHJhZ0VsID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5kcmFnUm9vdEVsID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5kcmFnRGVwdGggPSAwO1xyXG4gICAgICAgICAgICB0aGlzLmhhc05ld1Jvb3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5wb2ludEVsID0gbnVsbDtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBleHBhbmRJdGVtOiBmdW5jdGlvbihsaSkge1xyXG4gICAgICAgICAgICBsaS5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuY29sbGFwc2VkQ2xhc3MpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGNvbGxhcHNlSXRlbTogZnVuY3Rpb24obGkpIHtcclxuICAgICAgICAgICAgdmFyIGxpc3RzID0gbGkuY2hpbGRyZW4odGhpcy5vcHRpb25zLmxpc3ROb2RlTmFtZSk7XHJcbiAgICAgICAgICAgIGlmIChsaXN0cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGxpLmFkZENsYXNzKHRoaXMub3B0aW9ucy5jb2xsYXBzZWRDbGFzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBleHBhbmRBbGw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgbGlzdCA9IHRoaXM7XHJcbiAgICAgICAgICAgIGxpc3QuZWwuZmluZChsaXN0Lm9wdGlvbnMuaXRlbU5vZGVOYW1lKS5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgbGlzdC5leHBhbmRJdGVtKCQodGhpcykpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBjb2xsYXBzZUFsbDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBsaXN0ID0gdGhpcztcclxuICAgICAgICAgICAgbGlzdC5lbC5maW5kKGxpc3Qub3B0aW9ucy5pdGVtTm9kZU5hbWUpLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBsaXN0LmNvbGxhcHNlSXRlbSgkKHRoaXMpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgc2V0UGFyZW50OiBmdW5jdGlvbihsaSkge1xyXG4gICAgICAgICAgICAvL0NoZWNrIGlmIGxpIGlzIGFuIGVsZW1lbnQgb2YgaXRlbU5vZGVOYW1lIHR5cGUgYW5kIGhhcyBjaGlsZHJlblxyXG4gICAgICAgICAgICBpZiAobGkuaXModGhpcy5vcHRpb25zLml0ZW1Ob2RlTmFtZSkgJiYgbGkuY2hpbGRyZW4odGhpcy5vcHRpb25zLmxpc3ROb2RlTmFtZSkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgTk9UIHNob3dpbmcgdHdvIG9yIG1vcmUgc2V0cyBkYXRhLWFjdGlvbiBidXR0b25zXHJcbiAgICAgICAgICAgICAgICBsaS5jaGlsZHJlbignW2RhdGEtYWN0aW9uXScpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgbGkucHJlcGVuZCgkKHRoaXMub3B0aW9ucy5leHBhbmRCdG5IVE1MKSk7XHJcbiAgICAgICAgICAgICAgICBsaS5wcmVwZW5kKCQodGhpcy5vcHRpb25zLmNvbGxhcHNlQnRuSFRNTCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgdW5zZXRQYXJlbnQ6IGZ1bmN0aW9uKGxpKSB7XHJcbiAgICAgICAgICAgIGxpLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5jb2xsYXBzZWRDbGFzcyk7XHJcbiAgICAgICAgICAgIGxpLmNoaWxkcmVuKCdbZGF0YS1hY3Rpb25dJykucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIGxpLmNoaWxkcmVuKHRoaXMub3B0aW9ucy5saXN0Tm9kZU5hbWUpLnJlbW92ZSgpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGRyYWdTdGFydDogZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICB2YXIgbW91c2UgPSB0aGlzLm1vdXNlLFxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gJChlLnRhcmdldCksXHJcbiAgICAgICAgICAgICAgICBkcmFnSXRlbSA9IHRhcmdldC5jbG9zZXN0KHRoaXMub3B0aW9ucy5pdGVtTm9kZU5hbWUpLFxyXG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9wICA6IGUucGFnZVksXHJcbiAgICAgICAgICAgICAgICAgICAgbGVmdCA6IGUucGFnZVhcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2YXIgY29udGludWVFeGVjdXRpb24gPSB0aGlzLm9wdGlvbnMub25EcmFnU3RhcnQuY2FsbCh0aGlzLCB0aGlzLmVsLCBkcmFnSXRlbSwgcG9zaXRpb24pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb250aW51ZUV4ZWN1dGlvbiAhPT0gJ3VuZGVmaW5lZCcgJiYgY29udGludWVFeGVjdXRpb24gPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMucGxhY2VFbC5jc3MoJ2hlaWdodCcsIGRyYWdJdGVtLmhlaWdodCgpKTtcclxuXHJcbiAgICAgICAgICAgIG1vdXNlLm9mZnNldFggPSBlLnBhZ2VYIC0gZHJhZ0l0ZW0ub2Zmc2V0KCkubGVmdDtcclxuICAgICAgICAgICAgbW91c2Uub2Zmc2V0WSA9IGUucGFnZVkgLSBkcmFnSXRlbS5vZmZzZXQoKS50b3A7XHJcbiAgICAgICAgICAgIG1vdXNlLnN0YXJ0WCA9IG1vdXNlLmxhc3RYID0gZS5wYWdlWDtcclxuICAgICAgICAgICAgbW91c2Uuc3RhcnRZID0gbW91c2UubGFzdFkgPSBlLnBhZ2VZO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kcmFnUm9vdEVsID0gdGhpcy5lbDtcclxuICAgICAgICAgICAgdGhpcy5kcmFnRWwgPSAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGhpcy5vcHRpb25zLmxpc3ROb2RlTmFtZSkpLmFkZENsYXNzKHRoaXMub3B0aW9ucy5saXN0Q2xhc3MgKyAnICcgKyB0aGlzLm9wdGlvbnMuZHJhZ0NsYXNzKTtcclxuICAgICAgICAgICAgdGhpcy5kcmFnRWwuY3NzKCd3aWR0aCcsIGRyYWdJdGVtLm91dGVyV2lkdGgoKSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNldEluZGV4T2ZJdGVtKGRyYWdJdGVtKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGZpeCBmb3IgemVwdG8uanNcclxuICAgICAgICAgICAgLy9kcmFnSXRlbS5hZnRlcih0aGlzLnBsYWNlRWwpLmRldGFjaCgpLmFwcGVuZFRvKHRoaXMuZHJhZ0VsKTtcclxuICAgICAgICAgICAgZHJhZ0l0ZW0uYWZ0ZXIodGhpcy5wbGFjZUVsKTtcclxuICAgICAgICAgICAgZHJhZ0l0ZW1bMF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkcmFnSXRlbVswXSk7XHJcbiAgICAgICAgICAgIGRyYWdJdGVtLmFwcGVuZFRvKHRoaXMuZHJhZ0VsKTtcclxuXHJcbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSkuYXBwZW5kKHRoaXMuZHJhZ0VsKTtcclxuICAgICAgICAgICAgdGhpcy5kcmFnRWwuY3NzKHtcclxuICAgICAgICAgICAgICAgICdsZWZ0JzogZS5wYWdlWCAtIG1vdXNlLm9mZnNldFgsXHJcbiAgICAgICAgICAgICAgICAndG9wJzogZS5wYWdlWSAtIG1vdXNlLm9mZnNldFlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIHRvdGFsIGRlcHRoIG9mIGRyYWdnaW5nIGl0ZW1cclxuICAgICAgICAgICAgdmFyIGksIGRlcHRoLFxyXG4gICAgICAgICAgICAgICAgaXRlbXMgPSB0aGlzLmRyYWdFbC5maW5kKHRoaXMub3B0aW9ucy5pdGVtTm9kZU5hbWUpO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGRlcHRoID0gJChpdGVtc1tpXSkucGFyZW50cyh0aGlzLm9wdGlvbnMubGlzdE5vZGVOYW1lKS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGVwdGggPiB0aGlzLmRyYWdEZXB0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ0RlcHRoID0gZGVwdGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvL0NyZWF0ZSBzdWJsZXZlbC5cclxuICAgICAgICAvLyAgZWxlbWVudCA6IGVsZW1lbnQgd2hpY2ggYmVjb21lIHBhcmVudFxyXG4gICAgICAgIC8vICBpdGVtICAgIDogc29tZXRoaW5nIHRvIHBsYWNlIGludG8gbmV3IHN1YmxldmVsXHJcbiAgICAgICAgY3JlYXRlU3ViTGV2ZWw6IGZ1bmN0aW9uKGVsZW1lbnQsIGl0ZW0pIHtcclxuICAgICAgICAgICAgdmFyIGxpc3QgPSAkKCc8JyArIHRoaXMub3B0aW9ucy5saXN0Tm9kZU5hbWUgKyAnLz4nKS5hZGRDbGFzcyh0aGlzLm9wdGlvbnMubGlzdENsYXNzKTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0pIGxpc3QuYXBwZW5kKGl0ZW0pO1xyXG4gICAgICAgICAgICBlbGVtZW50LmFwcGVuZChsaXN0KTtcclxuICAgICAgICAgICAgdGhpcy5zZXRQYXJlbnQoZWxlbWVudCk7XHJcbiAgICAgICAgICAgIHJldHVybiBsaXN0O1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNldEluZGV4T2ZJdGVtOiBmdW5jdGlvbihpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICBpbmRleCA9IGluZGV4IHx8IFtdO1xyXG5cclxuICAgICAgICAgICAgaW5kZXgudW5zaGlmdChpdGVtLmluZGV4KCkpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCQoaXRlbVswXS5wYXJlbnROb2RlKVswXSAhPT0gdGhpcy5kcmFnUm9vdEVsWzBdKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEluZGV4T2ZJdGVtKCQoaXRlbVswXS5wYXJlbnROb2RlKSwgaW5kZXgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnRWwuZGF0YSgnaW5kZXhPZkl0ZW0nLCBpbmRleCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICByZXN0b3JlSXRlbUF0SW5kZXg6IGZ1bmN0aW9uKGRyYWdFbGVtZW50LCBpbmRleEFycmF5KSB7XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50RWwgPSB0aGlzLmVsLFxyXG4gICAgICAgICAgICAgICAgbGFzdEluZGV4ID0gaW5kZXhBcnJheS5sZW5ndGggLSAxO1xyXG5cclxuICAgICAgICAgICAgLy9QdXQgZHJhZyBlbGVtZW50IGF0IGN1cnJlbnQgZWxlbWVudCBwb3NpdGlvbi5cclxuICAgICAgICAgICAgZnVuY3Rpb24gcGxhY2VFbGVtZW50KGN1cnJlbnRFbCwgZHJhZ0VsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleEFycmF5W2xhc3RJbmRleF0gPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAkKGN1cnJlbnRFbCkucHJlcGVuZChkcmFnRWxlbWVudC5jbG9uZSh0cnVlKSk7IC8vdXNpbmcgdHJ1ZSBzYXZlcyBhZGRlZCB0byBlbGVtZW50IGV2ZW50cy5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICQoY3VycmVudEVsLmNoaWxkcmVuW2luZGV4QXJyYXlbbGFzdEluZGV4XSAtIDFdKS5hZnRlcihkcmFnRWxlbWVudC5jbG9uZSh0cnVlKSk7IC8vdXNpbmcgdHJ1ZSBzYXZlcyBhZGRlZCB0byBlbGVtZW50IGV2ZW50cy5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL0RpZ2dpbiB0aHJvdWdoIGluZGV4QXJyYXkgdG8gZ2V0IGhvbWUgZm9yIGRyYWdFbGVtZW50LlxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluZGV4QXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChsYXN0SW5kZXggPT09IHBhcnNlSW50KGkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxhY2VFbGVtZW50KGN1cnJlbnRFbCwgZHJhZ0VsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vZWxlbWVudCBjYW4gaGF2ZSBubyBpbmRleGVzLCBzbyB3ZSBoYXZlIHRvIHVzZSBjb25kaXRpb25hbCBoZXJlIHRvIGF2b2lkIGVycm9ycy5cclxuICAgICAgICAgICAgICAgIC8vaWYgZWxlbWVudCBkb2Vzbid0IGV4aXN0IHdlIGRlZmVuZXRseSBuZWVkIHRvIGFkZCBuZXcgbGlzdC5cclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gKGN1cnJlbnRFbFswXSkgPyBjdXJyZW50RWxbMF0gOiBjdXJyZW50RWw7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV4dEVsICA9IGVsZW1lbnQuY2hpbGRyZW5baW5kZXhBcnJheVtpXV07XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50RWwgICA9ICghbmV4dEVsKSA/IHRoaXMuY3JlYXRlU3ViTGV2ZWwoJChlbGVtZW50KSkgOiBuZXh0RWw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBkcmFnU3RvcDogZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAvLyBmaXggZm9yIHplcHRvLmpzXHJcbiAgICAgICAgICAgIC8vdGhpcy5wbGFjZUVsLnJlcGxhY2VXaXRoKHRoaXMuZHJhZ0VsLmNoaWxkcmVuKHRoaXMub3B0aW9ucy5pdGVtTm9kZU5hbWUgKyAnOmZpcnN0JykuZGV0YWNoKCkpO1xyXG4gICAgICAgICAgICB2YXIgcG9zaXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICB0b3AgIDogZS5wYWdlWSxcclxuICAgICAgICAgICAgICAgIGxlZnQgOiBlLnBhZ2VYXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vR2V0IGluZGV4QXJyYXkgb2YgaXRlbSBhdCBkcmFnIHN0YXJ0LlxyXG4gICAgICAgICAgICB2YXIgc3JjSW5kZXggPSB0aGlzLmRyYWdFbC5kYXRhKCdpbmRleE9mSXRlbScpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGVsID0gdGhpcy5kcmFnRWwuY2hpbGRyZW4odGhpcy5vcHRpb25zLml0ZW1Ob2RlTmFtZSkuZmlyc3QoKTtcclxuXHJcbiAgICAgICAgICAgIGVsWzBdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxbMF0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kcmFnRWwucmVtb3ZlKCk7IC8vUmVtb3ZlIGRyYWdFbCwgY2F1c2UgaXQgY2FuIGFmZmVjdCBvbiBpbmRleGluZyBpbiBodG1sIGNvbGxlY3Rpb24uXHJcblxyXG4gICAgICAgICAgICAvL0JlZm9yZSBkcmFnIHN0b3AgY2FsbGJhY2tcclxuICAgICAgICAgICAgdmFyIGNvbnRpbnVlRXhlY3V0aW9uID0gdGhpcy5vcHRpb25zLmJlZm9yZURyYWdTdG9wLmNhbGwodGhpcywgdGhpcy5lbCwgZWwsIHRoaXMucGxhY2VFbC5wYXJlbnQoKSk7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29udGludWVFeGVjdXRpb24gIT09ICd1bmRlZmluZWQnICYmIGNvbnRpbnVlRXhlY3V0aW9uID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMucGxhY2VFbC5wYXJlbnQoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucGxhY2VFbC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIGlmICghcGFyZW50LmNoaWxkcmVuKCkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNldFBhcmVudChwYXJlbnQucGFyZW50KCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXN0b3JlSXRlbUF0SW5kZXgoZWwsIHNyY0luZGV4KTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5wbGFjZUVsLnJlcGxhY2VXaXRoKGVsKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmhhc05ld1Jvb3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZml4ZWQgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3RvcmVJdGVtQXRJbmRleChlbCwgc3JjSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbC50cmlnZ2VyKCdsb3N0SXRlbScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnUm9vdEVsLnRyaWdnZXIoJ2dhaW5lZEl0ZW0nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ1Jvb3RFbC50cmlnZ2VyKCdjaGFuZ2UnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmNhbGxiYWNrLmNhbGwodGhpcywgdGhpcy5kcmFnUm9vdEVsLCBlbCwgcG9zaXRpb24pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGRyYWdNb3ZlOiBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgIHZhciBsaXN0LCBwYXJlbnQsIHByZXYsIG5leHQsIGRlcHRoLFxyXG4gICAgICAgICAgICAgICAgb3B0ID0gdGhpcy5vcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgbW91c2UgPSB0aGlzLm1vdXNlO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kcmFnRWwuY3NzKHtcclxuICAgICAgICAgICAgICAgICdsZWZ0JzogZS5wYWdlWCAtIG1vdXNlLm9mZnNldFgsXHJcbiAgICAgICAgICAgICAgICAndG9wJzogZS5wYWdlWSAtIG1vdXNlLm9mZnNldFlcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBtb3VzZSBwb3NpdGlvbiBsYXN0IGV2ZW50c1xyXG4gICAgICAgICAgICBtb3VzZS5sYXN0WCA9IG1vdXNlLm5vd1g7XHJcbiAgICAgICAgICAgIG1vdXNlLmxhc3RZID0gbW91c2Uubm93WTtcclxuICAgICAgICAgICAgLy8gbW91c2UgcG9zaXRpb24gdGhpcyBldmVudHNcclxuICAgICAgICAgICAgbW91c2Uubm93WCA9IGUucGFnZVg7XHJcbiAgICAgICAgICAgIG1vdXNlLm5vd1kgPSBlLnBhZ2VZO1xyXG4gICAgICAgICAgICAvLyBkaXN0YW5jZSBtb3VzZSBtb3ZlZCBiZXR3ZWVuIGV2ZW50c1xyXG4gICAgICAgICAgICBtb3VzZS5kaXN0WCA9IG1vdXNlLm5vd1ggLSBtb3VzZS5sYXN0WDtcclxuICAgICAgICAgICAgbW91c2UuZGlzdFkgPSBtb3VzZS5ub3dZIC0gbW91c2UubGFzdFk7XHJcbiAgICAgICAgICAgIC8vIGRpcmVjdGlvbiBtb3VzZSB3YXMgbW92aW5nXHJcbiAgICAgICAgICAgIG1vdXNlLmxhc3REaXJYID0gbW91c2UuZGlyWDtcclxuICAgICAgICAgICAgbW91c2UubGFzdERpclkgPSBtb3VzZS5kaXJZO1xyXG4gICAgICAgICAgICAvLyBkaXJlY3Rpb24gbW91c2UgaXMgbm93IG1vdmluZyAob24gYm90aCBheGlzKVxyXG4gICAgICAgICAgICBtb3VzZS5kaXJYID0gbW91c2UuZGlzdFggPT09IDAgPyAwIDogbW91c2UuZGlzdFggPiAwID8gMSA6IC0xO1xyXG4gICAgICAgICAgICBtb3VzZS5kaXJZID0gbW91c2UuZGlzdFkgPT09IDAgPyAwIDogbW91c2UuZGlzdFkgPiAwID8gMSA6IC0xO1xyXG4gICAgICAgICAgICAvLyBheGlzIG1vdXNlIGlzIG5vdyBtb3Zpbmcgb25cclxuICAgICAgICAgICAgdmFyIG5ld0F4ID0gTWF0aC5hYnMobW91c2UuZGlzdFgpID4gTWF0aC5hYnMobW91c2UuZGlzdFkpID8gMSA6IDA7XHJcblxyXG4gICAgICAgICAgICAvLyBkbyBub3RoaW5nIG9uIGZpcnN0IG1vdmVcclxuICAgICAgICAgICAgaWYgKCFtb3VzZS5tb3ZpbmcpIHtcclxuICAgICAgICAgICAgICAgIG1vdXNlLmRpckF4ID0gbmV3QXg7XHJcbiAgICAgICAgICAgICAgICBtb3VzZS5tb3ZpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBkbyBzY3JvbGxpbmcgaWYgZW5hYmxlXHJcbiAgICAgICAgICAgIGlmIChvcHQuc2Nyb2xsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5qUXVlcnkuZm4uc2Nyb2xsUGFyZW50ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxQYXJlbnQgPSB0aGlzLmVsLnNjcm9sbFBhcmVudCgpWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY3JvbGxQYXJlbnQgIT09IGRvY3VtZW50ICYmIHNjcm9sbFBhcmVudC50YWdOYW1lICE9PSAnSFRNTCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChvcHQuc2Nyb2xsVHJpZ2dlcnMuYm90dG9tICsgc2Nyb2xsUGFyZW50Lm9mZnNldEhlaWdodCkgLSBlLnBhZ2VZIDwgb3B0LnNjcm9sbFNlbnNpdGl2aXR5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCA9IHNjcm9sbGVkID0gc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCArIG9wdC5zY3JvbGxTcGVlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZS5wYWdlWSAtIG9wdC5zY3JvbGxUcmlnZ2Vycy50b3AgPCBvcHQuc2Nyb2xsU2Vuc2l0aXZpdHkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxQYXJlbnQuc2Nyb2xsVG9wID0gc2Nyb2xsZWQgPSBzY3JvbGxQYXJlbnQuc2Nyb2xsVG9wIC0gb3B0LnNjcm9sbFNwZWVkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChvcHQuc2Nyb2xsVHJpZ2dlcnMucmlnaHQgKyBzY3JvbGxQYXJlbnQub2Zmc2V0V2lkdGgpIC0gZS5wYWdlWCA8IG9wdC5zY3JvbGxTZW5zaXRpdml0eSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0ID0gc2Nyb2xsZWQgPSBzY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCArIG9wdC5zY3JvbGxTcGVlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZS5wYWdlWCAtIG9wdC5zY3JvbGxUcmlnZ2Vycy5sZWZ0IDwgb3B0LnNjcm9sbFNlbnNpdGl2aXR5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQgPSBzY3JvbGxlZCA9IHNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0IC0gb3B0LnNjcm9sbFNwZWVkO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnBhZ2VZIC0gJChkb2N1bWVudCkuc2Nyb2xsVG9wKCkgPCBvcHQuc2Nyb2xsU2Vuc2l0aXZpdHkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSAtIG9wdC5zY3JvbGxTcGVlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCQod2luZG93KS5oZWlnaHQoKSAtIChlLnBhZ2VZIC0gJChkb2N1bWVudCkuc2Nyb2xsVG9wKCkpIDwgb3B0LnNjcm9sbFNlbnNpdGl2aXR5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsZWQgPSAkKGRvY3VtZW50KS5zY3JvbGxUb3AoJChkb2N1bWVudCkuc2Nyb2xsVG9wKCkgKyBvcHQuc2Nyb2xsU3BlZWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUucGFnZVggLSAkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkgPCBvcHQuc2Nyb2xsU2Vuc2l0aXZpdHkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpIC0gb3B0LnNjcm9sbFNwZWVkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoJCh3aW5kb3cpLndpZHRoKCkgLSAoZS5wYWdlWCAtICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSkgPCBvcHQuc2Nyb2xsU2Vuc2l0aXZpdHkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpICsgb3B0LnNjcm9sbFNwZWVkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignVG8gdXNlIHNjcm9sbGluZyB5b3UgbmVlZCB0byBoYXZlIHNjcm9sbFBhcmVudCgpIGZ1bmN0aW9uLCBjaGVjayBkb2N1bWVudGF0aW9uIGZvciBtb3JlIGluZm9ybWF0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNjcm9sbFRpbWVyKSB7XHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zY3JvbGxUaW1lcik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChvcHQuc2Nyb2xsICYmIHNjcm9sbGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKHdpbmRvdykudHJpZ2dlcihlKTtcclxuICAgICAgICAgICAgICAgIH0sIDEwKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSBtb3ZlZCBvbiB0aGlzIGF4aXMgKGFuZCBkaXJlY3Rpb24pXHJcbiAgICAgICAgICAgIGlmIChtb3VzZS5kaXJBeCAhPT0gbmV3QXgpIHtcclxuICAgICAgICAgICAgICAgIG1vdXNlLmRpc3RBeFggPSAwO1xyXG4gICAgICAgICAgICAgICAgbW91c2UuZGlzdEF4WSA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBtb3VzZS5kaXN0QXhYICs9IE1hdGguYWJzKG1vdXNlLmRpc3RYKTtcclxuICAgICAgICAgICAgICAgIGlmIChtb3VzZS5kaXJYICE9PSAwICYmIG1vdXNlLmRpclggIT09IG1vdXNlLmxhc3REaXJYKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW91c2UuZGlzdEF4WCA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBtb3VzZS5kaXN0QXhZICs9IE1hdGguYWJzKG1vdXNlLmRpc3RZKTtcclxuICAgICAgICAgICAgICAgIGlmIChtb3VzZS5kaXJZICE9PSAwICYmIG1vdXNlLmRpclkgIT09IG1vdXNlLmxhc3REaXJZKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW91c2UuZGlzdEF4WSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbW91c2UuZGlyQXggPSBuZXdBeDtcclxuXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBtb3ZlIGhvcml6b250YWxcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGlmIChtb3VzZS5kaXJBeCAmJiBtb3VzZS5kaXN0QXhYID49IG9wdC50aHJlc2hvbGQpIHtcclxuICAgICAgICAgICAgICAgIC8vIHJlc2V0IG1vdmUgZGlzdGFuY2Ugb24geC1heGlzIGZvciBuZXcgcGhhc2VcclxuICAgICAgICAgICAgICAgIG1vdXNlLmRpc3RBeFggPSAwO1xyXG4gICAgICAgICAgICAgICAgcHJldiA9IHRoaXMucGxhY2VFbC5wcmV2KG9wdC5pdGVtTm9kZU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgLy8gaW5jcmVhc2UgaG9yaXpvbnRhbCBsZXZlbCBpZiBwcmV2aW91cyBzaWJsaW5nIGV4aXN0cywgaXMgbm90IGNvbGxhcHNlZCwgYW5kIGNhbiBoYXZlIGNoaWxkcmVuXHJcbiAgICAgICAgICAgICAgICBpZiAobW91c2UuZGlzdFggPiAwICYmIHByZXYubGVuZ3RoICYmICFwcmV2Lmhhc0NsYXNzKG9wdC5jb2xsYXBzZWRDbGFzcykgJiYgIXByZXYuaGFzQ2xhc3Mob3B0Lm5vQ2hpbGRyZW5DbGFzcykpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjYW5ub3QgaW5jcmVhc2UgbGV2ZWwgd2hlbiBpdGVtIGFib3ZlIGlzIGNvbGxhcHNlZFxyXG4gICAgICAgICAgICAgICAgICAgIGxpc3QgPSBwcmV2LmZpbmQob3B0Lmxpc3ROb2RlTmFtZSkubGFzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIGRlcHRoIGxpbWl0IGhhcyByZWFjaGVkXHJcbiAgICAgICAgICAgICAgICAgICAgZGVwdGggPSB0aGlzLnBsYWNlRWwucGFyZW50cyhvcHQubGlzdE5vZGVOYW1lKS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlcHRoICsgdGhpcy5kcmFnRGVwdGggPD0gb3B0Lm1heERlcHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgc3ViLWxldmVsIGlmIG9uZSBkb2Vzbid0IGV4aXN0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbGlzdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlU3ViTGV2ZWwocHJldiwgdGhpcy5wbGFjZUVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVsc2UgYXBwZW5kIHRvIG5leHQgbGV2ZWwgdXBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QgPSBwcmV2LmNoaWxkcmVuKG9wdC5saXN0Tm9kZU5hbWUpLmxhc3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QuYXBwZW5kKHRoaXMucGxhY2VFbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBkZWNyZWFzZSBob3Jpem9udGFsIGxldmVsXHJcbiAgICAgICAgICAgICAgICBpZiAobW91c2UuZGlzdFggPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgY2FuJ3QgZGVjcmVhc2UgYSBsZXZlbCBpZiBhbiBpdGVtIHByZWNlZWRzIHRoZSBjdXJyZW50IG9uZVxyXG4gICAgICAgICAgICAgICAgICAgIG5leHQgPSB0aGlzLnBsYWNlRWwubmV4dChvcHQuaXRlbU5vZGVOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW5leHQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IHRoaXMucGxhY2VFbC5wYXJlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGFjZUVsLmNsb3Nlc3Qob3B0Lml0ZW1Ob2RlTmFtZSkuYWZ0ZXIodGhpcy5wbGFjZUVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXJlbnQuY2hpbGRyZW4oKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudW5zZXRQYXJlbnQocGFyZW50LnBhcmVudCgpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIGlzRW1wdHkgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIC8vIGZpbmQgbGlzdCBpdGVtIHVuZGVyIGN1cnNvclxyXG4gICAgICAgICAgICBpZiAoIWhhc1BvaW50ZXJFdmVudHMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ0VsWzBdLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnBvaW50RWwgPSAkKGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQoZS5wYWdlWCAtIGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCwgZS5wYWdlWSAtICh3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCkpKTtcclxuICAgICAgICAgICAgaWYgKCFoYXNQb2ludGVyRXZlbnRzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdFbFswXS5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBvaW50RWwuaGFzQ2xhc3Mob3B0LmhhbmRsZUNsYXNzKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wb2ludEVsID0gdGhpcy5wb2ludEVsLmNsb3Nlc3Qob3B0Lml0ZW1Ob2RlTmFtZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMucG9pbnRFbC5oYXNDbGFzcyhvcHQuZW1wdHlDbGFzcykpIHtcclxuICAgICAgICAgICAgICAgIGlzRW1wdHkgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCF0aGlzLnBvaW50RWwubGVuZ3RoIHx8ICF0aGlzLnBvaW50RWwuaGFzQ2xhc3Mob3B0Lml0ZW1DbGFzcykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gZmluZCBwYXJlbnQgbGlzdCBvZiBpdGVtIHVuZGVyIGN1cnNvclxyXG4gICAgICAgICAgICB2YXIgcG9pbnRFbFJvb3QgPSB0aGlzLnBvaW50RWwuY2xvc2VzdCgnLicgKyBvcHQucm9vdENsYXNzKSxcclxuICAgICAgICAgICAgICAgIGlzTmV3Um9vdCA9IHRoaXMuZHJhZ1Jvb3RFbC5kYXRhKCduZXN0YWJsZS1pZCcpICE9PSBwb2ludEVsUm9vdC5kYXRhKCduZXN0YWJsZS1pZCcpO1xyXG5cclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIG1vdmUgdmVydGljYWxcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGlmICghbW91c2UuZGlyQXggfHwgaXNOZXdSb290IHx8IGlzRW1wdHkpIHtcclxuICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIGdyb3VwcyBtYXRjaCBpZiBkcmFnZ2luZyBvdmVyIG5ldyByb290XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNOZXdSb290ICYmIG9wdC5ncm91cCAhPT0gcG9pbnRFbFJvb3QuZGF0YSgnbmVzdGFibGUtZ3JvdXAnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBmaXhlZCBpdGVtJ3MgZGVwdGgsIHVzZSBmb3Igc29tZSBsaXN0IGhhcyBzcGVjaWZpYyB0eXBlLCBlZzonVm9sdW1lLCBTZWN0aW9uLCBDaGFwdGVyIC4uLidcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZml4ZWREZXB0aCAmJiB0aGlzLmRyYWdEZXB0aCArIDEgIT09IHRoaXMucG9pbnRFbC5wYXJlbnRzKG9wdC5saXN0Tm9kZU5hbWUpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBjaGVjayBkZXB0aCBsaW1pdFxyXG4gICAgICAgICAgICAgICAgZGVwdGggPSB0aGlzLmRyYWdEZXB0aCAtIDEgKyB0aGlzLnBvaW50RWwucGFyZW50cyhvcHQubGlzdE5vZGVOYW1lKS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGVwdGggPiBvcHQubWF4RGVwdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgYmVmb3JlID0gZS5wYWdlWSA8ICh0aGlzLnBvaW50RWwub2Zmc2V0KCkudG9wICsgdGhpcy5wb2ludEVsLmhlaWdodCgpIC8gMik7XHJcbiAgICAgICAgICAgICAgICBwYXJlbnQgPSB0aGlzLnBsYWNlRWwucGFyZW50KCk7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiBlbXB0eSBjcmVhdGUgbmV3IGxpc3QgdG8gcmVwbGFjZSBlbXB0eSBwbGFjZWhvbGRlclxyXG4gICAgICAgICAgICAgICAgaWYgKGlzRW1wdHkpIHtcclxuICAgICAgICAgICAgICAgICAgICBsaXN0ID0gJChkb2N1bWVudC5jcmVhdGVFbGVtZW50KG9wdC5saXN0Tm9kZU5hbWUpKS5hZGRDbGFzcyhvcHQubGlzdENsYXNzKTtcclxuICAgICAgICAgICAgICAgICAgICBsaXN0LmFwcGVuZCh0aGlzLnBsYWNlRWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9pbnRFbC5yZXBsYWNlV2l0aChsaXN0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJlZm9yZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9pbnRFbC5iZWZvcmUodGhpcy5wbGFjZUVsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9pbnRFbC5hZnRlcih0aGlzLnBsYWNlRWwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFwYXJlbnQuY2hpbGRyZW4oKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuc2V0UGFyZW50KHBhcmVudC5wYXJlbnQoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZHJhZ1Jvb3RFbC5maW5kKG9wdC5pdGVtTm9kZU5hbWUpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kRW1wdHlFbGVtZW50KHRoaXMuZHJhZ1Jvb3RFbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBwYXJlbnQgcm9vdCBsaXN0IGhhcyBjaGFuZ2VkXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdSb290RWwgPSBwb2ludEVsUm9vdDtcclxuICAgICAgICAgICAgICAgIGlmIChpc05ld1Jvb3QpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc05ld1Jvb3QgPSB0aGlzLmVsWzBdICE9PSB0aGlzLmRyYWdSb290RWxbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvLyBBcHBlbmQgdGhlIC5kZC1lbXB0eSBkaXYgdG8gdGhlIGxpc3Qgc28gaXQgY2FuIGJlIHBvcHVsYXRlZCBhbmQgc3R5bGVkXHJcbiAgICAgICAgYXBwZW5kRW1wdHlFbGVtZW50OiBmdW5jdGlvbihlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kKCc8ZGl2IGNsYXNzPVwiJyArIHRoaXMub3B0aW9ucy5lbXB0eUNsYXNzICsgJ1wiLz4nKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgICQuZm4ubmVzdGFibGUgPSBmdW5jdGlvbihwYXJhbXMpIHtcclxuICAgICAgICB2YXIgbGlzdHMgID0gdGhpcyxcclxuICAgICAgICAgICAgcmV0dmFsID0gdGhpcyxcclxuICAgICAgICAgICAgYXJncyAgID0gYXJndW1lbnRzO1xyXG5cclxuICAgICAgICBpZiAoISgnTmVzdGFibGUnIGluIHdpbmRvdykpIHtcclxuICAgICAgICAgICAgd2luZG93Lk5lc3RhYmxlID0ge307XHJcbiAgICAgICAgICAgIE5lc3RhYmxlLmNvdW50ZXIgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGlzdHMuZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHBsdWdpbiA9ICQodGhpcykuZGF0YShcIm5lc3RhYmxlXCIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFwbHVnaW4pIHtcclxuICAgICAgICAgICAgICAgIE5lc3RhYmxlLmNvdW50ZXIrKztcclxuICAgICAgICAgICAgICAgICQodGhpcykuZGF0YShcIm5lc3RhYmxlXCIsIG5ldyBQbHVnaW4odGhpcywgcGFyYW1zKSk7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmRhdGEoXCJuZXN0YWJsZS1pZFwiLCBOZXN0YWJsZS5jb3VudGVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcGFyYW1zID09PSAnc3RyaW5nJyAmJiB0eXBlb2YgcGx1Z2luW3BhcmFtc10gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAxKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBsdWdpbkFyZ3MgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbHVnaW5BcmdzLnB1c2goYXJnc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dmFsID0gcGx1Z2luW3BhcmFtc10uYXBwbHkocGx1Z2luLCBwbHVnaW5BcmdzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHZhbCA9IHBsdWdpbltwYXJhbXNdKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXR2YWwgfHwgbGlzdHM7XHJcbiAgICB9O1xyXG5cclxufSkod2luZG93LmpRdWVyeSB8fCB3aW5kb3cuWmVwdG8sIHdpbmRvdywgZG9jdW1lbnQpO1xyXG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./Modules/Menu/node_modules/nestable2/jquery.nestable.js\n");

/***/ }),

/***/ 9:
/*!**************************************************************!*\
  !*** multi ./Modules/Menu/Resources/assets/admin/js/main.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(/*! D:\xampp\htdocs\ecom\Modules\Menu\Resources\assets\admin\js\main.js */"./Modules/Menu/Resources/assets/admin/js/main.js");


/***/ })

/******/ });