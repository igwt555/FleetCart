/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 17);
/******/ })
/************************************************************************/
/******/ ({

/***/ "./Modules/Translation/Resources/assets/admin/js/TranslationEditor.js":
/*!****************************************************************************!*\
  !*** ./Modules/Translation/Resources/assets/admin/js/TranslationEditor.js ***!
  \****************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return _default; });\n/* harmony import */ var _node_modules_x_editable_dist_bootstrap3_editable_js_bootstrap_editable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../node_modules/x-editable/dist/bootstrap3-editable/js/bootstrap-editable */ \"./Modules/Translation/node_modules/x-editable/dist/bootstrap3-editable/js/bootstrap-editable.js\");\n/* harmony import */ var _node_modules_x_editable_dist_bootstrap3_editable_js_bootstrap_editable__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_x_editable_dist_bootstrap3_editable_js_bootstrap_editable__WEBPACK_IMPORTED_MODULE_0__);\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\nvar _default = /*#__PURE__*/function () {\n  function _default() {\n    _classCallCheck(this, _default);\n\n    $('.translation').editable({\n      url: this.update,\n      type: 'text',\n      mode: 'inline',\n      send: 'always'\n    });\n  }\n\n  _createClass(_default, [{\n    key: \"update\",\n    value: function update(data) {\n      $.ajax({\n        url: route('admin.translations.update', this.dataset.key),\n        type: 'PUT',\n        data: {\n          locale: this.dataset.locale,\n          value: data.value\n        },\n        success: function (_success) {\n          function success(_x) {\n            return _success.apply(this, arguments);\n          }\n\n          success.toString = function () {\n            return _success.toString();\n          };\n\n          return success;\n        }(function (message) {\n          success(message);\n        }),\n        error: function (_error) {\n          function error(_x2) {\n            return _error.apply(this, arguments);\n          }\n\n          error.toString = function () {\n            return _error.toString();\n          };\n\n          return error;\n        }(function (xhr) {\n          error(xhr.responseJSON.message);\n        })\n      });\n    }\n  }]);\n\n  return _default;\n}();\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9Nb2R1bGVzL1RyYW5zbGF0aW9uL1Jlc291cmNlcy9hc3NldHMvYWRtaW4vanMvVHJhbnNsYXRpb25FZGl0b3IuanM/MzgxZiJdLCJuYW1lcyI6WyIkIiwiZWRpdGFibGUiLCJ1cmwiLCJ1cGRhdGUiLCJ0eXBlIiwibW9kZSIsInNlbmQiLCJkYXRhIiwiYWpheCIsInJvdXRlIiwiZGF0YXNldCIsImtleSIsImxvY2FsZSIsInZhbHVlIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJlcnJvciIsInhociIsInJlc3BvbnNlSlNPTiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOzs7QUFHSSxzQkFBYztBQUFBOztBQUNWQSxLQUFDLENBQUMsY0FBRCxDQUFELENBQWtCQyxRQUFsQixDQUEyQjtBQUN2QkMsU0FBRyxFQUFFLEtBQUtDLE1BRGE7QUFFdkJDLFVBQUksRUFBRSxNQUZpQjtBQUd2QkMsVUFBSSxFQUFFLFFBSGlCO0FBSXZCQyxVQUFJLEVBQUU7QUFKaUIsS0FBM0I7QUFNSDs7OztXQUVELGdCQUFPQyxJQUFQLEVBQWE7QUFDVFAsT0FBQyxDQUFDUSxJQUFGLENBQU87QUFDSE4sV0FBRyxFQUFFTyxLQUFLLENBQUMsMkJBQUQsRUFBOEIsS0FBS0MsT0FBTCxDQUFhQyxHQUEzQyxDQURQO0FBRUhQLFlBQUksRUFBRSxLQUZIO0FBR0hHLFlBQUksRUFBRTtBQUNGSyxnQkFBTSxFQUFFLEtBQUtGLE9BQUwsQ0FBYUUsTUFEbkI7QUFFRkMsZUFBSyxFQUFFTixJQUFJLENBQUNNO0FBRlYsU0FISDtBQU9IQyxlQVBHO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBLG9CQU9LQyxPQVBMLEVBT2M7QUFDYkQsaUJBQU8sQ0FBQ0MsT0FBRCxDQUFQO0FBQ0gsU0FURTtBQVVIQyxhQVZHO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBLG9CQVVHQyxHQVZILEVBVVE7QUFDUEQsZUFBSyxDQUFDQyxHQUFHLENBQUNDLFlBQUosQ0FBaUJILE9BQWxCLENBQUw7QUFDSCxTQVpFO0FBQUEsT0FBUDtBQWNIIiwiZmlsZSI6Ii4vTW9kdWxlcy9UcmFuc2xhdGlvbi9SZXNvdXJjZXMvYXNzZXRzL2FkbWluL2pzL1RyYW5zbGF0aW9uRWRpdG9yLmpzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICcuLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMveC1lZGl0YWJsZS9kaXN0L2Jvb3RzdHJhcDMtZWRpdGFibGUvanMvYm9vdHN0cmFwLWVkaXRhYmxlJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgICQoJy50cmFuc2xhdGlvbicpLmVkaXRhYmxlKHtcclxuICAgICAgICAgICAgdXJsOiB0aGlzLnVwZGF0ZSxcclxuICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgICAgICBtb2RlOiAnaW5saW5lJyxcclxuICAgICAgICAgICAgc2VuZDogJ2Fsd2F5cycsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlKGRhdGEpIHtcclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6IHJvdXRlKCdhZG1pbi50cmFuc2xhdGlvbnMudXBkYXRlJywgdGhpcy5kYXRhc2V0LmtleSksXHJcbiAgICAgICAgICAgIHR5cGU6ICdQVVQnLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBsb2NhbGU6IHRoaXMuZGF0YXNldC5sb2NhbGUsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogZGF0YS52YWx1ZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc3VjY2VzcyhtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnJvcih4aHIpIHtcclxuICAgICAgICAgICAgICAgIGVycm9yKHhoci5yZXNwb25zZUpTT04ubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./Modules/Translation/Resources/assets/admin/js/TranslationEditor.js\n");

/***/ }),

/***/ "./Modules/Translation/Resources/assets/admin/js/main.js":
/*!***************************************************************!*\
  !*** ./Modules/Translation/Resources/assets/admin/js/main.js ***!
  \***************************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _TranslationEditor__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./TranslationEditor */ \"./Modules/Translation/Resources/assets/admin/js/TranslationEditor.js\");\n\n$('.translations-table').dataTable({\n  pageLength: 20,\n  lengthMenu: [10, 20, 50, 100, 200],\n  drawCallback: function drawCallback() {\n    new _TranslationEditor__WEBPACK_IMPORTED_MODULE_0__[\"default\"]();\n  }\n});//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9Nb2R1bGVzL1RyYW5zbGF0aW9uL1Jlc291cmNlcy9hc3NldHMvYWRtaW4vanMvbWFpbi5qcz82ZDA1Il0sIm5hbWVzIjpbIiQiLCJkYXRhVGFibGUiLCJwYWdlTGVuZ3RoIiwibGVuZ3RoTWVudSIsImRyYXdDYWxsYmFjayIsIlRyYW5zbGF0aW9uRWRpdG9yIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFFQUEsQ0FBQyxDQUFDLHFCQUFELENBQUQsQ0FBeUJDLFNBQXpCLENBQW1DO0FBQy9CQyxZQUFVLEVBQUUsRUFEbUI7QUFFL0JDLFlBQVUsRUFBRSxDQUFDLEVBQUQsRUFBSyxFQUFMLEVBQVMsRUFBVCxFQUFhLEdBQWIsRUFBa0IsR0FBbEIsQ0FGbUI7QUFHL0JDLGNBQVksRUFBRSx3QkFBTTtBQUNoQixRQUFJQywwREFBSjtBQUNIO0FBTDhCLENBQW5DIiwiZmlsZSI6Ii4vTW9kdWxlcy9UcmFuc2xhdGlvbi9SZXNvdXJjZXMvYXNzZXRzL2FkbWluL2pzL21haW4uanMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVHJhbnNsYXRpb25FZGl0b3IgZnJvbSAnLi9UcmFuc2xhdGlvbkVkaXRvcic7XHJcblxyXG4kKCcudHJhbnNsYXRpb25zLXRhYmxlJykuZGF0YVRhYmxlKHtcclxuICAgIHBhZ2VMZW5ndGg6IDIwLFxyXG4gICAgbGVuZ3RoTWVudTogWzEwLCAyMCwgNTAsIDEwMCwgMjAwXSxcclxuICAgIGRyYXdDYWxsYmFjazogKCkgPT4ge1xyXG4gICAgICAgIG5ldyBUcmFuc2xhdGlvbkVkaXRvcigpO1xyXG4gICAgfSxcclxufSk7XHJcblxyXG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./Modules/Translation/Resources/assets/admin/js/main.js\n");

/***/ }),

/***/ "./Modules/Translation/node_modules/x-editable/dist/bootstrap3-editable/js/bootstrap-editable.js":
/*!*******************************************************************************************************!*\
  !*** ./Modules/Translation/node_modules/x-editable/dist/bootstrap3-editable/js/bootstrap-editable.js ***!
  \*******************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/*! X-editable - v1.5.1 \r\n* In-place editing with Twitter Bootstrap, jQuery UI or pure jQuery\r\n* http://github.com/vitalets/x-editable\r\n* Copyright (c) 2013 Vitaliy Potapov; Licensed MIT */\r\n/**\r\nForm with single input element, two buttons and two states: normal/loading.\r\nApplied as jQuery method to DIV tag (not to form tag!). This is because form can be in loading state when spinner shown.\r\nEditableform is linked with one of input types, e.g. 'text', 'select' etc.\r\n\r\n@class editableform\r\n@uses text\r\n@uses textarea\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var EditableForm = function (div, options) {\r\n        this.options = $.extend({}, $.fn.editableform.defaults, options);\r\n        this.$div = $(div); //div, containing form. Not form tag. Not editable-element.\r\n        if(!this.options.scope) {\r\n            this.options.scope = this;\r\n        }\r\n        //nothing shown after init\r\n    };\r\n\r\n    EditableForm.prototype = {\r\n        constructor: EditableForm,\r\n        initInput: function() {  //called once\r\n            //take input from options (as it is created in editable-element)\r\n            this.input = this.options.input;\r\n            \r\n            //set initial value\r\n            //todo: may be add check: typeof str === 'string' ? \r\n            this.value = this.input.str2value(this.options.value); \r\n            \r\n            //prerender: get input.$input\r\n            this.input.prerender();\r\n        },\r\n        initTemplate: function() {\r\n            this.$form = $($.fn.editableform.template); \r\n        },\r\n        initButtons: function() {\r\n            var $btn = this.$form.find('.editable-buttons');\r\n            $btn.append($.fn.editableform.buttons);\r\n            if(this.options.showbuttons === 'bottom') {\r\n                $btn.addClass('editable-buttons-bottom');\r\n            }\r\n        },\r\n        /**\r\n        Renders editableform\r\n\r\n        @method render\r\n        **/        \r\n        render: function() {\r\n            //init loader\r\n            this.$loading = $($.fn.editableform.loading);        \r\n            this.$div.empty().append(this.$loading);\r\n            \r\n            //init form template and buttons\r\n            this.initTemplate();\r\n            if(this.options.showbuttons) {\r\n                this.initButtons();\r\n            } else {\r\n                this.$form.find('.editable-buttons').remove();\r\n            }\r\n\r\n            //show loading state\r\n            this.showLoading();            \r\n            \r\n            //flag showing is form now saving value to server. \r\n            //It is needed to wait when closing form.\r\n            this.isSaving = false;\r\n            \r\n            /**        \r\n            Fired when rendering starts\r\n            @event rendering \r\n            @param {Object} event event object\r\n            **/            \r\n            this.$div.triggerHandler('rendering');\r\n            \r\n            //init input\r\n            this.initInput();\r\n            \r\n            //append input to form\r\n            this.$form.find('div.editable-input').append(this.input.$tpl);            \r\n            \r\n            //append form to container\r\n            this.$div.append(this.$form);\r\n            \r\n            //render input\r\n            $.when(this.input.render())\r\n            .then($.proxy(function () {\r\n                //setup input to submit automatically when no buttons shown\r\n                if(!this.options.showbuttons) {\r\n                    this.input.autosubmit(); \r\n                }\r\n                 \r\n                //attach 'cancel' handler\r\n                this.$form.find('.editable-cancel').click($.proxy(this.cancel, this));\r\n                \r\n                if(this.input.error) {\r\n                    this.error(this.input.error);\r\n                    this.$form.find('.editable-submit').attr('disabled', true);\r\n                    this.input.$input.attr('disabled', true);\r\n                    //prevent form from submitting\r\n                    this.$form.submit(function(e){ e.preventDefault(); });\r\n                } else {\r\n                    this.error(false);\r\n                    this.input.$input.removeAttr('disabled');\r\n                    this.$form.find('.editable-submit').removeAttr('disabled');\r\n                    var value = (this.value === null || this.value === undefined || this.value === '') ? this.options.defaultValue : this.value;\r\n                    this.input.value2input(value);\r\n                    //attach submit handler\r\n                    this.$form.submit($.proxy(this.submit, this));\r\n                }\r\n\r\n                /**        \r\n                Fired when form is rendered\r\n                @event rendered\r\n                @param {Object} event event object\r\n                **/            \r\n                this.$div.triggerHandler('rendered');                \r\n\r\n                this.showForm();\r\n                \r\n                //call postrender method to perform actions required visibility of form\r\n                if(this.input.postrender) {\r\n                    this.input.postrender();\r\n                }                \r\n            }, this));\r\n        },\r\n        cancel: function() {   \r\n            /**        \r\n            Fired when form was cancelled by user\r\n            @event cancel \r\n            @param {Object} event event object\r\n            **/              \r\n            this.$div.triggerHandler('cancel');\r\n        },\r\n        showLoading: function() {\r\n            var w, h;\r\n            if(this.$form) {\r\n                //set loading size equal to form\r\n                w = this.$form.outerWidth();\r\n                h = this.$form.outerHeight(); \r\n                if(w) {\r\n                    this.$loading.width(w);\r\n                }\r\n                if(h) {\r\n                    this.$loading.height(h);\r\n                }\r\n                this.$form.hide();\r\n            } else {\r\n                //stretch loading to fill container width\r\n                w = this.$loading.parent().width();\r\n                if(w) {\r\n                    this.$loading.width(w);\r\n                }\r\n            }\r\n            this.$loading.show(); \r\n        },\r\n\r\n        showForm: function(activate) {\r\n            this.$loading.hide();\r\n            this.$form.show();\r\n            if(activate !== false) {\r\n                this.input.activate(); \r\n            }\r\n            /**        \r\n            Fired when form is shown\r\n            @event show \r\n            @param {Object} event event object\r\n            **/                    \r\n            this.$div.triggerHandler('show');\r\n        },\r\n\r\n        error: function(msg) {\r\n            var $group = this.$form.find('.control-group'),\r\n                $block = this.$form.find('.editable-error-block'),\r\n                lines;\r\n\r\n            if(msg === false) {\r\n                $group.removeClass($.fn.editableform.errorGroupClass);\r\n                $block.removeClass($.fn.editableform.errorBlockClass).empty().hide(); \r\n            } else {\r\n                //convert newline to <br> for more pretty error display\r\n                if(msg) {\r\n                    lines = (''+msg).split('\\n');\r\n                    for (var i = 0; i < lines.length; i++) {\r\n                        lines[i] = $('<div>').text(lines[i]).html();\r\n                    }\r\n                    msg = lines.join('<br>');\r\n                }\r\n                $group.addClass($.fn.editableform.errorGroupClass);\r\n                $block.addClass($.fn.editableform.errorBlockClass).html(msg).show();\r\n            }\r\n        },\r\n\r\n        submit: function(e) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            \r\n            //get new value from input\r\n            var newValue = this.input.input2value(); \r\n\r\n            //validation: if validate returns string or truthy value - means error\r\n            //if returns object like {newValue: '...'} => submitted value is reassigned to it\r\n            var error = this.validate(newValue);\r\n            if ($.type(error) === 'object' && error.newValue !== undefined) {\r\n                newValue = error.newValue;\r\n                this.input.value2input(newValue);\r\n                if(typeof error.msg === 'string') {\r\n                    this.error(error.msg);\r\n                    this.showForm();\r\n                    return;\r\n                }\r\n            } else if (error) {\r\n                this.error(error);\r\n                this.showForm();\r\n                return;\r\n            } \r\n            \r\n            //if value not changed --> trigger 'nochange' event and return\r\n            /*jslint eqeq: true*/\r\n            if (!this.options.savenochange && this.input.value2str(newValue) == this.input.value2str(this.value)) {\r\n            /*jslint eqeq: false*/                \r\n                /**        \r\n                Fired when value not changed but form is submitted. Requires savenochange = false.\r\n                @event nochange \r\n                @param {Object} event event object\r\n                **/                    \r\n                this.$div.triggerHandler('nochange');            \r\n                return;\r\n            } \r\n\r\n            //convert value for submitting to server\r\n            var submitValue = this.input.value2submit(newValue);\r\n            \r\n            this.isSaving = true;\r\n            \r\n            //sending data to server\r\n            $.when(this.save(submitValue))\r\n            .done($.proxy(function(response) {\r\n                this.isSaving = false;\r\n\r\n                //run success callback\r\n                var res = typeof this.options.success === 'function' ? this.options.success.call(this.options.scope, response, newValue) : null;\r\n\r\n                //if success callback returns false --> keep form open and do not activate input\r\n                if(res === false) {\r\n                    this.error(false);\r\n                    this.showForm(false);\r\n                    return;\r\n                }\r\n\r\n                //if success callback returns string -->  keep form open, show error and activate input               \r\n                if(typeof res === 'string') {\r\n                    this.error(res);\r\n                    this.showForm();\r\n                    return;\r\n                }\r\n\r\n                //if success callback returns object like {newValue: <something>} --> use that value instead of submitted\r\n                //it is usefull if you want to chnage value in url-function\r\n                if(res && typeof res === 'object' && res.hasOwnProperty('newValue')) {\r\n                    newValue = res.newValue;\r\n                }\r\n\r\n                //clear error message\r\n                this.error(false);   \r\n                this.value = newValue;\r\n                /**        \r\n                Fired when form is submitted\r\n                @event save \r\n                @param {Object} event event object\r\n                @param {Object} params additional params\r\n                @param {mixed} params.newValue raw new value\r\n                @param {mixed} params.submitValue submitted value as string\r\n                @param {Object} params.response ajax response\r\n\r\n                @example\r\n                $('#form-div').on('save'), function(e, params){\r\n                    if(params.newValue === 'username') {...}\r\n                });\r\n                **/\r\n                this.$div.triggerHandler('save', {newValue: newValue, submitValue: submitValue, response: response});\r\n            }, this))\r\n            .fail($.proxy(function(xhr) {\r\n                this.isSaving = false;\r\n\r\n                var msg;\r\n                if(typeof this.options.error === 'function') {\r\n                    msg = this.options.error.call(this.options.scope, xhr, newValue);\r\n                } else {\r\n                    msg = typeof xhr === 'string' ? xhr : xhr.responseText || xhr.statusText || 'Unknown error!';\r\n                }\r\n\r\n                this.error(msg);\r\n                this.showForm();\r\n            }, this));\r\n        },\r\n\r\n        save: function(submitValue) {\r\n            //try parse composite pk defined as json string in data-pk \r\n            this.options.pk = $.fn.editableutils.tryParseJson(this.options.pk, true); \r\n            \r\n            var pk = (typeof this.options.pk === 'function') ? this.options.pk.call(this.options.scope) : this.options.pk,\r\n            /*\r\n              send on server in following cases:\r\n              1. url is function\r\n              2. url is string AND (pk defined OR send option = always) \r\n            */\r\n            send = !!(typeof this.options.url === 'function' || (this.options.url && ((this.options.send === 'always') || (this.options.send === 'auto' && pk !== null && pk !== undefined)))),\r\n            params;\r\n\r\n            if (send) { //send to server\r\n                this.showLoading();\r\n\r\n                //standard params\r\n                params = {\r\n                    name: this.options.name || '',\r\n                    value: submitValue,\r\n                    pk: pk \r\n                };\r\n\r\n                //additional params\r\n                if(typeof this.options.params === 'function') {\r\n                    params = this.options.params.call(this.options.scope, params);  \r\n                } else {\r\n                    //try parse json in single quotes (from data-params attribute)\r\n                    this.options.params = $.fn.editableutils.tryParseJson(this.options.params, true);   \r\n                    $.extend(params, this.options.params);\r\n                }\r\n\r\n                if(typeof this.options.url === 'function') { //user's function\r\n                    return this.options.url.call(this.options.scope, params);\r\n                } else {  \r\n                    //send ajax to server and return deferred object\r\n                    return $.ajax($.extend({\r\n                        url     : this.options.url,\r\n                        data    : params,\r\n                        type    : 'POST'\r\n                    }, this.options.ajaxOptions));\r\n                }\r\n            }\r\n        }, \r\n\r\n        validate: function (value) {\r\n            if (value === undefined) {\r\n                value = this.value;\r\n            }\r\n            if (typeof this.options.validate === 'function') {\r\n                return this.options.validate.call(this.options.scope, value);\r\n            }\r\n        },\r\n\r\n        option: function(key, value) {\r\n            if(key in this.options) {\r\n                this.options[key] = value;\r\n            }\r\n            \r\n            if(key === 'value') {\r\n                this.setValue(value);\r\n            }\r\n            \r\n            //do not pass option to input as it is passed in editable-element\r\n        },\r\n\r\n        setValue: function(value, convertStr) {\r\n            if(convertStr) {\r\n                this.value = this.input.str2value(value);\r\n            } else {\r\n                this.value = value;\r\n            }\r\n            \r\n            //if form is visible, update input\r\n            if(this.$form && this.$form.is(':visible')) {\r\n                this.input.value2input(this.value);\r\n            }            \r\n        }               \r\n    };\r\n\r\n    /*\r\n    Initialize editableform. Applied to jQuery object.\r\n\r\n    @method $().editableform(options)\r\n    @params {Object} options\r\n    @example\r\n    var $form = $('&lt;div&gt;').editableform({\r\n        type: 'text',\r\n        name: 'username',\r\n        url: '/post',\r\n        value: 'vitaliy'\r\n    });\r\n\r\n    //to display form you should call 'render' method\r\n    $form.editableform('render');     \r\n    */\r\n    $.fn.editableform = function (option) {\r\n        var args = arguments;\r\n        return this.each(function () {\r\n            var $this = $(this), \r\n            data = $this.data('editableform'), \r\n            options = typeof option === 'object' && option; \r\n            if (!data) {\r\n                $this.data('editableform', (data = new EditableForm(this, options)));\r\n            }\r\n\r\n            if (typeof option === 'string') { //call method \r\n                data[option].apply(data, Array.prototype.slice.call(args, 1));\r\n            } \r\n        });\r\n    };\r\n\r\n    //keep link to constructor to allow inheritance\r\n    $.fn.editableform.Constructor = EditableForm;    \r\n\r\n    //defaults\r\n    $.fn.editableform.defaults = {\r\n        /* see also defaults for input */\r\n\r\n        /**\r\n        Type of input. Can be <code>text|textarea|select|date|checklist</code>\r\n\r\n        @property type \r\n        @type string\r\n        @default 'text'\r\n        **/\r\n        type: 'text',\r\n        /**\r\n        Url for submit, e.g. <code>'/post'</code>  \r\n        If function - it will be called instead of ajax. Function should return deferred object to run fail/done callbacks.\r\n\r\n        @property url \r\n        @type string|function\r\n        @default null\r\n        @example\r\n        url: function(params) {\r\n            var d = new $.Deferred;\r\n            if(params.value === 'abc') {\r\n                return d.reject('error message'); //returning error via deferred object\r\n            } else {\r\n                //async saving data in js model\r\n                someModel.asyncSaveMethod({\r\n                   ..., \r\n                   success: function(){\r\n                      d.resolve();\r\n                   }\r\n                }); \r\n                return d.promise();\r\n            }\r\n        } \r\n        **/        \r\n        url:null,\r\n        /**\r\n        Additional params for submit. If defined as <code>object</code> - it is **appended** to original ajax data (pk, name and value).  \r\n        If defined as <code>function</code> - returned object **overwrites** original ajax data.\r\n        @example\r\n        params: function(params) {\r\n            //originally params contain pk, name and value\r\n            params.a = 1;\r\n            return params;\r\n        }\r\n\r\n        @property params \r\n        @type object|function\r\n        @default null\r\n        **/          \r\n        params:null,\r\n        /**\r\n        Name of field. Will be submitted on server. Can be taken from <code>id</code> attribute\r\n\r\n        @property name \r\n        @type string\r\n        @default null\r\n        **/         \r\n        name: null,\r\n        /**\r\n        Primary key of editable object (e.g. record id in database). For composite keys use object, e.g. <code>{id: 1, lang: 'en'}</code>.\r\n        Can be calculated dynamically via function.\r\n\r\n        @property pk \r\n        @type string|object|function\r\n        @default null\r\n        **/         \r\n        pk: null,\r\n        /**\r\n        Initial value. If not defined - will be taken from element's content.\r\n        For __select__ type should be defined (as it is ID of shown text).\r\n\r\n        @property value \r\n        @type string|object\r\n        @default null\r\n        **/        \r\n        value: null,\r\n        /**\r\n        Value that will be displayed in input if original field value is empty (`null|undefined|''`).\r\n\r\n        @property defaultValue \r\n        @type string|object\r\n        @default null\r\n        @since 1.4.6\r\n        **/        \r\n        defaultValue: null,\r\n        /**\r\n        Strategy for sending data on server. Can be `auto|always|never`.\r\n        When 'auto' data will be sent on server **only if pk and url defined**, otherwise new value will be stored locally.\r\n\r\n        @property send \r\n        @type string\r\n        @default 'auto'\r\n        **/          \r\n        send: 'auto', \r\n        /**\r\n        Function for client-side validation. If returns string - means validation not passed and string showed as error.\r\n        Since 1.5.1 you can modify submitted value by returning object from `validate`: \r\n        `{newValue: '...'}` or `{newValue: '...', msg: '...'}`\r\n\r\n        @property validate \r\n        @type function\r\n        @default null\r\n        @example\r\n        validate: function(value) {\r\n            if($.trim(value) == '') {\r\n                return 'This field is required';\r\n            }\r\n        }\r\n        **/         \r\n        validate: null,\r\n        /**\r\n        Success callback. Called when value successfully sent on server and **response status = 200**.  \r\n        Usefull to work with json response. For example, if your backend response can be <code>{success: true}</code>\r\n        or <code>{success: false, msg: \"server error\"}</code> you can check it inside this callback.  \r\n        If it returns **string** - means error occured and string is shown as error message.  \r\n        If it returns **object like** <code>{newValue: &lt;something&gt;}</code> - it overwrites value, submitted by user.  \r\n        Otherwise newValue simply rendered into element.\r\n        \r\n        @property success \r\n        @type function\r\n        @default null\r\n        @example\r\n        success: function(response, newValue) {\r\n            if(!response.success) return response.msg;\r\n        }\r\n        **/          \r\n        success: null,\r\n        /**\r\n        Error callback. Called when request failed (response status != 200).  \r\n        Usefull when you want to parse error response and display a custom message.\r\n        Must return **string** - the message to be displayed in the error block.\r\n                \r\n        @property error \r\n        @type function\r\n        @default null\r\n        @since 1.4.4\r\n        @example\r\n        error: function(response, newValue) {\r\n            if(response.status === 500) {\r\n                return 'Service unavailable. Please try later.';\r\n            } else {\r\n                return response.responseText;\r\n            }\r\n        }\r\n        **/          \r\n        error: null,\r\n        /**\r\n        Additional options for submit ajax request.\r\n        List of values: http://api.jquery.com/jQuery.ajax\r\n        \r\n        @property ajaxOptions \r\n        @type object\r\n        @default null\r\n        @since 1.1.1        \r\n        @example \r\n        ajaxOptions: {\r\n            type: 'put',\r\n            dataType: 'json'\r\n        }        \r\n        **/        \r\n        ajaxOptions: null,\r\n        /**\r\n        Where to show buttons: left(true)|bottom|false  \r\n        Form without buttons is auto-submitted.\r\n\r\n        @property showbuttons \r\n        @type boolean|string\r\n        @default true\r\n        @since 1.1.1\r\n        **/         \r\n        showbuttons: true,\r\n        /**\r\n        Scope for callback methods (success, validate).  \r\n        If <code>null</code> means editableform instance itself. \r\n\r\n        @property scope \r\n        @type DOMElement|object\r\n        @default null\r\n        @since 1.2.0\r\n        @private\r\n        **/            \r\n        scope: null,\r\n        /**\r\n        Whether to save or cancel value when it was not changed but form was submitted\r\n\r\n        @property savenochange \r\n        @type boolean\r\n        @default false\r\n        @since 1.2.0\r\n        **/\r\n        savenochange: false\r\n    };   \r\n\r\n    /*\r\n    Note: following params could redefined in engine: bootstrap or jqueryui:\r\n    Classes 'control-group' and 'editable-error-block' must always present!\r\n    */      \r\n    $.fn.editableform.template = '<form class=\"form-inline editableform\">'+\r\n    '<div class=\"control-group\">' + \r\n    '<div><div class=\"editable-input\"></div><div class=\"editable-buttons\"></div></div>'+\r\n    '<div class=\"editable-error-block\"></div>' + \r\n    '</div>' + \r\n    '</form>';\r\n\r\n    //loading div\r\n    $.fn.editableform.loading = '<div class=\"editableform-loading\"></div>';\r\n\r\n    //buttons\r\n    $.fn.editableform.buttons = '<button type=\"submit\" class=\"editable-submit\">ok</button>'+\r\n    '<button type=\"button\" class=\"editable-cancel\">cancel</button>';      \r\n\r\n    //error class attached to control-group\r\n    $.fn.editableform.errorGroupClass = null;  \r\n\r\n    //error class attached to editable-error-block\r\n    $.fn.editableform.errorBlockClass = 'editable-error';\r\n    \r\n    //engine\r\n    $.fn.editableform.engine = 'jquery';\r\n}(window.jQuery));\r\n\r\n/**\r\n* EditableForm utilites\r\n*/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    //utils\r\n    $.fn.editableutils = {\r\n        /**\r\n        * classic JS inheritance function\r\n        */  \r\n        inherit: function (Child, Parent) {\r\n            var F = function() { };\r\n            F.prototype = Parent.prototype;\r\n            Child.prototype = new F();\r\n            Child.prototype.constructor = Child;\r\n            Child.superclass = Parent.prototype;\r\n        },\r\n\r\n        /**\r\n        * set caret position in input\r\n        * see http://stackoverflow.com/questions/499126/jquery-set-cursor-position-in-text-area\r\n        */        \r\n        setCursorPosition: function(elem, pos) {\r\n            if (elem.setSelectionRange) {\r\n                elem.setSelectionRange(pos, pos);\r\n            } else if (elem.createTextRange) {\r\n                var range = elem.createTextRange();\r\n                range.collapse(true);\r\n                range.moveEnd('character', pos);\r\n                range.moveStart('character', pos);\r\n                range.select();\r\n            }\r\n        },\r\n\r\n        /**\r\n        * function to parse JSON in *single* quotes. (jquery automatically parse only double quotes)\r\n        * That allows such code as: <a data-source=\"{'a': 'b', 'c': 'd'}\">\r\n        * safe = true --> means no exception will be thrown\r\n        * for details see http://stackoverflow.com/questions/7410348/how-to-set-json-format-to-html5-data-attributes-in-the-jquery\r\n        */\r\n        tryParseJson: function(s, safe) {\r\n            if (typeof s === 'string' && s.length && s.match(/^[\\{\\[].*[\\}\\]]$/)) {\r\n                if (safe) {\r\n                    try {\r\n                        /*jslint evil: true*/\r\n                        s = (new Function('return ' + s))();\r\n                        /*jslint evil: false*/\r\n                    } catch (e) {} finally {\r\n                        return s;\r\n                    }\r\n                } else {\r\n                    /*jslint evil: true*/\r\n                    s = (new Function('return ' + s))();\r\n                    /*jslint evil: false*/\r\n                }\r\n            }\r\n            return s;\r\n        },\r\n\r\n        /**\r\n        * slice object by specified keys\r\n        */\r\n        sliceObj: function(obj, keys, caseSensitive /* default: false */) {\r\n            var key, keyLower, newObj = {};\r\n\r\n            if (!$.isArray(keys) || !keys.length) {\r\n                return newObj;\r\n            }\r\n\r\n            for (var i = 0; i < keys.length; i++) {\r\n                key = keys[i];\r\n                if (obj.hasOwnProperty(key)) {\r\n                    newObj[key] = obj[key];\r\n                }\r\n\r\n                if(caseSensitive === true) {\r\n                    continue;\r\n                }\r\n\r\n                //when getting data-* attributes via $.data() it's converted to lowercase.\r\n                //details: http://stackoverflow.com/questions/7602565/using-data-attributes-with-jquery\r\n                //workaround is code below.\r\n                keyLower = key.toLowerCase();\r\n                if (obj.hasOwnProperty(keyLower)) {\r\n                    newObj[key] = obj[keyLower];\r\n                }\r\n            }\r\n\r\n            return newObj;\r\n        },\r\n\r\n        /*\r\n        exclude complex objects from $.data() before pass to config\r\n        */\r\n        getConfigData: function($element) {\r\n            var data = {};\r\n            $.each($element.data(), function(k, v) {\r\n                if(typeof v !== 'object' || (v && typeof v === 'object' && (v.constructor === Object || v.constructor === Array))) {\r\n                    data[k] = v;\r\n                }\r\n            });\r\n            return data;\r\n        },\r\n\r\n        /*\r\n         returns keys of object\r\n        */\r\n        objectKeys: function(o) {\r\n            if (Object.keys) {\r\n                return Object.keys(o);  \r\n            } else {\r\n                if (o !== Object(o)) {\r\n                    throw new TypeError('Object.keys called on a non-object');\r\n                }\r\n                var k=[], p;\r\n                for (p in o) {\r\n                    if (Object.prototype.hasOwnProperty.call(o,p)) {\r\n                        k.push(p);\r\n                    }\r\n                }\r\n                return k;\r\n            }\r\n\r\n        },\r\n        \r\n       /**\r\n        method to escape html.\r\n       **/\r\n       escape: function(str) {\r\n           return $('<div>').text(str).html();\r\n       },\r\n       \r\n       /*\r\n        returns array items from sourceData having value property equal or inArray of 'value'\r\n       */\r\n       itemsByValue: function(value, sourceData, valueProp) {\r\n           if(!sourceData || value === null) {\r\n               return [];\r\n           }\r\n           \r\n           if (typeof(valueProp) !== \"function\") {\r\n               var idKey = valueProp || 'value';\r\n               valueProp = function (e) { return e[idKey]; };\r\n           }\r\n                      \r\n           var isValArray = $.isArray(value),\r\n           result = [], \r\n           that = this;\r\n\r\n           $.each(sourceData, function(i, o) {\r\n               if(o.children) {\r\n                   result = result.concat(that.itemsByValue(value, o.children, valueProp));\r\n               } else {\r\n                   /*jslint eqeq: true*/\r\n                   if(isValArray) {\r\n                       if($.grep(value, function(v){  return v == (o && typeof o === 'object' ? valueProp(o) : o); }).length) {\r\n                           result.push(o); \r\n                       }\r\n                   } else {\r\n                       var itemValue = (o && (typeof o === 'object')) ? valueProp(o) : o;\r\n                       if(value == itemValue) {\r\n                           result.push(o); \r\n                       }\r\n                   }\r\n                   /*jslint eqeq: false*/\r\n               }\r\n           });\r\n           \r\n           return result;\r\n       },\r\n       \r\n       /*\r\n       Returns input by options: type, mode. \r\n       */\r\n       createInput: function(options) {\r\n           var TypeConstructor, typeOptions, input,\r\n           type = options.type;\r\n\r\n           //`date` is some kind of virtual type that is transformed to one of exact types\r\n           //depending on mode and core lib\r\n           if(type === 'date') {\r\n               //inline\r\n               if(options.mode === 'inline') {\r\n                   if($.fn.editabletypes.datefield) {\r\n                       type = 'datefield';\r\n                   } else if($.fn.editabletypes.dateuifield) {\r\n                       type = 'dateuifield';\r\n                   }\r\n               //popup\r\n               } else {\r\n                   if($.fn.editabletypes.date) {\r\n                       type = 'date';\r\n                   } else if($.fn.editabletypes.dateui) {\r\n                       type = 'dateui';\r\n                   }\r\n               }\r\n               \r\n               //if type still `date` and not exist in types, replace with `combodate` that is base input\r\n               if(type === 'date' && !$.fn.editabletypes.date) {\r\n                   type = 'combodate';\r\n               } \r\n           }\r\n           \r\n           //`datetime` should be datetimefield in 'inline' mode\r\n           if(type === 'datetime' && options.mode === 'inline') {\r\n             type = 'datetimefield';  \r\n           }           \r\n\r\n           //change wysihtml5 to textarea for jquery UI and plain versions\r\n           if(type === 'wysihtml5' && !$.fn.editabletypes[type]) {\r\n               type = 'textarea';\r\n           }\r\n\r\n           //create input of specified type. Input will be used for converting value, not in form\r\n           if(typeof $.fn.editabletypes[type] === 'function') {\r\n               TypeConstructor = $.fn.editabletypes[type];\r\n               typeOptions = this.sliceObj(options, this.objectKeys(TypeConstructor.defaults));\r\n               input = new TypeConstructor(typeOptions);\r\n               return input;\r\n           } else {\r\n               $.error('Unknown type: '+ type);\r\n               return false; \r\n           }  \r\n       },\r\n       \r\n       //see http://stackoverflow.com/questions/7264899/detect-css-transitions-using-javascript-and-without-modernizr\r\n       supportsTransitions: function () {\r\n           var b = document.body || document.documentElement,\r\n               s = b.style,\r\n               p = 'transition',\r\n               v = ['Moz', 'Webkit', 'Khtml', 'O', 'ms'];\r\n               \r\n           if(typeof s[p] === 'string') {\r\n               return true; \r\n           }\r\n\r\n           // Tests for vendor specific prop\r\n           p = p.charAt(0).toUpperCase() + p.substr(1);\r\n           for(var i=0; i<v.length; i++) {\r\n               if(typeof s[v[i] + p] === 'string') { \r\n                   return true; \r\n               }\r\n           }\r\n           return false;\r\n       }            \r\n       \r\n    };      \r\n}(window.jQuery));\r\n\r\n/**\r\nAttaches stand-alone container with editable-form to HTML element. Element is used only for positioning, value is not stored anywhere.<br>\r\nThis method applied internally in <code>$().editable()</code>. You should subscribe on it's events (save / cancel) to get profit of it.<br>\r\nFinal realization can be different: bootstrap-popover, jqueryui-tooltip, poshytip, inline-div. It depends on which js file you include.<br>\r\nApplied as jQuery method.\r\n\r\n@class editableContainer\r\n@uses editableform\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n\r\n    var Popup = function (element, options) {\r\n        this.init(element, options);\r\n    };\r\n    \r\n    var Inline = function (element, options) {\r\n        this.init(element, options);\r\n    };    \r\n\r\n    //methods\r\n    Popup.prototype = {\r\n        containerName: null, //method to call container on element\r\n        containerDataName: null, //object name in element's .data()\r\n        innerCss: null, //tbd in child class\r\n        containerClass: 'editable-container editable-popup', //css class applied to container element\r\n        defaults: {}, //container itself defaults\r\n        \r\n        init: function(element, options) {\r\n            this.$element = $(element);\r\n            //since 1.4.1 container do not use data-* directly as they already merged into options.\r\n            this.options = $.extend({}, $.fn.editableContainer.defaults, options);         \r\n            this.splitOptions();\r\n            \r\n            //set scope of form callbacks to element\r\n            this.formOptions.scope = this.$element[0]; \r\n            \r\n            this.initContainer();\r\n            \r\n            //flag to hide container, when saving value will finish\r\n            this.delayedHide = false;\r\n\r\n            //bind 'destroyed' listener to destroy container when element is removed from dom\r\n            this.$element.on('destroyed', $.proxy(function(){\r\n                this.destroy();\r\n            }, this)); \r\n            \r\n            //attach document handler to close containers on click / escape\r\n            if(!$(document).data('editable-handlers-attached')) {\r\n                //close all on escape\r\n                $(document).on('keyup.editable', function (e) {\r\n                    if (e.which === 27) {\r\n                        $('.editable-open').editableContainer('hide');\r\n                        //todo: return focus on element \r\n                    }\r\n                });\r\n\r\n                //close containers when click outside \r\n                //(mousedown could be better than click, it closes everything also on drag drop)\r\n                $(document).on('click.editable', function(e) {\r\n                    var $target = $(e.target), i,\r\n                        exclude_classes = ['.editable-container', \r\n                                           '.ui-datepicker-header', \r\n                                           '.datepicker', //in inline mode datepicker is rendered into body\r\n                                           '.modal-backdrop', \r\n                                           '.bootstrap-wysihtml5-insert-image-modal', \r\n                                           '.bootstrap-wysihtml5-insert-link-modal'\r\n                                           ];\r\n                    \r\n                    //check if element is detached. It occurs when clicking in bootstrap datepicker\r\n                    if (!$.contains(document.documentElement, e.target)) {\r\n                      return;\r\n                    }\r\n\r\n                    //for some reason FF 20 generates extra event (click) in select2 widget with e.target = document\r\n                    //we need to filter it via construction below. See https://github.com/vitalets/x-editable/issues/199\r\n                    //Possibly related to http://stackoverflow.com/questions/10119793/why-does-firefox-react-differently-from-webkit-and-ie-to-click-event-on-selec\r\n                    if($target.is(document)) {\r\n                       return; \r\n                    }\r\n                    \r\n                    //if click inside one of exclude classes --> no nothing\r\n                    for(i=0; i<exclude_classes.length; i++) {\r\n                         if($target.is(exclude_classes[i]) || $target.parents(exclude_classes[i]).length) {\r\n                             return;\r\n                         }\r\n                    }\r\n                      \r\n                    //close all open containers (except one - target)\r\n                    Popup.prototype.closeOthers(e.target);\r\n                });\r\n                \r\n                $(document).data('editable-handlers-attached', true);\r\n            }                        \r\n        },\r\n\r\n        //split options on containerOptions and formOptions\r\n        splitOptions: function() {\r\n            this.containerOptions = {};\r\n            this.formOptions = {};\r\n            \r\n            if(!$.fn[this.containerName]) {\r\n                throw new Error(this.containerName + ' not found. Have you included corresponding js file?');   \r\n            }\r\n            \r\n            //keys defined in container defaults go to container, others go to form\r\n            for(var k in this.options) {\r\n              if(k in this.defaults) {\r\n                 this.containerOptions[k] = this.options[k];\r\n              } else {\r\n                 this.formOptions[k] = this.options[k];\r\n              } \r\n            }\r\n        },\r\n        \r\n        /*\r\n        Returns jquery object of container\r\n        @method tip()\r\n        */         \r\n        tip: function() {\r\n            return this.container() ? this.container().$tip : null;\r\n        },\r\n\r\n        /* returns container object */\r\n        container: function() {\r\n            var container;\r\n            //first, try get it by `containerDataName`\r\n            if(this.containerDataName) {\r\n                if(container = this.$element.data(this.containerDataName)) {\r\n                    return container;\r\n                }\r\n            }\r\n            //second, try `containerName`\r\n            container = this.$element.data(this.containerName);\r\n            return container;\r\n        },\r\n\r\n        /* call native method of underlying container, e.g. this.$element.popover('method') */ \r\n        call: function() {\r\n            this.$element[this.containerName].apply(this.$element, arguments); \r\n        },        \r\n        \r\n        initContainer: function(){\r\n            this.call(this.containerOptions);\r\n        },\r\n\r\n        renderForm: function() {\r\n            this.$form\r\n            .editableform(this.formOptions)\r\n            .on({\r\n                save: $.proxy(this.save, this), //click on submit button (value changed)\r\n                nochange: $.proxy(function(){ this.hide('nochange'); }, this), //click on submit button (value NOT changed)                \r\n                cancel: $.proxy(function(){ this.hide('cancel'); }, this), //click on calcel button\r\n                show: $.proxy(function() {\r\n                    if(this.delayedHide) {\r\n                        this.hide(this.delayedHide.reason);\r\n                        this.delayedHide = false;\r\n                    } else {\r\n                        this.setPosition();\r\n                    }\r\n                }, this), //re-position container every time form is shown (occurs each time after loading state)\r\n                rendering: $.proxy(this.setPosition, this), //this allows to place container correctly when loading shown\r\n                resize: $.proxy(this.setPosition, this), //this allows to re-position container when form size is changed \r\n                rendered: $.proxy(function(){\r\n                    /**        \r\n                    Fired when container is shown and form is rendered (for select will wait for loading dropdown options).  \r\n                    **Note:** Bootstrap popover has own `shown` event that now cannot be separated from x-editable's one.\r\n                    The workaround is to check `arguments.length` that is always `2` for x-editable.                     \r\n                    \r\n                    @event shown \r\n                    @param {Object} event event object\r\n                    @example\r\n                    $('#username').on('shown', function(e, editable) {\r\n                        editable.input.$input.val('overwriting value of input..');\r\n                    });                     \r\n                    **/                      \r\n                    /*\r\n                     TODO: added second param mainly to distinguish from bootstrap's shown event. It's a hotfix that will be solved in future versions via namespaced events.  \r\n                    */\r\n                    this.$element.triggerHandler('shown', $(this.options.scope).data('editable')); \r\n                }, this) \r\n            })\r\n            .editableform('render');\r\n        },        \r\n\r\n        /**\r\n        Shows container with form\r\n        @method show()\r\n        @param {boolean} closeAll Whether to close all other editable containers when showing this one. Default true.\r\n        **/\r\n        /* Note: poshytip owerwrites this method totally! */          \r\n        show: function (closeAll) {\r\n            this.$element.addClass('editable-open');\r\n            if(closeAll !== false) {\r\n                //close all open containers (except this)\r\n                this.closeOthers(this.$element[0]);  \r\n            }\r\n            \r\n            //show container itself\r\n            this.innerShow();\r\n            this.tip().addClass(this.containerClass);\r\n\r\n            /*\r\n            Currently, form is re-rendered on every show. \r\n            The main reason is that we dont know, what will container do with content when closed:\r\n            remove(), detach() or just hide() - it depends on container.\r\n            \r\n            Detaching form itself before hide and re-insert before show is good solution, \r\n            but visually it looks ugly --> container changes size before hide.  \r\n            */             \r\n            \r\n            //if form already exist - delete previous data \r\n            if(this.$form) {\r\n                //todo: destroy prev data!\r\n                //this.$form.destroy();\r\n            }\r\n\r\n            this.$form = $('<div>');\r\n            \r\n            //insert form into container body\r\n            if(this.tip().is(this.innerCss)) {\r\n                //for inline container\r\n                this.tip().append(this.$form); \r\n            } else {\r\n                this.tip().find(this.innerCss).append(this.$form);\r\n            } \r\n            \r\n            //render form\r\n            this.renderForm();\r\n        },\r\n\r\n        /**\r\n        Hides container with form\r\n        @method hide()\r\n        @param {string} reason Reason caused hiding. Can be <code>save|cancel|onblur|nochange|undefined (=manual)</code>\r\n        **/         \r\n        hide: function(reason) {  \r\n            if(!this.tip() || !this.tip().is(':visible') || !this.$element.hasClass('editable-open')) {\r\n                return;\r\n            }\r\n            \r\n            //if form is saving value, schedule hide\r\n            if(this.$form.data('editableform').isSaving) {\r\n                this.delayedHide = {reason: reason};\r\n                return;    \r\n            } else {\r\n                this.delayedHide = false;\r\n            }\r\n\r\n            this.$element.removeClass('editable-open');   \r\n            this.innerHide();\r\n\r\n            /**\r\n            Fired when container was hidden. It occurs on both save or cancel.  \r\n            **Note:** Bootstrap popover has own `hidden` event that now cannot be separated from x-editable's one.\r\n            The workaround is to check `arguments.length` that is always `2` for x-editable. \r\n\r\n            @event hidden \r\n            @param {object} event event object\r\n            @param {string} reason Reason caused hiding. Can be <code>save|cancel|onblur|nochange|manual</code>\r\n            @example\r\n            $('#username').on('hidden', function(e, reason) {\r\n                if(reason === 'save' || reason === 'cancel') {\r\n                    //auto-open next editable\r\n                    $(this).closest('tr').next().find('.editable').editable('show');\r\n                } \r\n            });\r\n            **/\r\n            this.$element.triggerHandler('hidden', reason || 'manual');   \r\n        },\r\n\r\n        /* internal show method. To be overwritten in child classes */\r\n        innerShow: function () {\r\n             \r\n        },        \r\n\r\n        /* internal hide method. To be overwritten in child classes */\r\n        innerHide: function () {\r\n\r\n        },\r\n        \r\n        /**\r\n        Toggles container visibility (show / hide)\r\n        @method toggle()\r\n        @param {boolean} closeAll Whether to close all other editable containers when showing this one. Default true.\r\n        **/          \r\n        toggle: function(closeAll) {\r\n            if(this.container() && this.tip() && this.tip().is(':visible')) {\r\n                this.hide();\r\n            } else {\r\n                this.show(closeAll);\r\n            } \r\n        },\r\n\r\n        /*\r\n        Updates the position of container when content changed.\r\n        @method setPosition()\r\n        */       \r\n        setPosition: function() {\r\n            //tbd in child class\r\n        },\r\n\r\n        save: function(e, params) {\r\n            /**        \r\n            Fired when new value was submitted. You can use <code>$(this).data('editableContainer')</code> inside handler to access to editableContainer instance\r\n            \r\n            @event save \r\n            @param {Object} event event object\r\n            @param {Object} params additional params\r\n            @param {mixed} params.newValue submitted value\r\n            @param {Object} params.response ajax response\r\n            @example\r\n            $('#username').on('save', function(e, params) {\r\n                //assuming server response: '{success: true}'\r\n                var pk = $(this).data('editableContainer').options.pk;\r\n                if(params.response && params.response.success) {\r\n                    alert('value: ' + params.newValue + ' with pk: ' + pk + ' saved!');\r\n                } else {\r\n                    alert('error!'); \r\n                } \r\n            });\r\n            **/             \r\n            this.$element.triggerHandler('save', params);\r\n            \r\n            //hide must be after trigger, as saving value may require methods of plugin, applied to input\r\n            this.hide('save');\r\n        },\r\n\r\n        /**\r\n        Sets new option\r\n        \r\n        @method option(key, value)\r\n        @param {string} key \r\n        @param {mixed} value \r\n        **/         \r\n        option: function(key, value) {\r\n            this.options[key] = value;\r\n            if(key in this.containerOptions) {\r\n                this.containerOptions[key] = value;\r\n                this.setContainerOption(key, value); \r\n            } else {\r\n                this.formOptions[key] = value;\r\n                if(this.$form) {\r\n                    this.$form.editableform('option', key, value);  \r\n                }\r\n            }\r\n        },\r\n        \r\n        setContainerOption: function(key, value) {\r\n            this.call('option', key, value);\r\n        },\r\n\r\n        /**\r\n        Destroys the container instance\r\n        @method destroy()\r\n        **/        \r\n        destroy: function() {\r\n            this.hide();\r\n            this.innerDestroy();\r\n            this.$element.off('destroyed');\r\n            this.$element.removeData('editableContainer');\r\n        },\r\n        \r\n        /* to be overwritten in child classes */\r\n        innerDestroy: function() {\r\n            \r\n        }, \r\n        \r\n        /*\r\n        Closes other containers except one related to passed element. \r\n        Other containers can be cancelled or submitted (depends on onblur option)\r\n        */\r\n        closeOthers: function(element) {\r\n            $('.editable-open').each(function(i, el){\r\n                //do nothing with passed element and it's children\r\n                if(el === element || $(el).find(element).length) {\r\n                    return;\r\n                }\r\n\r\n                //otherwise cancel or submit all open containers \r\n                var $el = $(el),\r\n                ec = $el.data('editableContainer');\r\n\r\n                if(!ec) {\r\n                    return;  \r\n                }\r\n                \r\n                if(ec.options.onblur === 'cancel') {\r\n                    $el.data('editableContainer').hide('onblur');\r\n                } else if(ec.options.onblur === 'submit') {\r\n                    $el.data('editableContainer').tip().find('form').submit();\r\n                }\r\n            });\r\n\r\n        },\r\n        \r\n        /**\r\n        Activates input of visible container (e.g. set focus)\r\n        @method activate()\r\n        **/         \r\n        activate: function() {\r\n            if(this.tip && this.tip().is(':visible') && this.$form) {\r\n               this.$form.data('editableform').input.activate(); \r\n            }\r\n        } \r\n\r\n    };\r\n\r\n    /**\r\n    jQuery method to initialize editableContainer.\r\n    \r\n    @method $().editableContainer(options)\r\n    @params {Object} options\r\n    @example\r\n    $('#edit').editableContainer({\r\n        type: 'text',\r\n        url: '/post',\r\n        pk: 1,\r\n        value: 'hello'\r\n    });\r\n    **/  \r\n    $.fn.editableContainer = function (option) {\r\n        var args = arguments;\r\n        return this.each(function () {\r\n            var $this = $(this),\r\n            dataKey = 'editableContainer', \r\n            data = $this.data(dataKey),\r\n            options = typeof option === 'object' && option,\r\n            Constructor = (options.mode === 'inline') ? Inline : Popup;             \r\n\r\n            if (!data) {\r\n                $this.data(dataKey, (data = new Constructor(this, options)));\r\n            }\r\n\r\n            if (typeof option === 'string') { //call method \r\n                data[option].apply(data, Array.prototype.slice.call(args, 1));\r\n            }            \r\n        });\r\n    };     \r\n\r\n    //store constructors\r\n    $.fn.editableContainer.Popup = Popup;\r\n    $.fn.editableContainer.Inline = Inline;\r\n\r\n    //defaults\r\n    $.fn.editableContainer.defaults = {\r\n        /**\r\n        Initial value of form input\r\n\r\n        @property value \r\n        @type mixed\r\n        @default null\r\n        @private\r\n        **/        \r\n        value: null,\r\n        /**\r\n        Placement of container relative to element. Can be <code>top|right|bottom|left</code>. Not used for inline container.\r\n\r\n        @property placement \r\n        @type string\r\n        @default 'top'\r\n        **/        \r\n        placement: 'top',\r\n        /**\r\n        Whether to hide container on save/cancel.\r\n\r\n        @property autohide \r\n        @type boolean\r\n        @default true\r\n        @private \r\n        **/        \r\n        autohide: true,\r\n        /**\r\n        Action when user clicks outside the container. Can be <code>cancel|submit|ignore</code>.  \r\n        Setting <code>ignore</code> allows to have several containers open. \r\n\r\n        @property onblur \r\n        @type string\r\n        @default 'cancel'\r\n        @since 1.1.1\r\n        **/        \r\n        onblur: 'cancel',\r\n        \r\n        /**\r\n        Animation speed (inline mode only)\r\n        @property anim \r\n        @type string\r\n        @default false\r\n        **/        \r\n        anim: false,\r\n        \r\n        /**\r\n        Mode of editable, can be `popup` or `inline` \r\n        \r\n        @property mode \r\n        @type string         \r\n        @default 'popup'\r\n        @since 1.4.0        \r\n        **/        \r\n        mode: 'popup'        \r\n    };\r\n\r\n    /* \r\n    * workaround to have 'destroyed' event to destroy popover when element is destroyed\r\n    * see http://stackoverflow.com/questions/2200494/jquery-trigger-event-when-an-element-is-removed-from-the-dom\r\n    */\r\n    jQuery.event.special.destroyed = {\r\n        remove: function(o) {\r\n            if (o.handler) {\r\n                o.handler();\r\n            }\r\n        }\r\n    };    \r\n\r\n}(window.jQuery));\r\n\r\n/**\r\n* Editable Inline \r\n* ---------------------\r\n*/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    //copy prototype from EditableContainer\r\n    //extend methods\r\n    $.extend($.fn.editableContainer.Inline.prototype, $.fn.editableContainer.Popup.prototype, {\r\n        containerName: 'editableform',\r\n        innerCss: '.editable-inline',\r\n        containerClass: 'editable-container editable-inline', //css class applied to container element\r\n                 \r\n        initContainer: function(){\r\n            //container is <span> element\r\n            this.$tip = $('<span></span>');\r\n            \r\n            //convert anim to miliseconds (int)\r\n            if(!this.options.anim) {\r\n                this.options.anim = 0;\r\n            }         \r\n        },\r\n        \r\n        splitOptions: function() {\r\n            //all options are passed to form\r\n            this.containerOptions = {};\r\n            this.formOptions = this.options;\r\n        },\r\n        \r\n        tip: function() {\r\n           return this.$tip; \r\n        },\r\n        \r\n        innerShow: function () {\r\n            this.$element.hide();\r\n            this.tip().insertAfter(this.$element).show();\r\n        }, \r\n        \r\n        innerHide: function () {\r\n            this.$tip.hide(this.options.anim, $.proxy(function() {\r\n                this.$element.show();\r\n                this.innerDestroy();\r\n            }, this)); \r\n        },\r\n        \r\n        innerDestroy: function() {\r\n            if(this.tip()) {\r\n                this.tip().empty().remove();\r\n            }\r\n        } \r\n    });\r\n\r\n}(window.jQuery));\r\n/**\r\nMakes editable any HTML element on the page. Applied as jQuery method.\r\n\r\n@class editable\r\n@uses editableContainer\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n\r\n    var Editable = function (element, options) {\r\n        this.$element = $(element);\r\n        //data-* has more priority over js options: because dynamically created elements may change data-* \r\n        this.options = $.extend({}, $.fn.editable.defaults, options, $.fn.editableutils.getConfigData(this.$element));  \r\n        if(this.options.selector) {\r\n            this.initLive();\r\n        } else {\r\n            this.init();\r\n        }\r\n        \r\n        //check for transition support\r\n        if(this.options.highlight && !$.fn.editableutils.supportsTransitions()) {\r\n            this.options.highlight = false;\r\n        }\r\n    };\r\n\r\n    Editable.prototype = {\r\n        constructor: Editable, \r\n        init: function () {\r\n            var isValueByText = false, \r\n                doAutotext, finalize;\r\n\r\n            //name\r\n            this.options.name = this.options.name || this.$element.attr('id');\r\n             \r\n            //create input of specified type. Input needed already here to convert value for initial display (e.g. show text by id for select)\r\n            //also we set scope option to have access to element inside input specific callbacks (e. g. source as function)\r\n            this.options.scope = this.$element[0]; \r\n            this.input = $.fn.editableutils.createInput(this.options);\r\n            if(!this.input) {\r\n                return; \r\n            }            \r\n\r\n            //set value from settings or by element's text\r\n            if (this.options.value === undefined || this.options.value === null) {\r\n                this.value = this.input.html2value($.trim(this.$element.html()));\r\n                isValueByText = true;\r\n            } else {\r\n                /*\r\n                  value can be string when received from 'data-value' attribute\r\n                  for complext objects value can be set as json string in data-value attribute, \r\n                  e.g. data-value=\"{city: 'Moscow', street: 'Lenina'}\"\r\n                */\r\n                this.options.value = $.fn.editableutils.tryParseJson(this.options.value, true); \r\n                if(typeof this.options.value === 'string') {\r\n                    this.value = this.input.str2value(this.options.value);\r\n                } else {\r\n                    this.value = this.options.value;\r\n                }\r\n            }\r\n            \r\n            //add 'editable' class to every editable element\r\n            this.$element.addClass('editable');\r\n            \r\n            //specifically for \"textarea\" add class .editable-pre-wrapped to keep linebreaks\r\n            if(this.input.type === 'textarea') {\r\n                this.$element.addClass('editable-pre-wrapped');\r\n            }\r\n            \r\n            //attach handler activating editable. In disabled mode it just prevent default action (useful for links)\r\n            if(this.options.toggle !== 'manual') {\r\n                this.$element.addClass('editable-click');\r\n                this.$element.on(this.options.toggle + '.editable', $.proxy(function(e){\r\n                    //prevent following link if editable enabled\r\n                    if(!this.options.disabled) {\r\n                        e.preventDefault();\r\n                    }\r\n                    \r\n                    //stop propagation not required because in document click handler it checks event target\r\n                    //e.stopPropagation();\r\n                    \r\n                    if(this.options.toggle === 'mouseenter') {\r\n                        //for hover only show container\r\n                        this.show();\r\n                    } else {\r\n                        //when toggle='click' we should not close all other containers as they will be closed automatically in document click listener\r\n                        var closeAll = (this.options.toggle !== 'click');\r\n                        this.toggle(closeAll);\r\n                    }\r\n                }, this));\r\n            } else {\r\n                this.$element.attr('tabindex', -1); //do not stop focus on element when toggled manually\r\n            }\r\n            \r\n            //if display is function it's far more convinient to have autotext = always to render correctly on init\r\n            //see https://github.com/vitalets/x-editable-yii/issues/34\r\n            if(typeof this.options.display === 'function') {\r\n                this.options.autotext = 'always';\r\n            }\r\n            \r\n            //check conditions for autotext:\r\n            switch(this.options.autotext) {\r\n              case 'always':\r\n               doAutotext = true;\r\n              break;\r\n              case 'auto':\r\n                //if element text is empty and value is defined and value not generated by text --> run autotext\r\n                doAutotext = !$.trim(this.$element.text()).length && this.value !== null && this.value !== undefined && !isValueByText;\r\n              break;\r\n              default:\r\n               doAutotext = false;\r\n            }\r\n\r\n            //depending on autotext run render() or just finilize init\r\n            $.when(doAutotext ? this.render() : true).then($.proxy(function() {\r\n                if(this.options.disabled) {\r\n                    this.disable();\r\n                } else {\r\n                    this.enable(); \r\n                }\r\n               /**        \r\n               Fired when element was initialized by `$().editable()` method. \r\n               Please note that you should setup `init` handler **before** applying `editable`. \r\n                              \r\n               @event init \r\n               @param {Object} event event object\r\n               @param {Object} editable editable instance (as here it cannot accessed via data('editable'))\r\n               @since 1.2.0\r\n               @example\r\n               $('#username').on('init', function(e, editable) {\r\n                   alert('initialized ' + editable.options.name);\r\n               });\r\n               $('#username').editable();\r\n               **/                  \r\n                this.$element.triggerHandler('init', this);\r\n            }, this));\r\n        },\r\n\r\n        /*\r\n         Initializes parent element for live editables \r\n        */\r\n        initLive: function() {\r\n           //store selector \r\n           var selector = this.options.selector;\r\n           //modify options for child elements\r\n           this.options.selector = false; \r\n           this.options.autotext = 'never';\r\n           //listen toggle events\r\n           this.$element.on(this.options.toggle + '.editable', selector, $.proxy(function(e){\r\n               var $target = $(e.target);\r\n               if(!$target.data('editable')) {\r\n                   //if delegated element initially empty, we need to clear it's text (that was manually set to `empty` by user)\r\n                   //see https://github.com/vitalets/x-editable/issues/137 \r\n                   if($target.hasClass(this.options.emptyclass)) {\r\n                      $target.empty();\r\n                   }\r\n                   $target.editable(this.options).trigger(e);\r\n               }\r\n           }, this)); \r\n        },\r\n        \r\n        /*\r\n        Renders value into element's text.\r\n        Can call custom display method from options.\r\n        Can return deferred object.\r\n        @method render()\r\n        @param {mixed} response server response (if exist) to pass into display function\r\n        */          \r\n        render: function(response) {\r\n            //do not display anything\r\n            if(this.options.display === false) {\r\n                return;\r\n            }\r\n            \r\n            //if input has `value2htmlFinal` method, we pass callback in third param to be called when source is loaded\r\n            if(this.input.value2htmlFinal) {\r\n                return this.input.value2html(this.value, this.$element[0], this.options.display, response); \r\n            //if display method defined --> use it    \r\n            } else if(typeof this.options.display === 'function') {\r\n                return this.options.display.call(this.$element[0], this.value, response);\r\n            //else use input's original value2html() method    \r\n            } else {\r\n                return this.input.value2html(this.value, this.$element[0]); \r\n            }\r\n        },\r\n        \r\n        /**\r\n        Enables editable\r\n        @method enable()\r\n        **/          \r\n        enable: function() {\r\n            this.options.disabled = false;\r\n            this.$element.removeClass('editable-disabled');\r\n            this.handleEmpty(this.isEmpty);\r\n            if(this.options.toggle !== 'manual') {\r\n                if(this.$element.attr('tabindex') === '-1') {    \r\n                    this.$element.removeAttr('tabindex');                                \r\n                }\r\n            }\r\n        },\r\n        \r\n        /**\r\n        Disables editable\r\n        @method disable()\r\n        **/         \r\n        disable: function() {\r\n            this.options.disabled = true; \r\n            this.hide();           \r\n            this.$element.addClass('editable-disabled');\r\n            this.handleEmpty(this.isEmpty);\r\n            //do not stop focus on this element\r\n            this.$element.attr('tabindex', -1);                \r\n        },\r\n        \r\n        /**\r\n        Toggles enabled / disabled state of editable element\r\n        @method toggleDisabled()\r\n        **/         \r\n        toggleDisabled: function() {\r\n            if(this.options.disabled) {\r\n                this.enable();\r\n            } else { \r\n                this.disable(); \r\n            }\r\n        },  \r\n        \r\n        /**\r\n        Sets new option\r\n        \r\n        @method option(key, value)\r\n        @param {string|object} key option name or object with several options\r\n        @param {mixed} value option new value\r\n        @example\r\n        $('.editable').editable('option', 'pk', 2);\r\n        **/          \r\n        option: function(key, value) {\r\n            //set option(s) by object\r\n            if(key && typeof key === 'object') {\r\n               $.each(key, $.proxy(function(k, v){\r\n                  this.option($.trim(k), v); \r\n               }, this)); \r\n               return;\r\n            }\r\n\r\n            //set option by string             \r\n            this.options[key] = value;                          \r\n            \r\n            //disabled\r\n            if(key === 'disabled') {\r\n               return value ? this.disable() : this.enable();\r\n            } \r\n            \r\n            //value\r\n            if(key === 'value') {\r\n                this.setValue(value);\r\n            }\r\n            \r\n            //transfer new option to container! \r\n            if(this.container) {\r\n                this.container.option(key, value);  \r\n            }\r\n             \r\n            //pass option to input directly (as it points to the same in form)\r\n            if(this.input.option) {\r\n                this.input.option(key, value);\r\n            }\r\n            \r\n        },              \r\n        \r\n        /*\r\n        * set emptytext if element is empty\r\n        */\r\n        handleEmpty: function (isEmpty) {\r\n            //do not handle empty if we do not display anything\r\n            if(this.options.display === false) {\r\n                return;\r\n            }\r\n\r\n            /* \r\n            isEmpty may be set directly as param of method.\r\n            It is required when we enable/disable field and can't rely on content \r\n            as node content is text: \"Empty\" that is not empty %)\r\n            */\r\n            if(isEmpty !== undefined) { \r\n                this.isEmpty = isEmpty;\r\n            } else {\r\n                //detect empty\r\n                //for some inputs we need more smart check\r\n                //e.g. wysihtml5 may have <br>, <p></p>, <img>\r\n                if(typeof(this.input.isEmpty) === 'function') {\r\n                    this.isEmpty = this.input.isEmpty(this.$element);                    \r\n                } else {\r\n                    this.isEmpty = $.trim(this.$element.html()) === '';\r\n                }\r\n            }           \r\n            \r\n            //emptytext shown only for enabled\r\n            if(!this.options.disabled) {\r\n                if (this.isEmpty) {\r\n                    this.$element.html(this.options.emptytext);\r\n                    if(this.options.emptyclass) {\r\n                        this.$element.addClass(this.options.emptyclass);\r\n                    }\r\n                } else if(this.options.emptyclass) {\r\n                    this.$element.removeClass(this.options.emptyclass);\r\n                }\r\n            } else {\r\n                //below required if element disable property was changed\r\n                if(this.isEmpty) {\r\n                    this.$element.empty();\r\n                    if(this.options.emptyclass) {\r\n                        this.$element.removeClass(this.options.emptyclass);\r\n                    }\r\n                }\r\n            }\r\n        },        \r\n        \r\n        /**\r\n        Shows container with form\r\n        @method show()\r\n        @param {boolean} closeAll Whether to close all other editable containers when showing this one. Default true.\r\n        **/  \r\n        show: function (closeAll) {\r\n            if(this.options.disabled) {\r\n                return;\r\n            }\r\n            \r\n            //init editableContainer: popover, tooltip, inline, etc..\r\n            if(!this.container) {\r\n                var containerOptions = $.extend({}, this.options, {\r\n                    value: this.value,\r\n                    input: this.input //pass input to form (as it is already created)\r\n                });\r\n                this.$element.editableContainer(containerOptions);\r\n                //listen `save` event \r\n                this.$element.on(\"save.internal\", $.proxy(this.save, this));\r\n                this.container = this.$element.data('editableContainer'); \r\n            } else if(this.container.tip().is(':visible')) {\r\n                return;\r\n            }      \r\n            \r\n            //show container\r\n            this.container.show(closeAll);\r\n        },\r\n        \r\n        /**\r\n        Hides container with form\r\n        @method hide()\r\n        **/       \r\n        hide: function () {   \r\n            if(this.container) {  \r\n                this.container.hide();\r\n            }\r\n        },\r\n        \r\n        /**\r\n        Toggles container visibility (show / hide)\r\n        @method toggle()\r\n        @param {boolean} closeAll Whether to close all other editable containers when showing this one. Default true.\r\n        **/  \r\n        toggle: function(closeAll) {\r\n            if(this.container && this.container.tip().is(':visible')) {\r\n                this.hide();\r\n            } else {\r\n                this.show(closeAll);\r\n            }\r\n        },\r\n        \r\n        /*\r\n        * called when form was submitted\r\n        */          \r\n        save: function(e, params) {\r\n            //mark element with unsaved class if needed\r\n            if(this.options.unsavedclass) {\r\n                /*\r\n                 Add unsaved css to element if:\r\n                  - url is not user's function \r\n                  - value was not sent to server\r\n                  - params.response === undefined, that means data was not sent\r\n                  - value changed \r\n                */\r\n                var sent = false;\r\n                sent = sent || typeof this.options.url === 'function';\r\n                sent = sent || this.options.display === false; \r\n                sent = sent || params.response !== undefined; \r\n                sent = sent || (this.options.savenochange && this.input.value2str(this.value) !== this.input.value2str(params.newValue)); \r\n                \r\n                if(sent) {\r\n                    this.$element.removeClass(this.options.unsavedclass); \r\n                } else {\r\n                    this.$element.addClass(this.options.unsavedclass);                    \r\n                }\r\n            }\r\n            \r\n            //highlight when saving\r\n            if(this.options.highlight) {\r\n                var $e = this.$element,\r\n                    bgColor = $e.css('background-color');\r\n                    \r\n                $e.css('background-color', this.options.highlight);\r\n                setTimeout(function(){\r\n                    if(bgColor === 'transparent') {\r\n                        bgColor = ''; \r\n                    }\r\n                    $e.css('background-color', bgColor);\r\n                    $e.addClass('editable-bg-transition');\r\n                    setTimeout(function(){\r\n                       $e.removeClass('editable-bg-transition');  \r\n                    }, 1700);\r\n                }, 10);\r\n            }\r\n            \r\n            //set new value\r\n            this.setValue(params.newValue, false, params.response);\r\n            \r\n            /**        \r\n            Fired when new value was submitted. You can use <code>$(this).data('editable')</code> to access to editable instance\r\n            \r\n            @event save \r\n            @param {Object} event event object\r\n            @param {Object} params additional params\r\n            @param {mixed} params.newValue submitted value\r\n            @param {Object} params.response ajax response\r\n            @example\r\n            $('#username').on('save', function(e, params) {\r\n                alert('Saved value: ' + params.newValue);\r\n            });\r\n            **/\r\n            //event itself is triggered by editableContainer. Description here is only for documentation              \r\n        },\r\n\r\n        validate: function () {\r\n            if (typeof this.options.validate === 'function') {\r\n                return this.options.validate.call(this, this.value);\r\n            }\r\n        },\r\n        \r\n        /**\r\n        Sets new value of editable\r\n        @method setValue(value, convertStr)\r\n        @param {mixed} value new value \r\n        @param {boolean} convertStr whether to convert value from string to internal format\r\n        **/         \r\n        setValue: function(value, convertStr, response) {\r\n            if(convertStr) {\r\n                this.value = this.input.str2value(value);\r\n            } else {\r\n                this.value = value;\r\n            }\r\n            if(this.container) {\r\n                this.container.option('value', this.value);\r\n            }\r\n            $.when(this.render(response))\r\n            .then($.proxy(function() {\r\n                this.handleEmpty();\r\n            }, this));\r\n        },\r\n        \r\n        /**\r\n        Activates input of visible container (e.g. set focus)\r\n        @method activate()\r\n        **/         \r\n        activate: function() {\r\n            if(this.container) {\r\n               this.container.activate(); \r\n            }\r\n        },\r\n        \r\n        /**\r\n        Removes editable feature from element\r\n        @method destroy()\r\n        **/        \r\n        destroy: function() {\r\n            this.disable();\r\n            \r\n            if(this.container) {\r\n               this.container.destroy(); \r\n            }\r\n            \r\n            this.input.destroy();\r\n\r\n            if(this.options.toggle !== 'manual') {\r\n                this.$element.removeClass('editable-click');\r\n                this.$element.off(this.options.toggle + '.editable');\r\n            } \r\n            \r\n            this.$element.off(\"save.internal\");\r\n            \r\n            this.$element.removeClass('editable editable-open editable-disabled');\r\n            this.$element.removeData('editable');\r\n        }        \r\n    };\r\n\r\n    /* EDITABLE PLUGIN DEFINITION\r\n    * ======================= */\r\n\r\n    /**\r\n    jQuery method to initialize editable element.\r\n    \r\n    @method $().editable(options)\r\n    @params {Object} options\r\n    @example\r\n    $('#username').editable({\r\n        type: 'text',\r\n        url: '/post',\r\n        pk: 1\r\n    });\r\n    **/\r\n    $.fn.editable = function (option) {\r\n        //special API methods returning non-jquery object\r\n        var result = {}, args = arguments, datakey = 'editable';\r\n        switch (option) {\r\n            /**\r\n            Runs client-side validation for all matched editables\r\n            \r\n            @method validate()\r\n            @returns {Object} validation errors map\r\n            @example\r\n            $('#username, #fullname').editable('validate');\r\n            // possible result:\r\n            {\r\n              username: \"username is required\",\r\n              fullname: \"fullname should be minimum 3 letters length\"\r\n            }\r\n            **/\r\n            case 'validate':\r\n                this.each(function () {\r\n                    var $this = $(this), data = $this.data(datakey), error;\r\n                    if (data && (error = data.validate())) {\r\n                        result[data.options.name] = error;\r\n                    }\r\n                });\r\n            return result;\r\n\r\n            /**\r\n            Returns current values of editable elements.   \r\n            Note that it returns an **object** with name-value pairs, not a value itself. It allows to get data from several elements.    \r\n            If value of some editable is `null` or `undefined` it is excluded from result object.\r\n            When param `isSingle` is set to **true** - it is supposed you have single element and will return value of editable instead of object.   \r\n             \r\n            @method getValue()\r\n            @param {bool} isSingle whether to return just value of single element\r\n            @returns {Object} object of element names and values\r\n            @example\r\n            $('#username, #fullname').editable('getValue');\r\n            //result:\r\n            {\r\n            username: \"superuser\",\r\n            fullname: \"John\"\r\n            }\r\n            //isSingle = true\r\n            $('#username').editable('getValue', true);\r\n            //result \"superuser\" \r\n            **/\r\n            case 'getValue':\r\n                if(arguments.length === 2 && arguments[1] === true) { //isSingle = true\r\n                    result = this.eq(0).data(datakey).value;\r\n                } else {\r\n                    this.each(function () {\r\n                        var $this = $(this), data = $this.data(datakey);\r\n                        if (data && data.value !== undefined && data.value !== null) {\r\n                            result[data.options.name] = data.input.value2submit(data.value);\r\n                        }\r\n                    });\r\n                }\r\n            return result;\r\n\r\n            /**\r\n            This method collects values from several editable elements and submit them all to server.   \r\n            Internally it runs client-side validation for all fields and submits only in case of success.  \r\n            See <a href=\"#newrecord\">creating new records</a> for details.  \r\n            Since 1.5.1 `submit` can be applied to single element to send data programmatically. In that case\r\n            `url`, `success` and `error` is taken from initial options and you can just call `$('#username').editable('submit')`. \r\n            \r\n            @method submit(options)\r\n            @param {object} options \r\n            @param {object} options.url url to submit data \r\n            @param {object} options.data additional data to submit\r\n            @param {object} options.ajaxOptions additional ajax options\r\n            @param {function} options.error(obj) error handler \r\n            @param {function} options.success(obj,config) success handler\r\n            @returns {Object} jQuery object\r\n            **/\r\n            case 'submit':  //collects value, validate and submit to server for creating new record\r\n                var config = arguments[1] || {},\r\n                $elems = this,\r\n                errors = this.editable('validate');\r\n\r\n                // validation ok\r\n                if($.isEmptyObject(errors)) {\r\n                    var ajaxOptions = {};\r\n                                                      \r\n                    // for single element use url, success etc from options\r\n                    if($elems.length === 1) {\r\n                        var editable = $elems.data('editable');\r\n                        //standard params\r\n                        var params = {\r\n                            name: editable.options.name || '',\r\n                            value: editable.input.value2submit(editable.value),\r\n                            pk: (typeof editable.options.pk === 'function') ? \r\n                                editable.options.pk.call(editable.options.scope) : \r\n                                editable.options.pk \r\n                        };\r\n\r\n                        //additional params\r\n                        if(typeof editable.options.params === 'function') {\r\n                            params = editable.options.params.call(editable.options.scope, params);  \r\n                        } else {\r\n                            //try parse json in single quotes (from data-params attribute)\r\n                            editable.options.params = $.fn.editableutils.tryParseJson(editable.options.params, true);   \r\n                            $.extend(params, editable.options.params);\r\n                        }\r\n\r\n                        ajaxOptions = {\r\n                            url: editable.options.url,\r\n                            data: params,\r\n                            type: 'POST'  \r\n                        };\r\n                        \r\n                        // use success / error from options \r\n                        config.success = config.success || editable.options.success;\r\n                        config.error = config.error || editable.options.error;\r\n                        \r\n                    // multiple elements\r\n                    } else {\r\n                        var values = this.editable('getValue'); \r\n                        \r\n                        ajaxOptions = {\r\n                            url: config.url,\r\n                            data: values, \r\n                            type: 'POST'\r\n                        };                        \r\n                    }                    \r\n\r\n                    // ajax success callabck (response 200 OK)\r\n                    ajaxOptions.success = typeof config.success === 'function' ? function(response) {\r\n                            config.success.call($elems, response, config);\r\n                        } : $.noop;\r\n                                  \r\n                    // ajax error callabck\r\n                    ajaxOptions.error = typeof config.error === 'function' ? function() {\r\n                             config.error.apply($elems, arguments);\r\n                        } : $.noop;\r\n                       \r\n                    // extend ajaxOptions    \r\n                    if(config.ajaxOptions) { \r\n                        $.extend(ajaxOptions, config.ajaxOptions);\r\n                    }\r\n                    \r\n                    // extra data \r\n                    if(config.data) {\r\n                        $.extend(ajaxOptions.data, config.data);\r\n                    }                     \r\n                    \r\n                    // perform ajax request\r\n                    $.ajax(ajaxOptions);\r\n                } else { //client-side validation error\r\n                    if(typeof config.error === 'function') {\r\n                        config.error.call($elems, errors);\r\n                    }\r\n                }\r\n            return this;\r\n        }\r\n\r\n        //return jquery object\r\n        return this.each(function () {\r\n            var $this = $(this), \r\n                data = $this.data(datakey), \r\n                options = typeof option === 'object' && option;\r\n\r\n            //for delegated targets do not store `editable` object for element\r\n            //it's allows several different selectors.\r\n            //see: https://github.com/vitalets/x-editable/issues/312    \r\n            if(options && options.selector) {\r\n                data = new Editable(this, options);\r\n                return; \r\n            }    \r\n            \r\n            if (!data) {\r\n                $this.data(datakey, (data = new Editable(this, options)));\r\n            }\r\n\r\n            if (typeof option === 'string') { //call method \r\n                data[option].apply(data, Array.prototype.slice.call(args, 1));\r\n            } \r\n        });\r\n    };    \r\n            \r\n\r\n    $.fn.editable.defaults = {\r\n        /**\r\n        Type of input. Can be <code>text|textarea|select|date|checklist</code> and more\r\n\r\n        @property type \r\n        @type string\r\n        @default 'text'\r\n        **/\r\n        type: 'text',        \r\n        /**\r\n        Sets disabled state of editable\r\n\r\n        @property disabled \r\n        @type boolean\r\n        @default false\r\n        **/         \r\n        disabled: false,\r\n        /**\r\n        How to toggle editable. Can be <code>click|dblclick|mouseenter|manual</code>.   \r\n        When set to <code>manual</code> you should manually call <code>show/hide</code> methods of editable.    \r\n        **Note**: if you call <code>show</code> or <code>toggle</code> inside **click** handler of some DOM element, \r\n        you need to apply <code>e.stopPropagation()</code> because containers are being closed on any click on document.\r\n        \r\n        @example\r\n        $('#edit-button').click(function(e) {\r\n            e.stopPropagation();\r\n            $('#username').editable('toggle');\r\n        });\r\n\r\n        @property toggle \r\n        @type string\r\n        @default 'click'\r\n        **/          \r\n        toggle: 'click',\r\n        /**\r\n        Text shown when element is empty.\r\n\r\n        @property emptytext \r\n        @type string\r\n        @default 'Empty'\r\n        **/         \r\n        emptytext: 'Empty',\r\n        /**\r\n        Allows to automatically set element's text based on it's value. Can be <code>auto|always|never</code>. Useful for select and date.\r\n        For example, if dropdown list is <code>{1: 'a', 2: 'b'}</code> and element's value set to <code>1</code>, it's html will be automatically set to <code>'a'</code>.  \r\n        <code>auto</code> - text will be automatically set only if element is empty.  \r\n        <code>always|never</code> - always(never) try to set element's text.\r\n\r\n        @property autotext \r\n        @type string\r\n        @default 'auto'\r\n        **/          \r\n        autotext: 'auto', \r\n        /**\r\n        Initial value of input. If not set, taken from element's text.  \r\n        Note, that if element's text is empty - text is automatically generated from value and can be customized (see `autotext` option).  \r\n        For example, to display currency sign:\r\n        @example\r\n        <a id=\"price\" data-type=\"text\" data-value=\"100\"></a>\r\n        <script>\r\n        $('#price').editable({\r\n            ...\r\n            display: function(value) {\r\n              $(this).text(value + '$');\r\n            } \r\n        }) \r\n        </script>\r\n                \r\n        @property value \r\n        @type mixed\r\n        @default element's text\r\n        **/\r\n        value: null,\r\n        /**\r\n        Callback to perform custom displaying of value in element's text.  \r\n        If `null`, default input's display used.  \r\n        If `false`, no displaying methods will be called, element's text will never change.  \r\n        Runs under element's scope.  \r\n        _**Parameters:**_  \r\n        \r\n        * `value` current value to be displayed\r\n        * `response` server response (if display called after ajax submit), since 1.4.0\r\n         \r\n        For _inputs with source_ (select, checklist) parameters are different:  \r\n          \r\n        * `value` current value to be displayed\r\n        * `sourceData` array of items for current input (e.g. dropdown items) \r\n        * `response` server response (if display called after ajax submit), since 1.4.0\r\n                  \r\n        To get currently selected items use `$.fn.editableutils.itemsByValue(value, sourceData)`.\r\n        \r\n        @property display \r\n        @type function|boolean\r\n        @default null\r\n        @since 1.2.0\r\n        @example\r\n        display: function(value, sourceData) {\r\n           //display checklist as comma-separated values\r\n           var html = [],\r\n               checked = $.fn.editableutils.itemsByValue(value, sourceData);\r\n               \r\n           if(checked.length) {\r\n               $.each(checked, function(i, v) { html.push($.fn.editableutils.escape(v.text)); });\r\n               $(this).html(html.join(', '));\r\n           } else {\r\n               $(this).empty(); \r\n           }\r\n        }\r\n        **/          \r\n        display: null,\r\n        /**\r\n        Css class applied when editable text is empty.\r\n\r\n        @property emptyclass \r\n        @type string\r\n        @since 1.4.1        \r\n        @default editable-empty\r\n        **/        \r\n        emptyclass: 'editable-empty',\r\n        /**\r\n        Css class applied when value was stored but not sent to server (`pk` is empty or `send = 'never'`).  \r\n        You may set it to `null` if you work with editables locally and submit them together.  \r\n\r\n        @property unsavedclass \r\n        @type string\r\n        @since 1.4.1        \r\n        @default editable-unsaved\r\n        **/        \r\n        unsavedclass: 'editable-unsaved',\r\n        /**\r\n        If selector is provided, editable will be delegated to the specified targets.  \r\n        Usefull for dynamically generated DOM elements.  \r\n        **Please note**, that delegated targets can't be initialized with `emptytext` and `autotext` options, \r\n        as they actually become editable only after first click.  \r\n        You should manually set class `editable-click` to these elements.  \r\n        Also, if element originally empty you should add class `editable-empty`, set `data-value=\"\"` and write emptytext into element:\r\n\r\n        @property selector \r\n        @type string\r\n        @since 1.4.1        \r\n        @default null\r\n        @example\r\n        <div id=\"user\">\r\n          <!-- empty -->\r\n          <a href=\"#\" data-name=\"username\" data-type=\"text\" class=\"editable-click editable-empty\" data-value=\"\" title=\"Username\">Empty</a>\r\n          <!-- non-empty -->\r\n          <a href=\"#\" data-name=\"group\" data-type=\"select\" data-source=\"/groups\" data-value=\"1\" class=\"editable-click\" title=\"Group\">Operator</a>\r\n        </div>     \r\n        \r\n        <script>\r\n        $('#user').editable({\r\n            selector: 'a',\r\n            url: '/post',\r\n            pk: 1\r\n        });\r\n        </script>\r\n        **/         \r\n        selector: null,\r\n        /**\r\n        Color used to highlight element after update. Implemented via CSS3 transition, works in modern browsers.\r\n        \r\n        @property highlight \r\n        @type string|boolean\r\n        @since 1.4.5        \r\n        @default #FFFF80 \r\n        **/\r\n        highlight: '#FFFF80'\r\n    };\r\n    \r\n}(window.jQuery));\r\n\r\n/**\r\nAbstractInput - base class for all editable inputs.\r\nIt defines interface to be implemented by any input type.\r\nTo create your own input you can inherit from this class.\r\n\r\n@class abstractinput\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n\r\n    //types\r\n    $.fn.editabletypes = {};\r\n\r\n    var AbstractInput = function () { };\r\n\r\n    AbstractInput.prototype = {\r\n       /**\r\n        Initializes input\r\n\r\n        @method init() \r\n        **/\r\n       init: function(type, options, defaults) {\r\n           this.type = type;\r\n           this.options = $.extend({}, defaults, options);\r\n       },\r\n\r\n       /*\r\n       this method called before render to init $tpl that is inserted in DOM\r\n       */\r\n       prerender: function() {\r\n           this.$tpl = $(this.options.tpl); //whole tpl as jquery object    \r\n           this.$input = this.$tpl;         //control itself, can be changed in render method\r\n           this.$clear = null;              //clear button\r\n           this.error = null;               //error message, if input cannot be rendered           \r\n       },\r\n       \r\n       /**\r\n        Renders input from tpl. Can return jQuery deferred object.\r\n        Can be overwritten in child objects\r\n\r\n        @method render()\r\n       **/\r\n       render: function() {\r\n\r\n       }, \r\n\r\n       /**\r\n        Sets element's html by value. \r\n\r\n        @method value2html(value, element)\r\n        @param {mixed} value\r\n        @param {DOMElement} element\r\n       **/\r\n       value2html: function(value, element) {\r\n           $(element)[this.options.escape ? 'text' : 'html']($.trim(value));\r\n       },\r\n\r\n       /**\r\n        Converts element's html to value\r\n\r\n        @method html2value(html)\r\n        @param {string} html\r\n        @returns {mixed}\r\n       **/\r\n       html2value: function(html) {\r\n           return $('<div>').html(html).text();\r\n       },\r\n\r\n       /**\r\n        Converts value to string (for internal compare). For submitting to server used value2submit().\r\n\r\n        @method value2str(value) \r\n        @param {mixed} value\r\n        @returns {string}\r\n       **/\r\n       value2str: function(value) {\r\n           return value;\r\n       }, \r\n\r\n       /**\r\n        Converts string received from server into value. Usually from `data-value` attribute.\r\n\r\n        @method str2value(str)\r\n        @param {string} str\r\n        @returns {mixed}\r\n       **/\r\n       str2value: function(str) {\r\n           return str;\r\n       }, \r\n       \r\n       /**\r\n        Converts value for submitting to server. Result can be string or object.\r\n\r\n        @method value2submit(value) \r\n        @param {mixed} value\r\n        @returns {mixed}\r\n       **/\r\n       value2submit: function(value) {\r\n           return value;\r\n       },\r\n\r\n       /**\r\n        Sets value of input.\r\n\r\n        @method value2input(value) \r\n        @param {mixed} value\r\n       **/\r\n       value2input: function(value) {\r\n           this.$input.val(value);\r\n       },\r\n\r\n       /**\r\n        Returns value of input. Value can be object (e.g. datepicker)\r\n\r\n        @method input2value() \r\n       **/\r\n       input2value: function() { \r\n           return this.$input.val();\r\n       }, \r\n\r\n       /**\r\n        Activates input. For text it sets focus.\r\n\r\n        @method activate() \r\n       **/\r\n       activate: function() {\r\n           if(this.$input.is(':visible')) {\r\n               this.$input.focus();\r\n           }\r\n       },\r\n\r\n       /**\r\n        Creates input.\r\n\r\n        @method clear() \r\n       **/        \r\n       clear: function() {\r\n           this.$input.val(null);\r\n       },\r\n\r\n       /**\r\n        method to escape html.\r\n       **/\r\n       escape: function(str) {\r\n           return $('<div>').text(str).html();\r\n       },\r\n       \r\n       /**\r\n        attach handler to automatically submit form when value changed (useful when buttons not shown)\r\n       **/\r\n       autosubmit: function() {\r\n        \r\n       },\r\n       \r\n       /**\r\n       Additional actions when destroying element \r\n       **/\r\n       destroy: function() {\r\n       },\r\n\r\n       // -------- helper functions --------\r\n       setClass: function() {          \r\n           if(this.options.inputclass) {\r\n               this.$input.addClass(this.options.inputclass); \r\n           } \r\n       },\r\n\r\n       setAttr: function(attr) {\r\n           if (this.options[attr] !== undefined && this.options[attr] !== null) {\r\n               this.$input.attr(attr, this.options[attr]);\r\n           } \r\n       },\r\n       \r\n       option: function(key, value) {\r\n            this.options[key] = value;\r\n       }\r\n       \r\n    };\r\n        \r\n    AbstractInput.defaults = {  \r\n        /**\r\n        HTML template of input. Normally you should not change it.\r\n\r\n        @property tpl \r\n        @type string\r\n        @default ''\r\n        **/   \r\n        tpl: '',\r\n        /**\r\n        CSS class automatically applied to input\r\n        \r\n        @property inputclass \r\n        @type string\r\n        @default null\r\n        **/         \r\n        inputclass: null,\r\n        \r\n        /**\r\n        If `true` - html will be escaped in content of element via $.text() method.  \r\n        If `false` - html will not be escaped, $.html() used.  \r\n        When you use own `display` function, this option obviosly has no effect.\r\n        \r\n        @property escape \r\n        @type boolean\r\n        @since 1.5.0\r\n        @default true\r\n        **/         \r\n        escape: true,\r\n                \r\n        //scope for external methods (e.g. source defined as function)\r\n        //for internal use only\r\n        scope: null,\r\n        \r\n        //need to re-declare showbuttons here to get it's value from common config (passed only options existing in defaults)\r\n        showbuttons: true \r\n    };\r\n    \r\n    $.extend($.fn.editabletypes, {abstractinput: AbstractInput});\r\n        \r\n}(window.jQuery));\r\n\r\n/**\r\nList - abstract class for inputs that have source option loaded from js array or via ajax\r\n\r\n@class list\r\n@extends abstractinput\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var List = function (options) {\r\n       \r\n    };\r\n\r\n    $.fn.editableutils.inherit(List, $.fn.editabletypes.abstractinput);\r\n\r\n    $.extend(List.prototype, {\r\n        render: function () {\r\n            var deferred = $.Deferred();\r\n\r\n            this.error = null;\r\n            this.onSourceReady(function () {\r\n                this.renderList();\r\n                deferred.resolve();\r\n            }, function () {\r\n                this.error = this.options.sourceError;\r\n                deferred.resolve();\r\n            });\r\n\r\n            return deferred.promise();\r\n        },\r\n\r\n        html2value: function (html) {\r\n            return null; //can't set value by text\r\n        },\r\n        \r\n        value2html: function (value, element, display, response) {\r\n            var deferred = $.Deferred(),\r\n                success = function () {\r\n                    if(typeof display === 'function') {\r\n                        //custom display method\r\n                        display.call(element, value, this.sourceData, response); \r\n                    } else {\r\n                        this.value2htmlFinal(value, element);\r\n                    }\r\n                    deferred.resolve();\r\n               };\r\n            \r\n            //for null value just call success without loading source\r\n            if(value === null) {\r\n               success.call(this);   \r\n            } else {\r\n               this.onSourceReady(success, function () { deferred.resolve(); });\r\n            }\r\n\r\n            return deferred.promise();\r\n        },  \r\n\r\n        // ------------- additional functions ------------\r\n\r\n        onSourceReady: function (success, error) {\r\n            //run source if it function\r\n            var source;\r\n            if ($.isFunction(this.options.source)) {\r\n                source = this.options.source.call(this.options.scope);\r\n                this.sourceData = null;\r\n                //note: if function returns the same source as URL - sourceData will be taken from cahce and no extra request performed\r\n            } else {\r\n                source = this.options.source;\r\n            }            \r\n            \r\n            //if allready loaded just call success\r\n            if(this.options.sourceCache && $.isArray(this.sourceData)) {\r\n                success.call(this);\r\n                return; \r\n            }\r\n\r\n            //try parse json in single quotes (for double quotes jquery does automatically)\r\n            try {\r\n                source = $.fn.editableutils.tryParseJson(source, false);\r\n            } catch (e) {\r\n                error.call(this);\r\n                return;\r\n            }\r\n\r\n            //loading from url\r\n            if (typeof source === 'string') {\r\n                //try to get sourceData from cache\r\n                if(this.options.sourceCache) {\r\n                    var cacheID = source,\r\n                    cache;\r\n\r\n                    if (!$(document).data(cacheID)) {\r\n                        $(document).data(cacheID, {});\r\n                    }\r\n                    cache = $(document).data(cacheID);\r\n\r\n                    //check for cached data\r\n                    if (cache.loading === false && cache.sourceData) { //take source from cache\r\n                        this.sourceData = cache.sourceData;\r\n                        this.doPrepend();\r\n                        success.call(this);\r\n                        return;\r\n                    } else if (cache.loading === true) { //cache is loading, put callback in stack to be called later\r\n                        cache.callbacks.push($.proxy(function () {\r\n                            this.sourceData = cache.sourceData;\r\n                            this.doPrepend();\r\n                            success.call(this);\r\n                        }, this));\r\n\r\n                        //also collecting error callbacks\r\n                        cache.err_callbacks.push($.proxy(error, this));\r\n                        return;\r\n                    } else { //no cache yet, activate it\r\n                        cache.loading = true;\r\n                        cache.callbacks = [];\r\n                        cache.err_callbacks = [];\r\n                    }\r\n                }\r\n                \r\n                //ajaxOptions for source. Can be overwritten bt options.sourceOptions\r\n                var ajaxOptions = $.extend({\r\n                    url: source,\r\n                    type: 'get',\r\n                    cache: false,\r\n                    dataType: 'json',\r\n                    success: $.proxy(function (data) {\r\n                        if(cache) {\r\n                            cache.loading = false;\r\n                        }\r\n                        this.sourceData = this.makeArray(data);\r\n                        if($.isArray(this.sourceData)) {\r\n                            if(cache) {\r\n                                //store result in cache\r\n                                cache.sourceData = this.sourceData;\r\n                                //run success callbacks for other fields waiting for this source\r\n                                $.each(cache.callbacks, function () { this.call(); }); \r\n                            }\r\n                            this.doPrepend();\r\n                            success.call(this);\r\n                        } else {\r\n                            error.call(this);\r\n                            if(cache) {\r\n                                //run error callbacks for other fields waiting for this source\r\n                                $.each(cache.err_callbacks, function () { this.call(); }); \r\n                            }\r\n                        }\r\n                    }, this),\r\n                    error: $.proxy(function () {\r\n                        error.call(this);\r\n                        if(cache) {\r\n                             cache.loading = false;\r\n                             //run error callbacks for other fields\r\n                             $.each(cache.err_callbacks, function () { this.call(); }); \r\n                        }\r\n                    }, this)\r\n                }, this.options.sourceOptions);\r\n                \r\n                //loading sourceData from server\r\n                $.ajax(ajaxOptions);\r\n                \r\n            } else { //options as json/array\r\n                this.sourceData = this.makeArray(source);\r\n                    \r\n                if($.isArray(this.sourceData)) {\r\n                    this.doPrepend();\r\n                    success.call(this);   \r\n                } else {\r\n                    error.call(this);\r\n                }\r\n            }\r\n        },\r\n\r\n        doPrepend: function () {\r\n            if(this.options.prepend === null || this.options.prepend === undefined) {\r\n                return;  \r\n            }\r\n            \r\n            if(!$.isArray(this.prependData)) {\r\n                //run prepend if it is function (once)\r\n                if ($.isFunction(this.options.prepend)) {\r\n                    this.options.prepend = this.options.prepend.call(this.options.scope);\r\n                }\r\n              \r\n                //try parse json in single quotes\r\n                this.options.prepend = $.fn.editableutils.tryParseJson(this.options.prepend, true);\r\n                \r\n                //convert prepend from string to object\r\n                if (typeof this.options.prepend === 'string') {\r\n                    this.options.prepend = {'': this.options.prepend};\r\n                }\r\n                \r\n                this.prependData = this.makeArray(this.options.prepend);\r\n            }\r\n\r\n            if($.isArray(this.prependData) && $.isArray(this.sourceData)) {\r\n                this.sourceData = this.prependData.concat(this.sourceData);\r\n            }\r\n        },\r\n\r\n        /*\r\n         renders input list\r\n        */\r\n        renderList: function() {\r\n            // this method should be overwritten in child class\r\n        },\r\n       \r\n         /*\r\n         set element's html by value\r\n        */\r\n        value2htmlFinal: function(value, element) {\r\n            // this method should be overwritten in child class\r\n        },        \r\n\r\n        /**\r\n        * convert data to array suitable for sourceData, e.g. [{value: 1, text: 'abc'}, {...}]\r\n        */\r\n        makeArray: function(data) {\r\n            var count, obj, result = [], item, iterateItem;\r\n            if(!data || typeof data === 'string') {\r\n                return null; \r\n            }\r\n\r\n            if($.isArray(data)) { //array\r\n                /* \r\n                   function to iterate inside item of array if item is object.\r\n                   Caclulates count of keys in item and store in obj. \r\n                */\r\n                iterateItem = function (k, v) {\r\n                    obj = {value: k, text: v};\r\n                    if(count++ >= 2) {\r\n                        return false;// exit from `each` if item has more than one key.\r\n                    }\r\n                };\r\n            \r\n                for(var i = 0; i < data.length; i++) {\r\n                    item = data[i]; \r\n                    if(typeof item === 'object') {\r\n                        count = 0; //count of keys inside item\r\n                        $.each(item, iterateItem);\r\n                        //case: [{val1: 'text1'}, {val2: 'text2} ...]\r\n                        if(count === 1) { \r\n                            result.push(obj); \r\n                            //case: [{value: 1, text: 'text1'}, {value: 2, text: 'text2'}, ...]\r\n                        } else if(count > 1) {\r\n                            //removed check of existance: item.hasOwnProperty('value') && item.hasOwnProperty('text')\r\n                            if(item.children) {\r\n                                item.children = this.makeArray(item.children);   \r\n                            }\r\n                            result.push(item);\r\n                        }\r\n                    } else {\r\n                        //case: ['text1', 'text2' ...]\r\n                        result.push({value: item, text: item}); \r\n                    }\r\n                }\r\n            } else {  //case: {val1: 'text1', val2: 'text2, ...}\r\n                $.each(data, function (k, v) {\r\n                    result.push({value: k, text: v});\r\n                });  \r\n            }\r\n            return result;\r\n        },\r\n        \r\n        option: function(key, value) {\r\n            this.options[key] = value;\r\n            if(key === 'source') {\r\n                this.sourceData = null;\r\n            }\r\n            if(key === 'prepend') {\r\n                this.prependData = null;\r\n            }            \r\n        }        \r\n\r\n    });      \r\n\r\n    List.defaults = $.extend({}, $.fn.editabletypes.abstractinput.defaults, {\r\n        /**\r\n        Source data for list.  \r\n        If **array** - it should be in format: `[{value: 1, text: \"text1\"}, {value: 2, text: \"text2\"}, ...]`  \r\n        For compability, object format is also supported: `{\"1\": \"text1\", \"2\": \"text2\" ...}` but it does not guarantee elements order.\r\n        \r\n        If **string** - considered ajax url to load items. In that case results will be cached for fields with the same source and name. See also `sourceCache` option.\r\n          \r\n        If **function**, it should return data in format above (since 1.4.0).\r\n        \r\n        Since 1.4.1 key `children` supported to render OPTGROUP (for **select** input only).  \r\n        `[{text: \"group1\", children: [{value: 1, text: \"text1\"}, {value: 2, text: \"text2\"}]}, ...]` \r\n\r\n\t\t\r\n        @property source \r\n        @type string | array | object | function\r\n        @default null\r\n        **/         \r\n        source: null, \r\n        /**\r\n        Data automatically prepended to the beginning of dropdown list.\r\n        \r\n        @property prepend \r\n        @type string | array | object | function\r\n        @default false\r\n        **/         \r\n        prepend: false,\r\n        /**\r\n        Error message when list cannot be loaded (e.g. ajax error)\r\n        \r\n        @property sourceError \r\n        @type string\r\n        @default Error when loading list\r\n        **/          \r\n        sourceError: 'Error when loading list',\r\n        /**\r\n        if <code>true</code> and source is **string url** - results will be cached for fields with the same source.    \r\n        Usefull for editable column in grid to prevent extra requests.\r\n        \r\n        @property sourceCache \r\n        @type boolean\r\n        @default true\r\n        @since 1.2.0\r\n        **/        \r\n        sourceCache: true,\r\n        /**\r\n        Additional ajax options to be used in $.ajax() when loading list from server.\r\n        Useful to send extra parameters (`data` key) or change request method (`type` key).\r\n        \r\n        @property sourceOptions \r\n        @type object|function\r\n        @default null\r\n        @since 1.5.0\r\n        **/        \r\n        sourceOptions: null\r\n    });\r\n\r\n    $.fn.editabletypes.list = List;      \r\n\r\n}(window.jQuery));\r\n\r\n/**\r\nText input\r\n\r\n@class text\r\n@extends abstractinput\r\n@final\r\n@example\r\n<a href=\"#\" id=\"username\" data-type=\"text\" data-pk=\"1\">awesome</a>\r\n<script>\r\n$(function(){\r\n    $('#username').editable({\r\n        url: '/post',\r\n        title: 'Enter username'\r\n    });\r\n});\r\n</script>\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var Text = function (options) {\r\n        this.init('text', options, Text.defaults);\r\n    };\r\n\r\n    $.fn.editableutils.inherit(Text, $.fn.editabletypes.abstractinput);\r\n\r\n    $.extend(Text.prototype, {\r\n        render: function() {\r\n           this.renderClear();\r\n           this.setClass();\r\n           this.setAttr('placeholder');\r\n        },\r\n        \r\n        activate: function() {\r\n            if(this.$input.is(':visible')) {\r\n                this.$input.focus();\r\n                $.fn.editableutils.setCursorPosition(this.$input.get(0), this.$input.val().length);\r\n                if(this.toggleClear) {\r\n                    this.toggleClear();\r\n                }\r\n            }\r\n        },\r\n        \r\n        //render clear button\r\n        renderClear:  function() {\r\n           if (this.options.clear) {\r\n               this.$clear = $('<span class=\"editable-clear-x\"></span>');\r\n               this.$input.after(this.$clear)\r\n                          .css('padding-right', 24)\r\n                          .keyup($.proxy(function(e) {\r\n                              //arrows, enter, tab, etc\r\n                              if(~$.inArray(e.keyCode, [40,38,9,13,27])) {\r\n                                return;\r\n                              }                            \r\n\r\n                              clearTimeout(this.t);\r\n                              var that = this;\r\n                              this.t = setTimeout(function() {\r\n                                that.toggleClear(e);\r\n                              }, 100);\r\n                              \r\n                          }, this))\r\n                          .parent().css('position', 'relative');\r\n                          \r\n               this.$clear.click($.proxy(this.clear, this));                       \r\n           }            \r\n        },\r\n        \r\n        postrender: function() {\r\n            /*\r\n            //now `clear` is positioned via css\r\n            if(this.$clear) {\r\n                //can position clear button only here, when form is shown and height can be calculated\r\n//                var h = this.$input.outerHeight(true) || 20,\r\n                var h = this.$clear.parent().height(),\r\n                    delta = (h - this.$clear.height()) / 2;\r\n                    \r\n                //this.$clear.css({bottom: delta, right: delta});\r\n            }\r\n            */ \r\n        },\r\n        \r\n        //show / hide clear button\r\n        toggleClear: function(e) {\r\n            if(!this.$clear) {\r\n                return;\r\n            }\r\n            \r\n            var len = this.$input.val().length,\r\n                visible = this.$clear.is(':visible');\r\n                 \r\n            if(len && !visible) {\r\n                this.$clear.show();\r\n            } \r\n            \r\n            if(!len && visible) {\r\n                this.$clear.hide();\r\n            } \r\n        },\r\n        \r\n        clear: function() {\r\n           this.$clear.hide();\r\n           this.$input.val('').focus();\r\n        }          \r\n    });\r\n\r\n    Text.defaults = $.extend({}, $.fn.editabletypes.abstractinput.defaults, {\r\n        /**\r\n        @property tpl \r\n        @default <input type=\"text\">\r\n        **/         \r\n        tpl: '<input type=\"text\">',\r\n        /**\r\n        Placeholder attribute of input. Shown when input is empty.\r\n\r\n        @property placeholder \r\n        @type string\r\n        @default null\r\n        **/             \r\n        placeholder: null,\r\n        \r\n        /**\r\n        Whether to show `clear` button \r\n        \r\n        @property clear \r\n        @type boolean\r\n        @default true        \r\n        **/\r\n        clear: true\r\n    });\r\n\r\n    $.fn.editabletypes.text = Text;\r\n\r\n}(window.jQuery));\r\n\r\n/**\r\nTextarea input\r\n\r\n@class textarea\r\n@extends abstractinput\r\n@final\r\n@example\r\n<a href=\"#\" id=\"comments\" data-type=\"textarea\" data-pk=\"1\">awesome comment!</a>\r\n<script>\r\n$(function(){\r\n    $('#comments').editable({\r\n        url: '/post',\r\n        title: 'Enter comments',\r\n        rows: 10\r\n    });\r\n});\r\n</script>\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var Textarea = function (options) {\r\n        this.init('textarea', options, Textarea.defaults);\r\n    };\r\n\r\n    $.fn.editableutils.inherit(Textarea, $.fn.editabletypes.abstractinput);\r\n\r\n    $.extend(Textarea.prototype, {\r\n        render: function () {\r\n            this.setClass();\r\n            this.setAttr('placeholder');\r\n            this.setAttr('rows');                        \r\n            \r\n            //ctrl + enter\r\n            this.$input.keydown(function (e) {\r\n                if (e.ctrlKey && e.which === 13) {\r\n                    $(this).closest('form').submit();\r\n                }\r\n            });\r\n        },\r\n        \r\n       //using `white-space: pre-wrap` solves \\n  <--> BR conversion very elegant!\r\n       /* \r\n       value2html: function(value, element) {\r\n            var html = '', lines;\r\n            if(value) {\r\n                lines = value.split(\"\\n\");\r\n                for (var i = 0; i < lines.length; i++) {\r\n                    lines[i] = $('<div>').text(lines[i]).html();\r\n                }\r\n                html = lines.join('<br>');\r\n            }\r\n            $(element).html(html);\r\n        },\r\n       \r\n        html2value: function(html) {\r\n            if(!html) {\r\n                return '';\r\n            }\r\n\r\n            var regex = new RegExp(String.fromCharCode(10), 'g');\r\n            var lines = html.split(/<br\\s*\\/?>/i);\r\n            for (var i = 0; i < lines.length; i++) {\r\n                var text = $('<div>').html(lines[i]).text();\r\n\r\n                // Remove newline characters (\\n) to avoid them being converted by value2html() method\r\n                // thus adding extra <br> tags\r\n                text = text.replace(regex, '');\r\n\r\n                lines[i] = text;\r\n            }\r\n            return lines.join(\"\\n\");\r\n        },\r\n         */\r\n        activate: function() {\r\n            $.fn.editabletypes.text.prototype.activate.call(this);\r\n        }\r\n    });\r\n\r\n    Textarea.defaults = $.extend({}, $.fn.editabletypes.abstractinput.defaults, {\r\n        /**\r\n        @property tpl\r\n        @default <textarea></textarea>\r\n        **/\r\n        tpl:'<textarea></textarea>',\r\n        /**\r\n        @property inputclass\r\n        @default input-large\r\n        **/\r\n        inputclass: 'input-large',\r\n        /**\r\n        Placeholder attribute of input. Shown when input is empty.\r\n\r\n        @property placeholder\r\n        @type string\r\n        @default null\r\n        **/\r\n        placeholder: null,\r\n        /**\r\n        Number of rows in textarea\r\n\r\n        @property rows\r\n        @type integer\r\n        @default 7\r\n        **/        \r\n        rows: 7        \r\n    });\r\n\r\n    $.fn.editabletypes.textarea = Textarea;\r\n\r\n}(window.jQuery));\r\n\r\n/**\r\nSelect (dropdown)\r\n\r\n@class select\r\n@extends list\r\n@final\r\n@example\r\n<a href=\"#\" id=\"status\" data-type=\"select\" data-pk=\"1\" data-url=\"/post\" data-title=\"Select status\"></a>\r\n<script>\r\n$(function(){\r\n    $('#status').editable({\r\n        value: 2,    \r\n        source: [\r\n              {value: 1, text: 'Active'},\r\n              {value: 2, text: 'Blocked'},\r\n              {value: 3, text: 'Deleted'}\r\n           ]\r\n    });\r\n});\r\n</script>\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var Select = function (options) {\r\n        this.init('select', options, Select.defaults);\r\n    };\r\n\r\n    $.fn.editableutils.inherit(Select, $.fn.editabletypes.list);\r\n\r\n    $.extend(Select.prototype, {\r\n        renderList: function() {\r\n            this.$input.empty();\r\n\r\n            var fillItems = function($el, data) {\r\n                var attr;\r\n                if($.isArray(data)) {\r\n                    for(var i=0; i<data.length; i++) {\r\n                        attr = {};\r\n                        if(data[i].children) {\r\n                            attr.label = data[i].text;\r\n                            $el.append(fillItems($('<optgroup>', attr), data[i].children)); \r\n                        } else {\r\n                            attr.value = data[i].value;\r\n                            if(data[i].disabled) {\r\n                                attr.disabled = true;\r\n                            }\r\n                            $el.append($('<option>', attr).text(data[i].text)); \r\n                        }\r\n                    }\r\n                }\r\n                return $el;\r\n            };        \r\n\r\n            fillItems(this.$input, this.sourceData);\r\n            \r\n            this.setClass();\r\n            \r\n            //enter submit\r\n            this.$input.on('keydown.editable', function (e) {\r\n                if (e.which === 13) {\r\n                    $(this).closest('form').submit();\r\n                }\r\n            });            \r\n        },\r\n       \r\n        value2htmlFinal: function(value, element) {\r\n            var text = '', \r\n                items = $.fn.editableutils.itemsByValue(value, this.sourceData);\r\n                \r\n            if(items.length) {\r\n                text = items[0].text;\r\n            }\r\n            \r\n            //$(element).text(text);\r\n            $.fn.editabletypes.abstractinput.prototype.value2html.call(this, text, element);\r\n        },\r\n        \r\n        autosubmit: function() {\r\n            this.$input.off('keydown.editable').on('change.editable', function(){\r\n                $(this).closest('form').submit();\r\n            });\r\n        }\r\n    });      \r\n\r\n    Select.defaults = $.extend({}, $.fn.editabletypes.list.defaults, {\r\n        /**\r\n        @property tpl \r\n        @default <select></select>\r\n        **/         \r\n        tpl:'<select></select>'\r\n    });\r\n\r\n    $.fn.editabletypes.select = Select;      \r\n\r\n}(window.jQuery));\r\n\r\n/**\r\nList of checkboxes. \r\nInternally value stored as javascript array of values.\r\n\r\n@class checklist\r\n@extends list\r\n@final\r\n@example\r\n<a href=\"#\" id=\"options\" data-type=\"checklist\" data-pk=\"1\" data-url=\"/post\" data-title=\"Select options\"></a>\r\n<script>\r\n$(function(){\r\n    $('#options').editable({\r\n        value: [2, 3],    \r\n        source: [\r\n              {value: 1, text: 'option1'},\r\n              {value: 2, text: 'option2'},\r\n              {value: 3, text: 'option3'}\r\n           ]\r\n    });\r\n});\r\n</script>\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var Checklist = function (options) {\r\n        this.init('checklist', options, Checklist.defaults);\r\n    };\r\n\r\n    $.fn.editableutils.inherit(Checklist, $.fn.editabletypes.list);\r\n\r\n    $.extend(Checklist.prototype, {\r\n        renderList: function() {\r\n            var $label, $div;\r\n            \r\n            this.$tpl.empty();\r\n            \r\n            if(!$.isArray(this.sourceData)) {\r\n                return;\r\n            }\r\n\r\n            for(var i=0; i<this.sourceData.length; i++) {\r\n                $label = $('<label>').append($('<input>', {\r\n                                           type: 'checkbox',\r\n                                           value: this.sourceData[i].value \r\n                                     }))\r\n                                     .append($('<span>').text(' '+this.sourceData[i].text));\r\n                \r\n                $('<div>').append($label).appendTo(this.$tpl);\r\n            }\r\n            \r\n            this.$input = this.$tpl.find('input[type=\"checkbox\"]');\r\n            this.setClass();\r\n        },\r\n       \r\n       value2str: function(value) {\r\n           return $.isArray(value) ? value.sort().join($.trim(this.options.separator)) : '';\r\n       },  \r\n       \r\n       //parse separated string\r\n        str2value: function(str) {\r\n           var reg, value = null;\r\n           if(typeof str === 'string' && str.length) {\r\n               reg = new RegExp('\\\\s*'+$.trim(this.options.separator)+'\\\\s*');\r\n               value = str.split(reg);\r\n           } else if($.isArray(str)) {\r\n               value = str; \r\n           } else {\r\n               value = [str];\r\n           }\r\n           return value;\r\n        },       \r\n       \r\n       //set checked on required checkboxes\r\n       value2input: function(value) {\r\n            this.$input.prop('checked', false);\r\n            if($.isArray(value) && value.length) {\r\n               this.$input.each(function(i, el) {\r\n                   var $el = $(el);\r\n                   // cannot use $.inArray as it performs strict comparison\r\n                   $.each(value, function(j, val){\r\n                       /*jslint eqeq: true*/\r\n                       if($el.val() == val) {\r\n                       /*jslint eqeq: false*/                           \r\n                           $el.prop('checked', true);\r\n                       }\r\n                   });\r\n               }); \r\n            }  \r\n        },  \r\n        \r\n       input2value: function() { \r\n           var checked = [];\r\n           this.$input.filter(':checked').each(function(i, el) {\r\n               checked.push($(el).val());\r\n           });\r\n           return checked;\r\n       },            \r\n          \r\n       //collect text of checked boxes\r\n        value2htmlFinal: function(value, element) {\r\n           var html = [],\r\n               checked = $.fn.editableutils.itemsByValue(value, this.sourceData),\r\n               escape = this.options.escape;\r\n               \r\n           if(checked.length) {\r\n               $.each(checked, function(i, v) {\r\n                   var text = escape ? $.fn.editableutils.escape(v.text) : v.text; \r\n                   html.push(text); \r\n               });\r\n               $(element).html(html.join('<br>'));\r\n           } else {\r\n               $(element).empty(); \r\n           }\r\n        },\r\n        \r\n       activate: function() {\r\n           this.$input.first().focus();\r\n       },\r\n       \r\n       autosubmit: function() {\r\n           this.$input.on('keydown', function(e){\r\n               if (e.which === 13) {\r\n                   $(this).closest('form').submit();\r\n               }\r\n           });\r\n       }\r\n    });      \r\n\r\n    Checklist.defaults = $.extend({}, $.fn.editabletypes.list.defaults, {\r\n        /**\r\n        @property tpl \r\n        @default <div></div>\r\n        **/         \r\n        tpl:'<div class=\"editable-checklist\"></div>',\r\n        \r\n        /**\r\n        @property inputclass \r\n        @type string\r\n        @default null\r\n        **/         \r\n        inputclass: null,        \r\n        \r\n        /**\r\n        Separator of values when reading from `data-value` attribute\r\n\r\n        @property separator \r\n        @type string\r\n        @default ','\r\n        **/         \r\n        separator: ','\r\n    });\r\n\r\n    $.fn.editabletypes.checklist = Checklist;      \r\n\r\n}(window.jQuery));\r\n\r\n/**\r\nHTML5 input types.\r\nFollowing types are supported:\r\n\r\n* password\r\n* email\r\n* url\r\n* tel\r\n* number\r\n* range\r\n* time\r\n\r\nLearn more about html5 inputs:  \r\nhttp://www.w3.org/wiki/HTML5_form_additions  \r\nTo check browser compatibility please see:  \r\nhttps://developer.mozilla.org/en-US/docs/HTML/Element/Input\r\n            \r\n@class html5types \r\n@extends text\r\n@final\r\n@since 1.3.0\r\n@example\r\n<a href=\"#\" id=\"email\" data-type=\"email\" data-pk=\"1\">admin@example.com</a>\r\n<script>\r\n$(function(){\r\n    $('#email').editable({\r\n        url: '/post',\r\n        title: 'Enter email'\r\n    });\r\n});\r\n</script>\r\n**/\r\n\r\n/**\r\n@property tpl \r\n@default depends on type\r\n**/ \r\n\r\n/*\r\nPassword\r\n*/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var Password = function (options) {\r\n        this.init('password', options, Password.defaults);\r\n    };\r\n    $.fn.editableutils.inherit(Password, $.fn.editabletypes.text);\r\n    $.extend(Password.prototype, {\r\n       //do not display password, show '[hidden]' instead\r\n       value2html: function(value, element) {\r\n           if(value) {\r\n               $(element).text('[hidden]');\r\n           } else {\r\n               $(element).empty(); \r\n           }\r\n       },\r\n       //as password not displayed, should not set value by html\r\n       html2value: function(html) {\r\n           return null;\r\n       }       \r\n    });    \r\n    Password.defaults = $.extend({}, $.fn.editabletypes.text.defaults, {\r\n        tpl: '<input type=\"password\">'\r\n    });\r\n    $.fn.editabletypes.password = Password;\r\n}(window.jQuery));\r\n\r\n\r\n/*\r\nEmail\r\n*/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var Email = function (options) {\r\n        this.init('email', options, Email.defaults);\r\n    };\r\n    $.fn.editableutils.inherit(Email, $.fn.editabletypes.text);\r\n    Email.defaults = $.extend({}, $.fn.editabletypes.text.defaults, {\r\n        tpl: '<input type=\"email\">'\r\n    });\r\n    $.fn.editabletypes.email = Email;\r\n}(window.jQuery));\r\n\r\n\r\n/*\r\nUrl\r\n*/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var Url = function (options) {\r\n        this.init('url', options, Url.defaults);\r\n    };\r\n    $.fn.editableutils.inherit(Url, $.fn.editabletypes.text);\r\n    Url.defaults = $.extend({}, $.fn.editabletypes.text.defaults, {\r\n        tpl: '<input type=\"url\">'\r\n    });\r\n    $.fn.editabletypes.url = Url;\r\n}(window.jQuery));\r\n\r\n\r\n/*\r\nTel\r\n*/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var Tel = function (options) {\r\n        this.init('tel', options, Tel.defaults);\r\n    };\r\n    $.fn.editableutils.inherit(Tel, $.fn.editabletypes.text);\r\n    Tel.defaults = $.extend({}, $.fn.editabletypes.text.defaults, {\r\n        tpl: '<input type=\"tel\">'\r\n    });\r\n    $.fn.editabletypes.tel = Tel;\r\n}(window.jQuery));\r\n\r\n\r\n/*\r\nNumber\r\n*/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var NumberInput = function (options) {\r\n        this.init('number', options, NumberInput.defaults);\r\n    };\r\n    $.fn.editableutils.inherit(NumberInput, $.fn.editabletypes.text);\r\n    $.extend(NumberInput.prototype, {\r\n         render: function () {\r\n            NumberInput.superclass.render.call(this);\r\n            this.setAttr('min');\r\n            this.setAttr('max');\r\n            this.setAttr('step');\r\n        },\r\n        postrender: function() {\r\n            if(this.$clear) {\r\n                //increase right ffset  for up/down arrows\r\n                this.$clear.css({right: 24});\r\n                /*\r\n                //can position clear button only here, when form is shown and height can be calculated\r\n                var h = this.$input.outerHeight(true) || 20,\r\n                    delta = (h - this.$clear.height()) / 2;\r\n                \r\n                //add 12px to offset right for up/down arrows    \r\n                this.$clear.css({top: delta, right: delta + 16});\r\n                */\r\n            } \r\n        }        \r\n    });     \r\n    NumberInput.defaults = $.extend({}, $.fn.editabletypes.text.defaults, {\r\n        tpl: '<input type=\"number\">',\r\n        inputclass: 'input-mini',\r\n        min: null,\r\n        max: null,\r\n        step: null\r\n    });\r\n    $.fn.editabletypes.number = NumberInput;\r\n}(window.jQuery));\r\n\r\n\r\n/*\r\nRange (inherit from number)\r\n*/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var Range = function (options) {\r\n        this.init('range', options, Range.defaults);\r\n    };\r\n    $.fn.editableutils.inherit(Range, $.fn.editabletypes.number);\r\n    $.extend(Range.prototype, {\r\n        render: function () {\r\n            this.$input = this.$tpl.filter('input');\r\n            \r\n            this.setClass();\r\n            this.setAttr('min');\r\n            this.setAttr('max');\r\n            this.setAttr('step');           \r\n            \r\n            this.$input.on('input', function(){\r\n                $(this).siblings('output').text($(this).val()); \r\n            });  \r\n        },\r\n        activate: function() {\r\n            this.$input.focus();\r\n        }         \r\n    });\r\n    Range.defaults = $.extend({}, $.fn.editabletypes.number.defaults, {\r\n        tpl: '<input type=\"range\"><output style=\"width: 30px; display: inline-block\"></output>',\r\n        inputclass: 'input-medium'\r\n    });\r\n    $.fn.editabletypes.range = Range;\r\n}(window.jQuery));\r\n\r\n/*\r\nTime\r\n*/\r\n(function ($) {\r\n    \"use strict\";\r\n\r\n    var Time = function (options) {\r\n        this.init('time', options, Time.defaults);\r\n    };\r\n    //inherit from abstract, as inheritance from text gives selection error.\r\n    $.fn.editableutils.inherit(Time, $.fn.editabletypes.abstractinput);\r\n    $.extend(Time.prototype, {\r\n        render: function() {\r\n           this.setClass();\r\n        }        \r\n    });\r\n    Time.defaults = $.extend({}, $.fn.editabletypes.abstractinput.defaults, {\r\n        tpl: '<input type=\"time\">'\r\n    });\r\n    $.fn.editabletypes.time = Time;\r\n}(window.jQuery));\r\n\r\n/**\r\nSelect2 input. Based on amazing work of Igor Vaynberg https://github.com/ivaynberg/select2.  \r\nPlease see [original select2 docs](http://ivaynberg.github.com/select2) for detailed description and options.  \r\n \r\nYou should manually download and include select2 distributive:  \r\n\r\n    <link href=\"select2/select2.css\" rel=\"stylesheet\" type=\"text/css\"></link>  \r\n    <script src=\"select2/select2.js\"></script>  \r\n    \r\nTo make it **bootstrap-styled** you can use css from [here](https://github.com/t0m/select2-bootstrap-css): \r\n\r\n    <link href=\"select2-bootstrap.css\" rel=\"stylesheet\" type=\"text/css\"></link>    \r\n    \r\n**Note:** currently `autotext` feature does not work for select2 with `ajax` remote source.    \r\nYou need initially put both `data-value` and element's text youself:    \r\n\r\n    <a href=\"#\" data-type=\"select2\" data-value=\"1\">Text1</a>\r\n    \r\n    \r\n@class select2\r\n@extends abstractinput\r\n@since 1.4.1\r\n@final\r\n@example\r\n<a href=\"#\" id=\"country\" data-type=\"select2\" data-pk=\"1\" data-value=\"ru\" data-url=\"/post\" data-title=\"Select country\"></a>\r\n<script>\r\n$(function(){\r\n    //local source\r\n    $('#country').editable({\r\n        source: [\r\n              {id: 'gb', text: 'Great Britain'},\r\n              {id: 'us', text: 'United States'},\r\n              {id: 'ru', text: 'Russia'}\r\n           ],\r\n        select2: {\r\n           multiple: true\r\n        }\r\n    });\r\n    //remote source (simple)\r\n    $('#country').editable({\r\n        source: '/getCountries',\r\n        select2: {\r\n            placeholder: 'Select Country',\r\n            minimumInputLength: 1\r\n        }\r\n    });\r\n    //remote source (advanced)\r\n    $('#country').editable({\r\n        select2: {\r\n            placeholder: 'Select Country',\r\n            allowClear: true,\r\n            minimumInputLength: 3,\r\n            id: function (item) {\r\n                return item.CountryId;\r\n            },\r\n            ajax: {\r\n                url: '/getCountries',\r\n                dataType: 'json',\r\n                data: function (term, page) {\r\n                    return { query: term };\r\n                },\r\n                results: function (data, page) {\r\n                    return { results: data };\r\n                }\r\n            },\r\n            formatResult: function (item) {\r\n                return item.CountryName;\r\n            },\r\n            formatSelection: function (item) {\r\n                return item.CountryName;\r\n            },\r\n            initSelection: function (element, callback) {\r\n                return $.get('/getCountryById', { query: element.val() }, function (data) {\r\n                    callback(data);\r\n                });\r\n            } \r\n        }  \r\n    });\r\n});\r\n</script>\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var Constructor = function (options) {\r\n        this.init('select2', options, Constructor.defaults);\r\n\r\n        options.select2 = options.select2 || {};\r\n\r\n        this.sourceData = null;\r\n        \r\n        //placeholder\r\n        if(options.placeholder) {\r\n            options.select2.placeholder = options.placeholder;\r\n        }\r\n       \r\n        //if not `tags` mode, use source\r\n        if(!options.select2.tags && options.source) {\r\n            var source = options.source;\r\n            //if source is function, call it (once!)\r\n            if ($.isFunction(options.source)) {\r\n                source = options.source.call(options.scope);\r\n            }               \r\n\r\n            if (typeof source === 'string') {\r\n                options.select2.ajax = options.select2.ajax || {};\r\n                //some default ajax params\r\n                if(!options.select2.ajax.data) {\r\n                    options.select2.ajax.data = function(term) {return { query:term };};\r\n                }\r\n                if(!options.select2.ajax.results) {\r\n                    options.select2.ajax.results = function(data) { return {results:data };};\r\n                }\r\n                options.select2.ajax.url = source;\r\n            } else {\r\n                //check format and convert x-editable format to select2 format (if needed)\r\n                this.sourceData = this.convertSource(source);\r\n                options.select2.data = this.sourceData;\r\n            }\r\n        } \r\n\r\n        //overriding objects in config (as by default jQuery extend() is not recursive)\r\n        this.options.select2 = $.extend({}, Constructor.defaults.select2, options.select2);\r\n\r\n        //detect whether it is multi-valued\r\n        this.isMultiple = this.options.select2.tags || this.options.select2.multiple;\r\n        this.isRemote = ('ajax' in this.options.select2);\r\n\r\n        //store function returning ID of item\r\n        //should be here as used inautotext for local source\r\n        this.idFunc = this.options.select2.id;\r\n        if (typeof(this.idFunc) !== \"function\") {\r\n            var idKey = this.idFunc || 'id';\r\n            this.idFunc = function (e) { return e[idKey]; };\r\n        }\r\n\r\n        //store function that renders text in select2\r\n        this.formatSelection = this.options.select2.formatSelection;\r\n        if (typeof(this.formatSelection) !== \"function\") {\r\n            this.formatSelection = function (e) { return e.text; };\r\n        }\r\n    };\r\n\r\n    $.fn.editableutils.inherit(Constructor, $.fn.editabletypes.abstractinput);\r\n\r\n    $.extend(Constructor.prototype, {\r\n        render: function() {\r\n            this.setClass();\r\n\r\n            //can not apply select2 here as it calls initSelection \r\n            //over input that does not have correct value yet.\r\n            //apply select2 only in value2input\r\n            //this.$input.select2(this.options.select2);\r\n\r\n            //when data is loaded via ajax, we need to know when it's done to populate listData\r\n            if(this.isRemote) {\r\n                //listen to loaded event to populate data\r\n                this.$input.on('select2-loaded', $.proxy(function(e) {\r\n                    this.sourceData = e.items.results;\r\n                }, this));\r\n            }\r\n\r\n            //trigger resize of editableform to re-position container in multi-valued mode\r\n            if(this.isMultiple) {\r\n               this.$input.on('change', function() {\r\n                   $(this).closest('form').parent().triggerHandler('resize');\r\n               });\r\n            }\r\n       },\r\n\r\n       value2html: function(value, element) {\r\n           var text = '', data,\r\n               that = this;\r\n\r\n           if(this.options.select2.tags) { //in tags mode just assign value\r\n              data = value; \r\n              //data = $.fn.editableutils.itemsByValue(value, this.options.select2.tags, this.idFunc);\r\n           } else if(this.sourceData) {\r\n              data = $.fn.editableutils.itemsByValue(value, this.sourceData, this.idFunc); \r\n           } else {\r\n              //can not get list of possible values \r\n              //(e.g. autotext for select2 with ajax source)\r\n           }\r\n\r\n           //data may be array (when multiple values allowed)\r\n           if($.isArray(data)) {\r\n               //collect selected data and show with separator\r\n               text = [];\r\n               $.each(data, function(k, v){\r\n                   text.push(v && typeof v === 'object' ? that.formatSelection(v) : v);\r\n               });\r\n           } else if(data) {\r\n               text = that.formatSelection(data);\r\n           }\r\n\r\n           text = $.isArray(text) ? text.join(this.options.viewseparator) : text;\r\n\r\n           //$(element).text(text);\r\n           Constructor.superclass.value2html.call(this, text, element); \r\n       },\r\n\r\n       html2value: function(html) {\r\n           return this.options.select2.tags ? this.str2value(html, this.options.viewseparator) : null;\r\n       },\r\n\r\n       value2input: function(value) {\r\n           // if value array => join it anyway\r\n           if($.isArray(value)) {\r\n              value = value.join(this.getSeparator());\r\n           }\r\n\r\n           //for remote source just set value, text is updated by initSelection\r\n           if(!this.$input.data('select2')) {\r\n               this.$input.val(value);\r\n               this.$input.select2(this.options.select2);\r\n           } else {\r\n               //second argument needed to separate initial change from user's click (for autosubmit)   \r\n               this.$input.val(value).trigger('change', true); \r\n\r\n               //Uncaught Error: cannot call val() if initSelection() is not defined\r\n               //this.$input.select2('val', value);\r\n           }\r\n\r\n           // if defined remote source AND no multiple mode AND no user's initSelection provided --> \r\n           // we should somehow get text for provided id.\r\n           // The solution is to use element's text as text for that id (exclude empty)\r\n           if(this.isRemote && !this.isMultiple && !this.options.select2.initSelection) {\r\n               // customId and customText are methods to extract `id` and `text` from data object\r\n               // we can use this workaround only if user did not define these methods\r\n               // otherwise we cant construct data object\r\n               var customId = this.options.select2.id,\r\n                   customText = this.options.select2.formatSelection;\r\n\r\n               if(!customId && !customText) {\r\n                   var $el = $(this.options.scope);\r\n                   if (!$el.data('editable').isEmpty) {\r\n                       var data = {id: value, text: $el.text()};\r\n                       this.$input.select2('data', data); \r\n                   }\r\n               }\r\n           }\r\n       },\r\n       \r\n       input2value: function() { \r\n           return this.$input.select2('val');\r\n       },\r\n\r\n       str2value: function(str, separator) {\r\n            if(typeof str !== 'string' || !this.isMultiple) {\r\n                return str;\r\n            }\r\n\r\n            separator = separator || this.getSeparator();\r\n\r\n            var val, i, l;\r\n\r\n            if (str === null || str.length < 1) {\r\n                return null;\r\n            }\r\n            val = str.split(separator);\r\n            for (i = 0, l = val.length; i < l; i = i + 1) {\r\n                val[i] = $.trim(val[i]);\r\n            }\r\n\r\n            return val;\r\n       },\r\n\r\n        autosubmit: function() {\r\n            this.$input.on('change', function(e, isInitial){\r\n                if(!isInitial) {\r\n                  $(this).closest('form').submit();\r\n                }\r\n            });\r\n        },\r\n\r\n        getSeparator: function() {\r\n            return this.options.select2.separator || $.fn.select2.defaults.separator;\r\n        },\r\n\r\n        /*\r\n        Converts source from x-editable format: {value: 1, text: \"1\"} to\r\n        select2 format: {id: 1, text: \"1\"}\r\n        */\r\n        convertSource: function(source) {\r\n            if($.isArray(source) && source.length && source[0].value !== undefined) {\r\n                for(var i = 0; i<source.length; i++) {\r\n                    if(source[i].value !== undefined) {\r\n                        source[i].id = source[i].value;\r\n                        delete source[i].value;\r\n                    }\r\n                }\r\n            }\r\n            return source;\r\n        },\r\n        \r\n        destroy: function() {\r\n            if(this.$input.data('select2')) {\r\n                this.$input.select2('destroy');\r\n            }\r\n        }\r\n        \r\n    });\r\n\r\n    Constructor.defaults = $.extend({}, $.fn.editabletypes.abstractinput.defaults, {\r\n        /**\r\n        @property tpl \r\n        @default <input type=\"hidden\">\r\n        **/\r\n        tpl:'<input type=\"hidden\">',\r\n        /**\r\n        Configuration of select2. [Full list of options](http://ivaynberg.github.com/select2).\r\n\r\n        @property select2 \r\n        @type object\r\n        @default null\r\n        **/\r\n        select2: null,\r\n        /**\r\n        Placeholder attribute of select\r\n\r\n        @property placeholder \r\n        @type string\r\n        @default null\r\n        **/\r\n        placeholder: null,\r\n        /**\r\n        Source data for select. It will be assigned to select2 `data` property and kept here just for convenience.\r\n        Please note, that format is different from simple `select` input: use 'id' instead of 'value'.\r\n        E.g. `[{id: 1, text: \"text1\"}, {id: 2, text: \"text2\"}, ...]`.\r\n\r\n        @property source \r\n        @type array|string|function\r\n        @default null        \r\n        **/\r\n        source: null,\r\n        /**\r\n        Separator used to display tags.\r\n\r\n        @property viewseparator \r\n        @type string\r\n        @default ', '        \r\n        **/\r\n        viewseparator: ', '\r\n    });\r\n\r\n    $.fn.editabletypes.select2 = Constructor;\r\n\r\n}(window.jQuery));\r\n\r\n/**\r\n* Combodate - 1.0.5\r\n* Dropdown date and time picker.\r\n* Converts text input into dropdowns to pick day, month, year, hour, minute and second.\r\n* Uses momentjs as datetime library http://momentjs.com.\r\n* For i18n include corresponding file from https://github.com/timrwood/moment/tree/master/lang \r\n*\r\n* Confusion at noon and midnight - see http://en.wikipedia.org/wiki/12-hour_clock#Confusion_at_noon_and_midnight\r\n* In combodate: \r\n* 12:00 pm --> 12:00 (24-h format, midday)\r\n* 12:00 am --> 00:00 (24-h format, midnight, start of day)\r\n* \r\n* Differs from momentjs parse rules:\r\n* 00:00 pm, 12:00 pm --> 12:00 (24-h format, day not change)\r\n* 00:00 am, 12:00 am --> 00:00 (24-h format, day not change)\r\n* \r\n* \r\n* Author: Vitaliy Potapov\r\n* Project page: http://github.com/vitalets/combodate\r\n* Copyright (c) 2012 Vitaliy Potapov. Released under MIT License.\r\n**/\r\n(function ($) {\r\n\r\n    var Combodate = function (element, options) {\r\n        this.$element = $(element);\r\n        if(!this.$element.is('input')) {\r\n            $.error('Combodate should be applied to INPUT element');\r\n            return;\r\n        }\r\n        this.options = $.extend({}, $.fn.combodate.defaults, options, this.$element.data());\r\n        this.init();  \r\n     };\r\n\r\n    Combodate.prototype = {\r\n        constructor: Combodate, \r\n        init: function () {\r\n            this.map = {\r\n                //key   regexp    moment.method\r\n                day:    ['D',    'date'], \r\n                month:  ['M',    'month'], \r\n                year:   ['Y',    'year'], \r\n                hour:   ['[Hh]', 'hours'],\r\n                minute: ['m',    'minutes'], \r\n                second: ['s',    'seconds'],\r\n                ampm:   ['[Aa]', ''] \r\n            };\r\n            \r\n            this.$widget = $('<span class=\"combodate\"></span>').html(this.getTemplate());\r\n                      \r\n            this.initCombos();\r\n            \r\n            //update original input on change \r\n            this.$widget.on('change', 'select', $.proxy(function(e) {\r\n                this.$element.val(this.getValue()).change();\r\n                // update days count if month or year changes\r\n                if (this.options.smartDays) {\r\n                    if ($(e.target).is('.month') || $(e.target).is('.year')) {\r\n                        this.fillCombo('day');\r\n                    }\r\n                }\r\n            }, this));\r\n            \r\n            this.$widget.find('select').css('width', 'auto');\r\n                                       \r\n            // hide original input and insert widget                                       \r\n            this.$element.hide().after(this.$widget);\r\n            \r\n            // set initial value\r\n            this.setValue(this.$element.val() || this.options.value);\r\n        },\r\n        \r\n        /*\r\n         Replace tokens in template with <select> elements \r\n        */         \r\n        getTemplate: function() {\r\n            var tpl = this.options.template;\r\n\r\n            //first pass\r\n            $.each(this.map, function(k, v) {\r\n                v = v[0]; \r\n                var r = new RegExp(v+'+'),\r\n                    token = v.length > 1 ? v.substring(1, 2) : v;\r\n                    \r\n                tpl = tpl.replace(r, '{'+token+'}');\r\n            });\r\n\r\n            //replace spaces with &nbsp;\r\n            tpl = tpl.replace(/ /g, '&nbsp;');\r\n\r\n            //second pass\r\n            $.each(this.map, function(k, v) {\r\n                v = v[0];\r\n                var token = v.length > 1 ? v.substring(1, 2) : v;\r\n                    \r\n                tpl = tpl.replace('{'+token+'}', '<select class=\"'+k+'\"></select>');\r\n            });   \r\n\r\n            return tpl;\r\n        },\r\n        \r\n        /*\r\n         Initialize combos that presents in template \r\n        */        \r\n        initCombos: function() {\r\n            for (var k in this.map) {\r\n                var $c = this.$widget.find('.'+k);\r\n                // set properties like this.$day, this.$month etc.\r\n                this['$'+k] = $c.length ? $c : null;\r\n                // fill with items\r\n                this.fillCombo(k);\r\n            }\r\n        },\r\n\r\n        /*\r\n         Fill combo with items \r\n        */        \r\n        fillCombo: function(k) {\r\n            var $combo = this['$'+k];\r\n            if (!$combo) {\r\n                return;\r\n            }\r\n\r\n            // define method name to fill items, e.g `fillDays`\r\n            var f = 'fill' + k.charAt(0).toUpperCase() + k.slice(1); \r\n            var items = this[f]();\r\n            var value = $combo.val();\r\n\r\n            $combo.empty();\r\n            for(var i=0; i<items.length; i++) {\r\n                $combo.append('<option value=\"'+items[i][0]+'\">'+items[i][1]+'</option>');\r\n            }\r\n\r\n            $combo.val(value);\r\n        },\r\n\r\n        /*\r\n         Initialize items of combos. Handles `firstItem` option \r\n        */\r\n        fillCommon: function(key) {\r\n            var values = [],\r\n                relTime;\r\n                \r\n            if(this.options.firstItem === 'name') {\r\n                //need both to support moment ver < 2 and  >= 2\r\n                relTime = moment.relativeTime || moment.langData()._relativeTime; \r\n                var header = typeof relTime[key] === 'function' ? relTime[key](1, true, key, false) : relTime[key];\r\n                //take last entry (see momentjs lang files structure) \r\n                header = header.split(' ').reverse()[0];                \r\n                values.push(['', header]);\r\n            } else if(this.options.firstItem === 'empty') {\r\n                values.push(['', '']);\r\n            }\r\n            return values;\r\n        },  \r\n\r\n\r\n        /*\r\n        fill day\r\n        */\r\n        fillDay: function() {\r\n            var items = this.fillCommon('d'), name, i,\r\n                twoDigit = this.options.template.indexOf('DD') !== -1,\r\n                daysCount = 31;\r\n\r\n            // detect days count (depends on month and year)\r\n            // originally https://github.com/vitalets/combodate/pull/7\r\n            if (this.options.smartDays && this.$month && this.$year) {\r\n                var month = parseInt(this.$month.val(), 10);\r\n                var year = parseInt(this.$year.val(), 10);\r\n\r\n                if (!isNaN(month) && !isNaN(year)) {\r\n                    daysCount = moment([year, month]).daysInMonth();\r\n                }\r\n            }\r\n\r\n            for (i = 1; i <= daysCount; i++) {\r\n                name = twoDigit ? this.leadZero(i) : i;\r\n                items.push([i, name]);\r\n            }\r\n            return items;        \r\n        },\r\n        \r\n        /*\r\n        fill month\r\n        */\r\n        fillMonth: function() {\r\n            var items = this.fillCommon('M'), name, i, \r\n                longNames = this.options.template.indexOf('MMMM') !== -1,\r\n                shortNames = this.options.template.indexOf('MMM') !== -1,\r\n                twoDigit = this.options.template.indexOf('MM') !== -1;\r\n                \r\n            for(i=0; i<=11; i++) {\r\n                if(longNames) {\r\n                    //see https://github.com/timrwood/momentjs.com/pull/36\r\n                    name = moment().date(1).month(i).format('MMMM');\r\n                } else if(shortNames) {\r\n                    name = moment().date(1).month(i).format('MMM');\r\n                } else if(twoDigit) {\r\n                    name = this.leadZero(i+1);\r\n                } else {\r\n                    name = i+1;\r\n                }\r\n                items.push([i, name]);\r\n            } \r\n            return items;\r\n        },  \r\n        \r\n        /*\r\n        fill year\r\n        */\r\n        fillYear: function() {\r\n            var items = [], name, i, \r\n                longNames = this.options.template.indexOf('YYYY') !== -1;\r\n           \r\n            for(i=this.options.maxYear; i>=this.options.minYear; i--) {\r\n                name = longNames ? i : (i+'').substring(2);\r\n                items[this.options.yearDescending ? 'push' : 'unshift']([i, name]);\r\n            }\r\n            \r\n            items = this.fillCommon('y').concat(items);\r\n            \r\n            return items;              \r\n        },    \r\n        \r\n        /*\r\n        fill hour\r\n        */\r\n        fillHour: function() {\r\n            var items = this.fillCommon('h'), name, i,\r\n                h12 = this.options.template.indexOf('h') !== -1,\r\n                h24 = this.options.template.indexOf('H') !== -1,\r\n                twoDigit = this.options.template.toLowerCase().indexOf('hh') !== -1,\r\n                min = h12 ? 1 : 0, \r\n                max = h12 ? 12 : 23;\r\n                \r\n            for(i=min; i<=max; i++) {\r\n                name = twoDigit ? this.leadZero(i) : i;\r\n                items.push([i, name]);\r\n            } \r\n            return items;                 \r\n        },    \r\n        \r\n        /*\r\n        fill minute\r\n        */\r\n        fillMinute: function() {\r\n            var items = this.fillCommon('m'), name, i,\r\n                twoDigit = this.options.template.indexOf('mm') !== -1;\r\n\r\n            for(i=0; i<=59; i+= this.options.minuteStep) {\r\n                name = twoDigit ? this.leadZero(i) : i;\r\n                items.push([i, name]);\r\n            }    \r\n            return items;              \r\n        },  \r\n        \r\n        /*\r\n        fill second\r\n        */\r\n        fillSecond: function() {\r\n            var items = this.fillCommon('s'), name, i,\r\n                twoDigit = this.options.template.indexOf('ss') !== -1;\r\n\r\n            for(i=0; i<=59; i+= this.options.secondStep) {\r\n                name = twoDigit ? this.leadZero(i) : i;\r\n                items.push([i, name]);\r\n            }    \r\n            return items;              \r\n        },  \r\n        \r\n        /*\r\n        fill ampm\r\n        */\r\n        fillAmpm: function() {\r\n            var ampmL = this.options.template.indexOf('a') !== -1,\r\n                ampmU = this.options.template.indexOf('A') !== -1,            \r\n                items = [\r\n                    ['am', ampmL ? 'am' : 'AM'],\r\n                    ['pm', ampmL ? 'pm' : 'PM']\r\n                ];\r\n            return items;                              \r\n        },                                       \r\n\r\n        /*\r\n         Returns current date value from combos. \r\n         If format not specified - `options.format` used.\r\n         If format = `null` - Moment object returned.\r\n        */\r\n        getValue: function(format) {\r\n            var dt, values = {}, \r\n                that = this,\r\n                notSelected = false;\r\n                \r\n            //getting selected values    \r\n            $.each(this.map, function(k, v) {\r\n                if(k === 'ampm') {\r\n                    return;\r\n                }\r\n                var def = k === 'day' ? 1 : 0;\r\n                  \r\n                values[k] = that['$'+k] ? parseInt(that['$'+k].val(), 10) : def; \r\n                \r\n                if(isNaN(values[k])) {\r\n                   notSelected = true;\r\n                   return false; \r\n                }\r\n            });\r\n            \r\n            //if at least one visible combo not selected - return empty string\r\n            if(notSelected) {\r\n               return '';\r\n            }\r\n            \r\n            //convert hours 12h --> 24h \r\n            if(this.$ampm) {\r\n                //12:00 pm --> 12:00 (24-h format, midday), 12:00 am --> 00:00 (24-h format, midnight, start of day)\r\n                if(values.hour === 12) {\r\n                    values.hour = this.$ampm.val() === 'am' ? 0 : 12;                    \r\n                } else {\r\n                    values.hour = this.$ampm.val() === 'am' ? values.hour : values.hour+12;\r\n                }\r\n            }    \r\n            \r\n            dt = moment([values.year, values.month, values.day, values.hour, values.minute, values.second]);\r\n            \r\n            //highlight invalid date\r\n            this.highlight(dt);\r\n                              \r\n            format = format === undefined ? this.options.format : format;\r\n            if(format === null) {\r\n               return dt.isValid() ? dt : null; \r\n            } else {\r\n               return dt.isValid() ? dt.format(format) : ''; \r\n            }           \r\n        },\r\n        \r\n        setValue: function(value) {\r\n            if(!value) {\r\n                return;\r\n            }\r\n            \r\n            var dt = typeof value === 'string' ? moment(value, this.options.format) : moment(value),\r\n                that = this,\r\n                values = {};\r\n            \r\n            //function to find nearest value in select options\r\n            function getNearest($select, value) {\r\n                var delta = {};\r\n                $select.children('option').each(function(i, opt){\r\n                    var optValue = $(opt).attr('value'),\r\n                    distance;\r\n\r\n                    if(optValue === '') return;\r\n                    distance = Math.abs(optValue - value); \r\n                    if(typeof delta.distance === 'undefined' || distance < delta.distance) {\r\n                        delta = {value: optValue, distance: distance};\r\n                    } \r\n                }); \r\n                return delta.value;\r\n            }             \r\n            \r\n            if(dt.isValid()) {\r\n                //read values from date object\r\n                $.each(this.map, function(k, v) {\r\n                    if(k === 'ampm') {\r\n                       return; \r\n                    }\r\n                    values[k] = dt[v[1]]();\r\n                });\r\n               \r\n                if(this.$ampm) {\r\n                    //12:00 pm --> 12:00 (24-h format, midday), 12:00 am --> 00:00 (24-h format, midnight, start of day)\r\n                    if(values.hour >= 12) {\r\n                        values.ampm = 'pm';\r\n                        if(values.hour > 12) {\r\n                            values.hour -= 12;\r\n                        }\r\n                    } else {\r\n                        values.ampm = 'am';\r\n                        if(values.hour === 0) {\r\n                            values.hour = 12;\r\n                        }\r\n                    } \r\n                }\r\n               \r\n                $.each(values, function(k, v) {\r\n                    //call val() for each existing combo, e.g. this.$hour.val()\r\n                    if(that['$'+k]) {\r\n                       \r\n                        if(k === 'minute' && that.options.minuteStep > 1 && that.options.roundTime) {\r\n                           v = getNearest(that['$'+k], v);\r\n                        }\r\n                       \r\n                        if(k === 'second' && that.options.secondStep > 1 && that.options.roundTime) {\r\n                           v = getNearest(that['$'+k], v);\r\n                        }                       \r\n                       \r\n                        that['$'+k].val(v);\r\n                    }\r\n                });\r\n\r\n                // update days count\r\n                if (this.options.smartDays) {\r\n                    this.fillCombo('day');\r\n                }\r\n               \r\n               this.$element.val(dt.format(this.options.format)).change();\r\n            }\r\n        },\r\n        \r\n        /*\r\n         highlight combos if date is invalid\r\n        */\r\n        highlight: function(dt) {\r\n            if(!dt.isValid()) {\r\n                if(this.options.errorClass) {\r\n                    this.$widget.addClass(this.options.errorClass);\r\n                } else {\r\n                    //store original border color\r\n                    if(!this.borderColor) {\r\n                        this.borderColor = this.$widget.find('select').css('border-color'); \r\n                    }\r\n                    this.$widget.find('select').css('border-color', 'red');\r\n                } \r\n            } else {\r\n                if(this.options.errorClass) {\r\n                    this.$widget.removeClass(this.options.errorClass);\r\n                } else {\r\n                    this.$widget.find('select').css('border-color', this.borderColor);\r\n                }  \r\n            }\r\n        },\r\n        \r\n        leadZero: function(v) {\r\n            return v <= 9 ? '0' + v : v; \r\n        },\r\n        \r\n        destroy: function() {\r\n            this.$widget.remove();\r\n            this.$element.removeData('combodate').show();\r\n        }\r\n        \r\n        //todo: clear method        \r\n    };\r\n\r\n    $.fn.combodate = function ( option ) {\r\n        var d, args = Array.apply(null, arguments);\r\n        args.shift();\r\n\r\n        //getValue returns date as string / object (not jQuery object)\r\n        if(option === 'getValue' && this.length && (d = this.eq(0).data('combodate'))) {\r\n          return d.getValue.apply(d, args);\r\n        }        \r\n        \r\n        return this.each(function () {\r\n            var $this = $(this),\r\n            data = $this.data('combodate'),\r\n            options = typeof option == 'object' && option;\r\n            if (!data) {\r\n                $this.data('combodate', (data = new Combodate(this, options)));\r\n            }\r\n            if (typeof option == 'string' && typeof data[option] == 'function') {\r\n                data[option].apply(data, args);\r\n            }\r\n        });\r\n    };  \r\n    \r\n    $.fn.combodate.defaults = {\r\n         //in this format value stored in original input\r\n        format: 'DD-MM-YYYY HH:mm',      \r\n        //in this format items in dropdowns are displayed\r\n        template: 'D / MMM / YYYY   H : mm',\r\n        //initial value, can be `new Date()`    \r\n        value: null,                       \r\n        minYear: 1970,\r\n        maxYear: 2015,\r\n        yearDescending: true,\r\n        minuteStep: 5,\r\n        secondStep: 1,\r\n        firstItem: 'empty', //'name', 'empty', 'none'\r\n        errorClass: null,\r\n        roundTime: true, // whether to round minutes and seconds if step > 1\r\n        smartDays: false // whether days in combo depend on selected month: 31, 30, 28\r\n    };\r\n\r\n}(window.jQuery));\r\n/**\r\nCombodate input - dropdown date and time picker.    \r\nBased on [combodate](http://vitalets.github.com/combodate) plugin (included). To use it you should manually include [momentjs](http://momentjs.com).\r\n\r\n    <script src=\"js/moment.min.js\"></script>\r\n   \r\nAllows to input:\r\n\r\n* only date\r\n* only time \r\n* both date and time  \r\n\r\nPlease note, that format is taken from momentjs and **not compatible** with bootstrap-datepicker / jquery UI datepicker.  \r\nInternally value stored as `momentjs` object. \r\n\r\n@class combodate\r\n@extends abstractinput\r\n@final\r\n@since 1.4.0\r\n@example\r\n<a href=\"#\" id=\"dob\" data-type=\"combodate\" data-pk=\"1\" data-url=\"/post\" data-value=\"1984-05-15\" data-title=\"Select date\"></a>\r\n<script>\r\n$(function(){\r\n    $('#dob').editable({\r\n        format: 'YYYY-MM-DD',    \r\n        viewformat: 'DD.MM.YYYY',    \r\n        template: 'D / MMMM / YYYY',    \r\n        combodate: {\r\n                minYear: 2000,\r\n                maxYear: 2015,\r\n                minuteStep: 1\r\n           }\r\n        }\r\n    });\r\n});\r\n</script>\r\n**/\r\n\r\n/*global moment*/\r\n\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var Constructor = function (options) {\r\n        this.init('combodate', options, Constructor.defaults);\r\n        \r\n        //by default viewformat equals to format\r\n        if(!this.options.viewformat) {\r\n            this.options.viewformat = this.options.format;\r\n        }        \r\n        \r\n        //try parse combodate config defined as json string in data-combodate\r\n        options.combodate = $.fn.editableutils.tryParseJson(options.combodate, true);\r\n\r\n        //overriding combodate config (as by default jQuery extend() is not recursive)\r\n        this.options.combodate = $.extend({}, Constructor.defaults.combodate, options.combodate, {\r\n            format: this.options.format,\r\n            template: this.options.template\r\n        });\r\n    };\r\n\r\n    $.fn.editableutils.inherit(Constructor, $.fn.editabletypes.abstractinput);    \r\n    \r\n    $.extend(Constructor.prototype, {\r\n        render: function () {\r\n            this.$input.combodate(this.options.combodate);\r\n                    \r\n            if($.fn.editableform.engine === 'bs3') {\r\n                this.$input.siblings().find('select').addClass('form-control');\r\n            }\r\n            \r\n            if(this.options.inputclass) {\r\n                this.$input.siblings().find('select').addClass(this.options.inputclass);\r\n            }            \r\n            //\"clear\" link\r\n            /*\r\n            if(this.options.clear) {\r\n                this.$clear = $('<a href=\"#\"></a>').html(this.options.clear).click($.proxy(function(e){\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    this.clear();\r\n                }, this));\r\n                \r\n                this.$tpl.parent().append($('<div class=\"editable-clear\">').append(this.$clear));  \r\n            } \r\n            */               \r\n        },\r\n        \r\n        value2html: function(value, element) {\r\n            var text = value ? value.format(this.options.viewformat) : '';\r\n            //$(element).text(text);\r\n            Constructor.superclass.value2html.call(this, text, element);  \r\n        },\r\n\r\n        html2value: function(html) {\r\n            return html ? moment(html, this.options.viewformat) : null;\r\n        },   \r\n        \r\n        value2str: function(value) {\r\n            return value ? value.format(this.options.format) : '';\r\n       }, \r\n       \r\n       str2value: function(str) {\r\n           return str ? moment(str, this.options.format) : null;\r\n       }, \r\n       \r\n       value2submit: function(value) {\r\n           return this.value2str(value);\r\n       },                    \r\n\r\n       value2input: function(value) {\r\n           this.$input.combodate('setValue', value);\r\n       },\r\n        \r\n       input2value: function() { \r\n           return this.$input.combodate('getValue', null);\r\n       },       \r\n       \r\n       activate: function() {\r\n           this.$input.siblings('.combodate').find('select').eq(0).focus();\r\n       },\r\n       \r\n       /*\r\n       clear:  function() {\r\n          this.$input.data('datepicker').date = null;\r\n          this.$input.find('.active').removeClass('active');\r\n       },\r\n       */\r\n       \r\n       autosubmit: function() {\r\n           \r\n       }\r\n\r\n    });\r\n    \r\n    Constructor.defaults = $.extend({}, $.fn.editabletypes.abstractinput.defaults, {\r\n        /**\r\n        @property tpl \r\n        @default <input type=\"text\">\r\n        **/         \r\n        tpl:'<input type=\"text\">',\r\n        /**\r\n        @property inputclass \r\n        @default null\r\n        **/         \r\n        inputclass: null,\r\n        /**\r\n        Format used for sending value to server. Also applied when converting date from <code>data-value</code> attribute.<br>\r\n        See list of tokens in [momentjs docs](http://momentjs.com/docs/#/parsing/string-format)  \r\n        \r\n        @property format \r\n        @type string\r\n        @default YYYY-MM-DD\r\n        **/         \r\n        format:'YYYY-MM-DD',\r\n        /**\r\n        Format used for displaying date. Also applied when converting date from element's text on init.   \r\n        If not specified equals to `format`.\r\n        \r\n        @property viewformat \r\n        @type string\r\n        @default null\r\n        **/          \r\n        viewformat: null,        \r\n        /**\r\n        Template used for displaying dropdowns.\r\n        \r\n        @property template \r\n        @type string\r\n        @default D / MMM / YYYY\r\n        **/          \r\n        template: 'D / MMM / YYYY',  \r\n        /**\r\n        Configuration of combodate.\r\n        Full list of options: http://vitalets.github.com/combodate/#docs\r\n        \r\n        @property combodate \r\n        @type object\r\n        @default null\r\n        **/\r\n        combodate: null\r\n        \r\n        /*\r\n        (not implemented yet)\r\n        Text shown as clear date button. \r\n        If <code>false</code> clear button will not be rendered.\r\n        \r\n        @property clear \r\n        @type boolean|string\r\n        @default 'x clear'         \r\n        */\r\n        //clear: '&times; clear'\r\n    });   \r\n\r\n    $.fn.editabletypes.combodate = Constructor;\r\n\r\n}(window.jQuery));\r\n\r\n/*\r\nEditableform based on Twitter Bootstrap 3\r\n*/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    //store parent methods\r\n    var pInitInput = $.fn.editableform.Constructor.prototype.initInput;\r\n    \r\n    $.extend($.fn.editableform.Constructor.prototype, {\r\n        initTemplate: function() {\r\n            this.$form = $($.fn.editableform.template); \r\n            this.$form.find('.control-group').addClass('form-group');\r\n            this.$form.find('.editable-error-block').addClass('help-block');\r\n        },\r\n        initInput: function() {  \r\n            pInitInput.apply(this);\r\n\r\n            //for bs3 set default class `input-sm` to standard inputs\r\n            var emptyInputClass = this.input.options.inputclass === null || this.input.options.inputclass === false;\r\n            var defaultClass = 'input-sm';\r\n            \r\n            //bs3 add `form-control` class to standard inputs\r\n            var stdtypes = 'text,select,textarea,password,email,url,tel,number,range,time,typeaheadjs'.split(','); \r\n            if(~$.inArray(this.input.type, stdtypes)) {\r\n                this.input.$input.addClass('form-control');\r\n                if(emptyInputClass) {\r\n                    this.input.options.inputclass = defaultClass;\r\n                    this.input.$input.addClass(defaultClass);\r\n                }\r\n            }             \r\n        \r\n            //apply bs3 size class also to buttons (to fit size of control)\r\n            var $btn = this.$form.find('.editable-buttons');\r\n            var classes = emptyInputClass ? [defaultClass] : this.input.options.inputclass.split(' ');\r\n            for(var i=0; i<classes.length; i++) {\r\n                // `btn-sm` is default now\r\n                /*\r\n                if(classes[i].toLowerCase() === 'input-sm') { \r\n                    $btn.find('button').addClass('btn-sm');  \r\n                }\r\n                */\r\n                if(classes[i].toLowerCase() === 'input-lg') {\r\n                    $btn.find('button').removeClass('btn-sm').addClass('btn-lg'); \r\n                }\r\n            }\r\n        }\r\n    });    \r\n    \r\n    //buttons\r\n    $.fn.editableform.buttons = \r\n      '<button type=\"submit\" class=\"btn btn-primary btn-sm editable-submit\">'+\r\n        '<i class=\"glyphicon glyphicon-ok\"></i>'+\r\n      '</button>'+\r\n      '<button type=\"button\" class=\"btn btn-default btn-sm editable-cancel\">'+\r\n        '<i class=\"glyphicon glyphicon-remove\"></i>'+\r\n      '</button>';         \r\n    \r\n    //error classes\r\n    $.fn.editableform.errorGroupClass = 'has-error';\r\n    $.fn.editableform.errorBlockClass = null;  \r\n    //engine\r\n    $.fn.editableform.engine = 'bs3';  \r\n}(window.jQuery));\r\n/**\r\n* Editable Popover3 (for Bootstrap 3) \r\n* ---------------------\r\n* requires bootstrap-popover.js\r\n*/\r\n(function ($) {\r\n    \"use strict\";\r\n\r\n    //extend methods\r\n    $.extend($.fn.editableContainer.Popup.prototype, {\r\n        containerName: 'popover',\r\n        containerDataName: 'bs.popover',\r\n        innerCss: '.popover-content',\r\n        defaults: $.fn.popover.Constructor.DEFAULTS,\r\n\r\n        initContainer: function(){\r\n            $.extend(this.containerOptions, {\r\n                trigger: 'manual',\r\n                selector: false,\r\n                content: ' ',\r\n                template: this.defaults.template\r\n            });\r\n            \r\n            //as template property is used in inputs, hide it from popover\r\n            var t;\r\n            if(this.$element.data('template')) {\r\n               t = this.$element.data('template');\r\n               this.$element.removeData('template');  \r\n            } \r\n            \r\n            this.call(this.containerOptions);\r\n            \r\n            if(t) {\r\n               //restore data('template')\r\n               this.$element.data('template', t); \r\n            }\r\n        }, \r\n        \r\n        /* show */\r\n        innerShow: function () {\r\n            this.call('show');                \r\n        },  \r\n        \r\n        /* hide */\r\n        innerHide: function () {\r\n            this.call('hide');       \r\n        }, \r\n        \r\n        /* destroy */\r\n        innerDestroy: function() {\r\n            this.call('destroy');\r\n        },                               \r\n        \r\n        setContainerOption: function(key, value) {\r\n            this.container().options[key] = value; \r\n        },               \r\n\r\n        /**\r\n        * move popover to new position. This function mainly copied from bootstrap-popover.\r\n        */\r\n        /*jshint laxcomma: true, eqeqeq: false*/\r\n        setPosition: function () { \r\n\r\n            (function() {\r\n            /*    \r\n                var $tip = this.tip()\r\n                , inside\r\n                , pos\r\n                , actualWidth\r\n                , actualHeight\r\n                , placement\r\n                , tp\r\n                , tpt\r\n                , tpb\r\n                , tpl\r\n                , tpr;\r\n\r\n                placement = typeof this.options.placement === 'function' ?\r\n                this.options.placement.call(this, $tip[0], this.$element[0]) :\r\n                this.options.placement;\r\n\r\n                inside = /in/.test(placement);\r\n               \r\n                $tip\r\n              //  .detach()\r\n              //vitalets: remove any placement class because otherwise they dont influence on re-positioning of visible popover\r\n                .removeClass('top right bottom left')\r\n                .css({ top: 0, left: 0, display: 'block' });\r\n              //  .insertAfter(this.$element);\r\n               \r\n                pos = this.getPosition(inside);\r\n\r\n                actualWidth = $tip[0].offsetWidth;\r\n                actualHeight = $tip[0].offsetHeight;\r\n\r\n                placement = inside ? placement.split(' ')[1] : placement;\r\n\r\n                tpb = {top: pos.top + pos.height, left: pos.left + pos.width / 2 - actualWidth / 2};\r\n                tpt = {top: pos.top - actualHeight, left: pos.left + pos.width / 2 - actualWidth / 2};\r\n                tpl = {top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left - actualWidth};\r\n                tpr = {top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left + pos.width};\r\n\r\n                switch (placement) {\r\n                    case 'bottom':\r\n                        if ((tpb.top + actualHeight) > ($(window).scrollTop() + $(window).height())) {\r\n                            if (tpt.top > $(window).scrollTop()) {\r\n                                placement = 'top';\r\n                            } else if ((tpr.left + actualWidth) < ($(window).scrollLeft() + $(window).width())) {\r\n                                placement = 'right';\r\n                            } else if (tpl.left > $(window).scrollLeft()) {\r\n                                placement = 'left';\r\n                            } else {\r\n                                placement = 'right';\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 'top':\r\n                        if (tpt.top < $(window).scrollTop()) {\r\n                            if ((tpb.top + actualHeight) < ($(window).scrollTop() + $(window).height())) {\r\n                                placement = 'bottom';\r\n                            } else if ((tpr.left + actualWidth) < ($(window).scrollLeft() + $(window).width())) {\r\n                                placement = 'right';\r\n                            } else if (tpl.left > $(window).scrollLeft()) {\r\n                                placement = 'left';\r\n                            } else {\r\n                                placement = 'right';\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 'left':\r\n                        if (tpl.left < $(window).scrollLeft()) {\r\n                            if ((tpr.left + actualWidth) < ($(window).scrollLeft() + $(window).width())) {\r\n                                placement = 'right';\r\n                            } else if (tpt.top > $(window).scrollTop()) {\r\n                                placement = 'top';\r\n                            } else if (tpt.top > $(window).scrollTop()) {\r\n                                placement = 'bottom';\r\n                            } else {\r\n                                placement = 'right';\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 'right':\r\n                        if ((tpr.left + actualWidth) > ($(window).scrollLeft() + $(window).width())) {\r\n                            if (tpl.left > $(window).scrollLeft()) {\r\n                                placement = 'left';\r\n                            } else if (tpt.top > $(window).scrollTop()) {\r\n                                placement = 'top';\r\n                            } else if (tpt.top > $(window).scrollTop()) {\r\n                                placement = 'bottom';\r\n                            }\r\n                        }\r\n                        break;\r\n                }\r\n\r\n                switch (placement) {\r\n                    case 'bottom':\r\n                        tp = tpb;\r\n                        break;\r\n                    case 'top':\r\n                        tp = tpt;\r\n                        break;\r\n                    case 'left':\r\n                        tp = tpl;\r\n                        break;\r\n                    case 'right':\r\n                        tp = tpr;\r\n                        break;\r\n                }\r\n\r\n                $tip\r\n                .offset(tp)\r\n                .addClass(placement)\r\n                .addClass('in');\r\n           */\r\n                     \r\n           \r\n            var $tip = this.tip();\r\n            \r\n            var placement = typeof this.options.placement == 'function' ?\r\n                this.options.placement.call(this, $tip[0], this.$element[0]) :\r\n                this.options.placement;            \r\n\r\n            var autoToken = /\\s?auto?\\s?/i;\r\n            var autoPlace = autoToken.test(placement);\r\n            if (autoPlace) {\r\n                placement = placement.replace(autoToken, '') || 'top';\r\n            }\r\n            \r\n            \r\n            var pos = this.getPosition();\r\n            var actualWidth = $tip[0].offsetWidth;\r\n            var actualHeight = $tip[0].offsetHeight;\r\n\r\n            if (autoPlace) {\r\n                var $parent = this.$element.parent();\r\n\r\n                var orgPlacement = placement;\r\n                var docScroll    = document.documentElement.scrollTop || document.body.scrollTop;\r\n                var parentWidth  = this.options.container == 'body' ? window.innerWidth  : $parent.outerWidth();\r\n                var parentHeight = this.options.container == 'body' ? window.innerHeight : $parent.outerHeight();\r\n                var parentLeft   = this.options.container == 'body' ? 0 : $parent.offset().left;\r\n\r\n                placement = placement == 'bottom' && pos.top   + pos.height  + actualHeight - docScroll > parentHeight  ? 'top'    :\r\n                            placement == 'top'    && pos.top   - docScroll   - actualHeight < 0                         ? 'bottom' :\r\n                            placement == 'right'  && pos.right + actualWidth > parentWidth                              ? 'left'   :\r\n                            placement == 'left'   && pos.left  - actualWidth < parentLeft                               ? 'right'  :\r\n                            placement;\r\n\r\n                $tip\r\n                  .removeClass(orgPlacement)\r\n                  .addClass(placement);\r\n            }\r\n\r\n\r\n            var calculatedOffset = this.getCalculatedOffset(placement, pos, actualWidth, actualHeight);\r\n\r\n            this.applyPlacement(calculatedOffset, placement);            \r\n                     \r\n                \r\n            }).call(this.container());\r\n          /*jshint laxcomma: false, eqeqeq: true*/  \r\n        }            \r\n    });\r\n\r\n}(window.jQuery));\r\n\r\n/* =========================================================\r\n * bootstrap-datepicker.js\r\n * http://www.eyecon.ro/bootstrap-datepicker\r\n * =========================================================\r\n * Copyright 2012 Stefan Petre\r\n * Improvements by Andrew Rowls\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n * ========================================================= */\r\n\r\n(function( $ ) {\r\n\r\n\tfunction UTCDate(){\r\n\t\treturn new Date(Date.UTC.apply(Date, arguments));\r\n\t}\r\n\tfunction UTCToday(){\r\n\t\tvar today = new Date();\r\n\t\treturn UTCDate(today.getUTCFullYear(), today.getUTCMonth(), today.getUTCDate());\r\n\t}\r\n\r\n\t// Picker object\r\n\r\n\tvar Datepicker = function(element, options) {\r\n\t\tvar that = this;\r\n\r\n\t\tthis._process_options(options);\r\n\r\n\t\tthis.element = $(element);\r\n\t\tthis.isInline = false;\r\n\t\tthis.isInput = this.element.is('input');\r\n\t\tthis.component = this.element.is('.date') ? this.element.find('.add-on, .btn') : false;\r\n\t\tthis.hasInput = this.component && this.element.find('input').length;\r\n\t\tif(this.component && this.component.length === 0)\r\n\t\t\tthis.component = false;\r\n\r\n\t\tthis.picker = $(DPGlobal.template);\r\n\t\tthis._buildEvents();\r\n\t\tthis._attachEvents();\r\n\r\n\t\tif(this.isInline) {\r\n\t\t\tthis.picker.addClass('datepicker-inline').appendTo(this.element);\r\n\t\t} else {\r\n\t\t\tthis.picker.addClass('datepicker-dropdown dropdown-menu');\r\n\t\t}\r\n\r\n\t\tif (this.o.rtl){\r\n\t\t\tthis.picker.addClass('datepicker-rtl');\r\n\t\t\tthis.picker.find('.prev i, .next i')\r\n\t\t\t\t\t\t.toggleClass('icon-arrow-left icon-arrow-right');\r\n\t\t}\r\n\r\n\r\n\t\tthis.viewMode = this.o.startView;\r\n\r\n\t\tif (this.o.calendarWeeks)\r\n\t\t\tthis.picker.find('tfoot th.today')\r\n\t\t\t\t\t\t.attr('colspan', function(i, val){\r\n\t\t\t\t\t\t\treturn parseInt(val) + 1;\r\n\t\t\t\t\t\t});\r\n\r\n\t\tthis._allow_update = false;\r\n\r\n\t\tthis.setStartDate(this.o.startDate);\r\n\t\tthis.setEndDate(this.o.endDate);\r\n\t\tthis.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled);\r\n\r\n\t\tthis.fillDow();\r\n\t\tthis.fillMonths();\r\n\r\n\t\tthis._allow_update = true;\r\n\r\n\t\tthis.update();\r\n\t\tthis.showMode();\r\n\r\n\t\tif(this.isInline) {\r\n\t\t\tthis.show();\r\n\t\t}\r\n\t};\r\n\r\n\tDatepicker.prototype = {\r\n\t\tconstructor: Datepicker,\r\n\r\n\t\t_process_options: function(opts){\r\n\t\t\t// Store raw options for reference\r\n\t\t\tthis._o = $.extend({}, this._o, opts);\r\n\t\t\t// Processed options\r\n\t\t\tvar o = this.o = $.extend({}, this._o);\r\n\r\n\t\t\t// Check if \"de-DE\" style date is available, if not language should\r\n\t\t\t// fallback to 2 letter code eg \"de\"\r\n\t\t\tvar lang = o.language;\r\n\t\t\tif (!dates[lang]) {\r\n\t\t\t\tlang = lang.split('-')[0];\r\n\t\t\t\tif (!dates[lang])\r\n\t\t\t\t\tlang = defaults.language;\r\n\t\t\t}\r\n\t\t\to.language = lang;\r\n\r\n\t\t\tswitch(o.startView){\r\n\t\t\t\tcase 2:\r\n\t\t\t\tcase 'decade':\r\n\t\t\t\t\to.startView = 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\tcase 'year':\r\n\t\t\t\t\to.startView = 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\to.startView = 0;\r\n\t\t\t}\r\n\r\n\t\t\tswitch (o.minViewMode) {\r\n\t\t\t\tcase 1:\r\n\t\t\t\tcase 'months':\r\n\t\t\t\t\to.minViewMode = 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\tcase 'years':\r\n\t\t\t\t\to.minViewMode = 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\to.minViewMode = 0;\r\n\t\t\t}\r\n\r\n\t\t\to.startView = Math.max(o.startView, o.minViewMode);\r\n\r\n\t\t\to.weekStart %= 7;\r\n\t\t\to.weekEnd = ((o.weekStart + 6) % 7);\r\n\r\n\t\t\tvar format = DPGlobal.parseFormat(o.format)\r\n\t\t\tif (o.startDate !== -Infinity) {\r\n\t\t\t\to.startDate = DPGlobal.parseDate(o.startDate, format, o.language);\r\n\t\t\t}\r\n\t\t\tif (o.endDate !== Infinity) {\r\n\t\t\t\to.endDate = DPGlobal.parseDate(o.endDate, format, o.language);\r\n\t\t\t}\r\n\r\n\t\t\to.daysOfWeekDisabled = o.daysOfWeekDisabled||[];\r\n\t\t\tif (!$.isArray(o.daysOfWeekDisabled))\r\n\t\t\t\to.daysOfWeekDisabled = o.daysOfWeekDisabled.split(/[,\\s]*/);\r\n\t\t\to.daysOfWeekDisabled = $.map(o.daysOfWeekDisabled, function (d) {\r\n\t\t\t\treturn parseInt(d, 10);\r\n\t\t\t});\r\n\t\t},\r\n\t\t_events: [],\r\n\t\t_secondaryEvents: [],\r\n\t\t_applyEvents: function(evs){\r\n\t\t\tfor (var i=0, el, ev; i<evs.length; i++){\r\n\t\t\t\tel = evs[i][0];\r\n\t\t\t\tev = evs[i][1];\r\n\t\t\t\tel.on(ev);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_unapplyEvents: function(evs){\r\n\t\t\tfor (var i=0, el, ev; i<evs.length; i++){\r\n\t\t\t\tel = evs[i][0];\r\n\t\t\t\tev = evs[i][1];\r\n\t\t\t\tel.off(ev);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_buildEvents: function(){\r\n\t\t\tif (this.isInput) { // single input\r\n\t\t\t\tthis._events = [\r\n\t\t\t\t\t[this.element, {\r\n\t\t\t\t\t\tfocus: $.proxy(this.show, this),\r\n\t\t\t\t\t\tkeyup: $.proxy(this.update, this),\r\n\t\t\t\t\t\tkeydown: $.proxy(this.keydown, this)\r\n\t\t\t\t\t}]\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t\telse if (this.component && this.hasInput){ // component: input + button\r\n\t\t\t\tthis._events = [\r\n\t\t\t\t\t// For components that are not readonly, allow keyboard nav\r\n\t\t\t\t\t[this.element.find('input'), {\r\n\t\t\t\t\t\tfocus: $.proxy(this.show, this),\r\n\t\t\t\t\t\tkeyup: $.proxy(this.update, this),\r\n\t\t\t\t\t\tkeydown: $.proxy(this.keydown, this)\r\n\t\t\t\t\t}],\r\n\t\t\t\t\t[this.component, {\r\n\t\t\t\t\t\tclick: $.proxy(this.show, this)\r\n\t\t\t\t\t}]\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t\telse if (this.element.is('div')) {  // inline datepicker\r\n\t\t\t\tthis.isInline = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._events = [\r\n\t\t\t\t\t[this.element, {\r\n\t\t\t\t\t\tclick: $.proxy(this.show, this)\r\n\t\t\t\t\t}]\r\n\t\t\t\t];\r\n\t\t\t}\r\n\r\n\t\t\tthis._secondaryEvents = [\r\n\t\t\t\t[this.picker, {\r\n\t\t\t\t\tclick: $.proxy(this.click, this)\r\n\t\t\t\t}],\r\n\t\t\t\t[$(window), {\r\n\t\t\t\t\tresize: $.proxy(this.place, this)\r\n\t\t\t\t}],\r\n\t\t\t\t[$(document), {\r\n\t\t\t\t\tmousedown: $.proxy(function (e) {\r\n\t\t\t\t\t\t// Clicked outside the datepicker, hide it\r\n\t\t\t\t\t\tif (!(\r\n\t\t\t\t\t\t\tthis.element.is(e.target) ||\r\n\t\t\t\t\t\t\tthis.element.find(e.target).size() ||\r\n\t\t\t\t\t\t\tthis.picker.is(e.target) ||\r\n\t\t\t\t\t\t\tthis.picker.find(e.target).size()\r\n\t\t\t\t\t\t)) {\r\n\t\t\t\t\t\t\tthis.hide();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, this)\r\n\t\t\t\t}]\r\n\t\t\t];\r\n\t\t},\r\n\t\t_attachEvents: function(){\r\n\t\t\tthis._detachEvents();\r\n\t\t\tthis._applyEvents(this._events);\r\n\t\t},\r\n\t\t_detachEvents: function(){\r\n\t\t\tthis._unapplyEvents(this._events);\r\n\t\t},\r\n\t\t_attachSecondaryEvents: function(){\r\n\t\t\tthis._detachSecondaryEvents();\r\n\t\t\tthis._applyEvents(this._secondaryEvents);\r\n\t\t},\r\n\t\t_detachSecondaryEvents: function(){\r\n\t\t\tthis._unapplyEvents(this._secondaryEvents);\r\n\t\t},\r\n\t\t_trigger: function(event, altdate){\r\n\t\t\tvar date = altdate || this.date,\r\n\t\t\t\tlocal_date = new Date(date.getTime() + (date.getTimezoneOffset()*60000));\r\n\r\n\t\t\tthis.element.trigger({\r\n\t\t\t\ttype: event,\r\n\t\t\t\tdate: local_date,\r\n\t\t\t\tformat: $.proxy(function(altformat){\r\n\t\t\t\t\tvar format = altformat || this.o.format;\r\n\t\t\t\t\treturn DPGlobal.formatDate(date, format, this.o.language);\r\n\t\t\t\t}, this)\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tshow: function(e) {\r\n\t\t\tif (!this.isInline)\r\n\t\t\t\tthis.picker.appendTo('body');\r\n\t\t\tthis.picker.show();\r\n\t\t\tthis.height = this.component ? this.component.outerHeight() : this.element.outerHeight();\r\n\t\t\tthis.place();\r\n\t\t\tthis._attachSecondaryEvents();\r\n\t\t\tif (e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t\tthis._trigger('show');\r\n\t\t},\r\n\r\n\t\thide: function(e){\r\n\t\t\tif(this.isInline) return;\r\n\t\t\tif (!this.picker.is(':visible')) return;\r\n\t\t\tthis.picker.hide().detach();\r\n\t\t\tthis._detachSecondaryEvents();\r\n\t\t\tthis.viewMode = this.o.startView;\r\n\t\t\tthis.showMode();\r\n\r\n\t\t\tif (\r\n\t\t\t\tthis.o.forceParse &&\r\n\t\t\t\t(\r\n\t\t\t\t\tthis.isInput && this.element.val() ||\r\n\t\t\t\t\tthis.hasInput && this.element.find('input').val()\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t\t\tthis.setValue();\r\n\t\t\tthis._trigger('hide');\r\n\t\t},\r\n\r\n\t\tremove: function() {\r\n\t\t\tthis.hide();\r\n\t\t\tthis._detachEvents();\r\n\t\t\tthis._detachSecondaryEvents();\r\n\t\t\tthis.picker.remove();\r\n\t\t\tdelete this.element.data().datepicker;\r\n\t\t\tif (!this.isInput) {\r\n\t\t\t\tdelete this.element.data().date;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetDate: function() {\r\n\t\t\tvar d = this.getUTCDate();\r\n\t\t\treturn new Date(d.getTime() + (d.getTimezoneOffset()*60000));\r\n\t\t},\r\n\r\n\t\tgetUTCDate: function() {\r\n\t\t\treturn this.date;\r\n\t\t},\r\n\r\n\t\tsetDate: function(d) {\r\n\t\t\tthis.setUTCDate(new Date(d.getTime() - (d.getTimezoneOffset()*60000)));\r\n\t\t},\r\n\r\n\t\tsetUTCDate: function(d) {\r\n\t\t\tthis.date = d;\r\n\t\t\tthis.setValue();\r\n\t\t},\r\n\r\n\t\tsetValue: function() {\r\n\t\t\tvar formatted = this.getFormattedDate();\r\n\t\t\tif (!this.isInput) {\r\n\t\t\t\tif (this.component){\r\n\t\t\t\t\tthis.element.find('input').val(formatted);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.element.val(formatted);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetFormattedDate: function(format) {\r\n\t\t\tif (format === undefined)\r\n\t\t\t\tformat = this.o.format;\r\n\t\t\treturn DPGlobal.formatDate(this.date, format, this.o.language);\r\n\t\t},\r\n\r\n\t\tsetStartDate: function(startDate){\r\n\t\t\tthis._process_options({startDate: startDate});\r\n\t\t\tthis.update();\r\n\t\t\tthis.updateNavArrows();\r\n\t\t},\r\n\r\n\t\tsetEndDate: function(endDate){\r\n\t\t\tthis._process_options({endDate: endDate});\r\n\t\t\tthis.update();\r\n\t\t\tthis.updateNavArrows();\r\n\t\t},\r\n\r\n\t\tsetDaysOfWeekDisabled: function(daysOfWeekDisabled){\r\n\t\t\tthis._process_options({daysOfWeekDisabled: daysOfWeekDisabled});\r\n\t\t\tthis.update();\r\n\t\t\tthis.updateNavArrows();\r\n\t\t},\r\n\r\n\t\tplace: function(){\r\n\t\t\t\t\t\tif(this.isInline) return;\r\n\t\t\tvar zIndex = parseInt(this.element.parents().filter(function() {\r\n\t\t\t\t\t\t\treturn $(this).css('z-index') != 'auto';\r\n\t\t\t\t\t\t}).first().css('z-index'))+10;\r\n\t\t\tvar offset = this.component ? this.component.parent().offset() : this.element.offset();\r\n\t\t\tvar height = this.component ? this.component.outerHeight(true) : this.element.outerHeight(true);\r\n\t\t\tthis.picker.css({\r\n\t\t\t\ttop: offset.top + height,\r\n\t\t\t\tleft: offset.left,\r\n\t\t\t\tzIndex: zIndex\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_allow_update: true,\r\n\t\tupdate: function(){\r\n\t\t\tif (!this._allow_update) return;\r\n\r\n\t\t\tvar date, fromArgs = false;\r\n\t\t\tif(arguments && arguments.length && (typeof arguments[0] === 'string' || arguments[0] instanceof Date)) {\r\n\t\t\t\tdate = arguments[0];\r\n\t\t\t\tfromArgs = true;\r\n\t\t\t} else {\r\n\t\t\t\tdate = this.isInput ? this.element.val() : this.element.data('date') || this.element.find('input').val();\r\n\t\t\t\tdelete this.element.data().date;\r\n\t\t\t}\r\n\r\n\t\t\tthis.date = DPGlobal.parseDate(date, this.o.format, this.o.language);\r\n\r\n\t\t\tif(fromArgs) this.setValue();\r\n\r\n\t\t\tif (this.date < this.o.startDate) {\r\n\t\t\t\tthis.viewDate = new Date(this.o.startDate);\r\n\t\t\t} else if (this.date > this.o.endDate) {\r\n\t\t\t\tthis.viewDate = new Date(this.o.endDate);\r\n\t\t\t} else {\r\n\t\t\t\tthis.viewDate = new Date(this.date);\r\n\t\t\t}\r\n\t\t\tthis.fill();\r\n\t\t},\r\n\r\n\t\tfillDow: function(){\r\n\t\t\tvar dowCnt = this.o.weekStart,\r\n\t\t\thtml = '<tr>';\r\n\t\t\tif(this.o.calendarWeeks){\r\n\t\t\t\tvar cell = '<th class=\"cw\">&nbsp;</th>';\r\n\t\t\t\thtml += cell;\r\n\t\t\t\tthis.picker.find('.datepicker-days thead tr:first-child').prepend(cell);\r\n\t\t\t}\r\n\t\t\twhile (dowCnt < this.o.weekStart + 7) {\r\n\t\t\t\thtml += '<th class=\"dow\">'+dates[this.o.language].daysMin[(dowCnt++)%7]+'</th>';\r\n\t\t\t}\r\n\t\t\thtml += '</tr>';\r\n\t\t\tthis.picker.find('.datepicker-days thead').append(html);\r\n\t\t},\r\n\r\n\t\tfillMonths: function(){\r\n\t\t\tvar html = '',\r\n\t\t\ti = 0;\r\n\t\t\twhile (i < 12) {\r\n\t\t\t\thtml += '<span class=\"month\">'+dates[this.o.language].monthsShort[i++]+'</span>';\r\n\t\t\t}\r\n\t\t\tthis.picker.find('.datepicker-months td').html(html);\r\n\t\t},\r\n\r\n\t\tsetRange: function(range){\r\n\t\t\tif (!range || !range.length)\r\n\t\t\t\tdelete this.range;\r\n\t\t\telse\r\n\t\t\t\tthis.range = $.map(range, function(d){ return d.valueOf(); });\r\n\t\t\tthis.fill();\r\n\t\t},\r\n\r\n\t\tgetClassNames: function(date){\r\n\t\t\tvar cls = [],\r\n\t\t\t\tyear = this.viewDate.getUTCFullYear(),\r\n\t\t\t\tmonth = this.viewDate.getUTCMonth(),\r\n\t\t\t\tcurrentDate = this.date.valueOf(),\r\n\t\t\t\ttoday = new Date();\r\n\t\t\tif (date.getUTCFullYear() < year || (date.getUTCFullYear() == year && date.getUTCMonth() < month)) {\r\n\t\t\t\tcls.push('old');\r\n\t\t\t} else if (date.getUTCFullYear() > year || (date.getUTCFullYear() == year && date.getUTCMonth() > month)) {\r\n\t\t\t\tcls.push('new');\r\n\t\t\t}\r\n\t\t\t// Compare internal UTC date with local today, not UTC today\r\n\t\t\tif (this.o.todayHighlight &&\r\n\t\t\t\tdate.getUTCFullYear() == today.getFullYear() &&\r\n\t\t\t\tdate.getUTCMonth() == today.getMonth() &&\r\n\t\t\t\tdate.getUTCDate() == today.getDate()) {\r\n\t\t\t\tcls.push('today');\r\n\t\t\t}\r\n\t\t\tif (currentDate && date.valueOf() == currentDate) {\r\n\t\t\t\tcls.push('active');\r\n\t\t\t}\r\n\t\t\tif (date.valueOf() < this.o.startDate || date.valueOf() > this.o.endDate ||\r\n\t\t\t\t$.inArray(date.getUTCDay(), this.o.daysOfWeekDisabled) !== -1) {\r\n\t\t\t\tcls.push('disabled');\r\n\t\t\t}\r\n\t\t\tif (this.range){\r\n\t\t\t\tif (date > this.range[0] && date < this.range[this.range.length-1]){\r\n\t\t\t\t\tcls.push('range');\r\n\t\t\t\t}\r\n\t\t\t\tif ($.inArray(date.valueOf(), this.range) != -1){\r\n\t\t\t\t\tcls.push('selected');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn cls;\r\n\t\t},\r\n\r\n\t\tfill: function() {\r\n\t\t\tvar d = new Date(this.viewDate),\r\n\t\t\t\tyear = d.getUTCFullYear(),\r\n\t\t\t\tmonth = d.getUTCMonth(),\r\n\t\t\t\tstartYear = this.o.startDate !== -Infinity ? this.o.startDate.getUTCFullYear() : -Infinity,\r\n\t\t\t\tstartMonth = this.o.startDate !== -Infinity ? this.o.startDate.getUTCMonth() : -Infinity,\r\n\t\t\t\tendYear = this.o.endDate !== Infinity ? this.o.endDate.getUTCFullYear() : Infinity,\r\n\t\t\t\tendMonth = this.o.endDate !== Infinity ? this.o.endDate.getUTCMonth() : Infinity,\r\n\t\t\t\tcurrentDate = this.date && this.date.valueOf(),\r\n\t\t\t\ttooltip;\r\n\t\t\tthis.picker.find('.datepicker-days thead th.datepicker-switch')\r\n\t\t\t\t\t\t.text(dates[this.o.language].months[month]+' '+year);\r\n\t\t\tthis.picker.find('tfoot th.today')\r\n\t\t\t\t\t\t.text(dates[this.o.language].today)\r\n\t\t\t\t\t\t.toggle(this.o.todayBtn !== false);\r\n\t\t\tthis.picker.find('tfoot th.clear')\r\n\t\t\t\t\t\t.text(dates[this.o.language].clear)\r\n\t\t\t\t\t\t.toggle(this.o.clearBtn !== false);\r\n\t\t\tthis.updateNavArrows();\r\n\t\t\tthis.fillMonths();\r\n\t\t\tvar prevMonth = UTCDate(year, month-1, 28,0,0,0,0),\r\n\t\t\t\tday = DPGlobal.getDaysInMonth(prevMonth.getUTCFullYear(), prevMonth.getUTCMonth());\r\n\t\t\tprevMonth.setUTCDate(day);\r\n\t\t\tprevMonth.setUTCDate(day - (prevMonth.getUTCDay() - this.o.weekStart + 7)%7);\r\n\t\t\tvar nextMonth = new Date(prevMonth);\r\n\t\t\tnextMonth.setUTCDate(nextMonth.getUTCDate() + 42);\r\n\t\t\tnextMonth = nextMonth.valueOf();\r\n\t\t\tvar html = [];\r\n\t\t\tvar clsName;\r\n\t\t\twhile(prevMonth.valueOf() < nextMonth) {\r\n\t\t\t\tif (prevMonth.getUTCDay() == this.o.weekStart) {\r\n\t\t\t\t\thtml.push('<tr>');\r\n\t\t\t\t\tif(this.o.calendarWeeks){\r\n\t\t\t\t\t\t// ISO 8601: First week contains first thursday.\r\n\t\t\t\t\t\t// ISO also states week starts on Monday, but we can be more abstract here.\r\n\t\t\t\t\t\tvar\r\n\t\t\t\t\t\t\t// Start of current week: based on weekstart/current date\r\n\t\t\t\t\t\t\tws = new Date(+prevMonth + (this.o.weekStart - prevMonth.getUTCDay() - 7) % 7 * 864e5),\r\n\t\t\t\t\t\t\t// Thursday of this week\r\n\t\t\t\t\t\t\tth = new Date(+ws + (7 + 4 - ws.getUTCDay()) % 7 * 864e5),\r\n\t\t\t\t\t\t\t// First Thursday of year, year from thursday\r\n\t\t\t\t\t\t\tyth = new Date(+(yth = UTCDate(th.getUTCFullYear(), 0, 1)) + (7 + 4 - yth.getUTCDay())%7*864e5),\r\n\t\t\t\t\t\t\t// Calendar week: ms between thursdays, div ms per day, div 7 days\r\n\t\t\t\t\t\t\tcalWeek =  (th - yth) / 864e5 / 7 + 1;\r\n\t\t\t\t\t\thtml.push('<td class=\"cw\">'+ calWeek +'</td>');\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tclsName = this.getClassNames(prevMonth);\r\n\t\t\t\tclsName.push('day');\r\n\r\n\t\t\t\tvar before = this.o.beforeShowDay(prevMonth);\r\n\t\t\t\tif (before === undefined)\r\n\t\t\t\t\tbefore = {};\r\n\t\t\t\telse if (typeof(before) === 'boolean')\r\n\t\t\t\t\tbefore = {enabled: before};\r\n\t\t\t\telse if (typeof(before) === 'string')\r\n\t\t\t\t\tbefore = {classes: before};\r\n\t\t\t\tif (before.enabled === false)\r\n\t\t\t\t\tclsName.push('disabled');\r\n\t\t\t\tif (before.classes)\r\n\t\t\t\t\tclsName = clsName.concat(before.classes.split(/\\s+/));\r\n\t\t\t\tif (before.tooltip)\r\n\t\t\t\t\ttooltip = before.tooltip;\r\n\r\n\t\t\t\tclsName = $.unique(clsName);\r\n\t\t\t\thtml.push('<td class=\"'+clsName.join(' ')+'\"' + (tooltip ? ' title=\"'+tooltip+'\"' : '') + '>'+prevMonth.getUTCDate() + '</td>');\r\n\t\t\t\tif (prevMonth.getUTCDay() == this.o.weekEnd) {\r\n\t\t\t\t\thtml.push('</tr>');\r\n\t\t\t\t}\r\n\t\t\t\tprevMonth.setUTCDate(prevMonth.getUTCDate()+1);\r\n\t\t\t}\r\n\t\t\tthis.picker.find('.datepicker-days tbody').empty().append(html.join(''));\r\n\t\t\tvar currentYear = this.date && this.date.getUTCFullYear();\r\n\r\n\t\t\tvar months = this.picker.find('.datepicker-months')\r\n\t\t\t\t\t\t.find('th:eq(1)')\r\n\t\t\t\t\t\t\t.text(year)\r\n\t\t\t\t\t\t\t.end()\r\n\t\t\t\t\t\t.find('span').removeClass('active');\r\n\t\t\tif (currentYear && currentYear == year) {\r\n\t\t\t\tmonths.eq(this.date.getUTCMonth()).addClass('active');\r\n\t\t\t}\r\n\t\t\tif (year < startYear || year > endYear) {\r\n\t\t\t\tmonths.addClass('disabled');\r\n\t\t\t}\r\n\t\t\tif (year == startYear) {\r\n\t\t\t\tmonths.slice(0, startMonth).addClass('disabled');\r\n\t\t\t}\r\n\t\t\tif (year == endYear) {\r\n\t\t\t\tmonths.slice(endMonth+1).addClass('disabled');\r\n\t\t\t}\r\n\r\n\t\t\thtml = '';\r\n\t\t\tyear = parseInt(year/10, 10) * 10;\r\n\t\t\tvar yearCont = this.picker.find('.datepicker-years')\r\n\t\t\t\t\t\t\t\t.find('th:eq(1)')\r\n\t\t\t\t\t\t\t\t\t.text(year + '-' + (year + 9))\r\n\t\t\t\t\t\t\t\t\t.end()\r\n\t\t\t\t\t\t\t\t.find('td');\r\n\t\t\tyear -= 1;\r\n\t\t\tfor (var i = -1; i < 11; i++) {\r\n\t\t\t\thtml += '<span class=\"year'+(i == -1 ? ' old' : i == 10 ? ' new' : '')+(currentYear == year ? ' active' : '')+(year < startYear || year > endYear ? ' disabled' : '')+'\">'+year+'</span>';\r\n\t\t\t\tyear += 1;\r\n\t\t\t}\r\n\t\t\tyearCont.html(html);\r\n\t\t},\r\n\r\n\t\tupdateNavArrows: function() {\r\n\t\t\tif (!this._allow_update) return;\r\n\r\n\t\t\tvar d = new Date(this.viewDate),\r\n\t\t\t\tyear = d.getUTCFullYear(),\r\n\t\t\t\tmonth = d.getUTCMonth();\r\n\t\t\tswitch (this.viewMode) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tif (this.o.startDate !== -Infinity && year <= this.o.startDate.getUTCFullYear() && month <= this.o.startDate.getUTCMonth()) {\r\n\t\t\t\t\t\tthis.picker.find('.prev').css({visibility: 'hidden'});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.picker.find('.prev').css({visibility: 'visible'});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.o.endDate !== Infinity && year >= this.o.endDate.getUTCFullYear() && month >= this.o.endDate.getUTCMonth()) {\r\n\t\t\t\t\t\tthis.picker.find('.next').css({visibility: 'hidden'});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.picker.find('.next').css({visibility: 'visible'});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tif (this.o.startDate !== -Infinity && year <= this.o.startDate.getUTCFullYear()) {\r\n\t\t\t\t\t\tthis.picker.find('.prev').css({visibility: 'hidden'});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.picker.find('.prev').css({visibility: 'visible'});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.o.endDate !== Infinity && year >= this.o.endDate.getUTCFullYear()) {\r\n\t\t\t\t\t\tthis.picker.find('.next').css({visibility: 'hidden'});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.picker.find('.next').css({visibility: 'visible'});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tclick: function(e) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar target = $(e.target).closest('span, td, th');\r\n\t\t\tif (target.length == 1) {\r\n\t\t\t\tswitch(target[0].nodeName.toLowerCase()) {\r\n\t\t\t\t\tcase 'th':\r\n\t\t\t\t\t\tswitch(target[0].className) {\r\n\t\t\t\t\t\t\tcase 'datepicker-switch':\r\n\t\t\t\t\t\t\t\tthis.showMode(1);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'prev':\r\n\t\t\t\t\t\t\tcase 'next':\r\n\t\t\t\t\t\t\t\tvar dir = DPGlobal.modes[this.viewMode].navStep * (target[0].className == 'prev' ? -1 : 1);\r\n\t\t\t\t\t\t\t\tswitch(this.viewMode){\r\n\t\t\t\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\t\t\t\tthis.viewDate = this.moveMonth(this.viewDate, dir);\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\t\t\t\tthis.viewDate = this.moveYear(this.viewDate, dir);\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tthis.fill();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'today':\r\n\t\t\t\t\t\t\t\tvar date = new Date();\r\n\t\t\t\t\t\t\t\tdate = UTCDate(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0);\r\n\r\n\t\t\t\t\t\t\t\tthis.showMode(-2);\r\n\t\t\t\t\t\t\t\tvar which = this.o.todayBtn == 'linked' ? null : 'view';\r\n\t\t\t\t\t\t\t\tthis._setDate(date, which);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'clear':\r\n\t\t\t\t\t\t\t\tvar element;\r\n\t\t\t\t\t\t\t\tif (this.isInput)\r\n\t\t\t\t\t\t\t\t\telement = this.element;\r\n\t\t\t\t\t\t\t\telse if (this.component)\r\n\t\t\t\t\t\t\t\t\telement = this.element.find('input');\r\n\t\t\t\t\t\t\t\tif (element)\r\n\t\t\t\t\t\t\t\t\telement.val(\"\").change();\r\n\t\t\t\t\t\t\t\tthis._trigger('changeDate');\r\n\t\t\t\t\t\t\t\tthis.update();\r\n\t\t\t\t\t\t\t\tif (this.o.autoclose)\r\n\t\t\t\t\t\t\t\t\tthis.hide();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'span':\r\n\t\t\t\t\t\tif (!target.is('.disabled')) {\r\n\t\t\t\t\t\t\tthis.viewDate.setUTCDate(1);\r\n\t\t\t\t\t\t\tif (target.is('.month')) {\r\n\t\t\t\t\t\t\t\tvar day = 1;\r\n\t\t\t\t\t\t\t\tvar month = target.parent().find('span').index(target);\r\n\t\t\t\t\t\t\t\tvar year = this.viewDate.getUTCFullYear();\r\n\t\t\t\t\t\t\t\tthis.viewDate.setUTCMonth(month);\r\n\t\t\t\t\t\t\t\tthis._trigger('changeMonth', this.viewDate);\r\n\t\t\t\t\t\t\t\tif (this.o.minViewMode === 1) {\r\n\t\t\t\t\t\t\t\t\tthis._setDate(UTCDate(year, month, day,0,0,0,0));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tvar year = parseInt(target.text(), 10)||0;\r\n\t\t\t\t\t\t\t\tvar day = 1;\r\n\t\t\t\t\t\t\t\tvar month = 0;\r\n\t\t\t\t\t\t\t\tthis.viewDate.setUTCFullYear(year);\r\n\t\t\t\t\t\t\t\tthis._trigger('changeYear', this.viewDate);\r\n\t\t\t\t\t\t\t\tif (this.o.minViewMode === 2) {\r\n\t\t\t\t\t\t\t\t\tthis._setDate(UTCDate(year, month, day,0,0,0,0));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.showMode(-1);\r\n\t\t\t\t\t\t\tthis.fill();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'td':\r\n\t\t\t\t\t\tif (target.is('.day') && !target.is('.disabled')){\r\n\t\t\t\t\t\t\tvar day = parseInt(target.text(), 10)||1;\r\n\t\t\t\t\t\t\tvar year = this.viewDate.getUTCFullYear(),\r\n\t\t\t\t\t\t\t\tmonth = this.viewDate.getUTCMonth();\r\n\t\t\t\t\t\t\tif (target.is('.old')) {\r\n\t\t\t\t\t\t\t\tif (month === 0) {\r\n\t\t\t\t\t\t\t\t\tmonth = 11;\r\n\t\t\t\t\t\t\t\t\tyear -= 1;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tmonth -= 1;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (target.is('.new')) {\r\n\t\t\t\t\t\t\t\tif (month == 11) {\r\n\t\t\t\t\t\t\t\t\tmonth = 0;\r\n\t\t\t\t\t\t\t\t\tyear += 1;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tmonth += 1;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis._setDate(UTCDate(year, month, day,0,0,0,0));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_setDate: function(date, which){\r\n\t\t\tif (!which || which == 'date')\r\n\t\t\t\tthis.date = new Date(date);\r\n\t\t\tif (!which || which  == 'view')\r\n\t\t\t\tthis.viewDate = new Date(date);\r\n\t\t\tthis.fill();\r\n\t\t\tthis.setValue();\r\n\t\t\tthis._trigger('changeDate');\r\n\t\t\tvar element;\r\n\t\t\tif (this.isInput) {\r\n\t\t\t\telement = this.element;\r\n\t\t\t} else if (this.component){\r\n\t\t\t\telement = this.element.find('input');\r\n\t\t\t}\r\n\t\t\tif (element) {\r\n\t\t\t\telement.change();\r\n\t\t\t\tif (this.o.autoclose && (!which || which == 'date')) {\r\n\t\t\t\t\tthis.hide();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tmoveMonth: function(date, dir){\r\n\t\t\tif (!dir) return date;\r\n\t\t\tvar new_date = new Date(date.valueOf()),\r\n\t\t\t\tday = new_date.getUTCDate(),\r\n\t\t\t\tmonth = new_date.getUTCMonth(),\r\n\t\t\t\tmag = Math.abs(dir),\r\n\t\t\t\tnew_month, test;\r\n\t\t\tdir = dir > 0 ? 1 : -1;\r\n\t\t\tif (mag == 1){\r\n\t\t\t\ttest = dir == -1\r\n\t\t\t\t\t// If going back one month, make sure month is not current month\r\n\t\t\t\t\t// (eg, Mar 31 -> Feb 31 == Feb 28, not Mar 02)\r\n\t\t\t\t\t? function(){ return new_date.getUTCMonth() == month; }\r\n\t\t\t\t\t// If going forward one month, make sure month is as expected\r\n\t\t\t\t\t// (eg, Jan 31 -> Feb 31 == Feb 28, not Mar 02)\r\n\t\t\t\t\t: function(){ return new_date.getUTCMonth() != new_month; };\r\n\t\t\t\tnew_month = month + dir;\r\n\t\t\t\tnew_date.setUTCMonth(new_month);\r\n\t\t\t\t// Dec -> Jan (12) or Jan -> Dec (-1) -- limit expected date to 0-11\r\n\t\t\t\tif (new_month < 0 || new_month > 11)\r\n\t\t\t\t\tnew_month = (new_month + 12) % 12;\r\n\t\t\t} else {\r\n\t\t\t\t// For magnitudes >1, move one month at a time...\r\n\t\t\t\tfor (var i=0; i<mag; i++)\r\n\t\t\t\t\t// ...which might decrease the day (eg, Jan 31 to Feb 28, etc)...\r\n\t\t\t\t\tnew_date = this.moveMonth(new_date, dir);\r\n\t\t\t\t// ...then reset the day, keeping it in the new month\r\n\t\t\t\tnew_month = new_date.getUTCMonth();\r\n\t\t\t\tnew_date.setUTCDate(day);\r\n\t\t\t\ttest = function(){ return new_month != new_date.getUTCMonth(); };\r\n\t\t\t}\r\n\t\t\t// Common date-resetting loop -- if date is beyond end of month, make it\r\n\t\t\t// end of month\r\n\t\t\twhile (test()){\r\n\t\t\t\tnew_date.setUTCDate(--day);\r\n\t\t\t\tnew_date.setUTCMonth(new_month);\r\n\t\t\t}\r\n\t\t\treturn new_date;\r\n\t\t},\r\n\r\n\t\tmoveYear: function(date, dir){\r\n\t\t\treturn this.moveMonth(date, dir*12);\r\n\t\t},\r\n\r\n\t\tdateWithinRange: function(date){\r\n\t\t\treturn date >= this.o.startDate && date <= this.o.endDate;\r\n\t\t},\r\n\r\n\t\tkeydown: function(e){\r\n\t\t\tif (this.picker.is(':not(:visible)')){\r\n\t\t\t\tif (e.keyCode == 27) // allow escape to hide and re-show picker\r\n\t\t\t\t\tthis.show();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar dateChanged = false,\r\n\t\t\t\tdir, day, month,\r\n\t\t\t\tnewDate, newViewDate;\r\n\t\t\tswitch(e.keyCode){\r\n\t\t\t\tcase 27: // escape\r\n\t\t\t\t\tthis.hide();\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 37: // left\r\n\t\t\t\tcase 39: // right\r\n\t\t\t\t\tif (!this.o.keyboardNavigation) break;\r\n\t\t\t\t\tdir = e.keyCode == 37 ? -1 : 1;\r\n\t\t\t\t\tif (e.ctrlKey){\r\n\t\t\t\t\t\tnewDate = this.moveYear(this.date, dir);\r\n\t\t\t\t\t\tnewViewDate = this.moveYear(this.viewDate, dir);\r\n\t\t\t\t\t} else if (e.shiftKey){\r\n\t\t\t\t\t\tnewDate = this.moveMonth(this.date, dir);\r\n\t\t\t\t\t\tnewViewDate = this.moveMonth(this.viewDate, dir);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnewDate = new Date(this.date);\r\n\t\t\t\t\t\tnewDate.setUTCDate(this.date.getUTCDate() + dir);\r\n\t\t\t\t\t\tnewViewDate = new Date(this.viewDate);\r\n\t\t\t\t\t\tnewViewDate.setUTCDate(this.viewDate.getUTCDate() + dir);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.dateWithinRange(newDate)){\r\n\t\t\t\t\t\tthis.date = newDate;\r\n\t\t\t\t\t\tthis.viewDate = newViewDate;\r\n\t\t\t\t\t\tthis.setValue();\r\n\t\t\t\t\t\tthis.update();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tdateChanged = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 38: // up\r\n\t\t\t\tcase 40: // down\r\n\t\t\t\t\tif (!this.o.keyboardNavigation) break;\r\n\t\t\t\t\tdir = e.keyCode == 38 ? -1 : 1;\r\n\t\t\t\t\tif (e.ctrlKey){\r\n\t\t\t\t\t\tnewDate = this.moveYear(this.date, dir);\r\n\t\t\t\t\t\tnewViewDate = this.moveYear(this.viewDate, dir);\r\n\t\t\t\t\t} else if (e.shiftKey){\r\n\t\t\t\t\t\tnewDate = this.moveMonth(this.date, dir);\r\n\t\t\t\t\t\tnewViewDate = this.moveMonth(this.viewDate, dir);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnewDate = new Date(this.date);\r\n\t\t\t\t\t\tnewDate.setUTCDate(this.date.getUTCDate() + dir * 7);\r\n\t\t\t\t\t\tnewViewDate = new Date(this.viewDate);\r\n\t\t\t\t\t\tnewViewDate.setUTCDate(this.viewDate.getUTCDate() + dir * 7);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.dateWithinRange(newDate)){\r\n\t\t\t\t\t\tthis.date = newDate;\r\n\t\t\t\t\t\tthis.viewDate = newViewDate;\r\n\t\t\t\t\t\tthis.setValue();\r\n\t\t\t\t\t\tthis.update();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tdateChanged = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 13: // enter\r\n\t\t\t\t\tthis.hide();\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 9: // tab\r\n\t\t\t\t\tthis.hide();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (dateChanged){\r\n\t\t\t\tthis._trigger('changeDate');\r\n\t\t\t\tvar element;\r\n\t\t\t\tif (this.isInput) {\r\n\t\t\t\t\telement = this.element;\r\n\t\t\t\t} else if (this.component){\r\n\t\t\t\t\telement = this.element.find('input');\r\n\t\t\t\t}\r\n\t\t\t\tif (element) {\r\n\t\t\t\t\telement.change();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tshowMode: function(dir) {\r\n\t\t\tif (dir) {\r\n\t\t\t\tthis.viewMode = Math.max(this.o.minViewMode, Math.min(2, this.viewMode + dir));\r\n\t\t\t}\r\n\t\t\t/*\r\n\t\t\t\tvitalets: fixing bug of very special conditions:\r\n\t\t\t\tjquery 1.7.1 + webkit + show inline datepicker in bootstrap popover.\r\n\t\t\t\tMethod show() does not set display css correctly and datepicker is not shown.\r\n\t\t\t\tChanged to .css('display', 'block') solve the problem.\r\n\t\t\t\tSee https://github.com/vitalets/x-editable/issues/37\r\n\r\n\t\t\t\tIn jquery 1.7.2+ everything works fine.\r\n\t\t\t*/\r\n\t\t\t//this.picker.find('>div').hide().filter('.datepicker-'+DPGlobal.modes[this.viewMode].clsName).show();\r\n\t\t\tthis.picker.find('>div').hide().filter('.datepicker-'+DPGlobal.modes[this.viewMode].clsName).css('display', 'block');\r\n\t\t\tthis.updateNavArrows();\r\n\t\t}\r\n\t};\r\n\r\n\tvar DateRangePicker = function(element, options){\r\n\t\tthis.element = $(element);\r\n\t\tthis.inputs = $.map(options.inputs, function(i){ return i.jquery ? i[0] : i; });\r\n\t\tdelete options.inputs;\r\n\r\n\t\t$(this.inputs)\r\n\t\t\t.datepicker(options)\r\n\t\t\t.bind('changeDate', $.proxy(this.dateUpdated, this));\r\n\r\n\t\tthis.pickers = $.map(this.inputs, function(i){ return $(i).data('datepicker'); });\r\n\t\tthis.updateDates();\r\n\t};\r\n\tDateRangePicker.prototype = {\r\n\t\tupdateDates: function(){\r\n\t\t\tthis.dates = $.map(this.pickers, function(i){ return i.date; });\r\n\t\t\tthis.updateRanges();\r\n\t\t},\r\n\t\tupdateRanges: function(){\r\n\t\t\tvar range = $.map(this.dates, function(d){ return d.valueOf(); });\r\n\t\t\t$.each(this.pickers, function(i, p){\r\n\t\t\t\tp.setRange(range);\r\n\t\t\t});\r\n\t\t},\r\n\t\tdateUpdated: function(e){\r\n\t\t\tvar dp = $(e.target).data('datepicker'),\r\n\t\t\t\tnew_date = dp.getUTCDate(),\r\n\t\t\t\ti = $.inArray(e.target, this.inputs),\r\n\t\t\t\tl = this.inputs.length;\r\n\t\t\tif (i == -1) return;\r\n\r\n\t\t\tif (new_date < this.dates[i]){\r\n\t\t\t\t// Date being moved earlier/left\r\n\t\t\t\twhile (i>=0 && new_date < this.dates[i]){\r\n\t\t\t\t\tthis.pickers[i--].setUTCDate(new_date);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (new_date > this.dates[i]){\r\n\t\t\t\t// Date being moved later/right\r\n\t\t\t\twhile (i<l && new_date > this.dates[i]){\r\n\t\t\t\t\tthis.pickers[i++].setUTCDate(new_date);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.updateDates();\r\n\t\t},\r\n\t\tremove: function(){\r\n\t\t\t$.map(this.pickers, function(p){ p.remove(); });\r\n\t\t\tdelete this.element.data().datepicker;\r\n\t\t}\r\n\t};\r\n\r\n\tfunction opts_from_el(el, prefix){\r\n\t\t// Derive options from element data-attrs\r\n\t\tvar data = $(el).data(),\r\n\t\t\tout = {}, inkey,\r\n\t\t\treplace = new RegExp('^' + prefix.toLowerCase() + '([A-Z])'),\r\n\t\t\tprefix = new RegExp('^' + prefix.toLowerCase());\r\n\t\tfor (var key in data)\r\n\t\t\tif (prefix.test(key)){\r\n\t\t\t\tinkey = key.replace(replace, function(_,a){ return a.toLowerCase(); });\r\n\t\t\t\tout[inkey] = data[key];\r\n\t\t\t}\r\n\t\treturn out;\r\n\t}\r\n\r\n\tfunction opts_from_locale(lang){\r\n\t\t// Derive options from locale plugins\r\n\t\tvar out = {};\r\n\t\t// Check if \"de-DE\" style date is available, if not language should\r\n\t\t// fallback to 2 letter code eg \"de\"\r\n\t\tif (!dates[lang]) {\r\n\t\t\tlang = lang.split('-')[0]\r\n\t\t\tif (!dates[lang])\r\n\t\t\t\treturn;\r\n\t\t}\r\n\t\tvar d = dates[lang];\r\n\t\t$.each(locale_opts, function(i,k){\r\n\t\t\tif (k in d)\r\n\t\t\t\tout[k] = d[k];\r\n\t\t});\r\n\t\treturn out;\r\n\t}\r\n\r\n\tvar old = $.fn.datepicker;\r\n\tvar datepicker = $.fn.datepicker = function ( option ) {\r\n\t\tvar args = Array.apply(null, arguments);\r\n\t\targs.shift();\r\n\t\tvar internal_return,\r\n\t\t\tthis_return;\r\n\t\tthis.each(function () {\r\n\t\t\tvar $this = $(this),\r\n\t\t\t\tdata = $this.data('datepicker'),\r\n\t\t\t\toptions = typeof option == 'object' && option;\r\n\t\t\tif (!data) {\r\n\t\t\t\tvar elopts = opts_from_el(this, 'date'),\r\n\t\t\t\t\t// Preliminary otions\r\n\t\t\t\t\txopts = $.extend({}, defaults, elopts, options),\r\n\t\t\t\t\tlocopts = opts_from_locale(xopts.language),\r\n\t\t\t\t\t// Options priority: js args, data-attrs, locales, defaults\r\n\t\t\t\t\topts = $.extend({}, defaults, locopts, elopts, options);\r\n\t\t\t\tif ($this.is('.input-daterange') || opts.inputs){\r\n\t\t\t\t\tvar ropts = {\r\n\t\t\t\t\t\tinputs: opts.inputs || $this.find('input').toArray()\r\n\t\t\t\t\t};\r\n\t\t\t\t\t$this.data('datepicker', (data = new DateRangePicker(this, $.extend(opts, ropts))));\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\t$this.data('datepicker', (data = new Datepicker(this, opts)));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (typeof option == 'string' && typeof data[option] == 'function') {\r\n\t\t\t\tinternal_return = data[option].apply(data, args);\r\n\t\t\t\tif (internal_return !== undefined)\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (internal_return !== undefined)\r\n\t\t\treturn internal_return;\r\n\t\telse\r\n\t\t\treturn this;\r\n\t};\r\n\r\n\tvar defaults = $.fn.datepicker.defaults = {\r\n\t\tautoclose: false,\r\n\t\tbeforeShowDay: $.noop,\r\n\t\tcalendarWeeks: false,\r\n\t\tclearBtn: false,\r\n\t\tdaysOfWeekDisabled: [],\r\n\t\tendDate: Infinity,\r\n\t\tforceParse: true,\r\n\t\tformat: 'mm/dd/yyyy',\r\n\t\tkeyboardNavigation: true,\r\n\t\tlanguage: 'en',\r\n\t\tminViewMode: 0,\r\n\t\trtl: false,\r\n\t\tstartDate: -Infinity,\r\n\t\tstartView: 0,\r\n\t\ttodayBtn: false,\r\n\t\ttodayHighlight: false,\r\n\t\tweekStart: 0\r\n\t};\r\n\tvar locale_opts = $.fn.datepicker.locale_opts = [\r\n\t\t'format',\r\n\t\t'rtl',\r\n\t\t'weekStart'\r\n\t];\r\n\t$.fn.datepicker.Constructor = Datepicker;\r\n\tvar dates = $.fn.datepicker.dates = {\r\n\t\ten: {\r\n\t\t\tdays: [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\", \"Sunday\"],\r\n\t\t\tdaysShort: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n\t\t\tdaysMin: [\"Su\", \"Mo\", \"Tu\", \"We\", \"Th\", \"Fr\", \"Sa\", \"Su\"],\r\n\t\t\tmonths: [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\r\n\t\t\tmonthsShort: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"],\r\n\t\t\ttoday: \"Today\",\r\n\t\t\tclear: \"Clear\"\r\n\t\t}\r\n\t};\r\n\r\n\tvar DPGlobal = {\r\n\t\tmodes: [\r\n\t\t\t{\r\n\t\t\t\tclsName: 'days',\r\n\t\t\t\tnavFnc: 'Month',\r\n\t\t\t\tnavStep: 1\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tclsName: 'months',\r\n\t\t\t\tnavFnc: 'FullYear',\r\n\t\t\t\tnavStep: 1\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tclsName: 'years',\r\n\t\t\t\tnavFnc: 'FullYear',\r\n\t\t\t\tnavStep: 10\r\n\t\t}],\r\n\t\tisLeapYear: function (year) {\r\n\t\t\treturn (((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0));\r\n\t\t},\r\n\t\tgetDaysInMonth: function (year, month) {\r\n\t\t\treturn [31, (DPGlobal.isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];\r\n\t\t},\r\n\t\tvalidParts: /dd?|DD?|mm?|MM?|yy(?:yy)?/g,\r\n\t\tnonpunctuation: /[^ -\\/:-@\\[\\u3400-\\u9fff-`{-~\\t\\n\\r]+/g,\r\n\t\tparseFormat: function(format){\r\n\t\t\t// IE treats \\0 as a string end in inputs (truncating the value),\r\n\t\t\t// so it's a bad format delimiter, anyway\r\n\t\t\tvar separators = format.replace(this.validParts, '\\0').split('\\0'),\r\n\t\t\t\tparts = format.match(this.validParts);\r\n\t\t\tif (!separators || !separators.length || !parts || parts.length === 0){\r\n\t\t\t\tthrow new Error(\"Invalid date format.\");\r\n\t\t\t}\r\n\t\t\treturn {separators: separators, parts: parts};\r\n\t\t},\r\n\t\tparseDate: function(date, format, language) {\r\n\t\t\tif (date instanceof Date) return date;\r\n\t\t\tif (typeof format === 'string')\r\n\t\t\t\tformat = DPGlobal.parseFormat(format);\r\n\t\t\tif (/^[\\-+]\\d+[dmwy]([\\s,]+[\\-+]\\d+[dmwy])*$/.test(date)) {\r\n\t\t\t\tvar part_re = /([\\-+]\\d+)([dmwy])/,\r\n\t\t\t\t\tparts = date.match(/([\\-+]\\d+)([dmwy])/g),\r\n\t\t\t\t\tpart, dir;\r\n\t\t\t\tdate = new Date();\r\n\t\t\t\tfor (var i=0; i<parts.length; i++) {\r\n\t\t\t\t\tpart = part_re.exec(parts[i]);\r\n\t\t\t\t\tdir = parseInt(part[1]);\r\n\t\t\t\t\tswitch(part[2]){\r\n\t\t\t\t\t\tcase 'd':\r\n\t\t\t\t\t\t\tdate.setUTCDate(date.getUTCDate() + dir);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'm':\r\n\t\t\t\t\t\t\tdate = Datepicker.prototype.moveMonth.call(Datepicker.prototype, date, dir);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'w':\r\n\t\t\t\t\t\t\tdate.setUTCDate(date.getUTCDate() + dir * 7);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'y':\r\n\t\t\t\t\t\t\tdate = Datepicker.prototype.moveYear.call(Datepicker.prototype, date, dir);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn UTCDate(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), 0, 0, 0);\r\n\t\t\t}\r\n\t\t\tvar parts = date && date.match(this.nonpunctuation) || [],\r\n\t\t\t\tdate = new Date(),\r\n\t\t\t\tparsed = {},\r\n\t\t\t\tsetters_order = ['yyyy', 'yy', 'M', 'MM', 'm', 'mm', 'd', 'dd'],\r\n\t\t\t\tsetters_map = {\r\n\t\t\t\t\tyyyy: function(d,v){ return d.setUTCFullYear(v); },\r\n\t\t\t\t\tyy: function(d,v){ return d.setUTCFullYear(2000+v); },\r\n\t\t\t\t\tm: function(d,v){\r\n\t\t\t\t\t\tv -= 1;\r\n\t\t\t\t\t\twhile (v<0) v += 12;\r\n\t\t\t\t\t\tv %= 12;\r\n\t\t\t\t\t\td.setUTCMonth(v);\r\n\t\t\t\t\t\twhile (d.getUTCMonth() != v)\r\n\t\t\t\t\t\t\td.setUTCDate(d.getUTCDate()-1);\r\n\t\t\t\t\t\treturn d;\r\n\t\t\t\t\t},\r\n\t\t\t\t\td: function(d,v){ return d.setUTCDate(v); }\r\n\t\t\t\t},\r\n\t\t\t\tval, filtered, part;\r\n\t\t\tsetters_map['M'] = setters_map['MM'] = setters_map['mm'] = setters_map['m'];\r\n\t\t\tsetters_map['dd'] = setters_map['d'];\r\n\t\t\tdate = UTCDate(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0);\r\n\t\t\tvar fparts = format.parts.slice();\r\n\t\t\t// Remove noop parts\r\n\t\t\tif (parts.length != fparts.length) {\r\n\t\t\t\tfparts = $(fparts).filter(function(i,p){\r\n\t\t\t\t\treturn $.inArray(p, setters_order) !== -1;\r\n\t\t\t\t}).toArray();\r\n\t\t\t}\r\n\t\t\t// Process remainder\r\n\t\t\tif (parts.length == fparts.length) {\r\n\t\t\t\tfor (var i=0, cnt = fparts.length; i < cnt; i++) {\r\n\t\t\t\t\tval = parseInt(parts[i], 10);\r\n\t\t\t\t\tpart = fparts[i];\r\n\t\t\t\t\tif (isNaN(val)) {\r\n\t\t\t\t\t\tswitch(part) {\r\n\t\t\t\t\t\t\tcase 'MM':\r\n\t\t\t\t\t\t\t\tfiltered = $(dates[language].months).filter(function(){\r\n\t\t\t\t\t\t\t\t\tvar m = this.slice(0, parts[i].length),\r\n\t\t\t\t\t\t\t\t\t\tp = parts[i].slice(0, m.length);\r\n\t\t\t\t\t\t\t\t\treturn m == p;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tval = $.inArray(filtered[0], dates[language].months) + 1;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'M':\r\n\t\t\t\t\t\t\t\tfiltered = $(dates[language].monthsShort).filter(function(){\r\n\t\t\t\t\t\t\t\t\tvar m = this.slice(0, parts[i].length),\r\n\t\t\t\t\t\t\t\t\t\tp = parts[i].slice(0, m.length);\r\n\t\t\t\t\t\t\t\t\treturn m == p;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tval = $.inArray(filtered[0], dates[language].monthsShort) + 1;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tparsed[part] = val;\r\n\t\t\t\t}\r\n\t\t\t\tfor (var i=0, s; i<setters_order.length; i++){\r\n\t\t\t\t\ts = setters_order[i];\r\n\t\t\t\t\tif (s in parsed && !isNaN(parsed[s]))\r\n\t\t\t\t\t\tsetters_map[s](date, parsed[s]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn date;\r\n\t\t},\r\n\t\tformatDate: function(date, format, language){\r\n\t\t\tif (typeof format === 'string')\r\n\t\t\t\tformat = DPGlobal.parseFormat(format);\r\n\t\t\tvar val = {\r\n\t\t\t\td: date.getUTCDate(),\r\n\t\t\t\tD: dates[language].daysShort[date.getUTCDay()],\r\n\t\t\t\tDD: dates[language].days[date.getUTCDay()],\r\n\t\t\t\tm: date.getUTCMonth() + 1,\r\n\t\t\t\tM: dates[language].monthsShort[date.getUTCMonth()],\r\n\t\t\t\tMM: dates[language].months[date.getUTCMonth()],\r\n\t\t\t\tyy: date.getUTCFullYear().toString().substring(2),\r\n\t\t\t\tyyyy: date.getUTCFullYear()\r\n\t\t\t};\r\n\t\t\tval.dd = (val.d < 10 ? '0' : '') + val.d;\r\n\t\t\tval.mm = (val.m < 10 ? '0' : '') + val.m;\r\n\t\t\tvar date = [],\r\n\t\t\t\tseps = $.extend([], format.separators);\r\n\t\t\tfor (var i=0, cnt = format.parts.length; i <= cnt; i++) {\r\n\t\t\t\tif (seps.length)\r\n\t\t\t\t\tdate.push(seps.shift());\r\n\t\t\t\tdate.push(val[format.parts[i]]);\r\n\t\t\t}\r\n\t\t\treturn date.join('');\r\n\t\t},\r\n\t\theadTemplate: '<thead>'+\r\n\t\t\t\t\t\t\t'<tr>'+\r\n\t\t\t\t\t\t\t\t'<th class=\"prev\"><i class=\"icon-arrow-left\"/></th>'+\r\n\t\t\t\t\t\t\t\t'<th colspan=\"5\" class=\"datepicker-switch\"></th>'+\r\n\t\t\t\t\t\t\t\t'<th class=\"next\"><i class=\"icon-arrow-right\"/></th>'+\r\n\t\t\t\t\t\t\t'</tr>'+\r\n\t\t\t\t\t\t'</thead>',\r\n\t\tcontTemplate: '<tbody><tr><td colspan=\"7\"></td></tr></tbody>',\r\n\t\tfootTemplate: '<tfoot><tr><th colspan=\"7\" class=\"today\"></th></tr><tr><th colspan=\"7\" class=\"clear\"></th></tr></tfoot>'\r\n\t};\r\n\tDPGlobal.template = '<div class=\"datepicker\">'+\r\n\t\t\t\t\t\t\t'<div class=\"datepicker-days\">'+\r\n\t\t\t\t\t\t\t\t'<table class=\" table-condensed\">'+\r\n\t\t\t\t\t\t\t\t\tDPGlobal.headTemplate+\r\n\t\t\t\t\t\t\t\t\t'<tbody></tbody>'+\r\n\t\t\t\t\t\t\t\t\tDPGlobal.footTemplate+\r\n\t\t\t\t\t\t\t\t'</table>'+\r\n\t\t\t\t\t\t\t'</div>'+\r\n\t\t\t\t\t\t\t'<div class=\"datepicker-months\">'+\r\n\t\t\t\t\t\t\t\t'<table class=\"table-condensed\">'+\r\n\t\t\t\t\t\t\t\t\tDPGlobal.headTemplate+\r\n\t\t\t\t\t\t\t\t\tDPGlobal.contTemplate+\r\n\t\t\t\t\t\t\t\t\tDPGlobal.footTemplate+\r\n\t\t\t\t\t\t\t\t'</table>'+\r\n\t\t\t\t\t\t\t'</div>'+\r\n\t\t\t\t\t\t\t'<div class=\"datepicker-years\">'+\r\n\t\t\t\t\t\t\t\t'<table class=\"table-condensed\">'+\r\n\t\t\t\t\t\t\t\t\tDPGlobal.headTemplate+\r\n\t\t\t\t\t\t\t\t\tDPGlobal.contTemplate+\r\n\t\t\t\t\t\t\t\t\tDPGlobal.footTemplate+\r\n\t\t\t\t\t\t\t\t'</table>'+\r\n\t\t\t\t\t\t\t'</div>'+\r\n\t\t\t\t\t\t'</div>';\r\n\r\n\t$.fn.datepicker.DPGlobal = DPGlobal;\r\n\r\n\r\n\t/* DATEPICKER NO CONFLICT\r\n\t* =================== */\r\n\r\n\t$.fn.datepicker.noConflict = function(){\r\n\t\t$.fn.datepicker = old;\r\n\t\treturn this;\r\n\t};\r\n\r\n\r\n\t/* DATEPICKER DATA-API\r\n\t* ================== */\r\n\r\n\t$(document).on(\r\n\t\t'focus.datepicker.data-api click.datepicker.data-api',\r\n\t\t'[data-provide=\"datepicker\"]',\r\n\t\tfunction(e){\r\n\t\t\tvar $this = $(this);\r\n\t\t\tif ($this.data('datepicker')) return;\r\n\t\t\te.preventDefault();\r\n\t\t\t// component click requires us to explicitly show it\r\n\t\t\tdatepicker.call($this, 'show');\r\n\t\t}\r\n\t);\r\n\t$(function(){\r\n\t\t//$('[data-provide=\"datepicker-inline\"]').datepicker();\r\n        //vit: changed to support noConflict()\r\n        datepicker.call($('[data-provide=\"datepicker-inline\"]'));\r\n\t});\r\n\r\n}( window.jQuery ));\r\n\r\n/**\r\nBootstrap-datepicker.  \r\nDescription and examples: https://github.com/eternicode/bootstrap-datepicker.  \r\nFor **i18n** you should include js file from here: https://github.com/eternicode/bootstrap-datepicker/tree/master/js/locales\r\nand set `language` option.  \r\nSince 1.4.0 date has different appearance in **popup** and **inline** modes. \r\n\r\n@class date\r\n@extends abstractinput\r\n@final\r\n@example\r\n<a href=\"#\" id=\"dob\" data-type=\"date\" data-pk=\"1\" data-url=\"/post\" data-title=\"Select date\">15/05/1984</a>\r\n<script>\r\n$(function(){\r\n    $('#dob').editable({\r\n        format: 'yyyy-mm-dd',    \r\n        viewformat: 'dd/mm/yyyy',    \r\n        datepicker: {\r\n                weekStart: 1\r\n           }\r\n        }\r\n    });\r\n});\r\n</script>\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    //store bootstrap-datepicker as bdateicker to exclude conflict with jQuery UI one\r\n    $.fn.bdatepicker = $.fn.datepicker.noConflict();\r\n    if(!$.fn.datepicker) { //if there were no other datepickers, keep also original name\r\n        $.fn.datepicker = $.fn.bdatepicker;    \r\n    }    \r\n    \r\n    var Date = function (options) {\r\n        this.init('date', options, Date.defaults);\r\n        this.initPicker(options, Date.defaults);\r\n    };\r\n\r\n    $.fn.editableutils.inherit(Date, $.fn.editabletypes.abstractinput);    \r\n    \r\n    $.extend(Date.prototype, {\r\n        initPicker: function(options, defaults) {\r\n            //'format' is set directly from settings or data-* attributes\r\n\r\n            //by default viewformat equals to format\r\n            if(!this.options.viewformat) {\r\n                this.options.viewformat = this.options.format;\r\n            }\r\n            \r\n            //try parse datepicker config defined as json string in data-datepicker\r\n            options.datepicker = $.fn.editableutils.tryParseJson(options.datepicker, true);\r\n            \r\n            //overriding datepicker config (as by default jQuery extend() is not recursive)\r\n            //since 1.4 datepicker internally uses viewformat instead of format. Format is for submit only\r\n            this.options.datepicker = $.extend({}, defaults.datepicker, options.datepicker, {\r\n                format: this.options.viewformat\r\n            });\r\n            \r\n            //language\r\n            this.options.datepicker.language = this.options.datepicker.language || 'en'; \r\n\r\n            //store DPglobal\r\n            this.dpg = $.fn.bdatepicker.DPGlobal; \r\n\r\n            //store parsed formats\r\n            this.parsedFormat = this.dpg.parseFormat(this.options.format);\r\n            this.parsedViewFormat = this.dpg.parseFormat(this.options.viewformat);            \r\n        },\r\n        \r\n        render: function () {\r\n            this.$input.bdatepicker(this.options.datepicker);\r\n            \r\n            //\"clear\" link\r\n            if(this.options.clear) {\r\n                this.$clear = $('<a href=\"#\"></a>').html(this.options.clear).click($.proxy(function(e){\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    this.clear();\r\n                }, this));\r\n                \r\n                this.$tpl.parent().append($('<div class=\"editable-clear\">').append(this.$clear));  \r\n            }                \r\n        },\r\n        \r\n        value2html: function(value, element) {\r\n           var text = value ? this.dpg.formatDate(value, this.parsedViewFormat, this.options.datepicker.language) : '';\r\n           Date.superclass.value2html.call(this, text, element); \r\n        },\r\n\r\n        html2value: function(html) {\r\n            return this.parseDate(html, this.parsedViewFormat);\r\n        },   \r\n\r\n        value2str: function(value) {\r\n            return value ? this.dpg.formatDate(value, this.parsedFormat, this.options.datepicker.language) : '';\r\n        }, \r\n\r\n        str2value: function(str) {\r\n            return this.parseDate(str, this.parsedFormat);\r\n        }, \r\n\r\n        value2submit: function(value) {\r\n            return this.value2str(value);\r\n        },                    \r\n\r\n        value2input: function(value) {\r\n            this.$input.bdatepicker('update', value);\r\n        },\r\n\r\n        input2value: function() { \r\n            return this.$input.data('datepicker').date;\r\n        },       \r\n\r\n        activate: function() {\r\n        },\r\n\r\n        clear:  function() {\r\n            this.$input.data('datepicker').date = null;\r\n            this.$input.find('.active').removeClass('active');\r\n            if(!this.options.showbuttons) {\r\n                this.$input.closest('form').submit(); \r\n            }\r\n        },\r\n\r\n        autosubmit: function() {\r\n            this.$input.on('mouseup', '.day', function(e){\r\n                if($(e.currentTarget).is('.old') || $(e.currentTarget).is('.new')) {\r\n                    return;\r\n                }\r\n                var $form = $(this).closest('form');\r\n                setTimeout(function() {\r\n                    $form.submit();\r\n                }, 200);\r\n            });\r\n           //changedate is not suitable as it triggered when showing datepicker. see #149\r\n           /*\r\n           this.$input.on('changeDate', function(e){\r\n               var $form = $(this).closest('form');\r\n               setTimeout(function() {\r\n                   $form.submit();\r\n               }, 200);\r\n           });\r\n           */\r\n       },\r\n       \r\n       /*\r\n        For incorrect date bootstrap-datepicker returns current date that is not suitable\r\n        for datefield.\r\n        This function returns null for incorrect date.  \r\n       */\r\n       parseDate: function(str, format) {\r\n           var date = null, formattedBack;\r\n           if(str) {\r\n               date = this.dpg.parseDate(str, format, this.options.datepicker.language);\r\n               if(typeof str === 'string') {\r\n                   formattedBack = this.dpg.formatDate(date, format, this.options.datepicker.language);\r\n                   if(str !== formattedBack) {\r\n                       date = null;\r\n                   }\r\n               }\r\n           }\r\n           return date;\r\n       }\r\n\r\n    });\r\n\r\n    Date.defaults = $.extend({}, $.fn.editabletypes.abstractinput.defaults, {\r\n        /**\r\n        @property tpl \r\n        @default <div></div>\r\n        **/         \r\n        tpl:'<div class=\"editable-date well\"></div>',\r\n        /**\r\n        @property inputclass \r\n        @default null\r\n        **/\r\n        inputclass: null,\r\n        /**\r\n        Format used for sending value to server. Also applied when converting date from <code>data-value</code> attribute.<br>\r\n        Possible tokens are: <code>d, dd, m, mm, yy, yyyy</code>  \r\n\r\n        @property format \r\n        @type string\r\n        @default yyyy-mm-dd\r\n        **/\r\n        format:'yyyy-mm-dd',\r\n        /**\r\n        Format used for displaying date. Also applied when converting date from element's text on init.   \r\n        If not specified equals to <code>format</code>\r\n\r\n        @property viewformat \r\n        @type string\r\n        @default null\r\n        **/\r\n        viewformat: null,\r\n        /**\r\n        Configuration of datepicker.\r\n        Full list of options: http://bootstrap-datepicker.readthedocs.org/en/latest/options.html\r\n\r\n        @property datepicker \r\n        @type object\r\n        @default {\r\n            weekStart: 0,\r\n            startView: 0,\r\n            minViewMode: 0,\r\n            autoclose: false\r\n        }\r\n        **/\r\n        datepicker:{\r\n            weekStart: 0,\r\n            startView: 0,\r\n            minViewMode: 0,\r\n            autoclose: false\r\n        },\r\n        /**\r\n        Text shown as clear date button. \r\n        If <code>false</code> clear button will not be rendered.\r\n\r\n        @property clear \r\n        @type boolean|string\r\n        @default 'x clear'\r\n        **/\r\n        clear: '&times; clear'\r\n    });\r\n\r\n    $.fn.editabletypes.date = Date;\r\n\r\n}(window.jQuery));\r\n\r\n/**\r\nBootstrap datefield input - modification for inline mode.\r\nShows normal <input type=\"text\"> and binds popup datepicker.  \r\nAutomatically shown in inline mode.\r\n\r\n@class datefield\r\n@extends date\r\n\r\n@since 1.4.0\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var DateField = function (options) {\r\n        this.init('datefield', options, DateField.defaults);\r\n        this.initPicker(options, DateField.defaults);\r\n    };\r\n\r\n    $.fn.editableutils.inherit(DateField, $.fn.editabletypes.date);    \r\n    \r\n    $.extend(DateField.prototype, {\r\n        render: function () {\r\n            this.$input = this.$tpl.find('input');\r\n            this.setClass();\r\n            this.setAttr('placeholder');\r\n    \r\n            //bootstrap-datepicker is set `bdateicker` to exclude conflict with jQuery UI one. (in date.js)        \r\n            this.$tpl.bdatepicker(this.options.datepicker);\r\n            \r\n            //need to disable original event handlers\r\n            this.$input.off('focus keydown');\r\n            \r\n            //update value of datepicker\r\n            this.$input.keyup($.proxy(function(){\r\n               this.$tpl.removeData('date');\r\n               this.$tpl.bdatepicker('update');\r\n            }, this));\r\n            \r\n        },   \r\n        \r\n       value2input: function(value) {\r\n           this.$input.val(value ? this.dpg.formatDate(value, this.parsedViewFormat, this.options.datepicker.language) : '');\r\n           this.$tpl.bdatepicker('update');\r\n       },\r\n        \r\n       input2value: function() { \r\n           return this.html2value(this.$input.val());\r\n       },              \r\n        \r\n       activate: function() {\r\n           $.fn.editabletypes.text.prototype.activate.call(this);\r\n       },\r\n       \r\n       autosubmit: function() {\r\n         //reset autosubmit to empty  \r\n       }\r\n    });\r\n    \r\n    DateField.defaults = $.extend({}, $.fn.editabletypes.date.defaults, {\r\n        /**\r\n        @property tpl \r\n        **/         \r\n        tpl:'<div class=\"input-append date\"><input type=\"text\"/><span class=\"add-on\"><i class=\"icon-th\"></i></span></div>',\r\n        /**\r\n        @property inputclass \r\n        @default 'input-small'\r\n        **/         \r\n        inputclass: 'input-small',\r\n        \r\n        /* datepicker config */\r\n        datepicker: {\r\n            weekStart: 0,\r\n            startView: 0,\r\n            minViewMode: 0,\r\n            autoclose: true\r\n        }\r\n    });\r\n    \r\n    $.fn.editabletypes.datefield = DateField;\r\n\r\n}(window.jQuery));\r\n/**\r\nBootstrap-datetimepicker.  \r\nBased on [smalot bootstrap-datetimepicker plugin](https://github.com/smalot/bootstrap-datetimepicker). \r\nBefore usage you should manually include dependent js and css:\r\n\r\n    <link href=\"css/datetimepicker.css\" rel=\"stylesheet\" type=\"text/css\"></link> \r\n    <script src=\"js/bootstrap-datetimepicker.js\"></script>\r\n\r\nFor **i18n** you should include js file from here: https://github.com/smalot/bootstrap-datetimepicker/tree/master/js/locales\r\nand set `language` option.  \r\n\r\n@class datetime\r\n@extends abstractinput\r\n@final\r\n@since 1.4.4\r\n@example\r\n<a href=\"#\" id=\"last_seen\" data-type=\"datetime\" data-pk=\"1\" data-url=\"/post\" title=\"Select date & time\">15/03/2013 12:45</a>\r\n<script>\r\n$(function(){\r\n    $('#last_seen').editable({\r\n        format: 'yyyy-mm-dd hh:ii',    \r\n        viewformat: 'dd/mm/yyyy hh:ii',    \r\n        datetimepicker: {\r\n                weekStart: 1\r\n           }\r\n        }\r\n    });\r\n});\r\n</script>\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n\r\n    var DateTime = function (options) {\r\n        this.init('datetime', options, DateTime.defaults);\r\n        this.initPicker(options, DateTime.defaults);\r\n    };\r\n\r\n    $.fn.editableutils.inherit(DateTime, $.fn.editabletypes.abstractinput);\r\n\r\n    $.extend(DateTime.prototype, {\r\n        initPicker: function(options, defaults) {\r\n            //'format' is set directly from settings or data-* attributes\r\n\r\n            //by default viewformat equals to format\r\n            if(!this.options.viewformat) {\r\n                this.options.viewformat = this.options.format;\r\n            }\r\n            \r\n            //try parse datetimepicker config defined as json string in data-datetimepicker\r\n            options.datetimepicker = $.fn.editableutils.tryParseJson(options.datetimepicker, true);\r\n\r\n            //overriding datetimepicker config (as by default jQuery extend() is not recursive)\r\n            //since 1.4 datetimepicker internally uses viewformat instead of format. Format is for submit only\r\n            this.options.datetimepicker = $.extend({}, defaults.datetimepicker, options.datetimepicker, {\r\n                format: this.options.viewformat\r\n            });\r\n\r\n            //language\r\n            this.options.datetimepicker.language = this.options.datetimepicker.language || 'en'; \r\n\r\n            //store DPglobal\r\n            this.dpg = $.fn.datetimepicker.DPGlobal; \r\n\r\n            //store parsed formats\r\n            this.parsedFormat = this.dpg.parseFormat(this.options.format, this.options.formatType);\r\n            this.parsedViewFormat = this.dpg.parseFormat(this.options.viewformat, this.options.formatType);\r\n        },\r\n\r\n        render: function () {\r\n            this.$input.datetimepicker(this.options.datetimepicker);\r\n\r\n            //adjust container position when viewMode changes\r\n            //see https://github.com/smalot/bootstrap-datetimepicker/pull/80\r\n            this.$input.on('changeMode', function(e) {\r\n                var f = $(this).closest('form').parent();\r\n                //timeout here, otherwise container changes position before form has new size\r\n                setTimeout(function(){\r\n                    f.triggerHandler('resize');\r\n                }, 0);\r\n            });\r\n\r\n            //\"clear\" link\r\n            if(this.options.clear) {\r\n                this.$clear = $('<a href=\"#\"></a>').html(this.options.clear).click($.proxy(function(e){\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    this.clear();\r\n                }, this));\r\n\r\n                this.$tpl.parent().append($('<div class=\"editable-clear\">').append(this.$clear));  \r\n            }\r\n        },\r\n\r\n        value2html: function(value, element) {\r\n            //formatDate works with UTCDate!\r\n            var text = value ? this.dpg.formatDate(this.toUTC(value), this.parsedViewFormat, this.options.datetimepicker.language, this.options.formatType) : '';\r\n            if(element) {\r\n                DateTime.superclass.value2html.call(this, text, element);\r\n            } else {\r\n                return text;\r\n            }\r\n        },\r\n\r\n        html2value: function(html) {\r\n            //parseDate return utc date!\r\n            var value = this.parseDate(html, this.parsedViewFormat); \r\n            return value ? this.fromUTC(value) : null;\r\n        },\r\n\r\n        value2str: function(value) {\r\n            //formatDate works with UTCDate!\r\n            return value ? this.dpg.formatDate(this.toUTC(value), this.parsedFormat, this.options.datetimepicker.language, this.options.formatType) : '';\r\n       },\r\n\r\n       str2value: function(str) {\r\n           //parseDate return utc date!\r\n           var value = this.parseDate(str, this.parsedFormat);\r\n           return value ? this.fromUTC(value) : null;\r\n       },\r\n\r\n       value2submit: function(value) {\r\n           return this.value2str(value);\r\n       },\r\n\r\n       value2input: function(value) {\r\n           if(value) {\r\n             this.$input.data('datetimepicker').setDate(value);\r\n           }\r\n       },\r\n\r\n       input2value: function() { \r\n           //date may be cleared, in that case getDate() triggers error\r\n           var dt = this.$input.data('datetimepicker');\r\n           return dt.date ? dt.getDate() : null;\r\n       },\r\n\r\n       activate: function() {\r\n       },\r\n\r\n       clear: function() {\r\n          this.$input.data('datetimepicker').date = null;\r\n          this.$input.find('.active').removeClass('active');\r\n          if(!this.options.showbuttons) {\r\n             this.$input.closest('form').submit(); \r\n          }          \r\n       },\r\n\r\n       autosubmit: function() {\r\n           this.$input.on('mouseup', '.minute', function(e){\r\n               var $form = $(this).closest('form');\r\n               setTimeout(function() {\r\n                   $form.submit();\r\n               }, 200);\r\n           });\r\n       },\r\n\r\n       //convert date from local to utc\r\n       toUTC: function(value) {\r\n         return value ? new Date(value.valueOf() - value.getTimezoneOffset() * 60000) : value;  \r\n       },\r\n\r\n       //convert date from utc to local\r\n       fromUTC: function(value) {\r\n         return value ? new Date(value.valueOf() + value.getTimezoneOffset() * 60000) : value;  \r\n       },\r\n\r\n       /*\r\n        For incorrect date bootstrap-datetimepicker returns current date that is not suitable\r\n        for datetimefield.\r\n        This function returns null for incorrect date.  \r\n       */\r\n       parseDate: function(str, format) {\r\n           var date = null, formattedBack;\r\n           if(str) {\r\n               date = this.dpg.parseDate(str, format, this.options.datetimepicker.language, this.options.formatType);\r\n               if(typeof str === 'string') {\r\n                   formattedBack = this.dpg.formatDate(date, format, this.options.datetimepicker.language, this.options.formatType);\r\n                   if(str !== formattedBack) {\r\n                       date = null;\r\n                   } \r\n               }\r\n           }\r\n           return date;\r\n       }\r\n\r\n    });\r\n\r\n    DateTime.defaults = $.extend({}, $.fn.editabletypes.abstractinput.defaults, {\r\n        /**\r\n        @property tpl \r\n        @default <div></div>\r\n        **/         \r\n        tpl:'<div class=\"editable-date well\"></div>',\r\n        /**\r\n        @property inputclass \r\n        @default null\r\n        **/\r\n        inputclass: null,\r\n        /**\r\n        Format used for sending value to server. Also applied when converting date from <code>data-value</code> attribute.<br>\r\n        Possible tokens are: <code>d, dd, m, mm, yy, yyyy, h, i</code>  \r\n        \r\n        @property format \r\n        @type string\r\n        @default yyyy-mm-dd hh:ii\r\n        **/         \r\n        format:'yyyy-mm-dd hh:ii',\r\n        formatType:'standard',\r\n        /**\r\n        Format used for displaying date. Also applied when converting date from element's text on init.   \r\n        If not specified equals to <code>format</code>\r\n        \r\n        @property viewformat \r\n        @type string\r\n        @default null\r\n        **/\r\n        viewformat: null,\r\n        /**\r\n        Configuration of datetimepicker.\r\n        Full list of options: https://github.com/smalot/bootstrap-datetimepicker\r\n\r\n        @property datetimepicker \r\n        @type object\r\n        @default { }\r\n        **/\r\n        datetimepicker:{\r\n            todayHighlight: false,\r\n            autoclose: false\r\n        },\r\n        /**\r\n        Text shown as clear date button. \r\n        If <code>false</code> clear button will not be rendered.\r\n\r\n        @property clear \r\n        @type boolean|string\r\n        @default 'x clear'\r\n        **/\r\n        clear: '&times; clear'\r\n    });\r\n\r\n    $.fn.editabletypes.datetime = DateTime;\r\n\r\n}(window.jQuery));\r\n/**\r\nBootstrap datetimefield input - datetime input for inline mode.\r\nShows normal <input type=\"text\"> and binds popup datetimepicker.  \r\nAutomatically shown in inline mode.\r\n\r\n@class datetimefield\r\n@extends datetime\r\n\r\n**/\r\n(function ($) {\r\n    \"use strict\";\r\n    \r\n    var DateTimeField = function (options) {\r\n        this.init('datetimefield', options, DateTimeField.defaults);\r\n        this.initPicker(options, DateTimeField.defaults);\r\n    };\r\n\r\n    $.fn.editableutils.inherit(DateTimeField, $.fn.editabletypes.datetime);\r\n    \r\n    $.extend(DateTimeField.prototype, {\r\n        render: function () {\r\n            this.$input = this.$tpl.find('input');\r\n            this.setClass();\r\n            this.setAttr('placeholder');\r\n            \r\n            this.$tpl.datetimepicker(this.options.datetimepicker);\r\n            \r\n            //need to disable original event handlers\r\n            this.$input.off('focus keydown');\r\n            \r\n            //update value of datepicker\r\n            this.$input.keyup($.proxy(function(){\r\n               this.$tpl.removeData('date');\r\n               this.$tpl.datetimepicker('update');\r\n            }, this));\r\n            \r\n        },   \r\n      \r\n       value2input: function(value) {\r\n           this.$input.val(this.value2html(value));\r\n           this.$tpl.datetimepicker('update');\r\n       },\r\n        \r\n       input2value: function() { \r\n           return this.html2value(this.$input.val());\r\n       },              \r\n        \r\n       activate: function() {\r\n           $.fn.editabletypes.text.prototype.activate.call(this);\r\n       },\r\n       \r\n       autosubmit: function() {\r\n         //reset autosubmit to empty  \r\n       }\r\n    });\r\n    \r\n    DateTimeField.defaults = $.extend({}, $.fn.editabletypes.datetime.defaults, {\r\n        /**\r\n        @property tpl \r\n        **/         \r\n        tpl:'<div class=\"input-append date\"><input type=\"text\"/><span class=\"add-on\"><i class=\"icon-th\"></i></span></div>',\r\n        /**\r\n        @property inputclass \r\n        @default 'input-medium'\r\n        **/         \r\n        inputclass: 'input-medium',\r\n        \r\n        /* datetimepicker config */\r\n        datetimepicker:{\r\n            todayHighlight: false,\r\n            autoclose: true\r\n        }\r\n    });\r\n    \r\n    $.fn.editabletypes.datetimefield = DateTimeField;\r\n\r\n}(window.jQuery));//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9Nb2R1bGVzL1RyYW5zbGF0aW9uL25vZGVfbW9kdWxlcy94LWVkaXRhYmxlL2Rpc3QvYm9vdHN0cmFwMy1lZGl0YWJsZS9qcy9ib290c3RyYXAtZWRpdGFibGUuanM/NDUwZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esa0NBQWtDO0FBQ2xDLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esa0U7O0FBRUE7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLHVEO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0EsK0I7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixPQUFPO0FBQzNCO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLDBFOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELG9CQUFvQixFQUFFO0FBQ3hFLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixPQUFPO0FBQy9CO0FBQ0EscUQ7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUI7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULDRCO0FBQ0E7QUFDQTtB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QUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDJCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTs7QUFFYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdFO0FBQ0E7QUFDQSxTOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxhQUFhLE9BQU87QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1RTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsNkNBQTZDO0FBQzdDO0FBQ0EsYTtBQUNBLFNBQVM7QUFDVCxNOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE07O0FBRUEsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtB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QUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUwsbUM7O0FBRUEsQ0FBQzs7QUFFRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQjs7QUFFL0IsMkJBQTJCO0FBQzNCOztBQUVBLDREO0FBQ0EsWTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxtQ0FBbUMsNEJBQTRCO0FBQy9EO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYTs7QUFFQTtBQUNBO0FBQ0EsYTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsUztBQUNBLEtBQUs7O0FBRUwsK0JBQStCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDs7QUFFQSxDQUFDOztBQUVEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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Q0EsNkJBQTZCO0FBQzdCO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTs7QUFFQTtBQUNBO0FBQ0EsdUM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTs7QUFFQSw2RDs7O0FBR0EsYUFBYTtBQUNiO0FBQ0EsUztBQUNBLEtBQUs7O0FBRUwsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPOztBQUVQOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0EsK0JBQStCOztBQUUvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixjQUFjO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0Esd0JBQXdCLGNBQWM7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsNkNBQTZDO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0osR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQSwwQkFBMEIscUJBQXFCO0FBQy9DO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0EsMEJBQTBCLGlCQUFpQjtBQUMzQztBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBLDBCQUEwQix1Q0FBdUM7QUFDakU7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLG9CQUFvQixFQUFFO0FBQ2hFO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsUUFBUTtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMscUJBQXFCO0FBQzFELE1BQU07QUFDTixxQ0FBcUMsc0JBQXNCO0FBQzNEO0FBQ0E7QUFDQSxxQ0FBcUMscUJBQXFCO0FBQzFELE1BQU07QUFDTixxQ0FBcUMsc0JBQXNCO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMscUJBQXFCO0FBQzFELE1BQU07QUFDTixxQ0FBcUMsc0JBQXNCO0FBQzNEO0FB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsS0FBSzs7QUFFTCxtQ0FBbUM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkIsS0FBSzs7QUFFTDs7QUFFQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFFBQVE7O0FBRVIsZ0M7QUFDQTtBQUNBLFFBQVE7O0FBRVI7QUFDQTtBQUNBLFFBQVE7O0FBRVI7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTCx3Q0FBd0M7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMOztBQUVBLENBQUMiLCJmaWxlIjoiLi9Nb2R1bGVzL1RyYW5zbGF0aW9uL25vZGVfbW9kdWxlcy94LWVkaXRhYmxlL2Rpc3QvYm9vdHN0cmFwMy1lZGl0YWJsZS9qcy9ib290c3RyYXAtZWRpdGFibGUuanMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgWC1lZGl0YWJsZSAtIHYxLjUuMSBcclxuKiBJbi1wbGFjZSBlZGl0aW5nIHdpdGggVHdpdHRlciBCb290c3RyYXAsIGpRdWVyeSBVSSBvciBwdXJlIGpRdWVyeVxyXG4qIGh0dHA6Ly9naXRodWIuY29tL3ZpdGFsZXRzL3gtZWRpdGFibGVcclxuKiBDb3B5cmlnaHQgKGMpIDIwMTMgVml0YWxpeSBQb3RhcG92OyBMaWNlbnNlZCBNSVQgKi9cclxuLyoqXHJcbkZvcm0gd2l0aCBzaW5nbGUgaW5wdXQgZWxlbWVudCwgdHdvIGJ1dHRvbnMgYW5kIHR3byBzdGF0ZXM6IG5vcm1hbC9sb2FkaW5nLlxyXG5BcHBsaWVkIGFzIGpRdWVyeSBtZXRob2QgdG8gRElWIHRhZyAobm90IHRvIGZvcm0gdGFnISkuIFRoaXMgaXMgYmVjYXVzZSBmb3JtIGNhbiBiZSBpbiBsb2FkaW5nIHN0YXRlIHdoZW4gc3Bpbm5lciBzaG93bi5cclxuRWRpdGFibGVmb3JtIGlzIGxpbmtlZCB3aXRoIG9uZSBvZiBpbnB1dCB0eXBlcywgZS5nLiAndGV4dCcsICdzZWxlY3QnIGV0Yy5cclxuXHJcbkBjbGFzcyBlZGl0YWJsZWZvcm1cclxuQHVzZXMgdGV4dFxyXG5AdXNlcyB0ZXh0YXJlYVxyXG4qKi9cclxuKGZ1bmN0aW9uICgkKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIFxyXG4gICAgdmFyIEVkaXRhYmxlRm9ybSA9IGZ1bmN0aW9uIChkaXYsIG9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgJC5mbi5lZGl0YWJsZWZvcm0uZGVmYXVsdHMsIG9wdGlvbnMpO1xyXG4gICAgICAgIHRoaXMuJGRpdiA9ICQoZGl2KTsgLy9kaXYsIGNvbnRhaW5pbmcgZm9ybS4gTm90IGZvcm0gdGFnLiBOb3QgZWRpdGFibGUtZWxlbWVudC5cclxuICAgICAgICBpZighdGhpcy5vcHRpb25zLnNjb3BlKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zY29wZSA9IHRoaXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vbm90aGluZyBzaG93biBhZnRlciBpbml0XHJcbiAgICB9O1xyXG5cclxuICAgIEVkaXRhYmxlRm9ybS5wcm90b3R5cGUgPSB7XHJcbiAgICAgICAgY29uc3RydWN0b3I6IEVkaXRhYmxlRm9ybSxcclxuICAgICAgICBpbml0SW5wdXQ6IGZ1bmN0aW9uKCkgeyAgLy9jYWxsZWQgb25jZVxyXG4gICAgICAgICAgICAvL3Rha2UgaW5wdXQgZnJvbSBvcHRpb25zIChhcyBpdCBpcyBjcmVhdGVkIGluIGVkaXRhYmxlLWVsZW1lbnQpXHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXQgPSB0aGlzLm9wdGlvbnMuaW5wdXQ7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL3NldCBpbml0aWFsIHZhbHVlXHJcbiAgICAgICAgICAgIC8vdG9kbzogbWF5IGJlIGFkZCBjaGVjazogdHlwZW9mIHN0ciA9PT0gJ3N0cmluZycgPyBcclxuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuaW5wdXQuc3RyMnZhbHVlKHRoaXMub3B0aW9ucy52YWx1ZSk7IFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9wcmVyZW5kZXI6IGdldCBpbnB1dC4kaW5wdXRcclxuICAgICAgICAgICAgdGhpcy5pbnB1dC5wcmVyZW5kZXIoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGluaXRUZW1wbGF0ZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHRoaXMuJGZvcm0gPSAkKCQuZm4uZWRpdGFibGVmb3JtLnRlbXBsYXRlKTsgXHJcbiAgICAgICAgfSxcclxuICAgICAgICBpbml0QnV0dG9uczogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciAkYnRuID0gdGhpcy4kZm9ybS5maW5kKCcuZWRpdGFibGUtYnV0dG9ucycpO1xyXG4gICAgICAgICAgICAkYnRuLmFwcGVuZCgkLmZuLmVkaXRhYmxlZm9ybS5idXR0b25zKTtcclxuICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLnNob3didXR0b25zID09PSAnYm90dG9tJykge1xyXG4gICAgICAgICAgICAgICAgJGJ0bi5hZGRDbGFzcygnZWRpdGFibGUtYnV0dG9ucy1ib3R0b20nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgUmVuZGVycyBlZGl0YWJsZWZvcm1cclxuXHJcbiAgICAgICAgQG1ldGhvZCByZW5kZXJcclxuICAgICAgICAqKi8gICAgICAgIFxyXG4gICAgICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vaW5pdCBsb2FkZXJcclxuICAgICAgICAgICAgdGhpcy4kbG9hZGluZyA9ICQoJC5mbi5lZGl0YWJsZWZvcm0ubG9hZGluZyk7ICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy4kZGl2LmVtcHR5KCkuYXBwZW5kKHRoaXMuJGxvYWRpbmcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9pbml0IGZvcm0gdGVtcGxhdGUgYW5kIGJ1dHRvbnNcclxuICAgICAgICAgICAgdGhpcy5pbml0VGVtcGxhdGUoKTtcclxuICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLnNob3didXR0b25zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRCdXR0b25zKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRmb3JtLmZpbmQoJy5lZGl0YWJsZS1idXR0b25zJykucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vc2hvdyBsb2FkaW5nIHN0YXRlXHJcbiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcoKTsgICAgICAgICAgICBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vZmxhZyBzaG93aW5nIGlzIGZvcm0gbm93IHNhdmluZyB2YWx1ZSB0byBzZXJ2ZXIuIFxyXG4gICAgICAgICAgICAvL0l0IGlzIG5lZWRlZCB0byB3YWl0IHdoZW4gY2xvc2luZyBmb3JtLlxyXG4gICAgICAgICAgICB0aGlzLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvKiogICAgICAgIFxyXG4gICAgICAgICAgICBGaXJlZCB3aGVuIHJlbmRlcmluZyBzdGFydHNcclxuICAgICAgICAgICAgQGV2ZW50IHJlbmRlcmluZyBcclxuICAgICAgICAgICAgQHBhcmFtIHtPYmplY3R9IGV2ZW50IGV2ZW50IG9iamVjdFxyXG4gICAgICAgICAgICAqKi8gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy4kZGl2LnRyaWdnZXJIYW5kbGVyKCdyZW5kZXJpbmcnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vaW5pdCBpbnB1dFxyXG4gICAgICAgICAgICB0aGlzLmluaXRJbnB1dCgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9hcHBlbmQgaW5wdXQgdG8gZm9ybVxyXG4gICAgICAgICAgICB0aGlzLiRmb3JtLmZpbmQoJ2Rpdi5lZGl0YWJsZS1pbnB1dCcpLmFwcGVuZCh0aGlzLmlucHV0LiR0cGwpOyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9hcHBlbmQgZm9ybSB0byBjb250YWluZXJcclxuICAgICAgICAgICAgdGhpcy4kZGl2LmFwcGVuZCh0aGlzLiRmb3JtKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vcmVuZGVyIGlucHV0XHJcbiAgICAgICAgICAgICQud2hlbih0aGlzLmlucHV0LnJlbmRlcigpKVxyXG4gICAgICAgICAgICAudGhlbigkLnByb3h5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIC8vc2V0dXAgaW5wdXQgdG8gc3VibWl0IGF1dG9tYXRpY2FsbHkgd2hlbiBubyBidXR0b25zIHNob3duXHJcbiAgICAgICAgICAgICAgICBpZighdGhpcy5vcHRpb25zLnNob3didXR0b25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5hdXRvc3VibWl0KCk7IFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy9hdHRhY2ggJ2NhbmNlbCcgaGFuZGxlclxyXG4gICAgICAgICAgICAgICAgdGhpcy4kZm9ybS5maW5kKCcuZWRpdGFibGUtY2FuY2VsJykuY2xpY2soJC5wcm94eSh0aGlzLmNhbmNlbCwgdGhpcykpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmlucHV0LmVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcih0aGlzLmlucHV0LmVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRmb3JtLmZpbmQoJy5lZGl0YWJsZS1zdWJtaXQnKS5hdHRyKCdkaXNhYmxlZCcsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuJGlucHV0LmF0dHIoJ2Rpc2FibGVkJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9wcmV2ZW50IGZvcm0gZnJvbSBzdWJtaXR0aW5nXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZm9ybS5zdWJtaXQoZnVuY3Rpb24oZSl7IGUucHJldmVudERlZmF1bHQoKTsgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuJGlucHV0LnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZm9ybS5maW5kKCcuZWRpdGFibGUtc3VibWl0JykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSAodGhpcy52YWx1ZSA9PT0gbnVsbCB8fCB0aGlzLnZhbHVlID09PSB1bmRlZmluZWQgfHwgdGhpcy52YWx1ZSA9PT0gJycpID8gdGhpcy5vcHRpb25zLmRlZmF1bHRWYWx1ZSA6IHRoaXMudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC52YWx1ZTJpbnB1dCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9hdHRhY2ggc3VibWl0IGhhbmRsZXJcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRmb3JtLnN1Ym1pdCgkLnByb3h5KHRoaXMuc3VibWl0LCB0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLyoqICAgICAgICBcclxuICAgICAgICAgICAgICAgIEZpcmVkIHdoZW4gZm9ybSBpcyByZW5kZXJlZFxyXG4gICAgICAgICAgICAgICAgQGV2ZW50IHJlbmRlcmVkXHJcbiAgICAgICAgICAgICAgICBAcGFyYW0ge09iamVjdH0gZXZlbnQgZXZlbnQgb2JqZWN0XHJcbiAgICAgICAgICAgICAgICAqKi8gICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuJGRpdi50cmlnZ2VySGFuZGxlcigncmVuZGVyZWQnKTsgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93Rm9ybSgpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvL2NhbGwgcG9zdHJlbmRlciBtZXRob2QgdG8gcGVyZm9ybSBhY3Rpb25zIHJlcXVpcmVkIHZpc2liaWxpdHkgb2YgZm9ybVxyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5pbnB1dC5wb3N0cmVuZGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5wb3N0cmVuZGVyKCk7XHJcbiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9LCB0aGlzKSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uKCkgeyAgIFxyXG4gICAgICAgICAgICAvKiogICAgICAgIFxyXG4gICAgICAgICAgICBGaXJlZCB3aGVuIGZvcm0gd2FzIGNhbmNlbGxlZCBieSB1c2VyXHJcbiAgICAgICAgICAgIEBldmVudCBjYW5jZWwgXHJcbiAgICAgICAgICAgIEBwYXJhbSB7T2JqZWN0fSBldmVudCBldmVudCBvYmplY3RcclxuICAgICAgICAgICAgKiovICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy4kZGl2LnRyaWdnZXJIYW5kbGVyKCdjYW5jZWwnKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNob3dMb2FkaW5nOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHcsIGg7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuJGZvcm0pIHtcclxuICAgICAgICAgICAgICAgIC8vc2V0IGxvYWRpbmcgc2l6ZSBlcXVhbCB0byBmb3JtXHJcbiAgICAgICAgICAgICAgICB3ID0gdGhpcy4kZm9ybS5vdXRlcldpZHRoKCk7XHJcbiAgICAgICAgICAgICAgICBoID0gdGhpcy4kZm9ybS5vdXRlckhlaWdodCgpOyBcclxuICAgICAgICAgICAgICAgIGlmKHcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2FkaW5nLndpZHRoKHcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoaCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGxvYWRpbmcuaGVpZ2h0KGgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy4kZm9ybS5oaWRlKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvL3N0cmV0Y2ggbG9hZGluZyB0byBmaWxsIGNvbnRhaW5lciB3aWR0aFxyXG4gICAgICAgICAgICAgICAgdyA9IHRoaXMuJGxvYWRpbmcucGFyZW50KCkud2lkdGgoKTtcclxuICAgICAgICAgICAgICAgIGlmKHcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2FkaW5nLndpZHRoKHcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuJGxvYWRpbmcuc2hvdygpOyBcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBzaG93Rm9ybTogZnVuY3Rpb24oYWN0aXZhdGUpIHtcclxuICAgICAgICAgICAgdGhpcy4kbG9hZGluZy5oaWRlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuJGZvcm0uc2hvdygpO1xyXG4gICAgICAgICAgICBpZihhY3RpdmF0ZSAhPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuYWN0aXZhdGUoKTsgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLyoqICAgICAgICBcclxuICAgICAgICAgICAgRmlyZWQgd2hlbiBmb3JtIGlzIHNob3duXHJcbiAgICAgICAgICAgIEBldmVudCBzaG93IFxyXG4gICAgICAgICAgICBAcGFyYW0ge09iamVjdH0gZXZlbnQgZXZlbnQgb2JqZWN0XHJcbiAgICAgICAgICAgICoqLyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuJGRpdi50cmlnZ2VySGFuZGxlcignc2hvdycpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbihtc2cpIHtcclxuICAgICAgICAgICAgdmFyICRncm91cCA9IHRoaXMuJGZvcm0uZmluZCgnLmNvbnRyb2wtZ3JvdXAnKSxcclxuICAgICAgICAgICAgICAgICRibG9jayA9IHRoaXMuJGZvcm0uZmluZCgnLmVkaXRhYmxlLWVycm9yLWJsb2NrJyksXHJcbiAgICAgICAgICAgICAgICBsaW5lcztcclxuXHJcbiAgICAgICAgICAgIGlmKG1zZyA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICRncm91cC5yZW1vdmVDbGFzcygkLmZuLmVkaXRhYmxlZm9ybS5lcnJvckdyb3VwQ2xhc3MpO1xyXG4gICAgICAgICAgICAgICAgJGJsb2NrLnJlbW92ZUNsYXNzKCQuZm4uZWRpdGFibGVmb3JtLmVycm9yQmxvY2tDbGFzcykuZW1wdHkoKS5oaWRlKCk7IFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy9jb252ZXJ0IG5ld2xpbmUgdG8gPGJyPiBmb3IgbW9yZSBwcmV0dHkgZXJyb3IgZGlzcGxheVxyXG4gICAgICAgICAgICAgICAgaWYobXNnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGluZXMgPSAoJycrbXNnKS5zcGxpdCgnXFxuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lc1tpXSA9ICQoJzxkaXY+JykudGV4dChsaW5lc1tpXSkuaHRtbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBtc2cgPSBsaW5lcy5qb2luKCc8YnI+Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkZ3JvdXAuYWRkQ2xhc3MoJC5mbi5lZGl0YWJsZWZvcm0uZXJyb3JHcm91cENsYXNzKTtcclxuICAgICAgICAgICAgICAgICRibG9jay5hZGRDbGFzcygkLmZuLmVkaXRhYmxlZm9ybS5lcnJvckJsb2NrQ2xhc3MpLmh0bWwobXNnKS5zaG93KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBzdWJtaXQ6IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9nZXQgbmV3IHZhbHVlIGZyb20gaW5wdXRcclxuICAgICAgICAgICAgdmFyIG5ld1ZhbHVlID0gdGhpcy5pbnB1dC5pbnB1dDJ2YWx1ZSgpOyBcclxuXHJcbiAgICAgICAgICAgIC8vdmFsaWRhdGlvbjogaWYgdmFsaWRhdGUgcmV0dXJucyBzdHJpbmcgb3IgdHJ1dGh5IHZhbHVlIC0gbWVhbnMgZXJyb3JcclxuICAgICAgICAgICAgLy9pZiByZXR1cm5zIG9iamVjdCBsaWtlIHtuZXdWYWx1ZTogJy4uLid9ID0+IHN1Ym1pdHRlZCB2YWx1ZSBpcyByZWFzc2lnbmVkIHRvIGl0XHJcbiAgICAgICAgICAgIHZhciBlcnJvciA9IHRoaXMudmFsaWRhdGUobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICBpZiAoJC50eXBlKGVycm9yKSA9PT0gJ29iamVjdCcgJiYgZXJyb3IubmV3VmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgbmV3VmFsdWUgPSBlcnJvci5uZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQudmFsdWUyaW5wdXQobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGVycm9yLm1zZyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yKGVycm9yLm1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93Rm9ybSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dGb3JtKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2lmIHZhbHVlIG5vdCBjaGFuZ2VkIC0tPiB0cmlnZ2VyICdub2NoYW5nZScgZXZlbnQgYW5kIHJldHVyblxyXG4gICAgICAgICAgICAvKmpzbGludCBlcWVxOiB0cnVlKi9cclxuICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuc2F2ZW5vY2hhbmdlICYmIHRoaXMuaW5wdXQudmFsdWUyc3RyKG5ld1ZhbHVlKSA9PSB0aGlzLmlucHV0LnZhbHVlMnN0cih0aGlzLnZhbHVlKSkge1xyXG4gICAgICAgICAgICAvKmpzbGludCBlcWVxOiBmYWxzZSovICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLyoqICAgICAgICBcclxuICAgICAgICAgICAgICAgIEZpcmVkIHdoZW4gdmFsdWUgbm90IGNoYW5nZWQgYnV0IGZvcm0gaXMgc3VibWl0dGVkLiBSZXF1aXJlcyBzYXZlbm9jaGFuZ2UgPSBmYWxzZS5cclxuICAgICAgICAgICAgICAgIEBldmVudCBub2NoYW5nZSBcclxuICAgICAgICAgICAgICAgIEBwYXJhbSB7T2JqZWN0fSBldmVudCBldmVudCBvYmplY3RcclxuICAgICAgICAgICAgICAgICoqLyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLiRkaXYudHJpZ2dlckhhbmRsZXIoJ25vY2hhbmdlJyk7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0gXHJcblxyXG4gICAgICAgICAgICAvL2NvbnZlcnQgdmFsdWUgZm9yIHN1Ym1pdHRpbmcgdG8gc2VydmVyXHJcbiAgICAgICAgICAgIHZhciBzdWJtaXRWYWx1ZSA9IHRoaXMuaW5wdXQudmFsdWUyc3VibWl0KG5ld1ZhbHVlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuaXNTYXZpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9zZW5kaW5nIGRhdGEgdG8gc2VydmVyXHJcbiAgICAgICAgICAgICQud2hlbih0aGlzLnNhdmUoc3VibWl0VmFsdWUpKVxyXG4gICAgICAgICAgICAuZG9uZSgkLnByb3h5KGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzU2F2aW5nID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9ydW4gc3VjY2VzcyBjYWxsYmFja1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcyA9IHR5cGVvZiB0aGlzLm9wdGlvbnMuc3VjY2VzcyA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMub3B0aW9ucy5zdWNjZXNzLmNhbGwodGhpcy5vcHRpb25zLnNjb3BlLCByZXNwb25zZSwgbmV3VmFsdWUpIDogbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2lmIHN1Y2Nlc3MgY2FsbGJhY2sgcmV0dXJucyBmYWxzZSAtLT4ga2VlcCBmb3JtIG9wZW4gYW5kIGRvIG5vdCBhY3RpdmF0ZSBpbnB1dFxyXG4gICAgICAgICAgICAgICAgaWYocmVzID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Zvcm0oZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvL2lmIHN1Y2Nlc3MgY2FsbGJhY2sgcmV0dXJucyBzdHJpbmcgLS0+ICBrZWVwIGZvcm0gb3Blbiwgc2hvdyBlcnJvciBhbmQgYWN0aXZhdGUgaW5wdXQgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiByZXMgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcihyZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Zvcm0oKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy9pZiBzdWNjZXNzIGNhbGxiYWNrIHJldHVybnMgb2JqZWN0IGxpa2Uge25ld1ZhbHVlOiA8c29tZXRoaW5nPn0gLS0+IHVzZSB0aGF0IHZhbHVlIGluc3RlYWQgb2Ygc3VibWl0dGVkXHJcbiAgICAgICAgICAgICAgICAvL2l0IGlzIHVzZWZ1bGwgaWYgeW91IHdhbnQgdG8gY2huYWdlIHZhbHVlIGluIHVybC1mdW5jdGlvblxyXG4gICAgICAgICAgICAgICAgaWYocmVzICYmIHR5cGVvZiByZXMgPT09ICdvYmplY3QnICYmIHJlcy5oYXNPd25Qcm9wZXJ0eSgnbmV3VmFsdWUnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlID0gcmVzLm5ld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vY2xlYXIgZXJyb3IgbWVzc2FnZVxyXG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvcihmYWxzZSk7ICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAvKiogICAgICAgIFxyXG4gICAgICAgICAgICAgICAgRmlyZWQgd2hlbiBmb3JtIGlzIHN1Ym1pdHRlZFxyXG4gICAgICAgICAgICAgICAgQGV2ZW50IHNhdmUgXHJcbiAgICAgICAgICAgICAgICBAcGFyYW0ge09iamVjdH0gZXZlbnQgZXZlbnQgb2JqZWN0XHJcbiAgICAgICAgICAgICAgICBAcGFyYW0ge09iamVjdH0gcGFyYW1zIGFkZGl0aW9uYWwgcGFyYW1zXHJcbiAgICAgICAgICAgICAgICBAcGFyYW0ge21peGVkfSBwYXJhbXMubmV3VmFsdWUgcmF3IG5ldyB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgQHBhcmFtIHttaXhlZH0gcGFyYW1zLnN1Ym1pdFZhbHVlIHN1Ym1pdHRlZCB2YWx1ZSBhcyBzdHJpbmdcclxuICAgICAgICAgICAgICAgIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXMucmVzcG9uc2UgYWpheCByZXNwb25zZVxyXG5cclxuICAgICAgICAgICAgICAgIEBleGFtcGxlXHJcbiAgICAgICAgICAgICAgICAkKCcjZm9ybS1kaXYnKS5vbignc2F2ZScpLCBmdW5jdGlvbihlLCBwYXJhbXMpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHBhcmFtcy5uZXdWYWx1ZSA9PT0gJ3VzZXJuYW1lJykgey4uLn1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgKiovXHJcbiAgICAgICAgICAgICAgICB0aGlzLiRkaXYudHJpZ2dlckhhbmRsZXIoJ3NhdmUnLCB7bmV3VmFsdWU6IG5ld1ZhbHVlLCBzdWJtaXRWYWx1ZTogc3VibWl0VmFsdWUsIHJlc3BvbnNlOiByZXNwb25zZX0pO1xyXG4gICAgICAgICAgICB9LCB0aGlzKSlcclxuICAgICAgICAgICAgLmZhaWwoJC5wcm94eShmdW5jdGlvbih4aHIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNTYXZpbmcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbXNnO1xyXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIHRoaXMub3B0aW9ucy5lcnJvciA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIG1zZyA9IHRoaXMub3B0aW9ucy5lcnJvci5jYWxsKHRoaXMub3B0aW9ucy5zY29wZSwgeGhyLCBuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG1zZyA9IHR5cGVvZiB4aHIgPT09ICdzdHJpbmcnID8geGhyIDogeGhyLnJlc3BvbnNlVGV4dCB8fCB4aHIuc3RhdHVzVGV4dCB8fCAnVW5rbm93biBlcnJvciEnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IobXNnKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Zvcm0oKTtcclxuICAgICAgICAgICAgfSwgdGhpcykpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNhdmU6IGZ1bmN0aW9uKHN1Ym1pdFZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vdHJ5IHBhcnNlIGNvbXBvc2l0ZSBwayBkZWZpbmVkIGFzIGpzb24gc3RyaW5nIGluIGRhdGEtcGsgXHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5wayA9ICQuZm4uZWRpdGFibGV1dGlscy50cnlQYXJzZUpzb24odGhpcy5vcHRpb25zLnBrLCB0cnVlKTsgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgcGsgPSAodHlwZW9mIHRoaXMub3B0aW9ucy5wayA9PT0gJ2Z1bmN0aW9uJykgPyB0aGlzLm9wdGlvbnMucGsuY2FsbCh0aGlzLm9wdGlvbnMuc2NvcGUpIDogdGhpcy5vcHRpb25zLnBrLFxyXG4gICAgICAgICAgICAvKlxyXG4gICAgICAgICAgICAgIHNlbmQgb24gc2VydmVyIGluIGZvbGxvd2luZyBjYXNlczpcclxuICAgICAgICAgICAgICAxLiB1cmwgaXMgZnVuY3Rpb25cclxuICAgICAgICAgICAgICAyLiB1cmwgaXMgc3RyaW5nIEFORCAocGsgZGVmaW5lZCBPUiBzZW5kIG9wdGlvbiA9IGFsd2F5cykgXHJcbiAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHNlbmQgPSAhISh0eXBlb2YgdGhpcy5vcHRpb25zLnVybCA9PT0gJ2Z1bmN0aW9uJyB8fCAodGhpcy5vcHRpb25zLnVybCAmJiAoKHRoaXMub3B0aW9ucy5zZW5kID09PSAnYWx3YXlzJykgfHwgKHRoaXMub3B0aW9ucy5zZW5kID09PSAnYXV0bycgJiYgcGsgIT09IG51bGwgJiYgcGsgIT09IHVuZGVmaW5lZCkpKSksXHJcbiAgICAgICAgICAgIHBhcmFtcztcclxuXHJcbiAgICAgICAgICAgIGlmIChzZW5kKSB7IC8vc2VuZCB0byBzZXJ2ZXJcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL3N0YW5kYXJkIHBhcmFtc1xyXG4gICAgICAgICAgICAgICAgcGFyYW1zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMub3B0aW9ucy5uYW1lIHx8ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBzdWJtaXRWYWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICBwazogcGsgXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vYWRkaXRpb25hbCBwYXJhbXNcclxuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiB0aGlzLm9wdGlvbnMucGFyYW1zID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gdGhpcy5vcHRpb25zLnBhcmFtcy5jYWxsKHRoaXMub3B0aW9ucy5zY29wZSwgcGFyYW1zKTsgIFxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3RyeSBwYXJzZSBqc29uIGluIHNpbmdsZSBxdW90ZXMgKGZyb20gZGF0YS1wYXJhbXMgYXR0cmlidXRlKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5wYXJhbXMgPSAkLmZuLmVkaXRhYmxldXRpbHMudHJ5UGFyc2VKc29uKHRoaXMub3B0aW9ucy5wYXJhbXMsIHRydWUpOyAgIFxyXG4gICAgICAgICAgICAgICAgICAgICQuZXh0ZW5kKHBhcmFtcywgdGhpcy5vcHRpb25zLnBhcmFtcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIHRoaXMub3B0aW9ucy51cmwgPT09ICdmdW5jdGlvbicpIHsgLy91c2VyJ3MgZnVuY3Rpb25cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnVybC5jYWxsKHRoaXMub3B0aW9ucy5zY29wZSwgcGFyYW1zKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7ICBcclxuICAgICAgICAgICAgICAgICAgICAvL3NlbmQgYWpheCB0byBzZXJ2ZXIgYW5kIHJldHVybiBkZWZlcnJlZCBvYmplY3RcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJC5hamF4KCQuZXh0ZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsICAgICA6IHRoaXMub3B0aW9ucy51cmwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgICAgOiBwYXJhbXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgICAgOiAnUE9TVCdcclxuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLm9wdGlvbnMuYWpheE9wdGlvbnMpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIFxyXG5cclxuICAgICAgICB2YWxpZGF0ZTogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnMudmFsaWRhdGUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMudmFsaWRhdGUuY2FsbCh0aGlzLm9wdGlvbnMuc2NvcGUsIHZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIG9wdGlvbjogZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICBpZihrZXkgaW4gdGhpcy5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNba2V5XSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZihrZXkgPT09ICd2YWx1ZScpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2RvIG5vdCBwYXNzIG9wdGlvbiB0byBpbnB1dCBhcyBpdCBpcyBwYXNzZWQgaW4gZWRpdGFibGUtZWxlbWVudFxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbih2YWx1ZSwgY29udmVydFN0cikge1xyXG4gICAgICAgICAgICBpZihjb252ZXJ0U3RyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5pbnB1dC5zdHIydmFsdWUodmFsdWUpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2lmIGZvcm0gaXMgdmlzaWJsZSwgdXBkYXRlIGlucHV0XHJcbiAgICAgICAgICAgIGlmKHRoaXMuJGZvcm0gJiYgdGhpcy4kZm9ybS5pcygnOnZpc2libGUnKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dC52YWx1ZTJpbnB1dCh0aGlzLnZhbHVlKTtcclxuICAgICAgICAgICAgfSAgICAgICAgICAgIFxyXG4gICAgICAgIH0gICAgICAgICAgICAgICBcclxuICAgIH07XHJcblxyXG4gICAgLypcclxuICAgIEluaXRpYWxpemUgZWRpdGFibGVmb3JtLiBBcHBsaWVkIHRvIGpRdWVyeSBvYmplY3QuXHJcblxyXG4gICAgQG1ldGhvZCAkKCkuZWRpdGFibGVmb3JtKG9wdGlvbnMpXHJcbiAgICBAcGFyYW1zIHtPYmplY3R9IG9wdGlvbnNcclxuICAgIEBleGFtcGxlXHJcbiAgICB2YXIgJGZvcm0gPSAkKCcmbHQ7ZGl2Jmd0OycpLmVkaXRhYmxlZm9ybSh7XHJcbiAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgIG5hbWU6ICd1c2VybmFtZScsXHJcbiAgICAgICAgdXJsOiAnL3Bvc3QnLFxyXG4gICAgICAgIHZhbHVlOiAndml0YWxpeSdcclxuICAgIH0pO1xyXG5cclxuICAgIC8vdG8gZGlzcGxheSBmb3JtIHlvdSBzaG91bGQgY2FsbCAncmVuZGVyJyBtZXRob2RcclxuICAgICRmb3JtLmVkaXRhYmxlZm9ybSgncmVuZGVyJyk7ICAgICBcclxuICAgICovXHJcbiAgICAkLmZuLmVkaXRhYmxlZm9ybSA9IGZ1bmN0aW9uIChvcHRpb24pIHtcclxuICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSwgXHJcbiAgICAgICAgICAgIGRhdGEgPSAkdGhpcy5kYXRhKCdlZGl0YWJsZWZvcm0nKSwgXHJcbiAgICAgICAgICAgIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9uID09PSAnb2JqZWN0JyAmJiBvcHRpb247IFxyXG4gICAgICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgICAgICAgICR0aGlzLmRhdGEoJ2VkaXRhYmxlZm9ybScsIChkYXRhID0gbmV3IEVkaXRhYmxlRm9ybSh0aGlzLCBvcHRpb25zKSkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbiA9PT0gJ3N0cmluZycpIHsgLy9jYWxsIG1ldGhvZCBcclxuICAgICAgICAgICAgICAgIGRhdGFbb3B0aW9uXS5hcHBseShkYXRhLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmdzLCAxKSk7XHJcbiAgICAgICAgICAgIH0gXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8va2VlcCBsaW5rIHRvIGNvbnN0cnVjdG9yIHRvIGFsbG93IGluaGVyaXRhbmNlXHJcbiAgICAkLmZuLmVkaXRhYmxlZm9ybS5Db25zdHJ1Y3RvciA9IEVkaXRhYmxlRm9ybTsgICAgXHJcblxyXG4gICAgLy9kZWZhdWx0c1xyXG4gICAgJC5mbi5lZGl0YWJsZWZvcm0uZGVmYXVsdHMgPSB7XHJcbiAgICAgICAgLyogc2VlIGFsc28gZGVmYXVsdHMgZm9yIGlucHV0ICovXHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIFR5cGUgb2YgaW5wdXQuIENhbiBiZSA8Y29kZT50ZXh0fHRleHRhcmVhfHNlbGVjdHxkYXRlfGNoZWNrbGlzdDwvY29kZT5cclxuXHJcbiAgICAgICAgQHByb3BlcnR5IHR5cGUgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nXHJcbiAgICAgICAgQGRlZmF1bHQgJ3RleHQnXHJcbiAgICAgICAgKiovXHJcbiAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIFVybCBmb3Igc3VibWl0LCBlLmcuIDxjb2RlPicvcG9zdCc8L2NvZGU+ICBcclxuICAgICAgICBJZiBmdW5jdGlvbiAtIGl0IHdpbGwgYmUgY2FsbGVkIGluc3RlYWQgb2YgYWpheC4gRnVuY3Rpb24gc2hvdWxkIHJldHVybiBkZWZlcnJlZCBvYmplY3QgdG8gcnVuIGZhaWwvZG9uZSBjYWxsYmFja3MuXHJcblxyXG4gICAgICAgIEBwcm9wZXJ0eSB1cmwgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nfGZ1bmN0aW9uXHJcbiAgICAgICAgQGRlZmF1bHQgbnVsbFxyXG4gICAgICAgIEBleGFtcGxlXHJcbiAgICAgICAgdXJsOiBmdW5jdGlvbihwYXJhbXMpIHtcclxuICAgICAgICAgICAgdmFyIGQgPSBuZXcgJC5EZWZlcnJlZDtcclxuICAgICAgICAgICAgaWYocGFyYW1zLnZhbHVlID09PSAnYWJjJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucmVqZWN0KCdlcnJvciBtZXNzYWdlJyk7IC8vcmV0dXJuaW5nIGVycm9yIHZpYSBkZWZlcnJlZCBvYmplY3RcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vYXN5bmMgc2F2aW5nIGRhdGEgaW4ganMgbW9kZWxcclxuICAgICAgICAgICAgICAgIHNvbWVNb2RlbC5hc3luY1NhdmVNZXRob2Qoe1xyXG4gICAgICAgICAgICAgICAgICAgLi4uLCBcclxuICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pOyBcclxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gXHJcbiAgICAgICAgKiovICAgICAgICBcclxuICAgICAgICB1cmw6bnVsbCxcclxuICAgICAgICAvKipcclxuICAgICAgICBBZGRpdGlvbmFsIHBhcmFtcyBmb3Igc3VibWl0LiBJZiBkZWZpbmVkIGFzIDxjb2RlPm9iamVjdDwvY29kZT4gLSBpdCBpcyAqKmFwcGVuZGVkKiogdG8gb3JpZ2luYWwgYWpheCBkYXRhIChwaywgbmFtZSBhbmQgdmFsdWUpLiAgXHJcbiAgICAgICAgSWYgZGVmaW5lZCBhcyA8Y29kZT5mdW5jdGlvbjwvY29kZT4gLSByZXR1cm5lZCBvYmplY3QgKipvdmVyd3JpdGVzKiogb3JpZ2luYWwgYWpheCBkYXRhLlxyXG4gICAgICAgIEBleGFtcGxlXHJcbiAgICAgICAgcGFyYW1zOiBmdW5jdGlvbihwYXJhbXMpIHtcclxuICAgICAgICAgICAgLy9vcmlnaW5hbGx5IHBhcmFtcyBjb250YWluIHBrLCBuYW1lIGFuZCB2YWx1ZVxyXG4gICAgICAgICAgICBwYXJhbXMuYSA9IDE7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXJhbXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBAcHJvcGVydHkgcGFyYW1zIFxyXG4gICAgICAgIEB0eXBlIG9iamVjdHxmdW5jdGlvblxyXG4gICAgICAgIEBkZWZhdWx0IG51bGxcclxuICAgICAgICAqKi8gICAgICAgICAgXHJcbiAgICAgICAgcGFyYW1zOm51bGwsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgTmFtZSBvZiBmaWVsZC4gV2lsbCBiZSBzdWJtaXR0ZWQgb24gc2VydmVyLiBDYW4gYmUgdGFrZW4gZnJvbSA8Y29kZT5pZDwvY29kZT4gYXR0cmlidXRlXHJcblxyXG4gICAgICAgIEBwcm9wZXJ0eSBuYW1lIFxyXG4gICAgICAgIEB0eXBlIHN0cmluZ1xyXG4gICAgICAgIEBkZWZhdWx0IG51bGxcclxuICAgICAgICAqKi8gICAgICAgICBcclxuICAgICAgICBuYW1lOiBudWxsLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIFByaW1hcnkga2V5IG9mIGVkaXRhYmxlIG9iamVjdCAoZS5nLiByZWNvcmQgaWQgaW4gZGF0YWJhc2UpLiBGb3IgY29tcG9zaXRlIGtleXMgdXNlIG9iamVjdCwgZS5nLiA8Y29kZT57aWQ6IDEsIGxhbmc6ICdlbid9PC9jb2RlPi5cclxuICAgICAgICBDYW4gYmUgY2FsY3VsYXRlZCBkeW5hbWljYWxseSB2aWEgZnVuY3Rpb24uXHJcblxyXG4gICAgICAgIEBwcm9wZXJ0eSBwayBcclxuICAgICAgICBAdHlwZSBzdHJpbmd8b2JqZWN0fGZ1bmN0aW9uXHJcbiAgICAgICAgQGRlZmF1bHQgbnVsbFxyXG4gICAgICAgICoqLyAgICAgICAgIFxyXG4gICAgICAgIHBrOiBudWxsLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEluaXRpYWwgdmFsdWUuIElmIG5vdCBkZWZpbmVkIC0gd2lsbCBiZSB0YWtlbiBmcm9tIGVsZW1lbnQncyBjb250ZW50LlxyXG4gICAgICAgIEZvciBfX3NlbGVjdF9fIHR5cGUgc2hvdWxkIGJlIGRlZmluZWQgKGFzIGl0IGlzIElEIG9mIHNob3duIHRleHQpLlxyXG5cclxuICAgICAgICBAcHJvcGVydHkgdmFsdWUgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nfG9iamVjdFxyXG4gICAgICAgIEBkZWZhdWx0IG51bGxcclxuICAgICAgICAqKi8gICAgICAgIFxyXG4gICAgICAgIHZhbHVlOiBudWxsLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIFZhbHVlIHRoYXQgd2lsbCBiZSBkaXNwbGF5ZWQgaW4gaW5wdXQgaWYgb3JpZ2luYWwgZmllbGQgdmFsdWUgaXMgZW1wdHkgKGBudWxsfHVuZGVmaW5lZHwnJ2ApLlxyXG5cclxuICAgICAgICBAcHJvcGVydHkgZGVmYXVsdFZhbHVlIFxyXG4gICAgICAgIEB0eXBlIHN0cmluZ3xvYmplY3RcclxuICAgICAgICBAZGVmYXVsdCBudWxsXHJcbiAgICAgICAgQHNpbmNlIDEuNC42XHJcbiAgICAgICAgKiovICAgICAgICBcclxuICAgICAgICBkZWZhdWx0VmFsdWU6IG51bGwsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgU3RyYXRlZ3kgZm9yIHNlbmRpbmcgZGF0YSBvbiBzZXJ2ZXIuIENhbiBiZSBgYXV0b3xhbHdheXN8bmV2ZXJgLlxyXG4gICAgICAgIFdoZW4gJ2F1dG8nIGRhdGEgd2lsbCBiZSBzZW50IG9uIHNlcnZlciAqKm9ubHkgaWYgcGsgYW5kIHVybCBkZWZpbmVkKiosIG90aGVyd2lzZSBuZXcgdmFsdWUgd2lsbCBiZSBzdG9yZWQgbG9jYWxseS5cclxuXHJcbiAgICAgICAgQHByb3BlcnR5IHNlbmQgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nXHJcbiAgICAgICAgQGRlZmF1bHQgJ2F1dG8nXHJcbiAgICAgICAgKiovICAgICAgICAgIFxyXG4gICAgICAgIHNlbmQ6ICdhdXRvJywgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgRnVuY3Rpb24gZm9yIGNsaWVudC1zaWRlIHZhbGlkYXRpb24uIElmIHJldHVybnMgc3RyaW5nIC0gbWVhbnMgdmFsaWRhdGlvbiBub3QgcGFzc2VkIGFuZCBzdHJpbmcgc2hvd2VkIGFzIGVycm9yLlxyXG4gICAgICAgIFNpbmNlIDEuNS4xIHlvdSBjYW4gbW9kaWZ5IHN1Ym1pdHRlZCB2YWx1ZSBieSByZXR1cm5pbmcgb2JqZWN0IGZyb20gYHZhbGlkYXRlYDogXHJcbiAgICAgICAgYHtuZXdWYWx1ZTogJy4uLid9YCBvciBge25ld1ZhbHVlOiAnLi4uJywgbXNnOiAnLi4uJ31gXHJcblxyXG4gICAgICAgIEBwcm9wZXJ0eSB2YWxpZGF0ZSBcclxuICAgICAgICBAdHlwZSBmdW5jdGlvblxyXG4gICAgICAgIEBkZWZhdWx0IG51bGxcclxuICAgICAgICBAZXhhbXBsZVxyXG4gICAgICAgIHZhbGlkYXRlOiBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICAgICBpZigkLnRyaW0odmFsdWUpID09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJ1RoaXMgZmllbGQgaXMgcmVxdWlyZWQnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgICoqLyAgICAgICAgIFxyXG4gICAgICAgIHZhbGlkYXRlOiBudWxsLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIFN1Y2Nlc3MgY2FsbGJhY2suIENhbGxlZCB3aGVuIHZhbHVlIHN1Y2Nlc3NmdWxseSBzZW50IG9uIHNlcnZlciBhbmQgKipyZXNwb25zZSBzdGF0dXMgPSAyMDAqKi4gIFxyXG4gICAgICAgIFVzZWZ1bGwgdG8gd29yayB3aXRoIGpzb24gcmVzcG9uc2UuIEZvciBleGFtcGxlLCBpZiB5b3VyIGJhY2tlbmQgcmVzcG9uc2UgY2FuIGJlIDxjb2RlPntzdWNjZXNzOiB0cnVlfTwvY29kZT5cclxuICAgICAgICBvciA8Y29kZT57c3VjY2VzczogZmFsc2UsIG1zZzogXCJzZXJ2ZXIgZXJyb3JcIn08L2NvZGU+IHlvdSBjYW4gY2hlY2sgaXQgaW5zaWRlIHRoaXMgY2FsbGJhY2suICBcclxuICAgICAgICBJZiBpdCByZXR1cm5zICoqc3RyaW5nKiogLSBtZWFucyBlcnJvciBvY2N1cmVkIGFuZCBzdHJpbmcgaXMgc2hvd24gYXMgZXJyb3IgbWVzc2FnZS4gIFxyXG4gICAgICAgIElmIGl0IHJldHVybnMgKipvYmplY3QgbGlrZSoqIDxjb2RlPntuZXdWYWx1ZTogJmx0O3NvbWV0aGluZyZndDt9PC9jb2RlPiAtIGl0IG92ZXJ3cml0ZXMgdmFsdWUsIHN1Ym1pdHRlZCBieSB1c2VyLiAgXHJcbiAgICAgICAgT3RoZXJ3aXNlIG5ld1ZhbHVlIHNpbXBseSByZW5kZXJlZCBpbnRvIGVsZW1lbnQuXHJcbiAgICAgICAgXHJcbiAgICAgICAgQHByb3BlcnR5IHN1Y2Nlc3MgXHJcbiAgICAgICAgQHR5cGUgZnVuY3Rpb25cclxuICAgICAgICBAZGVmYXVsdCBudWxsXHJcbiAgICAgICAgQGV4YW1wbGVcclxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXNwb25zZSwgbmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgaWYoIXJlc3BvbnNlLnN1Y2Nlc3MpIHJldHVybiByZXNwb25zZS5tc2c7XHJcbiAgICAgICAgfVxyXG4gICAgICAgICoqLyAgICAgICAgICBcclxuICAgICAgICBzdWNjZXNzOiBudWxsLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEVycm9yIGNhbGxiYWNrLiBDYWxsZWQgd2hlbiByZXF1ZXN0IGZhaWxlZCAocmVzcG9uc2Ugc3RhdHVzICE9IDIwMCkuICBcclxuICAgICAgICBVc2VmdWxsIHdoZW4geW91IHdhbnQgdG8gcGFyc2UgZXJyb3IgcmVzcG9uc2UgYW5kIGRpc3BsYXkgYSBjdXN0b20gbWVzc2FnZS5cclxuICAgICAgICBNdXN0IHJldHVybiAqKnN0cmluZyoqIC0gdGhlIG1lc3NhZ2UgdG8gYmUgZGlzcGxheWVkIGluIHRoZSBlcnJvciBibG9jay5cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIEBwcm9wZXJ0eSBlcnJvciBcclxuICAgICAgICBAdHlwZSBmdW5jdGlvblxyXG4gICAgICAgIEBkZWZhdWx0IG51bGxcclxuICAgICAgICBAc2luY2UgMS40LjRcclxuICAgICAgICBAZXhhbXBsZVxyXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbihyZXNwb25zZSwgbmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3RhdHVzID09PSA1MDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnU2VydmljZSB1bmF2YWlsYWJsZS4gUGxlYXNlIHRyeSBsYXRlci4nO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnJlc3BvbnNlVGV4dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAqKi8gICAgICAgICAgXHJcbiAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgQWRkaXRpb25hbCBvcHRpb25zIGZvciBzdWJtaXQgYWpheCByZXF1ZXN0LlxyXG4gICAgICAgIExpc3Qgb2YgdmFsdWVzOiBodHRwOi8vYXBpLmpxdWVyeS5jb20valF1ZXJ5LmFqYXhcclxuICAgICAgICBcclxuICAgICAgICBAcHJvcGVydHkgYWpheE9wdGlvbnMgXHJcbiAgICAgICAgQHR5cGUgb2JqZWN0XHJcbiAgICAgICAgQGRlZmF1bHQgbnVsbFxyXG4gICAgICAgIEBzaW5jZSAxLjEuMSAgICAgICAgXHJcbiAgICAgICAgQGV4YW1wbGUgXHJcbiAgICAgICAgYWpheE9wdGlvbnM6IHtcclxuICAgICAgICAgICAgdHlwZTogJ3B1dCcsXHJcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcclxuICAgICAgICB9ICAgICAgICBcclxuICAgICAgICAqKi8gICAgICAgIFxyXG4gICAgICAgIGFqYXhPcHRpb25zOiBudWxsLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIFdoZXJlIHRvIHNob3cgYnV0dG9uczogbGVmdCh0cnVlKXxib3R0b218ZmFsc2UgIFxyXG4gICAgICAgIEZvcm0gd2l0aG91dCBidXR0b25zIGlzIGF1dG8tc3VibWl0dGVkLlxyXG5cclxuICAgICAgICBAcHJvcGVydHkgc2hvd2J1dHRvbnMgXHJcbiAgICAgICAgQHR5cGUgYm9vbGVhbnxzdHJpbmdcclxuICAgICAgICBAZGVmYXVsdCB0cnVlXHJcbiAgICAgICAgQHNpbmNlIDEuMS4xXHJcbiAgICAgICAgKiovICAgICAgICAgXHJcbiAgICAgICAgc2hvd2J1dHRvbnM6IHRydWUsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgU2NvcGUgZm9yIGNhbGxiYWNrIG1ldGhvZHMgKHN1Y2Nlc3MsIHZhbGlkYXRlKS4gIFxyXG4gICAgICAgIElmIDxjb2RlPm51bGw8L2NvZGU+IG1lYW5zIGVkaXRhYmxlZm9ybSBpbnN0YW5jZSBpdHNlbGYuIFxyXG5cclxuICAgICAgICBAcHJvcGVydHkgc2NvcGUgXHJcbiAgICAgICAgQHR5cGUgRE9NRWxlbWVudHxvYmplY3RcclxuICAgICAgICBAZGVmYXVsdCBudWxsXHJcbiAgICAgICAgQHNpbmNlIDEuMi4wXHJcbiAgICAgICAgQHByaXZhdGVcclxuICAgICAgICAqKi8gICAgICAgICAgICBcclxuICAgICAgICBzY29wZTogbnVsbCxcclxuICAgICAgICAvKipcclxuICAgICAgICBXaGV0aGVyIHRvIHNhdmUgb3IgY2FuY2VsIHZhbHVlIHdoZW4gaXQgd2FzIG5vdCBjaGFuZ2VkIGJ1dCBmb3JtIHdhcyBzdWJtaXR0ZWRcclxuXHJcbiAgICAgICAgQHByb3BlcnR5IHNhdmVub2NoYW5nZSBcclxuICAgICAgICBAdHlwZSBib29sZWFuXHJcbiAgICAgICAgQGRlZmF1bHQgZmFsc2VcclxuICAgICAgICBAc2luY2UgMS4yLjBcclxuICAgICAgICAqKi9cclxuICAgICAgICBzYXZlbm9jaGFuZ2U6IGZhbHNlXHJcbiAgICB9OyAgIFxyXG5cclxuICAgIC8qXHJcbiAgICBOb3RlOiBmb2xsb3dpbmcgcGFyYW1zIGNvdWxkIHJlZGVmaW5lZCBpbiBlbmdpbmU6IGJvb3RzdHJhcCBvciBqcXVlcnl1aTpcclxuICAgIENsYXNzZXMgJ2NvbnRyb2wtZ3JvdXAnIGFuZCAnZWRpdGFibGUtZXJyb3ItYmxvY2snIG11c3QgYWx3YXlzIHByZXNlbnQhXHJcbiAgICAqLyAgICAgIFxyXG4gICAgJC5mbi5lZGl0YWJsZWZvcm0udGVtcGxhdGUgPSAnPGZvcm0gY2xhc3M9XCJmb3JtLWlubGluZSBlZGl0YWJsZWZvcm1cIj4nK1xyXG4gICAgJzxkaXYgY2xhc3M9XCJjb250cm9sLWdyb3VwXCI+JyArIFxyXG4gICAgJzxkaXY+PGRpdiBjbGFzcz1cImVkaXRhYmxlLWlucHV0XCI+PC9kaXY+PGRpdiBjbGFzcz1cImVkaXRhYmxlLWJ1dHRvbnNcIj48L2Rpdj48L2Rpdj4nK1xyXG4gICAgJzxkaXYgY2xhc3M9XCJlZGl0YWJsZS1lcnJvci1ibG9ja1wiPjwvZGl2PicgKyBcclxuICAgICc8L2Rpdj4nICsgXHJcbiAgICAnPC9mb3JtPic7XHJcblxyXG4gICAgLy9sb2FkaW5nIGRpdlxyXG4gICAgJC5mbi5lZGl0YWJsZWZvcm0ubG9hZGluZyA9ICc8ZGl2IGNsYXNzPVwiZWRpdGFibGVmb3JtLWxvYWRpbmdcIj48L2Rpdj4nO1xyXG5cclxuICAgIC8vYnV0dG9uc1xyXG4gICAgJC5mbi5lZGl0YWJsZWZvcm0uYnV0dG9ucyA9ICc8YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiBjbGFzcz1cImVkaXRhYmxlLXN1Ym1pdFwiPm9rPC9idXR0b24+JytcclxuICAgICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImVkaXRhYmxlLWNhbmNlbFwiPmNhbmNlbDwvYnV0dG9uPic7ICAgICAgXHJcblxyXG4gICAgLy9lcnJvciBjbGFzcyBhdHRhY2hlZCB0byBjb250cm9sLWdyb3VwXHJcbiAgICAkLmZuLmVkaXRhYmxlZm9ybS5lcnJvckdyb3VwQ2xhc3MgPSBudWxsOyAgXHJcblxyXG4gICAgLy9lcnJvciBjbGFzcyBhdHRhY2hlZCB0byBlZGl0YWJsZS1lcnJvci1ibG9ja1xyXG4gICAgJC5mbi5lZGl0YWJsZWZvcm0uZXJyb3JCbG9ja0NsYXNzID0gJ2VkaXRhYmxlLWVycm9yJztcclxuICAgIFxyXG4gICAgLy9lbmdpbmVcclxuICAgICQuZm4uZWRpdGFibGVmb3JtLmVuZ2luZSA9ICdqcXVlcnknO1xyXG59KHdpbmRvdy5qUXVlcnkpKTtcclxuXHJcbi8qKlxyXG4qIEVkaXRhYmxlRm9ybSB1dGlsaXRlc1xyXG4qL1xyXG4oZnVuY3Rpb24gKCQpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgXHJcbiAgICAvL3V0aWxzXHJcbiAgICAkLmZuLmVkaXRhYmxldXRpbHMgPSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgKiBjbGFzc2ljIEpTIGluaGVyaXRhbmNlIGZ1bmN0aW9uXHJcbiAgICAgICAgKi8gIFxyXG4gICAgICAgIGluaGVyaXQ6IGZ1bmN0aW9uIChDaGlsZCwgUGFyZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBGID0gZnVuY3Rpb24oKSB7IH07XHJcbiAgICAgICAgICAgIEYucHJvdG90eXBlID0gUGFyZW50LnByb3RvdHlwZTtcclxuICAgICAgICAgICAgQ2hpbGQucHJvdG90eXBlID0gbmV3IEYoKTtcclxuICAgICAgICAgICAgQ2hpbGQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ2hpbGQ7XHJcbiAgICAgICAgICAgIENoaWxkLnN1cGVyY2xhc3MgPSBQYXJlbnQucHJvdG90eXBlO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICogc2V0IGNhcmV0IHBvc2l0aW9uIGluIGlucHV0XHJcbiAgICAgICAgKiBzZWUgaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy80OTkxMjYvanF1ZXJ5LXNldC1jdXJzb3ItcG9zaXRpb24taW4tdGV4dC1hcmVhXHJcbiAgICAgICAgKi8gICAgICAgIFxyXG4gICAgICAgIHNldEN1cnNvclBvc2l0aW9uOiBmdW5jdGlvbihlbGVtLCBwb3MpIHtcclxuICAgICAgICAgICAgaWYgKGVsZW0uc2V0U2VsZWN0aW9uUmFuZ2UpIHtcclxuICAgICAgICAgICAgICAgIGVsZW0uc2V0U2VsZWN0aW9uUmFuZ2UocG9zLCBwb3MpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW0uY3JlYXRlVGV4dFJhbmdlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSBlbGVtLmNyZWF0ZVRleHRSYW5nZSgpO1xyXG4gICAgICAgICAgICAgICAgcmFuZ2UuY29sbGFwc2UodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICByYW5nZS5tb3ZlRW5kKCdjaGFyYWN0ZXInLCBwb3MpO1xyXG4gICAgICAgICAgICAgICAgcmFuZ2UubW92ZVN0YXJ0KCdjaGFyYWN0ZXInLCBwb3MpO1xyXG4gICAgICAgICAgICAgICAgcmFuZ2Uuc2VsZWN0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAqIGZ1bmN0aW9uIHRvIHBhcnNlIEpTT04gaW4gKnNpbmdsZSogcXVvdGVzLiAoanF1ZXJ5IGF1dG9tYXRpY2FsbHkgcGFyc2Ugb25seSBkb3VibGUgcXVvdGVzKVxyXG4gICAgICAgICogVGhhdCBhbGxvd3Mgc3VjaCBjb2RlIGFzOiA8YSBkYXRhLXNvdXJjZT1cInsnYSc6ICdiJywgJ2MnOiAnZCd9XCI+XHJcbiAgICAgICAgKiBzYWZlID0gdHJ1ZSAtLT4gbWVhbnMgbm8gZXhjZXB0aW9uIHdpbGwgYmUgdGhyb3duXHJcbiAgICAgICAgKiBmb3IgZGV0YWlscyBzZWUgaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy83NDEwMzQ4L2hvdy10by1zZXQtanNvbi1mb3JtYXQtdG8taHRtbDUtZGF0YS1hdHRyaWJ1dGVzLWluLXRoZS1qcXVlcnlcclxuICAgICAgICAqL1xyXG4gICAgICAgIHRyeVBhcnNlSnNvbjogZnVuY3Rpb24ocywgc2FmZSkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHMgPT09ICdzdHJpbmcnICYmIHMubGVuZ3RoICYmIHMubWF0Y2goL15bXFx7XFxbXS4qW1xcfVxcXV0kLykpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzYWZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLypqc2xpbnQgZXZpbDogdHJ1ZSovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHMgPSAobmV3IEZ1bmN0aW9uKCdyZXR1cm4gJyArIHMpKSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvKmpzbGludCBldmlsOiBmYWxzZSovXHJcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30gZmluYWxseSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLypqc2xpbnQgZXZpbDogdHJ1ZSovXHJcbiAgICAgICAgICAgICAgICAgICAgcyA9IChuZXcgRnVuY3Rpb24oJ3JldHVybiAnICsgcykpKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLypqc2xpbnQgZXZpbDogZmFsc2UqL1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBzO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICogc2xpY2Ugb2JqZWN0IGJ5IHNwZWNpZmllZCBrZXlzXHJcbiAgICAgICAgKi9cclxuICAgICAgICBzbGljZU9iajogZnVuY3Rpb24ob2JqLCBrZXlzLCBjYXNlU2Vuc2l0aXZlIC8qIGRlZmF1bHQ6IGZhbHNlICovKSB7XHJcbiAgICAgICAgICAgIHZhciBrZXksIGtleUxvd2VyLCBuZXdPYmogPSB7fTtcclxuXHJcbiAgICAgICAgICAgIGlmICghJC5pc0FycmF5KGtleXMpIHx8ICFrZXlzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ld09iajtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBrZXkgPSBrZXlzW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZihjYXNlU2Vuc2l0aXZlID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy93aGVuIGdldHRpbmcgZGF0YS0qIGF0dHJpYnV0ZXMgdmlhICQuZGF0YSgpIGl0J3MgY29udmVydGVkIHRvIGxvd2VyY2FzZS5cclxuICAgICAgICAgICAgICAgIC8vZGV0YWlsczogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy83NjAyNTY1L3VzaW5nLWRhdGEtYXR0cmlidXRlcy13aXRoLWpxdWVyeVxyXG4gICAgICAgICAgICAgICAgLy93b3JrYXJvdW5kIGlzIGNvZGUgYmVsb3cuXHJcbiAgICAgICAgICAgICAgICBrZXlMb3dlciA9IGtleS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXlMb3dlcikpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXdPYmpba2V5XSA9IG9ialtrZXlMb3dlcl07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBuZXdPYmo7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICBleGNsdWRlIGNvbXBsZXggb2JqZWN0cyBmcm9tICQuZGF0YSgpIGJlZm9yZSBwYXNzIHRvIGNvbmZpZ1xyXG4gICAgICAgICovXHJcbiAgICAgICAgZ2V0Q29uZmlnRGF0YTogZnVuY3Rpb24oJGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcclxuICAgICAgICAgICAgJC5lYWNoKCRlbGVtZW50LmRhdGEoKSwgZnVuY3Rpb24oaywgdikge1xyXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIHYgIT09ICdvYmplY3QnIHx8ICh2ICYmIHR5cGVvZiB2ID09PSAnb2JqZWN0JyAmJiAodi5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0IHx8IHYuY29uc3RydWN0b3IgPT09IEFycmF5KSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhW2tdID0gdjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIHJldHVybnMga2V5cyBvZiBvYmplY3RcclxuICAgICAgICAqL1xyXG4gICAgICAgIG9iamVjdEtleXM6IGZ1bmN0aW9uKG8pIHtcclxuICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMobyk7ICBcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChvICE9PSBPYmplY3QobykpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdPYmplY3Qua2V5cyBjYWxsZWQgb24gYSBub24tb2JqZWN0Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgaz1bXSwgcDtcclxuICAgICAgICAgICAgICAgIGZvciAocCBpbiBvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvLHApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGsucHVzaChwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgLyoqXHJcbiAgICAgICAgbWV0aG9kIHRvIGVzY2FwZSBodG1sLlxyXG4gICAgICAgKiovXHJcbiAgICAgICBlc2NhcGU6IGZ1bmN0aW9uKHN0cikge1xyXG4gICAgICAgICAgIHJldHVybiAkKCc8ZGl2PicpLnRleHQoc3RyKS5odG1sKCk7XHJcbiAgICAgICB9LFxyXG4gICAgICAgXHJcbiAgICAgICAvKlxyXG4gICAgICAgIHJldHVybnMgYXJyYXkgaXRlbXMgZnJvbSBzb3VyY2VEYXRhIGhhdmluZyB2YWx1ZSBwcm9wZXJ0eSBlcXVhbCBvciBpbkFycmF5IG9mICd2YWx1ZSdcclxuICAgICAgICovXHJcbiAgICAgICBpdGVtc0J5VmFsdWU6IGZ1bmN0aW9uKHZhbHVlLCBzb3VyY2VEYXRhLCB2YWx1ZVByb3ApIHtcclxuICAgICAgICAgICBpZighc291cmNlRGF0YSB8fCB2YWx1ZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgIGlmICh0eXBlb2YodmFsdWVQcm9wKSAhPT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgICAgICAgIHZhciBpZEtleSA9IHZhbHVlUHJvcCB8fCAndmFsdWUnO1xyXG4gICAgICAgICAgICAgICB2YWx1ZVByb3AgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZVtpZEtleV07IH07XHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgdmFyIGlzVmFsQXJyYXkgPSAkLmlzQXJyYXkodmFsdWUpLFxyXG4gICAgICAgICAgIHJlc3VsdCA9IFtdLCBcclxuICAgICAgICAgICB0aGF0ID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgJC5lYWNoKHNvdXJjZURhdGEsIGZ1bmN0aW9uKGksIG8pIHtcclxuICAgICAgICAgICAgICAgaWYoby5jaGlsZHJlbikge1xyXG4gICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmNvbmNhdCh0aGF0Lml0ZW1zQnlWYWx1ZSh2YWx1ZSwgby5jaGlsZHJlbiwgdmFsdWVQcm9wKSk7XHJcbiAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAvKmpzbGludCBlcWVxOiB0cnVlKi9cclxuICAgICAgICAgICAgICAgICAgIGlmKGlzVmFsQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBpZigkLmdyZXAodmFsdWUsIGZ1bmN0aW9uKHYpeyAgcmV0dXJuIHYgPT0gKG8gJiYgdHlwZW9mIG8gPT09ICdvYmplY3QnID8gdmFsdWVQcm9wKG8pIDogbyk7IH0pLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChvKTsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbVZhbHVlID0gKG8gJiYgKHR5cGVvZiBvID09PSAnb2JqZWN0JykpID8gdmFsdWVQcm9wKG8pIDogbztcclxuICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSBpdGVtVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobyk7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgIC8qanNsaW50IGVxZXE6IGZhbHNlKi9cclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICB9LFxyXG4gICAgICAgXHJcbiAgICAgICAvKlxyXG4gICAgICAgUmV0dXJucyBpbnB1dCBieSBvcHRpb25zOiB0eXBlLCBtb2RlLiBcclxuICAgICAgICovXHJcbiAgICAgICBjcmVhdGVJbnB1dDogZnVuY3Rpb24ob3B0aW9ucykge1xyXG4gICAgICAgICAgIHZhciBUeXBlQ29uc3RydWN0b3IsIHR5cGVPcHRpb25zLCBpbnB1dCxcclxuICAgICAgICAgICB0eXBlID0gb3B0aW9ucy50eXBlO1xyXG5cclxuICAgICAgICAgICAvL2BkYXRlYCBpcyBzb21lIGtpbmQgb2YgdmlydHVhbCB0eXBlIHRoYXQgaXMgdHJhbnNmb3JtZWQgdG8gb25lIG9mIGV4YWN0IHR5cGVzXHJcbiAgICAgICAgICAgLy9kZXBlbmRpbmcgb24gbW9kZSBhbmQgY29yZSBsaWJcclxuICAgICAgICAgICBpZih0eXBlID09PSAnZGF0ZScpIHtcclxuICAgICAgICAgICAgICAgLy9pbmxpbmVcclxuICAgICAgICAgICAgICAgaWYob3B0aW9ucy5tb2RlID09PSAnaW5saW5lJykge1xyXG4gICAgICAgICAgICAgICAgICAgaWYoJC5mbi5lZGl0YWJsZXR5cGVzLmRhdGVmaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSAnZGF0ZWZpZWxkJztcclxuICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZigkLmZuLmVkaXRhYmxldHlwZXMuZGF0ZXVpZmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gJ2RhdGV1aWZpZWxkJztcclxuICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgLy9wb3B1cFxyXG4gICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgaWYoJC5mbi5lZGl0YWJsZXR5cGVzLmRhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gJ2RhdGUnO1xyXG4gICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKCQuZm4uZWRpdGFibGV0eXBlcy5kYXRldWkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gJ2RhdGV1aSc7XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgIC8vaWYgdHlwZSBzdGlsbCBgZGF0ZWAgYW5kIG5vdCBleGlzdCBpbiB0eXBlcywgcmVwbGFjZSB3aXRoIGBjb21ib2RhdGVgIHRoYXQgaXMgYmFzZSBpbnB1dFxyXG4gICAgICAgICAgICAgICBpZih0eXBlID09PSAnZGF0ZScgJiYgISQuZm4uZWRpdGFibGV0eXBlcy5kYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICB0eXBlID0gJ2NvbWJvZGF0ZSc7XHJcbiAgICAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgIC8vYGRhdGV0aW1lYCBzaG91bGQgYmUgZGF0ZXRpbWVmaWVsZCBpbiAnaW5saW5lJyBtb2RlXHJcbiAgICAgICAgICAgaWYodHlwZSA9PT0gJ2RhdGV0aW1lJyAmJiBvcHRpb25zLm1vZGUgPT09ICdpbmxpbmUnKSB7XHJcbiAgICAgICAgICAgICB0eXBlID0gJ2RhdGV0aW1lZmllbGQnOyAgXHJcbiAgICAgICAgICAgfSAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgIC8vY2hhbmdlIHd5c2lodG1sNSB0byB0ZXh0YXJlYSBmb3IganF1ZXJ5IFVJIGFuZCBwbGFpbiB2ZXJzaW9uc1xyXG4gICAgICAgICAgIGlmKHR5cGUgPT09ICd3eXNpaHRtbDUnICYmICEkLmZuLmVkaXRhYmxldHlwZXNbdHlwZV0pIHtcclxuICAgICAgICAgICAgICAgdHlwZSA9ICd0ZXh0YXJlYSc7XHJcbiAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAvL2NyZWF0ZSBpbnB1dCBvZiBzcGVjaWZpZWQgdHlwZS4gSW5wdXQgd2lsbCBiZSB1c2VkIGZvciBjb252ZXJ0aW5nIHZhbHVlLCBub3QgaW4gZm9ybVxyXG4gICAgICAgICAgIGlmKHR5cGVvZiAkLmZuLmVkaXRhYmxldHlwZXNbdHlwZV0gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgVHlwZUNvbnN0cnVjdG9yID0gJC5mbi5lZGl0YWJsZXR5cGVzW3R5cGVdO1xyXG4gICAgICAgICAgICAgICB0eXBlT3B0aW9ucyA9IHRoaXMuc2xpY2VPYmoob3B0aW9ucywgdGhpcy5vYmplY3RLZXlzKFR5cGVDb25zdHJ1Y3Rvci5kZWZhdWx0cykpO1xyXG4gICAgICAgICAgICAgICBpbnB1dCA9IG5ldyBUeXBlQ29uc3RydWN0b3IodHlwZU9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICByZXR1cm4gaW5wdXQ7XHJcbiAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgJC5lcnJvcignVW5rbm93biB0eXBlOiAnKyB0eXBlKTtcclxuICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyBcclxuICAgICAgICAgICB9ICBcclxuICAgICAgIH0sXHJcbiAgICAgICBcclxuICAgICAgIC8vc2VlIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNzI2NDg5OS9kZXRlY3QtY3NzLXRyYW5zaXRpb25zLXVzaW5nLWphdmFzY3JpcHQtYW5kLXdpdGhvdXQtbW9kZXJuaXpyXHJcbiAgICAgICBzdXBwb3J0c1RyYW5zaXRpb25zOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgdmFyIGIgPSBkb2N1bWVudC5ib2R5IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxcclxuICAgICAgICAgICAgICAgcyA9IGIuc3R5bGUsXHJcbiAgICAgICAgICAgICAgIHAgPSAndHJhbnNpdGlvbicsXHJcbiAgICAgICAgICAgICAgIHYgPSBbJ01veicsICdXZWJraXQnLCAnS2h0bWwnLCAnTycsICdtcyddO1xyXG4gICAgICAgICAgICAgICBcclxuICAgICAgICAgICBpZih0eXBlb2Ygc1twXSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7IFxyXG4gICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgLy8gVGVzdHMgZm9yIHZlbmRvciBzcGVjaWZpYyBwcm9wXHJcbiAgICAgICAgICAgcCA9IHAuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBwLnN1YnN0cigxKTtcclxuICAgICAgICAgICBmb3IodmFyIGk9MDsgaTx2Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgIGlmKHR5cGVvZiBzW3ZbaV0gKyBwXSA9PT0gJ3N0cmluZycpIHsgXHJcbiAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsgXHJcbiAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICB9XHJcbiAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgfSAgICAgICAgICAgIFxyXG4gICAgICAgXHJcbiAgICB9OyAgICAgIFxyXG59KHdpbmRvdy5qUXVlcnkpKTtcclxuXHJcbi8qKlxyXG5BdHRhY2hlcyBzdGFuZC1hbG9uZSBjb250YWluZXIgd2l0aCBlZGl0YWJsZS1mb3JtIHRvIEhUTUwgZWxlbWVudC4gRWxlbWVudCBpcyB1c2VkIG9ubHkgZm9yIHBvc2l0aW9uaW5nLCB2YWx1ZSBpcyBub3Qgc3RvcmVkIGFueXdoZXJlLjxicj5cclxuVGhpcyBtZXRob2QgYXBwbGllZCBpbnRlcm5hbGx5IGluIDxjb2RlPiQoKS5lZGl0YWJsZSgpPC9jb2RlPi4gWW91IHNob3VsZCBzdWJzY3JpYmUgb24gaXQncyBldmVudHMgKHNhdmUgLyBjYW5jZWwpIHRvIGdldCBwcm9maXQgb2YgaXQuPGJyPlxyXG5GaW5hbCByZWFsaXphdGlvbiBjYW4gYmUgZGlmZmVyZW50OiBib290c3RyYXAtcG9wb3ZlciwganF1ZXJ5dWktdG9vbHRpcCwgcG9zaHl0aXAsIGlubGluZS1kaXYuIEl0IGRlcGVuZHMgb24gd2hpY2gganMgZmlsZSB5b3UgaW5jbHVkZS48YnI+XHJcbkFwcGxpZWQgYXMgalF1ZXJ5IG1ldGhvZC5cclxuXHJcbkBjbGFzcyBlZGl0YWJsZUNvbnRhaW5lclxyXG5AdXNlcyBlZGl0YWJsZWZvcm1cclxuKiovXHJcbihmdW5jdGlvbiAoJCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIFBvcHVwID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLmluaXQoZWxlbWVudCwgb3B0aW9ucyk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICB2YXIgSW5saW5lID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLmluaXQoZWxlbWVudCwgb3B0aW9ucyk7XHJcbiAgICB9OyAgICBcclxuXHJcbiAgICAvL21ldGhvZHNcclxuICAgIFBvcHVwLnByb3RvdHlwZSA9IHtcclxuICAgICAgICBjb250YWluZXJOYW1lOiBudWxsLCAvL21ldGhvZCB0byBjYWxsIGNvbnRhaW5lciBvbiBlbGVtZW50XHJcbiAgICAgICAgY29udGFpbmVyRGF0YU5hbWU6IG51bGwsIC8vb2JqZWN0IG5hbWUgaW4gZWxlbWVudCdzIC5kYXRhKClcclxuICAgICAgICBpbm5lckNzczogbnVsbCwgLy90YmQgaW4gY2hpbGQgY2xhc3NcclxuICAgICAgICBjb250YWluZXJDbGFzczogJ2VkaXRhYmxlLWNvbnRhaW5lciBlZGl0YWJsZS1wb3B1cCcsIC8vY3NzIGNsYXNzIGFwcGxpZWQgdG8gY29udGFpbmVyIGVsZW1lbnRcclxuICAgICAgICBkZWZhdWx0czoge30sIC8vY29udGFpbmVyIGl0c2VsZiBkZWZhdWx0c1xyXG4gICAgICAgIFxyXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgdGhpcy4kZWxlbWVudCA9ICQoZWxlbWVudCk7XHJcbiAgICAgICAgICAgIC8vc2luY2UgMS40LjEgY29udGFpbmVyIGRvIG5vdCB1c2UgZGF0YS0qIGRpcmVjdGx5IGFzIHRoZXkgYWxyZWFkeSBtZXJnZWQgaW50byBvcHRpb25zLlxyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgJC5mbi5lZGl0YWJsZUNvbnRhaW5lci5kZWZhdWx0cywgb3B0aW9ucyk7ICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuc3BsaXRPcHRpb25zKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL3NldCBzY29wZSBvZiBmb3JtIGNhbGxiYWNrcyB0byBlbGVtZW50XHJcbiAgICAgICAgICAgIHRoaXMuZm9ybU9wdGlvbnMuc2NvcGUgPSB0aGlzLiRlbGVtZW50WzBdOyBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuaW5pdENvbnRhaW5lcigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9mbGFnIHRvIGhpZGUgY29udGFpbmVyLCB3aGVuIHNhdmluZyB2YWx1ZSB3aWxsIGZpbmlzaFxyXG4gICAgICAgICAgICB0aGlzLmRlbGF5ZWRIaWRlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAvL2JpbmQgJ2Rlc3Ryb3llZCcgbGlzdGVuZXIgdG8gZGVzdHJveSBjb250YWluZXIgd2hlbiBlbGVtZW50IGlzIHJlbW92ZWQgZnJvbSBkb21cclxuICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5vbignZGVzdHJveWVkJywgJC5wcm94eShmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH0sIHRoaXMpKTsgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2F0dGFjaCBkb2N1bWVudCBoYW5kbGVyIHRvIGNsb3NlIGNvbnRhaW5lcnMgb24gY2xpY2sgLyBlc2NhcGVcclxuICAgICAgICAgICAgaWYoISQoZG9jdW1lbnQpLmRhdGEoJ2VkaXRhYmxlLWhhbmRsZXJzLWF0dGFjaGVkJykpIHtcclxuICAgICAgICAgICAgICAgIC8vY2xvc2UgYWxsIG9uIGVzY2FwZVxyXG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ2tleXVwLmVkaXRhYmxlJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS53aGljaCA9PT0gMjcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmVkaXRhYmxlLW9wZW4nKS5lZGl0YWJsZUNvbnRhaW5lcignaGlkZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3RvZG86IHJldHVybiBmb2N1cyBvbiBlbGVtZW50IFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vY2xvc2UgY29udGFpbmVycyB3aGVuIGNsaWNrIG91dHNpZGUgXHJcbiAgICAgICAgICAgICAgICAvLyhtb3VzZWRvd24gY291bGQgYmUgYmV0dGVyIHRoYW4gY2xpY2ssIGl0IGNsb3NlcyBldmVyeXRoaW5nIGFsc28gb24gZHJhZyBkcm9wKVxyXG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrLmVkaXRhYmxlJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciAkdGFyZ2V0ID0gJChlLnRhcmdldCksIGksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGVfY2xhc3NlcyA9IFsnLmVkaXRhYmxlLWNvbnRhaW5lcicsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJy51aS1kYXRlcGlja2VyLWhlYWRlcicsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJy5kYXRlcGlja2VyJywgLy9pbiBpbmxpbmUgbW9kZSBkYXRlcGlja2VyIGlzIHJlbmRlcmVkIGludG8gYm9keVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJy5tb2RhbC1iYWNrZHJvcCcsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJy5ib290c3RyYXAtd3lzaWh0bWw1LWluc2VydC1pbWFnZS1tb2RhbCcsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJy5ib290c3RyYXAtd3lzaWh0bWw1LWluc2VydC1saW5rLW1vZGFsJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvL2NoZWNrIGlmIGVsZW1lbnQgaXMgZGV0YWNoZWQuIEl0IG9jY3VycyB3aGVuIGNsaWNraW5nIGluIGJvb3RzdHJhcCBkYXRlcGlja2VyXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkLmNvbnRhaW5zKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgZS50YXJnZXQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL2ZvciBzb21lIHJlYXNvbiBGRiAyMCBnZW5lcmF0ZXMgZXh0cmEgZXZlbnQgKGNsaWNrKSBpbiBzZWxlY3QyIHdpZGdldCB3aXRoIGUudGFyZ2V0ID0gZG9jdW1lbnRcclxuICAgICAgICAgICAgICAgICAgICAvL3dlIG5lZWQgdG8gZmlsdGVyIGl0IHZpYSBjb25zdHJ1Y3Rpb24gYmVsb3cuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdml0YWxldHMveC1lZGl0YWJsZS9pc3N1ZXMvMTk5XHJcbiAgICAgICAgICAgICAgICAgICAgLy9Qb3NzaWJseSByZWxhdGVkIHRvIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTAxMTk3OTMvd2h5LWRvZXMtZmlyZWZveC1yZWFjdC1kaWZmZXJlbnRseS1mcm9tLXdlYmtpdC1hbmQtaWUtdG8tY2xpY2stZXZlbnQtb24tc2VsZWNcclxuICAgICAgICAgICAgICAgICAgICBpZigkdGFyZ2V0LmlzKGRvY3VtZW50KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsgXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vaWYgY2xpY2sgaW5zaWRlIG9uZSBvZiBleGNsdWRlIGNsYXNzZXMgLS0+IG5vIG5vdGhpbmdcclxuICAgICAgICAgICAgICAgICAgICBmb3IoaT0wOyBpPGV4Y2x1ZGVfY2xhc3Nlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHRhcmdldC5pcyhleGNsdWRlX2NsYXNzZXNbaV0pIHx8ICR0YXJnZXQucGFyZW50cyhleGNsdWRlX2NsYXNzZXNbaV0pLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvL2Nsb3NlIGFsbCBvcGVuIGNvbnRhaW5lcnMgKGV4Y2VwdCBvbmUgLSB0YXJnZXQpXHJcbiAgICAgICAgICAgICAgICAgICAgUG9wdXAucHJvdG90eXBlLmNsb3NlT3RoZXJzKGUudGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5kYXRhKCdlZGl0YWJsZS1oYW5kbGVycy1hdHRhY2hlZCcsIHRydWUpO1xyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLy9zcGxpdCBvcHRpb25zIG9uIGNvbnRhaW5lck9wdGlvbnMgYW5kIGZvcm1PcHRpb25zXHJcbiAgICAgICAgc3BsaXRPcHRpb25zOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXJPcHRpb25zID0ge307XHJcbiAgICAgICAgICAgIHRoaXMuZm9ybU9wdGlvbnMgPSB7fTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKCEkLmZuW3RoaXMuY29udGFpbmVyTmFtZV0pIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcih0aGlzLmNvbnRhaW5lck5hbWUgKyAnIG5vdCBmb3VuZC4gSGF2ZSB5b3UgaW5jbHVkZWQgY29ycmVzcG9uZGluZyBqcyBmaWxlPycpOyAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2tleXMgZGVmaW5lZCBpbiBjb250YWluZXIgZGVmYXVsdHMgZ28gdG8gY29udGFpbmVyLCBvdGhlcnMgZ28gdG8gZm9ybVxyXG4gICAgICAgICAgICBmb3IodmFyIGsgaW4gdGhpcy5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgaWYoayBpbiB0aGlzLmRlZmF1bHRzKSB7XHJcbiAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXJPcHRpb25zW2tdID0gdGhpcy5vcHRpb25zW2tdO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgdGhpcy5mb3JtT3B0aW9uc1trXSA9IHRoaXMub3B0aW9uc1trXTtcclxuICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICAvKlxyXG4gICAgICAgIFJldHVybnMganF1ZXJ5IG9iamVjdCBvZiBjb250YWluZXJcclxuICAgICAgICBAbWV0aG9kIHRpcCgpXHJcbiAgICAgICAgKi8gICAgICAgICBcclxuICAgICAgICB0aXA6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb250YWluZXIoKSA/IHRoaXMuY29udGFpbmVyKCkuJHRpcCA6IG51bGw7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLyogcmV0dXJucyBjb250YWluZXIgb2JqZWN0ICovXHJcbiAgICAgICAgY29udGFpbmVyOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGNvbnRhaW5lcjtcclxuICAgICAgICAgICAgLy9maXJzdCwgdHJ5IGdldCBpdCBieSBgY29udGFpbmVyRGF0YU5hbWVgXHJcbiAgICAgICAgICAgIGlmKHRoaXMuY29udGFpbmVyRGF0YU5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGlmKGNvbnRhaW5lciA9IHRoaXMuJGVsZW1lbnQuZGF0YSh0aGlzLmNvbnRhaW5lckRhdGFOYW1lKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb250YWluZXI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9zZWNvbmQsIHRyeSBgY29udGFpbmVyTmFtZWBcclxuICAgICAgICAgICAgY29udGFpbmVyID0gdGhpcy4kZWxlbWVudC5kYXRhKHRoaXMuY29udGFpbmVyTmFtZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBjb250YWluZXI7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLyogY2FsbCBuYXRpdmUgbWV0aG9kIG9mIHVuZGVybHlpbmcgY29udGFpbmVyLCBlLmcuIHRoaXMuJGVsZW1lbnQucG9wb3ZlcignbWV0aG9kJykgKi8gXHJcbiAgICAgICAgY2FsbDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHRoaXMuJGVsZW1lbnRbdGhpcy5jb250YWluZXJOYW1lXS5hcHBseSh0aGlzLiRlbGVtZW50LCBhcmd1bWVudHMpOyBcclxuICAgICAgICB9LCAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgaW5pdENvbnRhaW5lcjogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdGhpcy5jYWxsKHRoaXMuY29udGFpbmVyT3B0aW9ucyk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgcmVuZGVyRm9ybTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHRoaXMuJGZvcm1cclxuICAgICAgICAgICAgLmVkaXRhYmxlZm9ybSh0aGlzLmZvcm1PcHRpb25zKVxyXG4gICAgICAgICAgICAub24oe1xyXG4gICAgICAgICAgICAgICAgc2F2ZTogJC5wcm94eSh0aGlzLnNhdmUsIHRoaXMpLCAvL2NsaWNrIG9uIHN1Ym1pdCBidXR0b24gKHZhbHVlIGNoYW5nZWQpXHJcbiAgICAgICAgICAgICAgICBub2NoYW5nZTogJC5wcm94eShmdW5jdGlvbigpeyB0aGlzLmhpZGUoJ25vY2hhbmdlJyk7IH0sIHRoaXMpLCAvL2NsaWNrIG9uIHN1Ym1pdCBidXR0b24gKHZhbHVlIE5PVCBjaGFuZ2VkKSAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGNhbmNlbDogJC5wcm94eShmdW5jdGlvbigpeyB0aGlzLmhpZGUoJ2NhbmNlbCcpOyB9LCB0aGlzKSwgLy9jbGljayBvbiBjYWxjZWwgYnV0dG9uXHJcbiAgICAgICAgICAgICAgICBzaG93OiAkLnByb3h5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuZGVsYXllZEhpZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKHRoaXMuZGVsYXllZEhpZGUucmVhc29uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWxheWVkSGlkZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCB0aGlzKSwgLy9yZS1wb3NpdGlvbiBjb250YWluZXIgZXZlcnkgdGltZSBmb3JtIGlzIHNob3duIChvY2N1cnMgZWFjaCB0aW1lIGFmdGVyIGxvYWRpbmcgc3RhdGUpXHJcbiAgICAgICAgICAgICAgICByZW5kZXJpbmc6ICQucHJveHkodGhpcy5zZXRQb3NpdGlvbiwgdGhpcyksIC8vdGhpcyBhbGxvd3MgdG8gcGxhY2UgY29udGFpbmVyIGNvcnJlY3RseSB3aGVuIGxvYWRpbmcgc2hvd25cclxuICAgICAgICAgICAgICAgIHJlc2l6ZTogJC5wcm94eSh0aGlzLnNldFBvc2l0aW9uLCB0aGlzKSwgLy90aGlzIGFsbG93cyB0byByZS1wb3NpdGlvbiBjb250YWluZXIgd2hlbiBmb3JtIHNpemUgaXMgY2hhbmdlZCBcclxuICAgICAgICAgICAgICAgIHJlbmRlcmVkOiAkLnByb3h5KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgLyoqICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBGaXJlZCB3aGVuIGNvbnRhaW5lciBpcyBzaG93biBhbmQgZm9ybSBpcyByZW5kZXJlZCAoZm9yIHNlbGVjdCB3aWxsIHdhaXQgZm9yIGxvYWRpbmcgZHJvcGRvd24gb3B0aW9ucykuICBcclxuICAgICAgICAgICAgICAgICAgICAqKk5vdGU6KiogQm9vdHN0cmFwIHBvcG92ZXIgaGFzIG93biBgc2hvd25gIGV2ZW50IHRoYXQgbm93IGNhbm5vdCBiZSBzZXBhcmF0ZWQgZnJvbSB4LWVkaXRhYmxlJ3Mgb25lLlxyXG4gICAgICAgICAgICAgICAgICAgIFRoZSB3b3JrYXJvdW5kIGlzIHRvIGNoZWNrIGBhcmd1bWVudHMubGVuZ3RoYCB0aGF0IGlzIGFsd2F5cyBgMmAgZm9yIHgtZWRpdGFibGUuICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgQGV2ZW50IHNob3duIFxyXG4gICAgICAgICAgICAgICAgICAgIEBwYXJhbSB7T2JqZWN0fSBldmVudCBldmVudCBvYmplY3RcclxuICAgICAgICAgICAgICAgICAgICBAZXhhbXBsZVxyXG4gICAgICAgICAgICAgICAgICAgICQoJyN1c2VybmFtZScpLm9uKCdzaG93bicsIGZ1bmN0aW9uKGUsIGVkaXRhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRhYmxlLmlucHV0LiRpbnB1dC52YWwoJ292ZXJ3cml0aW5nIHZhbHVlIG9mIGlucHV0Li4nKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTsgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAqKi8gICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLypcclxuICAgICAgICAgICAgICAgICAgICAgVE9ETzogYWRkZWQgc2Vjb25kIHBhcmFtIG1haW5seSB0byBkaXN0aW5ndWlzaCBmcm9tIGJvb3RzdHJhcCdzIHNob3duIGV2ZW50LiBJdCdzIGEgaG90Zml4IHRoYXQgd2lsbCBiZSBzb2x2ZWQgaW4gZnV0dXJlIHZlcnNpb25zIHZpYSBuYW1lc3BhY2VkIGV2ZW50cy4gIFxyXG4gICAgICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VySGFuZGxlcignc2hvd24nLCAkKHRoaXMub3B0aW9ucy5zY29wZSkuZGF0YSgnZWRpdGFibGUnKSk7IFxyXG4gICAgICAgICAgICAgICAgfSwgdGhpcykgXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5lZGl0YWJsZWZvcm0oJ3JlbmRlcicpO1xyXG4gICAgICAgIH0sICAgICAgICBcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgU2hvd3MgY29udGFpbmVyIHdpdGggZm9ybVxyXG4gICAgICAgIEBtZXRob2Qgc2hvdygpXHJcbiAgICAgICAgQHBhcmFtIHtib29sZWFufSBjbG9zZUFsbCBXaGV0aGVyIHRvIGNsb3NlIGFsbCBvdGhlciBlZGl0YWJsZSBjb250YWluZXJzIHdoZW4gc2hvd2luZyB0aGlzIG9uZS4gRGVmYXVsdCB0cnVlLlxyXG4gICAgICAgICoqL1xyXG4gICAgICAgIC8qIE5vdGU6IHBvc2h5dGlwIG93ZXJ3cml0ZXMgdGhpcyBtZXRob2QgdG90YWxseSEgKi8gICAgICAgICAgXHJcbiAgICAgICAgc2hvdzogZnVuY3Rpb24gKGNsb3NlQWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQuYWRkQ2xhc3MoJ2VkaXRhYmxlLW9wZW4nKTtcclxuICAgICAgICAgICAgaWYoY2xvc2VBbGwgIT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAvL2Nsb3NlIGFsbCBvcGVuIGNvbnRhaW5lcnMgKGV4Y2VwdCB0aGlzKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZU90aGVycyh0aGlzLiRlbGVtZW50WzBdKTsgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL3Nob3cgY29udGFpbmVyIGl0c2VsZlxyXG4gICAgICAgICAgICB0aGlzLmlubmVyU2hvdygpO1xyXG4gICAgICAgICAgICB0aGlzLnRpcCgpLmFkZENsYXNzKHRoaXMuY29udGFpbmVyQ2xhc3MpO1xyXG5cclxuICAgICAgICAgICAgLypcclxuICAgICAgICAgICAgQ3VycmVudGx5LCBmb3JtIGlzIHJlLXJlbmRlcmVkIG9uIGV2ZXJ5IHNob3cuIFxyXG4gICAgICAgICAgICBUaGUgbWFpbiByZWFzb24gaXMgdGhhdCB3ZSBkb250IGtub3csIHdoYXQgd2lsbCBjb250YWluZXIgZG8gd2l0aCBjb250ZW50IHdoZW4gY2xvc2VkOlxyXG4gICAgICAgICAgICByZW1vdmUoKSwgZGV0YWNoKCkgb3IganVzdCBoaWRlKCkgLSBpdCBkZXBlbmRzIG9uIGNvbnRhaW5lci5cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIERldGFjaGluZyBmb3JtIGl0c2VsZiBiZWZvcmUgaGlkZSBhbmQgcmUtaW5zZXJ0IGJlZm9yZSBzaG93IGlzIGdvb2Qgc29sdXRpb24sIFxyXG4gICAgICAgICAgICBidXQgdmlzdWFsbHkgaXQgbG9va3MgdWdseSAtLT4gY29udGFpbmVyIGNoYW5nZXMgc2l6ZSBiZWZvcmUgaGlkZS4gIFxyXG4gICAgICAgICAgICAqLyAgICAgICAgICAgICBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vaWYgZm9ybSBhbHJlYWR5IGV4aXN0IC0gZGVsZXRlIHByZXZpb3VzIGRhdGEgXHJcbiAgICAgICAgICAgIGlmKHRoaXMuJGZvcm0pIHtcclxuICAgICAgICAgICAgICAgIC8vdG9kbzogZGVzdHJveSBwcmV2IGRhdGEhXHJcbiAgICAgICAgICAgICAgICAvL3RoaXMuJGZvcm0uZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLiRmb3JtID0gJCgnPGRpdj4nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vaW5zZXJ0IGZvcm0gaW50byBjb250YWluZXIgYm9keVxyXG4gICAgICAgICAgICBpZih0aGlzLnRpcCgpLmlzKHRoaXMuaW5uZXJDc3MpKSB7XHJcbiAgICAgICAgICAgICAgICAvL2ZvciBpbmxpbmUgY29udGFpbmVyXHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpcCgpLmFwcGVuZCh0aGlzLiRmb3JtKTsgXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpcCgpLmZpbmQodGhpcy5pbm5lckNzcykuYXBwZW5kKHRoaXMuJGZvcm0pO1xyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9yZW5kZXIgZm9ybVxyXG4gICAgICAgICAgICB0aGlzLnJlbmRlckZvcm0oKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICBIaWRlcyBjb250YWluZXIgd2l0aCBmb3JtXHJcbiAgICAgICAgQG1ldGhvZCBoaWRlKClcclxuICAgICAgICBAcGFyYW0ge3N0cmluZ30gcmVhc29uIFJlYXNvbiBjYXVzZWQgaGlkaW5nLiBDYW4gYmUgPGNvZGU+c2F2ZXxjYW5jZWx8b25ibHVyfG5vY2hhbmdlfHVuZGVmaW5lZCAoPW1hbnVhbCk8L2NvZGU+XHJcbiAgICAgICAgKiovICAgICAgICAgXHJcbiAgICAgICAgaGlkZTogZnVuY3Rpb24ocmVhc29uKSB7ICBcclxuICAgICAgICAgICAgaWYoIXRoaXMudGlwKCkgfHwgIXRoaXMudGlwKCkuaXMoJzp2aXNpYmxlJykgfHwgIXRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ2VkaXRhYmxlLW9wZW4nKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2lmIGZvcm0gaXMgc2F2aW5nIHZhbHVlLCBzY2hlZHVsZSBoaWRlXHJcbiAgICAgICAgICAgIGlmKHRoaXMuJGZvcm0uZGF0YSgnZWRpdGFibGVmb3JtJykuaXNTYXZpbmcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVsYXllZEhpZGUgPSB7cmVhc29uOiByZWFzb259O1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuOyAgICBcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVsYXllZEhpZGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcygnZWRpdGFibGUtb3BlbicpOyAgIFxyXG4gICAgICAgICAgICB0aGlzLmlubmVySGlkZSgpO1xyXG5cclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgIEZpcmVkIHdoZW4gY29udGFpbmVyIHdhcyBoaWRkZW4uIEl0IG9jY3VycyBvbiBib3RoIHNhdmUgb3IgY2FuY2VsLiAgXHJcbiAgICAgICAgICAgICoqTm90ZToqKiBCb290c3RyYXAgcG9wb3ZlciBoYXMgb3duIGBoaWRkZW5gIGV2ZW50IHRoYXQgbm93IGNhbm5vdCBiZSBzZXBhcmF0ZWQgZnJvbSB4LWVkaXRhYmxlJ3Mgb25lLlxyXG4gICAgICAgICAgICBUaGUgd29ya2Fyb3VuZCBpcyB0byBjaGVjayBgYXJndW1lbnRzLmxlbmd0aGAgdGhhdCBpcyBhbHdheXMgYDJgIGZvciB4LWVkaXRhYmxlLiBcclxuXHJcbiAgICAgICAgICAgIEBldmVudCBoaWRkZW4gXHJcbiAgICAgICAgICAgIEBwYXJhbSB7b2JqZWN0fSBldmVudCBldmVudCBvYmplY3RcclxuICAgICAgICAgICAgQHBhcmFtIHtzdHJpbmd9IHJlYXNvbiBSZWFzb24gY2F1c2VkIGhpZGluZy4gQ2FuIGJlIDxjb2RlPnNhdmV8Y2FuY2VsfG9uYmx1cnxub2NoYW5nZXxtYW51YWw8L2NvZGU+XHJcbiAgICAgICAgICAgIEBleGFtcGxlXHJcbiAgICAgICAgICAgICQoJyN1c2VybmFtZScpLm9uKCdoaWRkZW4nLCBmdW5jdGlvbihlLCByZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGlmKHJlYXNvbiA9PT0gJ3NhdmUnIHx8IHJlYXNvbiA9PT0gJ2NhbmNlbCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2F1dG8tb3BlbiBuZXh0IGVkaXRhYmxlXHJcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCd0cicpLm5leHQoKS5maW5kKCcuZWRpdGFibGUnKS5lZGl0YWJsZSgnc2hvdycpO1xyXG4gICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICoqL1xyXG4gICAgICAgICAgICB0aGlzLiRlbGVtZW50LnRyaWdnZXJIYW5kbGVyKCdoaWRkZW4nLCByZWFzb24gfHwgJ21hbnVhbCcpOyAgIFxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qIGludGVybmFsIHNob3cgbWV0aG9kLiBUbyBiZSBvdmVyd3JpdHRlbiBpbiBjaGlsZCBjbGFzc2VzICovXHJcbiAgICAgICAgaW5uZXJTaG93OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICBcclxuICAgICAgICB9LCAgICAgICAgXHJcblxyXG4gICAgICAgIC8qIGludGVybmFsIGhpZGUgbWV0aG9kLiBUbyBiZSBvdmVyd3JpdHRlbiBpbiBjaGlsZCBjbGFzc2VzICovXHJcbiAgICAgICAgaW5uZXJIaWRlOiBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgVG9nZ2xlcyBjb250YWluZXIgdmlzaWJpbGl0eSAoc2hvdyAvIGhpZGUpXHJcbiAgICAgICAgQG1ldGhvZCB0b2dnbGUoKVxyXG4gICAgICAgIEBwYXJhbSB7Ym9vbGVhbn0gY2xvc2VBbGwgV2hldGhlciB0byBjbG9zZSBhbGwgb3RoZXIgZWRpdGFibGUgY29udGFpbmVycyB3aGVuIHNob3dpbmcgdGhpcyBvbmUuIERlZmF1bHQgdHJ1ZS5cclxuICAgICAgICAqKi8gICAgICAgICAgXHJcbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbihjbG9zZUFsbCkge1xyXG4gICAgICAgICAgICBpZih0aGlzLmNvbnRhaW5lcigpICYmIHRoaXMudGlwKCkgJiYgdGhpcy50aXAoKS5pcygnOnZpc2libGUnKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNob3coY2xvc2VBbGwpO1xyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgVXBkYXRlcyB0aGUgcG9zaXRpb24gb2YgY29udGFpbmVyIHdoZW4gY29udGVudCBjaGFuZ2VkLlxyXG4gICAgICAgIEBtZXRob2Qgc2V0UG9zaXRpb24oKVxyXG4gICAgICAgICovICAgICAgIFxyXG4gICAgICAgIHNldFBvc2l0aW9uOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy90YmQgaW4gY2hpbGQgY2xhc3NcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBzYXZlOiBmdW5jdGlvbihlLCBwYXJhbXMpIHtcclxuICAgICAgICAgICAgLyoqICAgICAgICBcclxuICAgICAgICAgICAgRmlyZWQgd2hlbiBuZXcgdmFsdWUgd2FzIHN1Ym1pdHRlZC4gWW91IGNhbiB1c2UgPGNvZGU+JCh0aGlzKS5kYXRhKCdlZGl0YWJsZUNvbnRhaW5lcicpPC9jb2RlPiBpbnNpZGUgaGFuZGxlciB0byBhY2Nlc3MgdG8gZWRpdGFibGVDb250YWluZXIgaW5zdGFuY2VcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIEBldmVudCBzYXZlIFxyXG4gICAgICAgICAgICBAcGFyYW0ge09iamVjdH0gZXZlbnQgZXZlbnQgb2JqZWN0XHJcbiAgICAgICAgICAgIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXMgYWRkaXRpb25hbCBwYXJhbXNcclxuICAgICAgICAgICAgQHBhcmFtIHttaXhlZH0gcGFyYW1zLm5ld1ZhbHVlIHN1Ym1pdHRlZCB2YWx1ZVxyXG4gICAgICAgICAgICBAcGFyYW0ge09iamVjdH0gcGFyYW1zLnJlc3BvbnNlIGFqYXggcmVzcG9uc2VcclxuICAgICAgICAgICAgQGV4YW1wbGVcclxuICAgICAgICAgICAgJCgnI3VzZXJuYW1lJykub24oJ3NhdmUnLCBmdW5jdGlvbihlLCBwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgIC8vYXNzdW1pbmcgc2VydmVyIHJlc3BvbnNlOiAne3N1Y2Nlc3M6IHRydWV9J1xyXG4gICAgICAgICAgICAgICAgdmFyIHBrID0gJCh0aGlzKS5kYXRhKCdlZGl0YWJsZUNvbnRhaW5lcicpLm9wdGlvbnMucGs7XHJcbiAgICAgICAgICAgICAgICBpZihwYXJhbXMucmVzcG9uc2UgJiYgcGFyYW1zLnJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbGVydCgndmFsdWU6ICcgKyBwYXJhbXMubmV3VmFsdWUgKyAnIHdpdGggcGs6ICcgKyBwayArICcgc2F2ZWQhJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdlcnJvciEnKTsgXHJcbiAgICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgKiovICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLiRlbGVtZW50LnRyaWdnZXJIYW5kbGVyKCdzYXZlJywgcGFyYW1zKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vaGlkZSBtdXN0IGJlIGFmdGVyIHRyaWdnZXIsIGFzIHNhdmluZyB2YWx1ZSBtYXkgcmVxdWlyZSBtZXRob2RzIG9mIHBsdWdpbiwgYXBwbGllZCB0byBpbnB1dFxyXG4gICAgICAgICAgICB0aGlzLmhpZGUoJ3NhdmUnKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICBTZXRzIG5ldyBvcHRpb25cclxuICAgICAgICBcclxuICAgICAgICBAbWV0aG9kIG9wdGlvbihrZXksIHZhbHVlKVxyXG4gICAgICAgIEBwYXJhbSB7c3RyaW5nfSBrZXkgXHJcbiAgICAgICAgQHBhcmFtIHttaXhlZH0gdmFsdWUgXHJcbiAgICAgICAgKiovICAgICAgICAgXHJcbiAgICAgICAgb3B0aW9uOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9uc1trZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgIGlmKGtleSBpbiB0aGlzLmNvbnRhaW5lck9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyT3B0aW9uc1trZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldENvbnRhaW5lck9wdGlvbihrZXksIHZhbHVlKTsgXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1PcHRpb25zW2tleV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuJGZvcm0pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRmb3JtLmVkaXRhYmxlZm9ybSgnb3B0aW9uJywga2V5LCB2YWx1ZSk7ICBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAgc2V0Q29udGFpbmVyT3B0aW9uOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FsbCgnb3B0aW9uJywga2V5LCB2YWx1ZSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgRGVzdHJveXMgdGhlIGNvbnRhaW5lciBpbnN0YW5jZVxyXG4gICAgICAgIEBtZXRob2QgZGVzdHJveSgpXHJcbiAgICAgICAgKiovICAgICAgICBcclxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5uZXJEZXN0cm95KCk7XHJcbiAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQub2ZmKCdkZXN0cm95ZWQnKTtcclxuICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5yZW1vdmVEYXRhKCdlZGl0YWJsZUNvbnRhaW5lcicpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAgLyogdG8gYmUgb3ZlcndyaXR0ZW4gaW4gY2hpbGQgY2xhc3NlcyAqL1xyXG4gICAgICAgIGlubmVyRGVzdHJveTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH0sIFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgQ2xvc2VzIG90aGVyIGNvbnRhaW5lcnMgZXhjZXB0IG9uZSByZWxhdGVkIHRvIHBhc3NlZCBlbGVtZW50LiBcclxuICAgICAgICBPdGhlciBjb250YWluZXJzIGNhbiBiZSBjYW5jZWxsZWQgb3Igc3VibWl0dGVkIChkZXBlbmRzIG9uIG9uYmx1ciBvcHRpb24pXHJcbiAgICAgICAgKi9cclxuICAgICAgICBjbG9zZU90aGVyczogZnVuY3Rpb24oZWxlbWVudCkge1xyXG4gICAgICAgICAgICAkKCcuZWRpdGFibGUtb3BlbicpLmVhY2goZnVuY3Rpb24oaSwgZWwpe1xyXG4gICAgICAgICAgICAgICAgLy9kbyBub3RoaW5nIHdpdGggcGFzc2VkIGVsZW1lbnQgYW5kIGl0J3MgY2hpbGRyZW5cclxuICAgICAgICAgICAgICAgIGlmKGVsID09PSBlbGVtZW50IHx8ICQoZWwpLmZpbmQoZWxlbWVudCkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vb3RoZXJ3aXNlIGNhbmNlbCBvciBzdWJtaXQgYWxsIG9wZW4gY29udGFpbmVycyBcclxuICAgICAgICAgICAgICAgIHZhciAkZWwgPSAkKGVsKSxcclxuICAgICAgICAgICAgICAgIGVjID0gJGVsLmRhdGEoJ2VkaXRhYmxlQ29udGFpbmVyJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoIWVjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmKGVjLm9wdGlvbnMub25ibHVyID09PSAnY2FuY2VsJykge1xyXG4gICAgICAgICAgICAgICAgICAgICRlbC5kYXRhKCdlZGl0YWJsZUNvbnRhaW5lcicpLmhpZGUoJ29uYmx1cicpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKGVjLm9wdGlvbnMub25ibHVyID09PSAnc3VibWl0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICRlbC5kYXRhKCdlZGl0YWJsZUNvbnRhaW5lcicpLnRpcCgpLmZpbmQoJ2Zvcm0nKS5zdWJtaXQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgQWN0aXZhdGVzIGlucHV0IG9mIHZpc2libGUgY29udGFpbmVyIChlLmcuIHNldCBmb2N1cylcclxuICAgICAgICBAbWV0aG9kIGFjdGl2YXRlKClcclxuICAgICAgICAqKi8gICAgICAgICBcclxuICAgICAgICBhY3RpdmF0ZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmKHRoaXMudGlwICYmIHRoaXMudGlwKCkuaXMoJzp2aXNpYmxlJykgJiYgdGhpcy4kZm9ybSkge1xyXG4gICAgICAgICAgICAgICB0aGlzLiRmb3JtLmRhdGEoJ2VkaXRhYmxlZm9ybScpLmlucHV0LmFjdGl2YXRlKCk7IFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgalF1ZXJ5IG1ldGhvZCB0byBpbml0aWFsaXplIGVkaXRhYmxlQ29udGFpbmVyLlxyXG4gICAgXHJcbiAgICBAbWV0aG9kICQoKS5lZGl0YWJsZUNvbnRhaW5lcihvcHRpb25zKVxyXG4gICAgQHBhcmFtcyB7T2JqZWN0fSBvcHRpb25zXHJcbiAgICBAZXhhbXBsZVxyXG4gICAgJCgnI2VkaXQnKS5lZGl0YWJsZUNvbnRhaW5lcih7XHJcbiAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgIHVybDogJy9wb3N0JyxcclxuICAgICAgICBwazogMSxcclxuICAgICAgICB2YWx1ZTogJ2hlbGxvJ1xyXG4gICAgfSk7XHJcbiAgICAqKi8gIFxyXG4gICAgJC5mbi5lZGl0YWJsZUNvbnRhaW5lciA9IGZ1bmN0aW9uIChvcHRpb24pIHtcclxuICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSxcclxuICAgICAgICAgICAgZGF0YUtleSA9ICdlZGl0YWJsZUNvbnRhaW5lcicsIFxyXG4gICAgICAgICAgICBkYXRhID0gJHRoaXMuZGF0YShkYXRhS2V5KSxcclxuICAgICAgICAgICAgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT09ICdvYmplY3QnICYmIG9wdGlvbixcclxuICAgICAgICAgICAgQ29uc3RydWN0b3IgPSAob3B0aW9ucy5tb2RlID09PSAnaW5saW5lJykgPyBJbmxpbmUgOiBQb3B1cDsgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgICAgICAgICR0aGlzLmRhdGEoZGF0YUtleSwgKGRhdGEgPSBuZXcgQ29uc3RydWN0b3IodGhpcywgb3B0aW9ucykpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT09ICdzdHJpbmcnKSB7IC8vY2FsbCBtZXRob2QgXHJcbiAgICAgICAgICAgICAgICBkYXRhW29wdGlvbl0uYXBwbHkoZGF0YSwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJncywgMSkpO1xyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgXHJcbiAgICAgICAgfSk7XHJcbiAgICB9OyAgICAgXHJcblxyXG4gICAgLy9zdG9yZSBjb25zdHJ1Y3RvcnNcclxuICAgICQuZm4uZWRpdGFibGVDb250YWluZXIuUG9wdXAgPSBQb3B1cDtcclxuICAgICQuZm4uZWRpdGFibGVDb250YWluZXIuSW5saW5lID0gSW5saW5lO1xyXG5cclxuICAgIC8vZGVmYXVsdHNcclxuICAgICQuZm4uZWRpdGFibGVDb250YWluZXIuZGVmYXVsdHMgPSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgSW5pdGlhbCB2YWx1ZSBvZiBmb3JtIGlucHV0XHJcblxyXG4gICAgICAgIEBwcm9wZXJ0eSB2YWx1ZSBcclxuICAgICAgICBAdHlwZSBtaXhlZFxyXG4gICAgICAgIEBkZWZhdWx0IG51bGxcclxuICAgICAgICBAcHJpdmF0ZVxyXG4gICAgICAgICoqLyAgICAgICAgXHJcbiAgICAgICAgdmFsdWU6IG51bGwsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgUGxhY2VtZW50IG9mIGNvbnRhaW5lciByZWxhdGl2ZSB0byBlbGVtZW50LiBDYW4gYmUgPGNvZGU+dG9wfHJpZ2h0fGJvdHRvbXxsZWZ0PC9jb2RlPi4gTm90IHVzZWQgZm9yIGlubGluZSBjb250YWluZXIuXHJcblxyXG4gICAgICAgIEBwcm9wZXJ0eSBwbGFjZW1lbnQgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nXHJcbiAgICAgICAgQGRlZmF1bHQgJ3RvcCdcclxuICAgICAgICAqKi8gICAgICAgIFxyXG4gICAgICAgIHBsYWNlbWVudDogJ3RvcCcsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgV2hldGhlciB0byBoaWRlIGNvbnRhaW5lciBvbiBzYXZlL2NhbmNlbC5cclxuXHJcbiAgICAgICAgQHByb3BlcnR5IGF1dG9oaWRlIFxyXG4gICAgICAgIEB0eXBlIGJvb2xlYW5cclxuICAgICAgICBAZGVmYXVsdCB0cnVlXHJcbiAgICAgICAgQHByaXZhdGUgXHJcbiAgICAgICAgKiovICAgICAgICBcclxuICAgICAgICBhdXRvaGlkZTogdHJ1ZSxcclxuICAgICAgICAvKipcclxuICAgICAgICBBY3Rpb24gd2hlbiB1c2VyIGNsaWNrcyBvdXRzaWRlIHRoZSBjb250YWluZXIuIENhbiBiZSA8Y29kZT5jYW5jZWx8c3VibWl0fGlnbm9yZTwvY29kZT4uICBcclxuICAgICAgICBTZXR0aW5nIDxjb2RlPmlnbm9yZTwvY29kZT4gYWxsb3dzIHRvIGhhdmUgc2V2ZXJhbCBjb250YWluZXJzIG9wZW4uIFxyXG5cclxuICAgICAgICBAcHJvcGVydHkgb25ibHVyIFxyXG4gICAgICAgIEB0eXBlIHN0cmluZ1xyXG4gICAgICAgIEBkZWZhdWx0ICdjYW5jZWwnXHJcbiAgICAgICAgQHNpbmNlIDEuMS4xXHJcbiAgICAgICAgKiovICAgICAgICBcclxuICAgICAgICBvbmJsdXI6ICdjYW5jZWwnLFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEFuaW1hdGlvbiBzcGVlZCAoaW5saW5lIG1vZGUgb25seSlcclxuICAgICAgICBAcHJvcGVydHkgYW5pbSBcclxuICAgICAgICBAdHlwZSBzdHJpbmdcclxuICAgICAgICBAZGVmYXVsdCBmYWxzZVxyXG4gICAgICAgICoqLyAgICAgICAgXHJcbiAgICAgICAgYW5pbTogZmFsc2UsXHJcbiAgICAgICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgTW9kZSBvZiBlZGl0YWJsZSwgY2FuIGJlIGBwb3B1cGAgb3IgYGlubGluZWAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgQHByb3BlcnR5IG1vZGUgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nICAgICAgICAgXHJcbiAgICAgICAgQGRlZmF1bHQgJ3BvcHVwJ1xyXG4gICAgICAgIEBzaW5jZSAxLjQuMCAgICAgICAgXHJcbiAgICAgICAgKiovICAgICAgICBcclxuICAgICAgICBtb2RlOiAncG9wdXAnICAgICAgICBcclxuICAgIH07XHJcblxyXG4gICAgLyogXHJcbiAgICAqIHdvcmthcm91bmQgdG8gaGF2ZSAnZGVzdHJveWVkJyBldmVudCB0byBkZXN0cm95IHBvcG92ZXIgd2hlbiBlbGVtZW50IGlzIGRlc3Ryb3llZFxyXG4gICAgKiBzZWUgaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yMjAwNDk0L2pxdWVyeS10cmlnZ2VyLWV2ZW50LXdoZW4tYW4tZWxlbWVudC1pcy1yZW1vdmVkLWZyb20tdGhlLWRvbVxyXG4gICAgKi9cclxuICAgIGpRdWVyeS5ldmVudC5zcGVjaWFsLmRlc3Ryb3llZCA9IHtcclxuICAgICAgICByZW1vdmU6IGZ1bmN0aW9uKG8pIHtcclxuICAgICAgICAgICAgaWYgKG8uaGFuZGxlcikge1xyXG4gICAgICAgICAgICAgICAgby5oYW5kbGVyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9OyAgICBcclxuXHJcbn0od2luZG93LmpRdWVyeSkpO1xyXG5cclxuLyoqXHJcbiogRWRpdGFibGUgSW5saW5lIFxyXG4qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4qL1xyXG4oZnVuY3Rpb24gKCQpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgXHJcbiAgICAvL2NvcHkgcHJvdG90eXBlIGZyb20gRWRpdGFibGVDb250YWluZXJcclxuICAgIC8vZXh0ZW5kIG1ldGhvZHNcclxuICAgICQuZXh0ZW5kKCQuZm4uZWRpdGFibGVDb250YWluZXIuSW5saW5lLnByb3RvdHlwZSwgJC5mbi5lZGl0YWJsZUNvbnRhaW5lci5Qb3B1cC5wcm90b3R5cGUsIHtcclxuICAgICAgICBjb250YWluZXJOYW1lOiAnZWRpdGFibGVmb3JtJyxcclxuICAgICAgICBpbm5lckNzczogJy5lZGl0YWJsZS1pbmxpbmUnLFxyXG4gICAgICAgIGNvbnRhaW5lckNsYXNzOiAnZWRpdGFibGUtY29udGFpbmVyIGVkaXRhYmxlLWlubGluZScsIC8vY3NzIGNsYXNzIGFwcGxpZWQgdG8gY29udGFpbmVyIGVsZW1lbnRcclxuICAgICAgICAgICAgICAgICBcclxuICAgICAgICBpbml0Q29udGFpbmVyOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAvL2NvbnRhaW5lciBpcyA8c3Bhbj4gZWxlbWVudFxyXG4gICAgICAgICAgICB0aGlzLiR0aXAgPSAkKCc8c3Bhbj48L3NwYW4+Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2NvbnZlcnQgYW5pbSB0byBtaWxpc2Vjb25kcyAoaW50KVxyXG4gICAgICAgICAgICBpZighdGhpcy5vcHRpb25zLmFuaW0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hbmltID0gMDtcclxuICAgICAgICAgICAgfSAgICAgICAgIFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAgc3BsaXRPcHRpb25zOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy9hbGwgb3B0aW9ucyBhcmUgcGFzc2VkIHRvIGZvcm1cclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXJPcHRpb25zID0ge307XHJcbiAgICAgICAgICAgIHRoaXMuZm9ybU9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICB0aXA6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgIHJldHVybiB0aGlzLiR0aXA7IFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAgaW5uZXJTaG93OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQuaGlkZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnRpcCgpLmluc2VydEFmdGVyKHRoaXMuJGVsZW1lbnQpLnNob3coKTtcclxuICAgICAgICB9LCBcclxuICAgICAgICBcclxuICAgICAgICBpbm5lckhpZGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdGhpcy4kdGlwLmhpZGUodGhpcy5vcHRpb25zLmFuaW0sICQucHJveHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50LnNob3coKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5uZXJEZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH0sIHRoaXMpKTsgXHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICBpbm5lckRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZih0aGlzLnRpcCgpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpcCgpLmVtcHR5KCkucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IFxyXG4gICAgfSk7XHJcblxyXG59KHdpbmRvdy5qUXVlcnkpKTtcclxuLyoqXHJcbk1ha2VzIGVkaXRhYmxlIGFueSBIVE1MIGVsZW1lbnQgb24gdGhlIHBhZ2UuIEFwcGxpZWQgYXMgalF1ZXJ5IG1ldGhvZC5cclxuXHJcbkBjbGFzcyBlZGl0YWJsZVxyXG5AdXNlcyBlZGl0YWJsZUNvbnRhaW5lclxyXG4qKi9cclxuKGZ1bmN0aW9uICgkKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgRWRpdGFibGUgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucykge1xyXG4gICAgICAgIHRoaXMuJGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xyXG4gICAgICAgIC8vZGF0YS0qIGhhcyBtb3JlIHByaW9yaXR5IG92ZXIganMgb3B0aW9uczogYmVjYXVzZSBkeW5hbWljYWxseSBjcmVhdGVkIGVsZW1lbnRzIG1heSBjaGFuZ2UgZGF0YS0qIFxyXG4gICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCAkLmZuLmVkaXRhYmxlLmRlZmF1bHRzLCBvcHRpb25zLCAkLmZuLmVkaXRhYmxldXRpbHMuZ2V0Q29uZmlnRGF0YSh0aGlzLiRlbGVtZW50KSk7ICBcclxuICAgICAgICBpZih0aGlzLm9wdGlvbnMuc2VsZWN0b3IpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0TGl2ZSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvL2NoZWNrIGZvciB0cmFuc2l0aW9uIHN1cHBvcnRcclxuICAgICAgICBpZih0aGlzLm9wdGlvbnMuaGlnaGxpZ2h0ICYmICEkLmZuLmVkaXRhYmxldXRpbHMuc3VwcG9ydHNUcmFuc2l0aW9ucygpKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5oaWdobGlnaHQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIEVkaXRhYmxlLnByb3RvdHlwZSA9IHtcclxuICAgICAgICBjb25zdHJ1Y3RvcjogRWRpdGFibGUsIFxyXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGlzVmFsdWVCeVRleHQgPSBmYWxzZSwgXHJcbiAgICAgICAgICAgICAgICBkb0F1dG90ZXh0LCBmaW5hbGl6ZTtcclxuXHJcbiAgICAgICAgICAgIC8vbmFtZVxyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubmFtZSA9IHRoaXMub3B0aW9ucy5uYW1lIHx8IHRoaXMuJGVsZW1lbnQuYXR0cignaWQnKTtcclxuICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2NyZWF0ZSBpbnB1dCBvZiBzcGVjaWZpZWQgdHlwZS4gSW5wdXQgbmVlZGVkIGFscmVhZHkgaGVyZSB0byBjb252ZXJ0IHZhbHVlIGZvciBpbml0aWFsIGRpc3BsYXkgKGUuZy4gc2hvdyB0ZXh0IGJ5IGlkIGZvciBzZWxlY3QpXHJcbiAgICAgICAgICAgIC8vYWxzbyB3ZSBzZXQgc2NvcGUgb3B0aW9uIHRvIGhhdmUgYWNjZXNzIHRvIGVsZW1lbnQgaW5zaWRlIGlucHV0IHNwZWNpZmljIGNhbGxiYWNrcyAoZS4gZy4gc291cmNlIGFzIGZ1bmN0aW9uKVxyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuc2NvcGUgPSB0aGlzLiRlbGVtZW50WzBdOyBcclxuICAgICAgICAgICAgdGhpcy5pbnB1dCA9ICQuZm4uZWRpdGFibGV1dGlscy5jcmVhdGVJbnB1dCh0aGlzLm9wdGlvbnMpO1xyXG4gICAgICAgICAgICBpZighdGhpcy5pbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuOyBcclxuICAgICAgICAgICAgfSAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgLy9zZXQgdmFsdWUgZnJvbSBzZXR0aW5ncyBvciBieSBlbGVtZW50J3MgdGV4dFxyXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnZhbHVlID09PSB1bmRlZmluZWQgfHwgdGhpcy5vcHRpb25zLnZhbHVlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5pbnB1dC5odG1sMnZhbHVlKCQudHJpbSh0aGlzLiRlbGVtZW50Lmh0bWwoKSkpO1xyXG4gICAgICAgICAgICAgICAgaXNWYWx1ZUJ5VGV4dCA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvKlxyXG4gICAgICAgICAgICAgICAgICB2YWx1ZSBjYW4gYmUgc3RyaW5nIHdoZW4gcmVjZWl2ZWQgZnJvbSAnZGF0YS12YWx1ZScgYXR0cmlidXRlXHJcbiAgICAgICAgICAgICAgICAgIGZvciBjb21wbGV4dCBvYmplY3RzIHZhbHVlIGNhbiBiZSBzZXQgYXMganNvbiBzdHJpbmcgaW4gZGF0YS12YWx1ZSBhdHRyaWJ1dGUsIFxyXG4gICAgICAgICAgICAgICAgICBlLmcuIGRhdGEtdmFsdWU9XCJ7Y2l0eTogJ01vc2NvdycsIHN0cmVldDogJ0xlbmluYSd9XCJcclxuICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMudmFsdWUgPSAkLmZuLmVkaXRhYmxldXRpbHMudHJ5UGFyc2VKc29uKHRoaXMub3B0aW9ucy52YWx1ZSwgdHJ1ZSk7IFxyXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIHRoaXMub3B0aW9ucy52YWx1ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5pbnB1dC5zdHIydmFsdWUodGhpcy5vcHRpb25zLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMub3B0aW9ucy52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9hZGQgJ2VkaXRhYmxlJyBjbGFzcyB0byBldmVyeSBlZGl0YWJsZSBlbGVtZW50XHJcbiAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQuYWRkQ2xhc3MoJ2VkaXRhYmxlJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL3NwZWNpZmljYWxseSBmb3IgXCJ0ZXh0YXJlYVwiIGFkZCBjbGFzcyAuZWRpdGFibGUtcHJlLXdyYXBwZWQgdG8ga2VlcCBsaW5lYnJlYWtzXHJcbiAgICAgICAgICAgIGlmKHRoaXMuaW5wdXQudHlwZSA9PT0gJ3RleHRhcmVhJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5hZGRDbGFzcygnZWRpdGFibGUtcHJlLXdyYXBwZWQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9hdHRhY2ggaGFuZGxlciBhY3RpdmF0aW5nIGVkaXRhYmxlLiBJbiBkaXNhYmxlZCBtb2RlIGl0IGp1c3QgcHJldmVudCBkZWZhdWx0IGFjdGlvbiAodXNlZnVsIGZvciBsaW5rcylcclxuICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLnRvZ2dsZSAhPT0gJ21hbnVhbCcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQuYWRkQ2xhc3MoJ2VkaXRhYmxlLWNsaWNrJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50Lm9uKHRoaXMub3B0aW9ucy50b2dnbGUgKyAnLmVkaXRhYmxlJywgJC5wcm94eShmdW5jdGlvbihlKXtcclxuICAgICAgICAgICAgICAgICAgICAvL3ByZXZlbnQgZm9sbG93aW5nIGxpbmsgaWYgZWRpdGFibGUgZW5hYmxlZFxyXG4gICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLm9wdGlvbnMuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvL3N0b3AgcHJvcGFnYXRpb24gbm90IHJlcXVpcmVkIGJlY2F1c2UgaW4gZG9jdW1lbnQgY2xpY2sgaGFuZGxlciBpdCBjaGVja3MgZXZlbnQgdGFyZ2V0XHJcbiAgICAgICAgICAgICAgICAgICAgLy9lLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMub3B0aW9ucy50b2dnbGUgPT09ICdtb3VzZWVudGVyJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2ZvciBob3ZlciBvbmx5IHNob3cgY29udGFpbmVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vd2hlbiB0b2dnbGU9J2NsaWNrJyB3ZSBzaG91bGQgbm90IGNsb3NlIGFsbCBvdGhlciBjb250YWluZXJzIGFzIHRoZXkgd2lsbCBiZSBjbG9zZWQgYXV0b21hdGljYWxseSBpbiBkb2N1bWVudCBjbGljayBsaXN0ZW5lclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xvc2VBbGwgPSAodGhpcy5vcHRpb25zLnRvZ2dsZSAhPT0gJ2NsaWNrJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlKGNsb3NlQWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCB0aGlzKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50LmF0dHIoJ3RhYmluZGV4JywgLTEpOyAvL2RvIG5vdCBzdG9wIGZvY3VzIG9uIGVsZW1lbnQgd2hlbiB0b2dnbGVkIG1hbnVhbGx5XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vaWYgZGlzcGxheSBpcyBmdW5jdGlvbiBpdCdzIGZhciBtb3JlIGNvbnZpbmllbnQgdG8gaGF2ZSBhdXRvdGV4dCA9IGFsd2F5cyB0byByZW5kZXIgY29ycmVjdGx5IG9uIGluaXRcclxuICAgICAgICAgICAgLy9zZWUgaHR0cHM6Ly9naXRodWIuY29tL3ZpdGFsZXRzL3gtZWRpdGFibGUteWlpL2lzc3Vlcy8zNFxyXG4gICAgICAgICAgICBpZih0eXBlb2YgdGhpcy5vcHRpb25zLmRpc3BsYXkgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hdXRvdGV4dCA9ICdhbHdheXMnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2NoZWNrIGNvbmRpdGlvbnMgZm9yIGF1dG90ZXh0OlxyXG4gICAgICAgICAgICBzd2l0Y2godGhpcy5vcHRpb25zLmF1dG90ZXh0KSB7XHJcbiAgICAgICAgICAgICAgY2FzZSAnYWx3YXlzJzpcclxuICAgICAgICAgICAgICAgZG9BdXRvdGV4dCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnYXV0byc6XHJcbiAgICAgICAgICAgICAgICAvL2lmIGVsZW1lbnQgdGV4dCBpcyBlbXB0eSBhbmQgdmFsdWUgaXMgZGVmaW5lZCBhbmQgdmFsdWUgbm90IGdlbmVyYXRlZCBieSB0ZXh0IC0tPiBydW4gYXV0b3RleHRcclxuICAgICAgICAgICAgICAgIGRvQXV0b3RleHQgPSAhJC50cmltKHRoaXMuJGVsZW1lbnQudGV4dCgpKS5sZW5ndGggJiYgdGhpcy52YWx1ZSAhPT0gbnVsbCAmJiB0aGlzLnZhbHVlICE9PSB1bmRlZmluZWQgJiYgIWlzVmFsdWVCeVRleHQ7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgZG9BdXRvdGV4dCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL2RlcGVuZGluZyBvbiBhdXRvdGV4dCBydW4gcmVuZGVyKCkgb3IganVzdCBmaW5pbGl6ZSBpbml0XHJcbiAgICAgICAgICAgICQud2hlbihkb0F1dG90ZXh0ID8gdGhpcy5yZW5kZXIoKSA6IHRydWUpLnRoZW4oJC5wcm94eShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMub3B0aW9ucy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpOyBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgLyoqICAgICAgICBcclxuICAgICAgICAgICAgICAgRmlyZWQgd2hlbiBlbGVtZW50IHdhcyBpbml0aWFsaXplZCBieSBgJCgpLmVkaXRhYmxlKClgIG1ldGhvZC4gXHJcbiAgICAgICAgICAgICAgIFBsZWFzZSBub3RlIHRoYXQgeW91IHNob3VsZCBzZXR1cCBgaW5pdGAgaGFuZGxlciAqKmJlZm9yZSoqIGFwcGx5aW5nIGBlZGl0YWJsZWAuIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgQGV2ZW50IGluaXQgXHJcbiAgICAgICAgICAgICAgIEBwYXJhbSB7T2JqZWN0fSBldmVudCBldmVudCBvYmplY3RcclxuICAgICAgICAgICAgICAgQHBhcmFtIHtPYmplY3R9IGVkaXRhYmxlIGVkaXRhYmxlIGluc3RhbmNlIChhcyBoZXJlIGl0IGNhbm5vdCBhY2Nlc3NlZCB2aWEgZGF0YSgnZWRpdGFibGUnKSlcclxuICAgICAgICAgICAgICAgQHNpbmNlIDEuMi4wXHJcbiAgICAgICAgICAgICAgIEBleGFtcGxlXHJcbiAgICAgICAgICAgICAgICQoJyN1c2VybmFtZScpLm9uKCdpbml0JywgZnVuY3Rpb24oZSwgZWRpdGFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdpbml0aWFsaXplZCAnICsgZWRpdGFibGUub3B0aW9ucy5uYW1lKTtcclxuICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICQoJyN1c2VybmFtZScpLmVkaXRhYmxlKCk7XHJcbiAgICAgICAgICAgICAgICoqLyAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VySGFuZGxlcignaW5pdCcsIHRoaXMpO1xyXG4gICAgICAgICAgICB9LCB0aGlzKSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgSW5pdGlhbGl6ZXMgcGFyZW50IGVsZW1lbnQgZm9yIGxpdmUgZWRpdGFibGVzIFxyXG4gICAgICAgICovXHJcbiAgICAgICAgaW5pdExpdmU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgIC8vc3RvcmUgc2VsZWN0b3IgXHJcbiAgICAgICAgICAgdmFyIHNlbGVjdG9yID0gdGhpcy5vcHRpb25zLnNlbGVjdG9yO1xyXG4gICAgICAgICAgIC8vbW9kaWZ5IG9wdGlvbnMgZm9yIGNoaWxkIGVsZW1lbnRzXHJcbiAgICAgICAgICAgdGhpcy5vcHRpb25zLnNlbGVjdG9yID0gZmFsc2U7IFxyXG4gICAgICAgICAgIHRoaXMub3B0aW9ucy5hdXRvdGV4dCA9ICduZXZlcic7XHJcbiAgICAgICAgICAgLy9saXN0ZW4gdG9nZ2xlIGV2ZW50c1xyXG4gICAgICAgICAgIHRoaXMuJGVsZW1lbnQub24odGhpcy5vcHRpb25zLnRvZ2dsZSArICcuZWRpdGFibGUnLCBzZWxlY3RvciwgJC5wcm94eShmdW5jdGlvbihlKXtcclxuICAgICAgICAgICAgICAgdmFyICR0YXJnZXQgPSAkKGUudGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgaWYoISR0YXJnZXQuZGF0YSgnZWRpdGFibGUnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgLy9pZiBkZWxlZ2F0ZWQgZWxlbWVudCBpbml0aWFsbHkgZW1wdHksIHdlIG5lZWQgdG8gY2xlYXIgaXQncyB0ZXh0ICh0aGF0IHdhcyBtYW51YWxseSBzZXQgdG8gYGVtcHR5YCBieSB1c2VyKVxyXG4gICAgICAgICAgICAgICAgICAgLy9zZWUgaHR0cHM6Ly9naXRodWIuY29tL3ZpdGFsZXRzL3gtZWRpdGFibGUvaXNzdWVzLzEzNyBcclxuICAgICAgICAgICAgICAgICAgIGlmKCR0YXJnZXQuaGFzQ2xhc3ModGhpcy5vcHRpb25zLmVtcHR5Y2xhc3MpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0LmVtcHR5KCk7XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAkdGFyZ2V0LmVkaXRhYmxlKHRoaXMub3B0aW9ucykudHJpZ2dlcihlKTtcclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgIH0sIHRoaXMpKTsgXHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICAvKlxyXG4gICAgICAgIFJlbmRlcnMgdmFsdWUgaW50byBlbGVtZW50J3MgdGV4dC5cclxuICAgICAgICBDYW4gY2FsbCBjdXN0b20gZGlzcGxheSBtZXRob2QgZnJvbSBvcHRpb25zLlxyXG4gICAgICAgIENhbiByZXR1cm4gZGVmZXJyZWQgb2JqZWN0LlxyXG4gICAgICAgIEBtZXRob2QgcmVuZGVyKClcclxuICAgICAgICBAcGFyYW0ge21peGVkfSByZXNwb25zZSBzZXJ2ZXIgcmVzcG9uc2UgKGlmIGV4aXN0KSB0byBwYXNzIGludG8gZGlzcGxheSBmdW5jdGlvblxyXG4gICAgICAgICovICAgICAgICAgIFxyXG4gICAgICAgIHJlbmRlcjogZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgLy9kbyBub3QgZGlzcGxheSBhbnl0aGluZ1xyXG4gICAgICAgICAgICBpZih0aGlzLm9wdGlvbnMuZGlzcGxheSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9pZiBpbnB1dCBoYXMgYHZhbHVlMmh0bWxGaW5hbGAgbWV0aG9kLCB3ZSBwYXNzIGNhbGxiYWNrIGluIHRoaXJkIHBhcmFtIHRvIGJlIGNhbGxlZCB3aGVuIHNvdXJjZSBpcyBsb2FkZWRcclxuICAgICAgICAgICAgaWYodGhpcy5pbnB1dC52YWx1ZTJodG1sRmluYWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlucHV0LnZhbHVlMmh0bWwodGhpcy52YWx1ZSwgdGhpcy4kZWxlbWVudFswXSwgdGhpcy5vcHRpb25zLmRpc3BsYXksIHJlc3BvbnNlKTsgXHJcbiAgICAgICAgICAgIC8vaWYgZGlzcGxheSBtZXRob2QgZGVmaW5lZCAtLT4gdXNlIGl0ICAgIFxyXG4gICAgICAgICAgICB9IGVsc2UgaWYodHlwZW9mIHRoaXMub3B0aW9ucy5kaXNwbGF5ID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmRpc3BsYXkuY2FsbCh0aGlzLiRlbGVtZW50WzBdLCB0aGlzLnZhbHVlLCByZXNwb25zZSk7XHJcbiAgICAgICAgICAgIC8vZWxzZSB1c2UgaW5wdXQncyBvcmlnaW5hbCB2YWx1ZTJodG1sKCkgbWV0aG9kICAgIFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5wdXQudmFsdWUyaHRtbCh0aGlzLnZhbHVlLCB0aGlzLiRlbGVtZW50WzBdKTsgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEVuYWJsZXMgZWRpdGFibGVcclxuICAgICAgICBAbWV0aG9kIGVuYWJsZSgpXHJcbiAgICAgICAgKiovICAgICAgICAgIFxyXG4gICAgICAgIGVuYWJsZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLiRlbGVtZW50LnJlbW92ZUNsYXNzKCdlZGl0YWJsZS1kaXNhYmxlZCcpO1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZUVtcHR5KHRoaXMuaXNFbXB0eSk7XHJcbiAgICAgICAgICAgIGlmKHRoaXMub3B0aW9ucy50b2dnbGUgIT09ICdtYW51YWwnKSB7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLiRlbGVtZW50LmF0dHIoJ3RhYmluZGV4JykgPT09ICctMScpIHsgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5yZW1vdmVBdHRyKCd0YWJpbmRleCcpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIERpc2FibGVzIGVkaXRhYmxlXHJcbiAgICAgICAgQG1ldGhvZCBkaXNhYmxlKClcclxuICAgICAgICAqKi8gICAgICAgICBcclxuICAgICAgICBkaXNhYmxlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmRpc2FibGVkID0gdHJ1ZTsgXHJcbiAgICAgICAgICAgIHRoaXMuaGlkZSgpOyAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQuYWRkQ2xhc3MoJ2VkaXRhYmxlLWRpc2FibGVkJyk7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRW1wdHkodGhpcy5pc0VtcHR5KTtcclxuICAgICAgICAgICAgLy9kbyBub3Qgc3RvcCBmb2N1cyBvbiB0aGlzIGVsZW1lbnRcclxuICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5hdHRyKCd0YWJpbmRleCcsIC0xKTsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICBUb2dnbGVzIGVuYWJsZWQgLyBkaXNhYmxlZCBzdGF0ZSBvZiBlZGl0YWJsZSBlbGVtZW50XHJcbiAgICAgICAgQG1ldGhvZCB0b2dnbGVEaXNhYmxlZCgpXHJcbiAgICAgICAgKiovICAgICAgICAgXHJcbiAgICAgICAgdG9nZ2xlRGlzYWJsZWQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZih0aGlzLm9wdGlvbnMuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7IFxyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlKCk7IFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIFNldHMgbmV3IG9wdGlvblxyXG4gICAgICAgIFxyXG4gICAgICAgIEBtZXRob2Qgb3B0aW9uKGtleSwgdmFsdWUpXHJcbiAgICAgICAgQHBhcmFtIHtzdHJpbmd8b2JqZWN0fSBrZXkgb3B0aW9uIG5hbWUgb3Igb2JqZWN0IHdpdGggc2V2ZXJhbCBvcHRpb25zXHJcbiAgICAgICAgQHBhcmFtIHttaXhlZH0gdmFsdWUgb3B0aW9uIG5ldyB2YWx1ZVxyXG4gICAgICAgIEBleGFtcGxlXHJcbiAgICAgICAgJCgnLmVkaXRhYmxlJykuZWRpdGFibGUoJ29wdGlvbicsICdwaycsIDIpO1xyXG4gICAgICAgICoqLyAgICAgICAgICBcclxuICAgICAgICBvcHRpb246IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgLy9zZXQgb3B0aW9uKHMpIGJ5IG9iamVjdFxyXG4gICAgICAgICAgICBpZihrZXkgJiYgdHlwZW9mIGtleSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgJC5lYWNoKGtleSwgJC5wcm94eShmdW5jdGlvbihrLCB2KXtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb24oJC50cmltKGspLCB2KTsgXHJcbiAgICAgICAgICAgICAgIH0sIHRoaXMpKTsgXHJcbiAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9zZXQgb3B0aW9uIGJ5IHN0cmluZyAgICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zW2tleV0gPSB2YWx1ZTsgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9kaXNhYmxlZFxyXG4gICAgICAgICAgICBpZihrZXkgPT09ICdkaXNhYmxlZCcpIHtcclxuICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlID8gdGhpcy5kaXNhYmxlKCkgOiB0aGlzLmVuYWJsZSgpO1xyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy92YWx1ZVxyXG4gICAgICAgICAgICBpZihrZXkgPT09ICd2YWx1ZScpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL3RyYW5zZmVyIG5ldyBvcHRpb24gdG8gY29udGFpbmVyISBcclxuICAgICAgICAgICAgaWYodGhpcy5jb250YWluZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLm9wdGlvbihrZXksIHZhbHVlKTsgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9wYXNzIG9wdGlvbiB0byBpbnB1dCBkaXJlY3RseSAoYXMgaXQgcG9pbnRzIHRvIHRoZSBzYW1lIGluIGZvcm0pXHJcbiAgICAgICAgICAgIGlmKHRoaXMuaW5wdXQub3B0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0Lm9wdGlvbihrZXksIHZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9LCAgICAgICAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLypcclxuICAgICAgICAqIHNldCBlbXB0eXRleHQgaWYgZWxlbWVudCBpcyBlbXB0eVxyXG4gICAgICAgICovXHJcbiAgICAgICAgaGFuZGxlRW1wdHk6IGZ1bmN0aW9uIChpc0VtcHR5KSB7XHJcbiAgICAgICAgICAgIC8vZG8gbm90IGhhbmRsZSBlbXB0eSBpZiB3ZSBkbyBub3QgZGlzcGxheSBhbnl0aGluZ1xyXG4gICAgICAgICAgICBpZih0aGlzLm9wdGlvbnMuZGlzcGxheSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLyogXHJcbiAgICAgICAgICAgIGlzRW1wdHkgbWF5IGJlIHNldCBkaXJlY3RseSBhcyBwYXJhbSBvZiBtZXRob2QuXHJcbiAgICAgICAgICAgIEl0IGlzIHJlcXVpcmVkIHdoZW4gd2UgZW5hYmxlL2Rpc2FibGUgZmllbGQgYW5kIGNhbid0IHJlbHkgb24gY29udGVudCBcclxuICAgICAgICAgICAgYXMgbm9kZSBjb250ZW50IGlzIHRleHQ6IFwiRW1wdHlcIiB0aGF0IGlzIG5vdCBlbXB0eSAlKVxyXG4gICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBpZihpc0VtcHR5ICE9PSB1bmRlZmluZWQpIHsgXHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzRW1wdHkgPSBpc0VtcHR5O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy9kZXRlY3QgZW1wdHlcclxuICAgICAgICAgICAgICAgIC8vZm9yIHNvbWUgaW5wdXRzIHdlIG5lZWQgbW9yZSBzbWFydCBjaGVja1xyXG4gICAgICAgICAgICAgICAgLy9lLmcuIHd5c2lodG1sNSBtYXkgaGF2ZSA8YnI+LCA8cD48L3A+LCA8aW1nPlxyXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuaW5wdXQuaXNFbXB0eSkgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRW1wdHkgPSB0aGlzLmlucHV0LmlzRW1wdHkodGhpcy4kZWxlbWVudCk7ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0VtcHR5ID0gJC50cmltKHRoaXMuJGVsZW1lbnQuaHRtbCgpKSA9PT0gJyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9lbXB0eXRleHQgc2hvd24gb25seSBmb3IgZW5hYmxlZFxyXG4gICAgICAgICAgICBpZighdGhpcy5vcHRpb25zLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0VtcHR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5odG1sKHRoaXMub3B0aW9ucy5lbXB0eXRleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMub3B0aW9ucy5lbXB0eWNsYXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmVtcHR5Y2xhc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZih0aGlzLm9wdGlvbnMuZW1wdHljbGFzcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmVtcHR5Y2xhc3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy9iZWxvdyByZXF1aXJlZCBpZiBlbGVtZW50IGRpc2FibGUgcHJvcGVydHkgd2FzIGNoYW5nZWRcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuaXNFbXB0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQuZW1wdHkoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLm9wdGlvbnMuZW1wdHljbGFzcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5lbXB0eWNsYXNzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgU2hvd3MgY29udGFpbmVyIHdpdGggZm9ybVxyXG4gICAgICAgIEBtZXRob2Qgc2hvdygpXHJcbiAgICAgICAgQHBhcmFtIHtib29sZWFufSBjbG9zZUFsbCBXaGV0aGVyIHRvIGNsb3NlIGFsbCBvdGhlciBlZGl0YWJsZSBjb250YWluZXJzIHdoZW4gc2hvd2luZyB0aGlzIG9uZS4gRGVmYXVsdCB0cnVlLlxyXG4gICAgICAgICoqLyAgXHJcbiAgICAgICAgc2hvdzogZnVuY3Rpb24gKGNsb3NlQWxsKSB7XHJcbiAgICAgICAgICAgIGlmKHRoaXMub3B0aW9ucy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2luaXQgZWRpdGFibGVDb250YWluZXI6IHBvcG92ZXIsIHRvb2x0aXAsIGlubGluZSwgZXRjLi5cclxuICAgICAgICAgICAgaWYoIXRoaXMuY29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyT3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMsIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52YWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICBpbnB1dDogdGhpcy5pbnB1dCAvL3Bhc3MgaW5wdXQgdG8gZm9ybSAoYXMgaXQgaXMgYWxyZWFkeSBjcmVhdGVkKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50LmVkaXRhYmxlQ29udGFpbmVyKGNvbnRhaW5lck9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgLy9saXN0ZW4gYHNhdmVgIGV2ZW50IFxyXG4gICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5vbihcInNhdmUuaW50ZXJuYWxcIiwgJC5wcm94eSh0aGlzLnNhdmUsIHRoaXMpKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyID0gdGhpcy4kZWxlbWVudC5kYXRhKCdlZGl0YWJsZUNvbnRhaW5lcicpOyBcclxuICAgICAgICAgICAgfSBlbHNlIGlmKHRoaXMuY29udGFpbmVyLnRpcCgpLmlzKCc6dmlzaWJsZScpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0gICAgICBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vc2hvdyBjb250YWluZXJcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc2hvdyhjbG9zZUFsbCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICBIaWRlcyBjb250YWluZXIgd2l0aCBmb3JtXHJcbiAgICAgICAgQG1ldGhvZCBoaWRlKClcclxuICAgICAgICAqKi8gICAgICAgXHJcbiAgICAgICAgaGlkZTogZnVuY3Rpb24gKCkgeyAgIFxyXG4gICAgICAgICAgICBpZih0aGlzLmNvbnRhaW5lcikgeyAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5oaWRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIFRvZ2dsZXMgY29udGFpbmVyIHZpc2liaWxpdHkgKHNob3cgLyBoaWRlKVxyXG4gICAgICAgIEBtZXRob2QgdG9nZ2xlKClcclxuICAgICAgICBAcGFyYW0ge2Jvb2xlYW59IGNsb3NlQWxsIFdoZXRoZXIgdG8gY2xvc2UgYWxsIG90aGVyIGVkaXRhYmxlIGNvbnRhaW5lcnMgd2hlbiBzaG93aW5nIHRoaXMgb25lLiBEZWZhdWx0IHRydWUuXHJcbiAgICAgICAgKiovICBcclxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKGNsb3NlQWxsKSB7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuY29udGFpbmVyICYmIHRoaXMuY29udGFpbmVyLnRpcCgpLmlzKCc6dmlzaWJsZScpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvdyhjbG9zZUFsbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgKiBjYWxsZWQgd2hlbiBmb3JtIHdhcyBzdWJtaXR0ZWRcclxuICAgICAgICAqLyAgICAgICAgICBcclxuICAgICAgICBzYXZlOiBmdW5jdGlvbihlLCBwYXJhbXMpIHtcclxuICAgICAgICAgICAgLy9tYXJrIGVsZW1lbnQgd2l0aCB1bnNhdmVkIGNsYXNzIGlmIG5lZWRlZFxyXG4gICAgICAgICAgICBpZih0aGlzLm9wdGlvbnMudW5zYXZlZGNsYXNzKSB7XHJcbiAgICAgICAgICAgICAgICAvKlxyXG4gICAgICAgICAgICAgICAgIEFkZCB1bnNhdmVkIGNzcyB0byBlbGVtZW50IGlmOlxyXG4gICAgICAgICAgICAgICAgICAtIHVybCBpcyBub3QgdXNlcidzIGZ1bmN0aW9uIFxyXG4gICAgICAgICAgICAgICAgICAtIHZhbHVlIHdhcyBub3Qgc2VudCB0byBzZXJ2ZXJcclxuICAgICAgICAgICAgICAgICAgLSBwYXJhbXMucmVzcG9uc2UgPT09IHVuZGVmaW5lZCwgdGhhdCBtZWFucyBkYXRhIHdhcyBub3Qgc2VudFxyXG4gICAgICAgICAgICAgICAgICAtIHZhbHVlIGNoYW5nZWQgXHJcbiAgICAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbnQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHNlbnQgPSBzZW50IHx8IHR5cGVvZiB0aGlzLm9wdGlvbnMudXJsID09PSAnZnVuY3Rpb24nO1xyXG4gICAgICAgICAgICAgICAgc2VudCA9IHNlbnQgfHwgdGhpcy5vcHRpb25zLmRpc3BsYXkgPT09IGZhbHNlOyBcclxuICAgICAgICAgICAgICAgIHNlbnQgPSBzZW50IHx8IHBhcmFtcy5yZXNwb25zZSAhPT0gdW5kZWZpbmVkOyBcclxuICAgICAgICAgICAgICAgIHNlbnQgPSBzZW50IHx8ICh0aGlzLm9wdGlvbnMuc2F2ZW5vY2hhbmdlICYmIHRoaXMuaW5wdXQudmFsdWUyc3RyKHRoaXMudmFsdWUpICE9PSB0aGlzLmlucHV0LnZhbHVlMnN0cihwYXJhbXMubmV3VmFsdWUpKTsgXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmKHNlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy51bnNhdmVkY2xhc3MpOyBcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMudW5zYXZlZGNsYXNzKTsgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2hpZ2hsaWdodCB3aGVuIHNhdmluZ1xyXG4gICAgICAgICAgICBpZih0aGlzLm9wdGlvbnMuaGlnaGxpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgJGUgPSB0aGlzLiRlbGVtZW50LFxyXG4gICAgICAgICAgICAgICAgICAgIGJnQ29sb3IgPSAkZS5jc3MoJ2JhY2tncm91bmQtY29sb3InKTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICRlLmNzcygnYmFja2dyb3VuZC1jb2xvcicsIHRoaXMub3B0aW9ucy5oaWdobGlnaHQpO1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGJnQ29sb3IgPT09ICd0cmFuc3BhcmVudCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmdDb2xvciA9ICcnOyBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJGUuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgYmdDb2xvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgJGUuYWRkQ2xhc3MoJ2VkaXRhYmxlLWJnLXRyYW5zaXRpb24nKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgJGUucmVtb3ZlQ2xhc3MoJ2VkaXRhYmxlLWJnLXRyYW5zaXRpb24nKTsgIFxyXG4gICAgICAgICAgICAgICAgICAgIH0sIDE3MDApO1xyXG4gICAgICAgICAgICAgICAgfSwgMTApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL3NldCBuZXcgdmFsdWVcclxuICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZShwYXJhbXMubmV3VmFsdWUsIGZhbHNlLCBwYXJhbXMucmVzcG9uc2UpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLyoqICAgICAgICBcclxuICAgICAgICAgICAgRmlyZWQgd2hlbiBuZXcgdmFsdWUgd2FzIHN1Ym1pdHRlZC4gWW91IGNhbiB1c2UgPGNvZGU+JCh0aGlzKS5kYXRhKCdlZGl0YWJsZScpPC9jb2RlPiB0byBhY2Nlc3MgdG8gZWRpdGFibGUgaW5zdGFuY2VcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIEBldmVudCBzYXZlIFxyXG4gICAgICAgICAgICBAcGFyYW0ge09iamVjdH0gZXZlbnQgZXZlbnQgb2JqZWN0XHJcbiAgICAgICAgICAgIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXMgYWRkaXRpb25hbCBwYXJhbXNcclxuICAgICAgICAgICAgQHBhcmFtIHttaXhlZH0gcGFyYW1zLm5ld1ZhbHVlIHN1Ym1pdHRlZCB2YWx1ZVxyXG4gICAgICAgICAgICBAcGFyYW0ge09iamVjdH0gcGFyYW1zLnJlc3BvbnNlIGFqYXggcmVzcG9uc2VcclxuICAgICAgICAgICAgQGV4YW1wbGVcclxuICAgICAgICAgICAgJCgnI3VzZXJuYW1lJykub24oJ3NhdmUnLCBmdW5jdGlvbihlLCBwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgIGFsZXJ0KCdTYXZlZCB2YWx1ZTogJyArIHBhcmFtcy5uZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAqKi9cclxuICAgICAgICAgICAgLy9ldmVudCBpdHNlbGYgaXMgdHJpZ2dlcmVkIGJ5IGVkaXRhYmxlQ29udGFpbmVyLiBEZXNjcmlwdGlvbiBoZXJlIGlzIG9ubHkgZm9yIGRvY3VtZW50YXRpb24gICAgICAgICAgICAgIFxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHZhbGlkYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLnZhbGlkYXRlID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnZhbGlkYXRlLmNhbGwodGhpcywgdGhpcy52YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIFNldHMgbmV3IHZhbHVlIG9mIGVkaXRhYmxlXHJcbiAgICAgICAgQG1ldGhvZCBzZXRWYWx1ZSh2YWx1ZSwgY29udmVydFN0cilcclxuICAgICAgICBAcGFyYW0ge21peGVkfSB2YWx1ZSBuZXcgdmFsdWUgXHJcbiAgICAgICAgQHBhcmFtIHtib29sZWFufSBjb252ZXJ0U3RyIHdoZXRoZXIgdG8gY29udmVydCB2YWx1ZSBmcm9tIHN0cmluZyB0byBpbnRlcm5hbCBmb3JtYXRcclxuICAgICAgICAqKi8gICAgICAgICBcclxuICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24odmFsdWUsIGNvbnZlcnRTdHIsIHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmKGNvbnZlcnRTdHIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLmlucHV0LnN0cjJ2YWx1ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYodGhpcy5jb250YWluZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLm9wdGlvbigndmFsdWUnLCB0aGlzLnZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkLndoZW4odGhpcy5yZW5kZXIocmVzcG9uc2UpKVxyXG4gICAgICAgICAgICAudGhlbigkLnByb3h5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVFbXB0eSgpO1xyXG4gICAgICAgICAgICB9LCB0aGlzKSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICBBY3RpdmF0ZXMgaW5wdXQgb2YgdmlzaWJsZSBjb250YWluZXIgKGUuZy4gc2V0IGZvY3VzKVxyXG4gICAgICAgIEBtZXRob2QgYWN0aXZhdGUoKVxyXG4gICAgICAgICoqLyAgICAgICAgIFxyXG4gICAgICAgIGFjdGl2YXRlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYodGhpcy5jb250YWluZXIpIHtcclxuICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuYWN0aXZhdGUoKTsgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIFJlbW92ZXMgZWRpdGFibGUgZmVhdHVyZSBmcm9tIGVsZW1lbnRcclxuICAgICAgICBAbWV0aG9kIGRlc3Ryb3koKVxyXG4gICAgICAgICoqLyAgICAgICAgXHJcbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYodGhpcy5jb250YWluZXIpIHtcclxuICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZGVzdHJveSgpOyBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5pbnB1dC5kZXN0cm95KCk7XHJcblxyXG4gICAgICAgICAgICBpZih0aGlzLm9wdGlvbnMudG9nZ2xlICE9PSAnbWFudWFsJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcygnZWRpdGFibGUtY2xpY2snKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQub2ZmKHRoaXMub3B0aW9ucy50b2dnbGUgKyAnLmVkaXRhYmxlJyk7XHJcbiAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLiRlbGVtZW50Lm9mZihcInNhdmUuaW50ZXJuYWxcIik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLiRlbGVtZW50LnJlbW92ZUNsYXNzKCdlZGl0YWJsZSBlZGl0YWJsZS1vcGVuIGVkaXRhYmxlLWRpc2FibGVkJyk7XHJcbiAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQucmVtb3ZlRGF0YSgnZWRpdGFibGUnKTtcclxuICAgICAgICB9ICAgICAgICBcclxuICAgIH07XHJcblxyXG4gICAgLyogRURJVEFCTEUgUExVR0lOIERFRklOSVRJT05cclxuICAgICogPT09PT09PT09PT09PT09PT09PT09PT0gKi9cclxuXHJcbiAgICAvKipcclxuICAgIGpRdWVyeSBtZXRob2QgdG8gaW5pdGlhbGl6ZSBlZGl0YWJsZSBlbGVtZW50LlxyXG4gICAgXHJcbiAgICBAbWV0aG9kICQoKS5lZGl0YWJsZShvcHRpb25zKVxyXG4gICAgQHBhcmFtcyB7T2JqZWN0fSBvcHRpb25zXHJcbiAgICBAZXhhbXBsZVxyXG4gICAgJCgnI3VzZXJuYW1lJykuZWRpdGFibGUoe1xyXG4gICAgICAgIHR5cGU6ICd0ZXh0JyxcclxuICAgICAgICB1cmw6ICcvcG9zdCcsXHJcbiAgICAgICAgcGs6IDFcclxuICAgIH0pO1xyXG4gICAgKiovXHJcbiAgICAkLmZuLmVkaXRhYmxlID0gZnVuY3Rpb24gKG9wdGlvbikge1xyXG4gICAgICAgIC8vc3BlY2lhbCBBUEkgbWV0aG9kcyByZXR1cm5pbmcgbm9uLWpxdWVyeSBvYmplY3RcclxuICAgICAgICB2YXIgcmVzdWx0ID0ge30sIGFyZ3MgPSBhcmd1bWVudHMsIGRhdGFrZXkgPSAnZWRpdGFibGUnO1xyXG4gICAgICAgIHN3aXRjaCAob3B0aW9uKSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICBSdW5zIGNsaWVudC1zaWRlIHZhbGlkYXRpb24gZm9yIGFsbCBtYXRjaGVkIGVkaXRhYmxlc1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgQG1ldGhvZCB2YWxpZGF0ZSgpXHJcbiAgICAgICAgICAgIEByZXR1cm5zIHtPYmplY3R9IHZhbGlkYXRpb24gZXJyb3JzIG1hcFxyXG4gICAgICAgICAgICBAZXhhbXBsZVxyXG4gICAgICAgICAgICAkKCcjdXNlcm5hbWUsICNmdWxsbmFtZScpLmVkaXRhYmxlKCd2YWxpZGF0ZScpO1xyXG4gICAgICAgICAgICAvLyBwb3NzaWJsZSByZXN1bHQ6XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICB1c2VybmFtZTogXCJ1c2VybmFtZSBpcyByZXF1aXJlZFwiLFxyXG4gICAgICAgICAgICAgIGZ1bGxuYW1lOiBcImZ1bGxuYW1lIHNob3VsZCBiZSBtaW5pbXVtIDMgbGV0dGVycyBsZW5ndGhcIlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICoqL1xyXG4gICAgICAgICAgICBjYXNlICd2YWxpZGF0ZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksIGRhdGEgPSAkdGhpcy5kYXRhKGRhdGFrZXkpLCBlcnJvcjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAmJiAoZXJyb3IgPSBkYXRhLnZhbGlkYXRlKCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtkYXRhLm9wdGlvbnMubmFtZV0gPSBlcnJvcjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICBSZXR1cm5zIGN1cnJlbnQgdmFsdWVzIG9mIGVkaXRhYmxlIGVsZW1lbnRzLiAgIFxyXG4gICAgICAgICAgICBOb3RlIHRoYXQgaXQgcmV0dXJucyBhbiAqKm9iamVjdCoqIHdpdGggbmFtZS12YWx1ZSBwYWlycywgbm90IGEgdmFsdWUgaXRzZWxmLiBJdCBhbGxvd3MgdG8gZ2V0IGRhdGEgZnJvbSBzZXZlcmFsIGVsZW1lbnRzLiAgICBcclxuICAgICAgICAgICAgSWYgdmFsdWUgb2Ygc29tZSBlZGl0YWJsZSBpcyBgbnVsbGAgb3IgYHVuZGVmaW5lZGAgaXQgaXMgZXhjbHVkZWQgZnJvbSByZXN1bHQgb2JqZWN0LlxyXG4gICAgICAgICAgICBXaGVuIHBhcmFtIGBpc1NpbmdsZWAgaXMgc2V0IHRvICoqdHJ1ZSoqIC0gaXQgaXMgc3VwcG9zZWQgeW91IGhhdmUgc2luZ2xlIGVsZW1lbnQgYW5kIHdpbGwgcmV0dXJuIHZhbHVlIG9mIGVkaXRhYmxlIGluc3RlYWQgb2Ygb2JqZWN0LiAgIFxyXG4gICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIEBtZXRob2QgZ2V0VmFsdWUoKVxyXG4gICAgICAgICAgICBAcGFyYW0ge2Jvb2x9IGlzU2luZ2xlIHdoZXRoZXIgdG8gcmV0dXJuIGp1c3QgdmFsdWUgb2Ygc2luZ2xlIGVsZW1lbnRcclxuICAgICAgICAgICAgQHJldHVybnMge09iamVjdH0gb2JqZWN0IG9mIGVsZW1lbnQgbmFtZXMgYW5kIHZhbHVlc1xyXG4gICAgICAgICAgICBAZXhhbXBsZVxyXG4gICAgICAgICAgICAkKCcjdXNlcm5hbWUsICNmdWxsbmFtZScpLmVkaXRhYmxlKCdnZXRWYWx1ZScpO1xyXG4gICAgICAgICAgICAvL3Jlc3VsdDpcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICB1c2VybmFtZTogXCJzdXBlcnVzZXJcIixcclxuICAgICAgICAgICAgZnVsbG5hbWU6IFwiSm9oblwiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9pc1NpbmdsZSA9IHRydWVcclxuICAgICAgICAgICAgJCgnI3VzZXJuYW1lJykuZWRpdGFibGUoJ2dldFZhbHVlJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIC8vcmVzdWx0IFwic3VwZXJ1c2VyXCIgXHJcbiAgICAgICAgICAgICoqL1xyXG4gICAgICAgICAgICBjYXNlICdnZXRWYWx1ZSc6XHJcbiAgICAgICAgICAgICAgICBpZihhcmd1bWVudHMubGVuZ3RoID09PSAyICYmIGFyZ3VtZW50c1sxXSA9PT0gdHJ1ZSkgeyAvL2lzU2luZ2xlID0gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuZXEoMCkuZGF0YShkYXRha2V5KS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSwgZGF0YSA9ICR0aGlzLmRhdGEoZGF0YWtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEudmFsdWUgIT09IHVuZGVmaW5lZCAmJiBkYXRhLnZhbHVlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbZGF0YS5vcHRpb25zLm5hbWVdID0gZGF0YS5pbnB1dC52YWx1ZTJzdWJtaXQoZGF0YS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICBUaGlzIG1ldGhvZCBjb2xsZWN0cyB2YWx1ZXMgZnJvbSBzZXZlcmFsIGVkaXRhYmxlIGVsZW1lbnRzIGFuZCBzdWJtaXQgdGhlbSBhbGwgdG8gc2VydmVyLiAgIFxyXG4gICAgICAgICAgICBJbnRlcm5hbGx5IGl0IHJ1bnMgY2xpZW50LXNpZGUgdmFsaWRhdGlvbiBmb3IgYWxsIGZpZWxkcyBhbmQgc3VibWl0cyBvbmx5IGluIGNhc2Ugb2Ygc3VjY2Vzcy4gIFxyXG4gICAgICAgICAgICBTZWUgPGEgaHJlZj1cIiNuZXdyZWNvcmRcIj5jcmVhdGluZyBuZXcgcmVjb3JkczwvYT4gZm9yIGRldGFpbHMuICBcclxuICAgICAgICAgICAgU2luY2UgMS41LjEgYHN1Ym1pdGAgY2FuIGJlIGFwcGxpZWQgdG8gc2luZ2xlIGVsZW1lbnQgdG8gc2VuZCBkYXRhIHByb2dyYW1tYXRpY2FsbHkuIEluIHRoYXQgY2FzZVxyXG4gICAgICAgICAgICBgdXJsYCwgYHN1Y2Nlc3NgIGFuZCBgZXJyb3JgIGlzIHRha2VuIGZyb20gaW5pdGlhbCBvcHRpb25zIGFuZCB5b3UgY2FuIGp1c3QgY2FsbCBgJCgnI3VzZXJuYW1lJykuZWRpdGFibGUoJ3N1Ym1pdCcpYC4gXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBAbWV0aG9kIHN1Ym1pdChvcHRpb25zKVxyXG4gICAgICAgICAgICBAcGFyYW0ge29iamVjdH0gb3B0aW9ucyBcclxuICAgICAgICAgICAgQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMudXJsIHVybCB0byBzdWJtaXQgZGF0YSBcclxuICAgICAgICAgICAgQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMuZGF0YSBhZGRpdGlvbmFsIGRhdGEgdG8gc3VibWl0XHJcbiAgICAgICAgICAgIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zLmFqYXhPcHRpb25zIGFkZGl0aW9uYWwgYWpheCBvcHRpb25zXHJcbiAgICAgICAgICAgIEBwYXJhbSB7ZnVuY3Rpb259IG9wdGlvbnMuZXJyb3Iob2JqKSBlcnJvciBoYW5kbGVyIFxyXG4gICAgICAgICAgICBAcGFyYW0ge2Z1bmN0aW9ufSBvcHRpb25zLnN1Y2Nlc3Mob2JqLGNvbmZpZykgc3VjY2VzcyBoYW5kbGVyXHJcbiAgICAgICAgICAgIEByZXR1cm5zIHtPYmplY3R9IGpRdWVyeSBvYmplY3RcclxuICAgICAgICAgICAgKiovXHJcbiAgICAgICAgICAgIGNhc2UgJ3N1Ym1pdCc6ICAvL2NvbGxlY3RzIHZhbHVlLCB2YWxpZGF0ZSBhbmQgc3VibWl0IHRvIHNlcnZlciBmb3IgY3JlYXRpbmcgbmV3IHJlY29yZFxyXG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IGFyZ3VtZW50c1sxXSB8fCB7fSxcclxuICAgICAgICAgICAgICAgICRlbGVtcyA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICBlcnJvcnMgPSB0aGlzLmVkaXRhYmxlKCd2YWxpZGF0ZScpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHZhbGlkYXRpb24gb2tcclxuICAgICAgICAgICAgICAgIGlmKCQuaXNFbXB0eU9iamVjdChlcnJvcnMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFqYXhPcHRpb25zID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGZvciBzaW5nbGUgZWxlbWVudCB1c2UgdXJsLCBzdWNjZXNzIGV0YyBmcm9tIG9wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICBpZigkZWxlbXMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlZGl0YWJsZSA9ICRlbGVtcy5kYXRhKCdlZGl0YWJsZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3N0YW5kYXJkIHBhcmFtc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZWRpdGFibGUub3B0aW9ucy5uYW1lIHx8ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGVkaXRhYmxlLmlucHV0LnZhbHVlMnN1Ym1pdChlZGl0YWJsZS52YWx1ZSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwazogKHR5cGVvZiBlZGl0YWJsZS5vcHRpb25zLnBrID09PSAnZnVuY3Rpb24nKSA/IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRhYmxlLm9wdGlvbnMucGsuY2FsbChlZGl0YWJsZS5vcHRpb25zLnNjb3BlKSA6IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRhYmxlLm9wdGlvbnMucGsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2FkZGl0aW9uYWwgcGFyYW1zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBlZGl0YWJsZS5vcHRpb25zLnBhcmFtcyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gZWRpdGFibGUub3B0aW9ucy5wYXJhbXMuY2FsbChlZGl0YWJsZS5vcHRpb25zLnNjb3BlLCBwYXJhbXMpOyAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RyeSBwYXJzZSBqc29uIGluIHNpbmdsZSBxdW90ZXMgKGZyb20gZGF0YS1wYXJhbXMgYXR0cmlidXRlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdGFibGUub3B0aW9ucy5wYXJhbXMgPSAkLmZuLmVkaXRhYmxldXRpbHMudHJ5UGFyc2VKc29uKGVkaXRhYmxlLm9wdGlvbnMucGFyYW1zLCB0cnVlKTsgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZXh0ZW5kKHBhcmFtcywgZWRpdGFibGUub3B0aW9ucy5wYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhamF4T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogZWRpdGFibGUub3B0aW9ucy51cmwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXNlIHN1Y2Nlc3MgLyBlcnJvciBmcm9tIG9wdGlvbnMgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5zdWNjZXNzID0gY29uZmlnLnN1Y2Nlc3MgfHwgZWRpdGFibGUub3B0aW9ucy5zdWNjZXNzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuZXJyb3IgPSBjb25maWcuZXJyb3IgfHwgZWRpdGFibGUub3B0aW9ucy5lcnJvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gbXVsdGlwbGUgZWxlbWVudHNcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy5lZGl0YWJsZSgnZ2V0VmFsdWUnKTsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhamF4T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnVybCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHZhbHVlcywgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTsgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWpheCBzdWNjZXNzIGNhbGxhYmNrIChyZXNwb25zZSAyMDAgT0spXHJcbiAgICAgICAgICAgICAgICAgICAgYWpheE9wdGlvbnMuc3VjY2VzcyA9IHR5cGVvZiBjb25maWcuc3VjY2VzcyA9PT0gJ2Z1bmN0aW9uJyA/IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuc3VjY2Vzcy5jYWxsKCRlbGVtcywgcmVzcG9uc2UsIGNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gOiAkLm5vb3A7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBhamF4IGVycm9yIGNhbGxhYmNrXHJcbiAgICAgICAgICAgICAgICAgICAgYWpheE9wdGlvbnMuZXJyb3IgPSB0eXBlb2YgY29uZmlnLmVycm9yID09PSAnZnVuY3Rpb24nID8gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmVycm9yLmFwcGx5KCRlbGVtcywgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSA6ICQubm9vcDtcclxuICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBleHRlbmQgYWpheE9wdGlvbnMgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoY29uZmlnLmFqYXhPcHRpb25zKSB7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmV4dGVuZChhamF4T3B0aW9ucywgY29uZmlnLmFqYXhPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZXh0cmEgZGF0YSBcclxuICAgICAgICAgICAgICAgICAgICBpZihjb25maWcuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmV4dGVuZChhamF4T3B0aW9ucy5kYXRhLCBjb25maWcuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHBlcmZvcm0gYWpheCByZXF1ZXN0XHJcbiAgICAgICAgICAgICAgICAgICAgJC5hamF4KGFqYXhPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vY2xpZW50LXNpZGUgdmFsaWRhdGlvbiBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBjb25maWcuZXJyb3IgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmVycm9yLmNhbGwoJGVsZW1zLCBlcnJvcnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL3JldHVybiBqcXVlcnkgb2JqZWN0XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksIFxyXG4gICAgICAgICAgICAgICAgZGF0YSA9ICR0aGlzLmRhdGEoZGF0YWtleSksIFxyXG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT09ICdvYmplY3QnICYmIG9wdGlvbjtcclxuXHJcbiAgICAgICAgICAgIC8vZm9yIGRlbGVnYXRlZCB0YXJnZXRzIGRvIG5vdCBzdG9yZSBgZWRpdGFibGVgIG9iamVjdCBmb3IgZWxlbWVudFxyXG4gICAgICAgICAgICAvL2l0J3MgYWxsb3dzIHNldmVyYWwgZGlmZmVyZW50IHNlbGVjdG9ycy5cclxuICAgICAgICAgICAgLy9zZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS92aXRhbGV0cy94LWVkaXRhYmxlL2lzc3Vlcy8zMTIgICAgXHJcbiAgICAgICAgICAgIGlmKG9wdGlvbnMgJiYgb3B0aW9ucy5zZWxlY3Rvcikge1xyXG4gICAgICAgICAgICAgICAgZGF0YSA9IG5ldyBFZGl0YWJsZSh0aGlzLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjsgXHJcbiAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgICAgICAgICR0aGlzLmRhdGEoZGF0YWtleSwgKGRhdGEgPSBuZXcgRWRpdGFibGUodGhpcywgb3B0aW9ucykpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT09ICdzdHJpbmcnKSB7IC8vY2FsbCBtZXRob2QgXHJcbiAgICAgICAgICAgICAgICBkYXRhW29wdGlvbl0uYXBwbHkoZGF0YSwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJncywgMSkpO1xyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTsgICAgXHJcbiAgICAgICAgICAgIFxyXG5cclxuICAgICQuZm4uZWRpdGFibGUuZGVmYXVsdHMgPSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgVHlwZSBvZiBpbnB1dC4gQ2FuIGJlIDxjb2RlPnRleHR8dGV4dGFyZWF8c2VsZWN0fGRhdGV8Y2hlY2tsaXN0PC9jb2RlPiBhbmQgbW9yZVxyXG5cclxuICAgICAgICBAcHJvcGVydHkgdHlwZSBcclxuICAgICAgICBAdHlwZSBzdHJpbmdcclxuICAgICAgICBAZGVmYXVsdCAndGV4dCdcclxuICAgICAgICAqKi9cclxuICAgICAgICB0eXBlOiAndGV4dCcsICAgICAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICBTZXRzIGRpc2FibGVkIHN0YXRlIG9mIGVkaXRhYmxlXHJcblxyXG4gICAgICAgIEBwcm9wZXJ0eSBkaXNhYmxlZCBcclxuICAgICAgICBAdHlwZSBib29sZWFuXHJcbiAgICAgICAgQGRlZmF1bHQgZmFsc2VcclxuICAgICAgICAqKi8gICAgICAgICBcclxuICAgICAgICBkaXNhYmxlZDogZmFsc2UsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgSG93IHRvIHRvZ2dsZSBlZGl0YWJsZS4gQ2FuIGJlIDxjb2RlPmNsaWNrfGRibGNsaWNrfG1vdXNlZW50ZXJ8bWFudWFsPC9jb2RlPi4gICBcclxuICAgICAgICBXaGVuIHNldCB0byA8Y29kZT5tYW51YWw8L2NvZGU+IHlvdSBzaG91bGQgbWFudWFsbHkgY2FsbCA8Y29kZT5zaG93L2hpZGU8L2NvZGU+IG1ldGhvZHMgb2YgZWRpdGFibGUuICAgIFxyXG4gICAgICAgICoqTm90ZSoqOiBpZiB5b3UgY2FsbCA8Y29kZT5zaG93PC9jb2RlPiBvciA8Y29kZT50b2dnbGU8L2NvZGU+IGluc2lkZSAqKmNsaWNrKiogaGFuZGxlciBvZiBzb21lIERPTSBlbGVtZW50LCBcclxuICAgICAgICB5b3UgbmVlZCB0byBhcHBseSA8Y29kZT5lLnN0b3BQcm9wYWdhdGlvbigpPC9jb2RlPiBiZWNhdXNlIGNvbnRhaW5lcnMgYXJlIGJlaW5nIGNsb3NlZCBvbiBhbnkgY2xpY2sgb24gZG9jdW1lbnQuXHJcbiAgICAgICAgXHJcbiAgICAgICAgQGV4YW1wbGVcclxuICAgICAgICAkKCcjZWRpdC1idXR0b24nKS5jbGljayhmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICQoJyN1c2VybmFtZScpLmVkaXRhYmxlKCd0b2dnbGUnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgQHByb3BlcnR5IHRvZ2dsZSBcclxuICAgICAgICBAdHlwZSBzdHJpbmdcclxuICAgICAgICBAZGVmYXVsdCAnY2xpY2snXHJcbiAgICAgICAgKiovICAgICAgICAgIFxyXG4gICAgICAgIHRvZ2dsZTogJ2NsaWNrJyxcclxuICAgICAgICAvKipcclxuICAgICAgICBUZXh0IHNob3duIHdoZW4gZWxlbWVudCBpcyBlbXB0eS5cclxuXHJcbiAgICAgICAgQHByb3BlcnR5IGVtcHR5dGV4dCBcclxuICAgICAgICBAdHlwZSBzdHJpbmdcclxuICAgICAgICBAZGVmYXVsdCAnRW1wdHknXHJcbiAgICAgICAgKiovICAgICAgICAgXHJcbiAgICAgICAgZW1wdHl0ZXh0OiAnRW1wdHknLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEFsbG93cyB0byBhdXRvbWF0aWNhbGx5IHNldCBlbGVtZW50J3MgdGV4dCBiYXNlZCBvbiBpdCdzIHZhbHVlLiBDYW4gYmUgPGNvZGU+YXV0b3xhbHdheXN8bmV2ZXI8L2NvZGU+LiBVc2VmdWwgZm9yIHNlbGVjdCBhbmQgZGF0ZS5cclxuICAgICAgICBGb3IgZXhhbXBsZSwgaWYgZHJvcGRvd24gbGlzdCBpcyA8Y29kZT57MTogJ2EnLCAyOiAnYid9PC9jb2RlPiBhbmQgZWxlbWVudCdzIHZhbHVlIHNldCB0byA8Y29kZT4xPC9jb2RlPiwgaXQncyBodG1sIHdpbGwgYmUgYXV0b21hdGljYWxseSBzZXQgdG8gPGNvZGU+J2EnPC9jb2RlPi4gIFxyXG4gICAgICAgIDxjb2RlPmF1dG88L2NvZGU+IC0gdGV4dCB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgc2V0IG9ubHkgaWYgZWxlbWVudCBpcyBlbXB0eS4gIFxyXG4gICAgICAgIDxjb2RlPmFsd2F5c3xuZXZlcjwvY29kZT4gLSBhbHdheXMobmV2ZXIpIHRyeSB0byBzZXQgZWxlbWVudCdzIHRleHQuXHJcblxyXG4gICAgICAgIEBwcm9wZXJ0eSBhdXRvdGV4dCBcclxuICAgICAgICBAdHlwZSBzdHJpbmdcclxuICAgICAgICBAZGVmYXVsdCAnYXV0bydcclxuICAgICAgICAqKi8gICAgICAgICAgXHJcbiAgICAgICAgYXV0b3RleHQ6ICdhdXRvJywgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgSW5pdGlhbCB2YWx1ZSBvZiBpbnB1dC4gSWYgbm90IHNldCwgdGFrZW4gZnJvbSBlbGVtZW50J3MgdGV4dC4gIFxyXG4gICAgICAgIE5vdGUsIHRoYXQgaWYgZWxlbWVudCdzIHRleHQgaXMgZW1wdHkgLSB0ZXh0IGlzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGZyb20gdmFsdWUgYW5kIGNhbiBiZSBjdXN0b21pemVkIChzZWUgYGF1dG90ZXh0YCBvcHRpb24pLiAgXHJcbiAgICAgICAgRm9yIGV4YW1wbGUsIHRvIGRpc3BsYXkgY3VycmVuY3kgc2lnbjpcclxuICAgICAgICBAZXhhbXBsZVxyXG4gICAgICAgIDxhIGlkPVwicHJpY2VcIiBkYXRhLXR5cGU9XCJ0ZXh0XCIgZGF0YS12YWx1ZT1cIjEwMFwiPjwvYT5cclxuICAgICAgICA8c2NyaXB0PlxyXG4gICAgICAgICQoJyNwcmljZScpLmVkaXRhYmxlKHtcclxuICAgICAgICAgICAgLi4uXHJcbiAgICAgICAgICAgIGRpc3BsYXk6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgJCh0aGlzKS50ZXh0KHZhbHVlICsgJyQnKTtcclxuICAgICAgICAgICAgfSBcclxuICAgICAgICB9KSBcclxuICAgICAgICA8L3NjcmlwdD5cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIEBwcm9wZXJ0eSB2YWx1ZSBcclxuICAgICAgICBAdHlwZSBtaXhlZFxyXG4gICAgICAgIEBkZWZhdWx0IGVsZW1lbnQncyB0ZXh0XHJcbiAgICAgICAgKiovXHJcbiAgICAgICAgdmFsdWU6IG51bGwsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgQ2FsbGJhY2sgdG8gcGVyZm9ybSBjdXN0b20gZGlzcGxheWluZyBvZiB2YWx1ZSBpbiBlbGVtZW50J3MgdGV4dC4gIFxyXG4gICAgICAgIElmIGBudWxsYCwgZGVmYXVsdCBpbnB1dCdzIGRpc3BsYXkgdXNlZC4gIFxyXG4gICAgICAgIElmIGBmYWxzZWAsIG5vIGRpc3BsYXlpbmcgbWV0aG9kcyB3aWxsIGJlIGNhbGxlZCwgZWxlbWVudCdzIHRleHQgd2lsbCBuZXZlciBjaGFuZ2UuICBcclxuICAgICAgICBSdW5zIHVuZGVyIGVsZW1lbnQncyBzY29wZS4gIFxyXG4gICAgICAgIF8qKlBhcmFtZXRlcnM6KipfICBcclxuICAgICAgICBcclxuICAgICAgICAqIGB2YWx1ZWAgY3VycmVudCB2YWx1ZSB0byBiZSBkaXNwbGF5ZWRcclxuICAgICAgICAqIGByZXNwb25zZWAgc2VydmVyIHJlc3BvbnNlIChpZiBkaXNwbGF5IGNhbGxlZCBhZnRlciBhamF4IHN1Ym1pdCksIHNpbmNlIDEuNC4wXHJcbiAgICAgICAgIFxyXG4gICAgICAgIEZvciBfaW5wdXRzIHdpdGggc291cmNlXyAoc2VsZWN0LCBjaGVja2xpc3QpIHBhcmFtZXRlcnMgYXJlIGRpZmZlcmVudDogIFxyXG4gICAgICAgICAgXHJcbiAgICAgICAgKiBgdmFsdWVgIGN1cnJlbnQgdmFsdWUgdG8gYmUgZGlzcGxheWVkXHJcbiAgICAgICAgKiBgc291cmNlRGF0YWAgYXJyYXkgb2YgaXRlbXMgZm9yIGN1cnJlbnQgaW5wdXQgKGUuZy4gZHJvcGRvd24gaXRlbXMpIFxyXG4gICAgICAgICogYHJlc3BvbnNlYCBzZXJ2ZXIgcmVzcG9uc2UgKGlmIGRpc3BsYXkgY2FsbGVkIGFmdGVyIGFqYXggc3VibWl0KSwgc2luY2UgMS40LjBcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgVG8gZ2V0IGN1cnJlbnRseSBzZWxlY3RlZCBpdGVtcyB1c2UgYCQuZm4uZWRpdGFibGV1dGlscy5pdGVtc0J5VmFsdWUodmFsdWUsIHNvdXJjZURhdGEpYC5cclxuICAgICAgICBcclxuICAgICAgICBAcHJvcGVydHkgZGlzcGxheSBcclxuICAgICAgICBAdHlwZSBmdW5jdGlvbnxib29sZWFuXHJcbiAgICAgICAgQGRlZmF1bHQgbnVsbFxyXG4gICAgICAgIEBzaW5jZSAxLjIuMFxyXG4gICAgICAgIEBleGFtcGxlXHJcbiAgICAgICAgZGlzcGxheTogZnVuY3Rpb24odmFsdWUsIHNvdXJjZURhdGEpIHtcclxuICAgICAgICAgICAvL2Rpc3BsYXkgY2hlY2tsaXN0IGFzIGNvbW1hLXNlcGFyYXRlZCB2YWx1ZXNcclxuICAgICAgICAgICB2YXIgaHRtbCA9IFtdLFxyXG4gICAgICAgICAgICAgICBjaGVja2VkID0gJC5mbi5lZGl0YWJsZXV0aWxzLml0ZW1zQnlWYWx1ZSh2YWx1ZSwgc291cmNlRGF0YSk7XHJcbiAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgIGlmKGNoZWNrZWQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICQuZWFjaChjaGVja2VkLCBmdW5jdGlvbihpLCB2KSB7IGh0bWwucHVzaCgkLmZuLmVkaXRhYmxldXRpbHMuZXNjYXBlKHYudGV4dCkpOyB9KTtcclxuICAgICAgICAgICAgICAgJCh0aGlzKS5odG1sKGh0bWwuam9pbignLCAnKSk7XHJcbiAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgJCh0aGlzKS5lbXB0eSgpOyBcclxuICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgICoqLyAgICAgICAgICBcclxuICAgICAgICBkaXNwbGF5OiBudWxsLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIENzcyBjbGFzcyBhcHBsaWVkIHdoZW4gZWRpdGFibGUgdGV4dCBpcyBlbXB0eS5cclxuXHJcbiAgICAgICAgQHByb3BlcnR5IGVtcHR5Y2xhc3MgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nXHJcbiAgICAgICAgQHNpbmNlIDEuNC4xICAgICAgICBcclxuICAgICAgICBAZGVmYXVsdCBlZGl0YWJsZS1lbXB0eVxyXG4gICAgICAgICoqLyAgICAgICAgXHJcbiAgICAgICAgZW1wdHljbGFzczogJ2VkaXRhYmxlLWVtcHR5JyxcclxuICAgICAgICAvKipcclxuICAgICAgICBDc3MgY2xhc3MgYXBwbGllZCB3aGVuIHZhbHVlIHdhcyBzdG9yZWQgYnV0IG5vdCBzZW50IHRvIHNlcnZlciAoYHBrYCBpcyBlbXB0eSBvciBgc2VuZCA9ICduZXZlcidgKS4gIFxyXG4gICAgICAgIFlvdSBtYXkgc2V0IGl0IHRvIGBudWxsYCBpZiB5b3Ugd29yayB3aXRoIGVkaXRhYmxlcyBsb2NhbGx5IGFuZCBzdWJtaXQgdGhlbSB0b2dldGhlci4gIFxyXG5cclxuICAgICAgICBAcHJvcGVydHkgdW5zYXZlZGNsYXNzIFxyXG4gICAgICAgIEB0eXBlIHN0cmluZ1xyXG4gICAgICAgIEBzaW5jZSAxLjQuMSAgICAgICAgXHJcbiAgICAgICAgQGRlZmF1bHQgZWRpdGFibGUtdW5zYXZlZFxyXG4gICAgICAgICoqLyAgICAgICAgXHJcbiAgICAgICAgdW5zYXZlZGNsYXNzOiAnZWRpdGFibGUtdW5zYXZlZCcsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgSWYgc2VsZWN0b3IgaXMgcHJvdmlkZWQsIGVkaXRhYmxlIHdpbGwgYmUgZGVsZWdhdGVkIHRvIHRoZSBzcGVjaWZpZWQgdGFyZ2V0cy4gIFxyXG4gICAgICAgIFVzZWZ1bGwgZm9yIGR5bmFtaWNhbGx5IGdlbmVyYXRlZCBET00gZWxlbWVudHMuICBcclxuICAgICAgICAqKlBsZWFzZSBub3RlKiosIHRoYXQgZGVsZWdhdGVkIHRhcmdldHMgY2FuJ3QgYmUgaW5pdGlhbGl6ZWQgd2l0aCBgZW1wdHl0ZXh0YCBhbmQgYGF1dG90ZXh0YCBvcHRpb25zLCBcclxuICAgICAgICBhcyB0aGV5IGFjdHVhbGx5IGJlY29tZSBlZGl0YWJsZSBvbmx5IGFmdGVyIGZpcnN0IGNsaWNrLiAgXHJcbiAgICAgICAgWW91IHNob3VsZCBtYW51YWxseSBzZXQgY2xhc3MgYGVkaXRhYmxlLWNsaWNrYCB0byB0aGVzZSBlbGVtZW50cy4gIFxyXG4gICAgICAgIEFsc28sIGlmIGVsZW1lbnQgb3JpZ2luYWxseSBlbXB0eSB5b3Ugc2hvdWxkIGFkZCBjbGFzcyBgZWRpdGFibGUtZW1wdHlgLCBzZXQgYGRhdGEtdmFsdWU9XCJcImAgYW5kIHdyaXRlIGVtcHR5dGV4dCBpbnRvIGVsZW1lbnQ6XHJcblxyXG4gICAgICAgIEBwcm9wZXJ0eSBzZWxlY3RvciBcclxuICAgICAgICBAdHlwZSBzdHJpbmdcclxuICAgICAgICBAc2luY2UgMS40LjEgICAgICAgIFxyXG4gICAgICAgIEBkZWZhdWx0IG51bGxcclxuICAgICAgICBAZXhhbXBsZVxyXG4gICAgICAgIDxkaXYgaWQ9XCJ1c2VyXCI+XHJcbiAgICAgICAgICA8IS0tIGVtcHR5IC0tPlxyXG4gICAgICAgICAgPGEgaHJlZj1cIiNcIiBkYXRhLW5hbWU9XCJ1c2VybmFtZVwiIGRhdGEtdHlwZT1cInRleHRcIiBjbGFzcz1cImVkaXRhYmxlLWNsaWNrIGVkaXRhYmxlLWVtcHR5XCIgZGF0YS12YWx1ZT1cIlwiIHRpdGxlPVwiVXNlcm5hbWVcIj5FbXB0eTwvYT5cclxuICAgICAgICAgIDwhLS0gbm9uLWVtcHR5IC0tPlxyXG4gICAgICAgICAgPGEgaHJlZj1cIiNcIiBkYXRhLW5hbWU9XCJncm91cFwiIGRhdGEtdHlwZT1cInNlbGVjdFwiIGRhdGEtc291cmNlPVwiL2dyb3Vwc1wiIGRhdGEtdmFsdWU9XCIxXCIgY2xhc3M9XCJlZGl0YWJsZS1jbGlja1wiIHRpdGxlPVwiR3JvdXBcIj5PcGVyYXRvcjwvYT5cclxuICAgICAgICA8L2Rpdj4gICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIDxzY3JpcHQ+XHJcbiAgICAgICAgJCgnI3VzZXInKS5lZGl0YWJsZSh7XHJcbiAgICAgICAgICAgIHNlbGVjdG9yOiAnYScsXHJcbiAgICAgICAgICAgIHVybDogJy9wb3N0JyxcclxuICAgICAgICAgICAgcGs6IDFcclxuICAgICAgICB9KTtcclxuICAgICAgICA8L3NjcmlwdD5cclxuICAgICAgICAqKi8gICAgICAgICBcclxuICAgICAgICBzZWxlY3RvcjogbnVsbCxcclxuICAgICAgICAvKipcclxuICAgICAgICBDb2xvciB1c2VkIHRvIGhpZ2hsaWdodCBlbGVtZW50IGFmdGVyIHVwZGF0ZS4gSW1wbGVtZW50ZWQgdmlhIENTUzMgdHJhbnNpdGlvbiwgd29ya3MgaW4gbW9kZXJuIGJyb3dzZXJzLlxyXG4gICAgICAgIFxyXG4gICAgICAgIEBwcm9wZXJ0eSBoaWdobGlnaHQgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nfGJvb2xlYW5cclxuICAgICAgICBAc2luY2UgMS40LjUgICAgICAgIFxyXG4gICAgICAgIEBkZWZhdWx0ICNGRkZGODAgXHJcbiAgICAgICAgKiovXHJcbiAgICAgICAgaGlnaGxpZ2h0OiAnI0ZGRkY4MCdcclxuICAgIH07XHJcbiAgICBcclxufSh3aW5kb3cualF1ZXJ5KSk7XHJcblxyXG4vKipcclxuQWJzdHJhY3RJbnB1dCAtIGJhc2UgY2xhc3MgZm9yIGFsbCBlZGl0YWJsZSBpbnB1dHMuXHJcbkl0IGRlZmluZXMgaW50ZXJmYWNlIHRvIGJlIGltcGxlbWVudGVkIGJ5IGFueSBpbnB1dCB0eXBlLlxyXG5UbyBjcmVhdGUgeW91ciBvd24gaW5wdXQgeW91IGNhbiBpbmhlcml0IGZyb20gdGhpcyBjbGFzcy5cclxuXHJcbkBjbGFzcyBhYnN0cmFjdGlucHV0XHJcbioqL1xyXG4oZnVuY3Rpb24gKCQpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIC8vdHlwZXNcclxuICAgICQuZm4uZWRpdGFibGV0eXBlcyA9IHt9O1xyXG5cclxuICAgIHZhciBBYnN0cmFjdElucHV0ID0gZnVuY3Rpb24gKCkgeyB9O1xyXG5cclxuICAgIEFic3RyYWN0SW5wdXQucHJvdG90eXBlID0ge1xyXG4gICAgICAgLyoqXHJcbiAgICAgICAgSW5pdGlhbGl6ZXMgaW5wdXRcclxuXHJcbiAgICAgICAgQG1ldGhvZCBpbml0KCkgXHJcbiAgICAgICAgKiovXHJcbiAgICAgICBpbml0OiBmdW5jdGlvbih0eXBlLCBvcHRpb25zLCBkZWZhdWx0cykge1xyXG4gICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XHJcbiAgICAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIGRlZmF1bHRzLCBvcHRpb25zKTtcclxuICAgICAgIH0sXHJcblxyXG4gICAgICAgLypcclxuICAgICAgIHRoaXMgbWV0aG9kIGNhbGxlZCBiZWZvcmUgcmVuZGVyIHRvIGluaXQgJHRwbCB0aGF0IGlzIGluc2VydGVkIGluIERPTVxyXG4gICAgICAgKi9cclxuICAgICAgIHByZXJlbmRlcjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgdGhpcy4kdHBsID0gJCh0aGlzLm9wdGlvbnMudHBsKTsgLy93aG9sZSB0cGwgYXMganF1ZXJ5IG9iamVjdCAgICBcclxuICAgICAgICAgICB0aGlzLiRpbnB1dCA9IHRoaXMuJHRwbDsgICAgICAgICAvL2NvbnRyb2wgaXRzZWxmLCBjYW4gYmUgY2hhbmdlZCBpbiByZW5kZXIgbWV0aG9kXHJcbiAgICAgICAgICAgdGhpcy4kY2xlYXIgPSBudWxsOyAgICAgICAgICAgICAgLy9jbGVhciBidXR0b25cclxuICAgICAgICAgICB0aGlzLmVycm9yID0gbnVsbDsgICAgICAgICAgICAgICAvL2Vycm9yIG1lc3NhZ2UsIGlmIGlucHV0IGNhbm5vdCBiZSByZW5kZXJlZCAgICAgICAgICAgXHJcbiAgICAgICB9LFxyXG4gICAgICAgXHJcbiAgICAgICAvKipcclxuICAgICAgICBSZW5kZXJzIGlucHV0IGZyb20gdHBsLiBDYW4gcmV0dXJuIGpRdWVyeSBkZWZlcnJlZCBvYmplY3QuXHJcbiAgICAgICAgQ2FuIGJlIG92ZXJ3cml0dGVuIGluIGNoaWxkIG9iamVjdHNcclxuXHJcbiAgICAgICAgQG1ldGhvZCByZW5kZXIoKVxyXG4gICAgICAgKiovXHJcbiAgICAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgIH0sIFxyXG5cclxuICAgICAgIC8qKlxyXG4gICAgICAgIFNldHMgZWxlbWVudCdzIGh0bWwgYnkgdmFsdWUuIFxyXG5cclxuICAgICAgICBAbWV0aG9kIHZhbHVlMmh0bWwodmFsdWUsIGVsZW1lbnQpXHJcbiAgICAgICAgQHBhcmFtIHttaXhlZH0gdmFsdWVcclxuICAgICAgICBAcGFyYW0ge0RPTUVsZW1lbnR9IGVsZW1lbnRcclxuICAgICAgICoqL1xyXG4gICAgICAgdmFsdWUyaHRtbDogZnVuY3Rpb24odmFsdWUsIGVsZW1lbnQpIHtcclxuICAgICAgICAgICAkKGVsZW1lbnQpW3RoaXMub3B0aW9ucy5lc2NhcGUgPyAndGV4dCcgOiAnaHRtbCddKCQudHJpbSh2YWx1ZSkpO1xyXG4gICAgICAgfSxcclxuXHJcbiAgICAgICAvKipcclxuICAgICAgICBDb252ZXJ0cyBlbGVtZW50J3MgaHRtbCB0byB2YWx1ZVxyXG5cclxuICAgICAgICBAbWV0aG9kIGh0bWwydmFsdWUoaHRtbClcclxuICAgICAgICBAcGFyYW0ge3N0cmluZ30gaHRtbFxyXG4gICAgICAgIEByZXR1cm5zIHttaXhlZH1cclxuICAgICAgICoqL1xyXG4gICAgICAgaHRtbDJ2YWx1ZTogZnVuY3Rpb24oaHRtbCkge1xyXG4gICAgICAgICAgIHJldHVybiAkKCc8ZGl2PicpLmh0bWwoaHRtbCkudGV4dCgpO1xyXG4gICAgICAgfSxcclxuXHJcbiAgICAgICAvKipcclxuICAgICAgICBDb252ZXJ0cyB2YWx1ZSB0byBzdHJpbmcgKGZvciBpbnRlcm5hbCBjb21wYXJlKS4gRm9yIHN1Ym1pdHRpbmcgdG8gc2VydmVyIHVzZWQgdmFsdWUyc3VibWl0KCkuXHJcblxyXG4gICAgICAgIEBtZXRob2QgdmFsdWUyc3RyKHZhbHVlKSBcclxuICAgICAgICBAcGFyYW0ge21peGVkfSB2YWx1ZVxyXG4gICAgICAgIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAgICAgICAqKi9cclxuICAgICAgIHZhbHVlMnN0cjogZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICB9LCBcclxuXHJcbiAgICAgICAvKipcclxuICAgICAgICBDb252ZXJ0cyBzdHJpbmcgcmVjZWl2ZWQgZnJvbSBzZXJ2ZXIgaW50byB2YWx1ZS4gVXN1YWxseSBmcm9tIGBkYXRhLXZhbHVlYCBhdHRyaWJ1dGUuXHJcblxyXG4gICAgICAgIEBtZXRob2Qgc3RyMnZhbHVlKHN0cilcclxuICAgICAgICBAcGFyYW0ge3N0cmluZ30gc3RyXHJcbiAgICAgICAgQHJldHVybnMge21peGVkfVxyXG4gICAgICAgKiovXHJcbiAgICAgICBzdHIydmFsdWU6IGZ1bmN0aW9uKHN0cikge1xyXG4gICAgICAgICAgIHJldHVybiBzdHI7XHJcbiAgICAgICB9LCBcclxuICAgICAgIFxyXG4gICAgICAgLyoqXHJcbiAgICAgICAgQ29udmVydHMgdmFsdWUgZm9yIHN1Ym1pdHRpbmcgdG8gc2VydmVyLiBSZXN1bHQgY2FuIGJlIHN0cmluZyBvciBvYmplY3QuXHJcblxyXG4gICAgICAgIEBtZXRob2QgdmFsdWUyc3VibWl0KHZhbHVlKSBcclxuICAgICAgICBAcGFyYW0ge21peGVkfSB2YWx1ZVxyXG4gICAgICAgIEByZXR1cm5zIHttaXhlZH1cclxuICAgICAgICoqL1xyXG4gICAgICAgdmFsdWUyc3VibWl0OiBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgIH0sXHJcblxyXG4gICAgICAgLyoqXHJcbiAgICAgICAgU2V0cyB2YWx1ZSBvZiBpbnB1dC5cclxuXHJcbiAgICAgICAgQG1ldGhvZCB2YWx1ZTJpbnB1dCh2YWx1ZSkgXHJcbiAgICAgICAgQHBhcmFtIHttaXhlZH0gdmFsdWVcclxuICAgICAgICoqL1xyXG4gICAgICAgdmFsdWUyaW5wdXQ6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgICAgdGhpcy4kaW5wdXQudmFsKHZhbHVlKTtcclxuICAgICAgIH0sXHJcblxyXG4gICAgICAgLyoqXHJcbiAgICAgICAgUmV0dXJucyB2YWx1ZSBvZiBpbnB1dC4gVmFsdWUgY2FuIGJlIG9iamVjdCAoZS5nLiBkYXRlcGlja2VyKVxyXG5cclxuICAgICAgICBAbWV0aG9kIGlucHV0MnZhbHVlKCkgXHJcbiAgICAgICAqKi9cclxuICAgICAgIGlucHV0MnZhbHVlOiBmdW5jdGlvbigpIHsgXHJcbiAgICAgICAgICAgcmV0dXJuIHRoaXMuJGlucHV0LnZhbCgpO1xyXG4gICAgICAgfSwgXHJcblxyXG4gICAgICAgLyoqXHJcbiAgICAgICAgQWN0aXZhdGVzIGlucHV0LiBGb3IgdGV4dCBpdCBzZXRzIGZvY3VzLlxyXG5cclxuICAgICAgICBAbWV0aG9kIGFjdGl2YXRlKCkgXHJcbiAgICAgICAqKi9cclxuICAgICAgIGFjdGl2YXRlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICBpZih0aGlzLiRpbnB1dC5pcygnOnZpc2libGUnKSkge1xyXG4gICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgICAgIH1cclxuICAgICAgIH0sXHJcblxyXG4gICAgICAgLyoqXHJcbiAgICAgICAgQ3JlYXRlcyBpbnB1dC5cclxuXHJcbiAgICAgICAgQG1ldGhvZCBjbGVhcigpIFxyXG4gICAgICAgKiovICAgICAgICBcclxuICAgICAgIGNsZWFyOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICB0aGlzLiRpbnB1dC52YWwobnVsbCk7XHJcbiAgICAgICB9LFxyXG5cclxuICAgICAgIC8qKlxyXG4gICAgICAgIG1ldGhvZCB0byBlc2NhcGUgaHRtbC5cclxuICAgICAgICoqL1xyXG4gICAgICAgZXNjYXBlOiBmdW5jdGlvbihzdHIpIHtcclxuICAgICAgICAgICByZXR1cm4gJCgnPGRpdj4nKS50ZXh0KHN0cikuaHRtbCgpO1xyXG4gICAgICAgfSxcclxuICAgICAgIFxyXG4gICAgICAgLyoqXHJcbiAgICAgICAgYXR0YWNoIGhhbmRsZXIgdG8gYXV0b21hdGljYWxseSBzdWJtaXQgZm9ybSB3aGVuIHZhbHVlIGNoYW5nZWQgKHVzZWZ1bCB3aGVuIGJ1dHRvbnMgbm90IHNob3duKVxyXG4gICAgICAgKiovXHJcbiAgICAgICBhdXRvc3VibWl0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICBcclxuICAgICAgIH0sXHJcbiAgICAgICBcclxuICAgICAgIC8qKlxyXG4gICAgICAgQWRkaXRpb25hbCBhY3Rpb25zIHdoZW4gZGVzdHJveWluZyBlbGVtZW50IFxyXG4gICAgICAgKiovXHJcbiAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcclxuICAgICAgIH0sXHJcblxyXG4gICAgICAgLy8gLS0tLS0tLS0gaGVscGVyIGZ1bmN0aW9ucyAtLS0tLS0tLVxyXG4gICAgICAgc2V0Q2xhc3M6IGZ1bmN0aW9uKCkgeyAgICAgICAgICBcclxuICAgICAgICAgICBpZih0aGlzLm9wdGlvbnMuaW5wdXRjbGFzcykge1xyXG4gICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuaW5wdXRjbGFzcyk7IFxyXG4gICAgICAgICAgIH0gXHJcbiAgICAgICB9LFxyXG5cclxuICAgICAgIHNldEF0dHI6IGZ1bmN0aW9uKGF0dHIpIHtcclxuICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zW2F0dHJdICE9PSB1bmRlZmluZWQgJiYgdGhpcy5vcHRpb25zW2F0dHJdICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgIHRoaXMuJGlucHV0LmF0dHIoYXR0ciwgdGhpcy5vcHRpb25zW2F0dHJdKTtcclxuICAgICAgICAgICB9IFxyXG4gICAgICAgfSxcclxuICAgICAgIFxyXG4gICAgICAgb3B0aW9uOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9uc1trZXldID0gdmFsdWU7XHJcbiAgICAgICB9XHJcbiAgICAgICBcclxuICAgIH07XHJcbiAgICAgICAgXHJcbiAgICBBYnN0cmFjdElucHV0LmRlZmF1bHRzID0geyAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgSFRNTCB0ZW1wbGF0ZSBvZiBpbnB1dC4gTm9ybWFsbHkgeW91IHNob3VsZCBub3QgY2hhbmdlIGl0LlxyXG5cclxuICAgICAgICBAcHJvcGVydHkgdHBsIFxyXG4gICAgICAgIEB0eXBlIHN0cmluZ1xyXG4gICAgICAgIEBkZWZhdWx0ICcnXHJcbiAgICAgICAgKiovICAgXHJcbiAgICAgICAgdHBsOiAnJyxcclxuICAgICAgICAvKipcclxuICAgICAgICBDU1MgY2xhc3MgYXV0b21hdGljYWxseSBhcHBsaWVkIHRvIGlucHV0XHJcbiAgICAgICAgXHJcbiAgICAgICAgQHByb3BlcnR5IGlucHV0Y2xhc3MgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nXHJcbiAgICAgICAgQGRlZmF1bHQgbnVsbFxyXG4gICAgICAgICoqLyAgICAgICAgIFxyXG4gICAgICAgIGlucHV0Y2xhc3M6IG51bGwsXHJcbiAgICAgICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgSWYgYHRydWVgIC0gaHRtbCB3aWxsIGJlIGVzY2FwZWQgaW4gY29udGVudCBvZiBlbGVtZW50IHZpYSAkLnRleHQoKSBtZXRob2QuICBcclxuICAgICAgICBJZiBgZmFsc2VgIC0gaHRtbCB3aWxsIG5vdCBiZSBlc2NhcGVkLCAkLmh0bWwoKSB1c2VkLiAgXHJcbiAgICAgICAgV2hlbiB5b3UgdXNlIG93biBgZGlzcGxheWAgZnVuY3Rpb24sIHRoaXMgb3B0aW9uIG9idmlvc2x5IGhhcyBubyBlZmZlY3QuXHJcbiAgICAgICAgXHJcbiAgICAgICAgQHByb3BlcnR5IGVzY2FwZSBcclxuICAgICAgICBAdHlwZSBib29sZWFuXHJcbiAgICAgICAgQHNpbmNlIDEuNS4wXHJcbiAgICAgICAgQGRlZmF1bHQgdHJ1ZVxyXG4gICAgICAgICoqLyAgICAgICAgIFxyXG4gICAgICAgIGVzY2FwZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIC8vc2NvcGUgZm9yIGV4dGVybmFsIG1ldGhvZHMgKGUuZy4gc291cmNlIGRlZmluZWQgYXMgZnVuY3Rpb24pXHJcbiAgICAgICAgLy9mb3IgaW50ZXJuYWwgdXNlIG9ubHlcclxuICAgICAgICBzY29wZTogbnVsbCxcclxuICAgICAgICBcclxuICAgICAgICAvL25lZWQgdG8gcmUtZGVjbGFyZSBzaG93YnV0dG9ucyBoZXJlIHRvIGdldCBpdCdzIHZhbHVlIGZyb20gY29tbW9uIGNvbmZpZyAocGFzc2VkIG9ubHkgb3B0aW9ucyBleGlzdGluZyBpbiBkZWZhdWx0cylcclxuICAgICAgICBzaG93YnV0dG9uczogdHJ1ZSBcclxuICAgIH07XHJcbiAgICBcclxuICAgICQuZXh0ZW5kKCQuZm4uZWRpdGFibGV0eXBlcywge2Fic3RyYWN0aW5wdXQ6IEFic3RyYWN0SW5wdXR9KTtcclxuICAgICAgICBcclxufSh3aW5kb3cualF1ZXJ5KSk7XHJcblxyXG4vKipcclxuTGlzdCAtIGFic3RyYWN0IGNsYXNzIGZvciBpbnB1dHMgdGhhdCBoYXZlIHNvdXJjZSBvcHRpb24gbG9hZGVkIGZyb20ganMgYXJyYXkgb3IgdmlhIGFqYXhcclxuXHJcbkBjbGFzcyBsaXN0XHJcbkBleHRlbmRzIGFic3RyYWN0aW5wdXRcclxuKiovXHJcbihmdW5jdGlvbiAoJCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBcclxuICAgIHZhciBMaXN0ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICAkLmZuLmVkaXRhYmxldXRpbHMuaW5oZXJpdChMaXN0LCAkLmZuLmVkaXRhYmxldHlwZXMuYWJzdHJhY3RpbnB1dCk7XHJcblxyXG4gICAgJC5leHRlbmQoTGlzdC5wcm90b3R5cGUsIHtcclxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5lcnJvciA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMub25Tb3VyY2VSZWFkeShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckxpc3QoKTtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvciA9IHRoaXMub3B0aW9ucy5zb3VyY2VFcnJvcjtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGh0bWwydmFsdWU6IGZ1bmN0aW9uIChodG1sKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsOyAvL2Nhbid0IHNldCB2YWx1ZSBieSB0ZXh0XHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICB2YWx1ZTJodG1sOiBmdW5jdGlvbiAodmFsdWUsIGVsZW1lbnQsIGRpc3BsYXksIHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKSxcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIGRpc3BsYXkgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9jdXN0b20gZGlzcGxheSBtZXRob2RcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheS5jYWxsKGVsZW1lbnQsIHZhbHVlLCB0aGlzLnNvdXJjZURhdGEsIHJlc3BvbnNlKTsgXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZTJodG1sRmluYWwodmFsdWUsIGVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XHJcbiAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2ZvciBudWxsIHZhbHVlIGp1c3QgY2FsbCBzdWNjZXNzIHdpdGhvdXQgbG9hZGluZyBzb3VyY2VcclxuICAgICAgICAgICAgaWYodmFsdWUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgc3VjY2Vzcy5jYWxsKHRoaXMpOyAgIFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICB0aGlzLm9uU291cmNlUmVhZHkoc3VjY2VzcywgZnVuY3Rpb24gKCkgeyBkZWZlcnJlZC5yZXNvbHZlKCk7IH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xyXG4gICAgICAgIH0sICBcclxuXHJcbiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLSBhZGRpdGlvbmFsIGZ1bmN0aW9ucyAtLS0tLS0tLS0tLS1cclxuXHJcbiAgICAgICAgb25Tb3VyY2VSZWFkeTogZnVuY3Rpb24gKHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgICAgIC8vcnVuIHNvdXJjZSBpZiBpdCBmdW5jdGlvblxyXG4gICAgICAgICAgICB2YXIgc291cmNlO1xyXG4gICAgICAgICAgICBpZiAoJC5pc0Z1bmN0aW9uKHRoaXMub3B0aW9ucy5zb3VyY2UpKSB7XHJcbiAgICAgICAgICAgICAgICBzb3VyY2UgPSB0aGlzLm9wdGlvbnMuc291cmNlLmNhbGwodGhpcy5vcHRpb25zLnNjb3BlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc291cmNlRGF0YSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAvL25vdGU6IGlmIGZ1bmN0aW9uIHJldHVybnMgdGhlIHNhbWUgc291cmNlIGFzIFVSTCAtIHNvdXJjZURhdGEgd2lsbCBiZSB0YWtlbiBmcm9tIGNhaGNlIGFuZCBubyBleHRyYSByZXF1ZXN0IHBlcmZvcm1lZFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc291cmNlID0gdGhpcy5vcHRpb25zLnNvdXJjZTtcclxuICAgICAgICAgICAgfSAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9pZiBhbGxyZWFkeSBsb2FkZWQganVzdCBjYWxsIHN1Y2Nlc3NcclxuICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLnNvdXJjZUNhY2hlICYmICQuaXNBcnJheSh0aGlzLnNvdXJjZURhdGEpKSB7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzLmNhbGwodGhpcyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47IFxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL3RyeSBwYXJzZSBqc29uIGluIHNpbmdsZSBxdW90ZXMgKGZvciBkb3VibGUgcXVvdGVzIGpxdWVyeSBkb2VzIGF1dG9tYXRpY2FsbHkpXHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBzb3VyY2UgPSAkLmZuLmVkaXRhYmxldXRpbHMudHJ5UGFyc2VKc29uKHNvdXJjZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICBlcnJvci5jYWxsKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL2xvYWRpbmcgZnJvbSB1cmxcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzb3VyY2UgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAvL3RyeSB0byBnZXQgc291cmNlRGF0YSBmcm9tIGNhY2hlXHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLm9wdGlvbnMuc291cmNlQ2FjaGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2FjaGVJRCA9IHNvdXJjZSxcclxuICAgICAgICAgICAgICAgICAgICBjYWNoZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkKGRvY3VtZW50KS5kYXRhKGNhY2hlSUQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLmRhdGEoY2FjaGVJRCwge30pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjYWNoZSA9ICQoZG9jdW1lbnQpLmRhdGEoY2FjaGVJRCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vY2hlY2sgZm9yIGNhY2hlZCBkYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhY2hlLmxvYWRpbmcgPT09IGZhbHNlICYmIGNhY2hlLnNvdXJjZURhdGEpIHsgLy90YWtlIHNvdXJjZSBmcm9tIGNhY2hlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc291cmNlRGF0YSA9IGNhY2hlLnNvdXJjZURhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG9QcmVwZW5kKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MuY2FsbCh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2FjaGUubG9hZGluZyA9PT0gdHJ1ZSkgeyAvL2NhY2hlIGlzIGxvYWRpbmcsIHB1dCBjYWxsYmFjayBpbiBzdGFjayB0byBiZSBjYWxsZWQgbGF0ZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGUuY2FsbGJhY2tzLnB1c2goJC5wcm94eShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZURhdGEgPSBjYWNoZS5zb3VyY2VEYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb1ByZXBlbmQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MuY2FsbCh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9hbHNvIGNvbGxlY3RpbmcgZXJyb3IgY2FsbGJhY2tzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlLmVycl9jYWxsYmFja3MucHVzaCgkLnByb3h5KGVycm9yLCB0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvL25vIGNhY2hlIHlldCwgYWN0aXZhdGUgaXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGUubG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlLmNhbGxiYWNrcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWNoZS5lcnJfY2FsbGJhY2tzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvL2FqYXhPcHRpb25zIGZvciBzb3VyY2UuIENhbiBiZSBvdmVyd3JpdHRlbiBidCBvcHRpb25zLnNvdXJjZU9wdGlvbnNcclxuICAgICAgICAgICAgICAgIHZhciBhamF4T3B0aW9ucyA9ICQuZXh0ZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6IHNvdXJjZSxcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ2V0JyxcclxuICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcclxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiAkLnByb3h5KGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNhY2hlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZS5sb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zb3VyY2VEYXRhID0gdGhpcy5tYWtlQXJyYXkoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQuaXNBcnJheSh0aGlzLnNvdXJjZURhdGEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjYWNoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vc3RvcmUgcmVzdWx0IGluIGNhY2hlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGUuc291cmNlRGF0YSA9IHRoaXMuc291cmNlRGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3J1biBzdWNjZXNzIGNhbGxiYWNrcyBmb3Igb3RoZXIgZmllbGRzIHdhaXRpbmcgZm9yIHRoaXMgc291cmNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGNhY2hlLmNhbGxiYWNrcywgZnVuY3Rpb24gKCkgeyB0aGlzLmNhbGwoKTsgfSk7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb1ByZXBlbmQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MuY2FsbCh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yLmNhbGwodGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjYWNoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vcnVuIGVycm9yIGNhbGxiYWNrcyBmb3Igb3RoZXIgZmllbGRzIHdhaXRpbmcgZm9yIHRoaXMgc291cmNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGNhY2hlLmVycl9jYWxsYmFja3MsIGZ1bmN0aW9uICgpIHsgdGhpcy5jYWxsKCk7IH0pOyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpLFxyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiAkLnByb3h5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IuY2FsbCh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2FjaGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZS5sb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9ydW4gZXJyb3IgY2FsbGJhY2tzIGZvciBvdGhlciBmaWVsZHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goY2FjaGUuZXJyX2NhbGxiYWNrcywgZnVuY3Rpb24gKCkgeyB0aGlzLmNhbGwoKTsgfSk7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcylcclxuICAgICAgICAgICAgICAgIH0sIHRoaXMub3B0aW9ucy5zb3VyY2VPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy9sb2FkaW5nIHNvdXJjZURhdGEgZnJvbSBzZXJ2ZXJcclxuICAgICAgICAgICAgICAgICQuYWpheChhamF4T3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSBlbHNlIHsgLy9vcHRpb25zIGFzIGpzb24vYXJyYXlcclxuICAgICAgICAgICAgICAgIHRoaXMuc291cmNlRGF0YSA9IHRoaXMubWFrZUFycmF5KHNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZigkLmlzQXJyYXkodGhpcy5zb3VyY2VEYXRhKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZG9QcmVwZW5kKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzcy5jYWxsKHRoaXMpOyAgIFxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBlcnJvci5jYWxsKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgZG9QcmVwZW5kOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmKHRoaXMub3B0aW9ucy5wcmVwZW5kID09PSBudWxsIHx8IHRoaXMub3B0aW9ucy5wcmVwZW5kID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjsgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZighJC5pc0FycmF5KHRoaXMucHJlcGVuZERhdGEpKSB7XHJcbiAgICAgICAgICAgICAgICAvL3J1biBwcmVwZW5kIGlmIGl0IGlzIGZ1bmN0aW9uIChvbmNlKVxyXG4gICAgICAgICAgICAgICAgaWYgKCQuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMucHJlcGVuZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMucHJlcGVuZCA9IHRoaXMub3B0aW9ucy5wcmVwZW5kLmNhbGwodGhpcy5vcHRpb25zLnNjb3BlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vdHJ5IHBhcnNlIGpzb24gaW4gc2luZ2xlIHF1b3Rlc1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnByZXBlbmQgPSAkLmZuLmVkaXRhYmxldXRpbHMudHJ5UGFyc2VKc29uKHRoaXMub3B0aW9ucy5wcmVwZW5kLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy9jb252ZXJ0IHByZXBlbmQgZnJvbSBzdHJpbmcgdG8gb2JqZWN0XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5wcmVwZW5kID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5wcmVwZW5kID0geycnOiB0aGlzLm9wdGlvbnMucHJlcGVuZH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMucHJlcGVuZERhdGEgPSB0aGlzLm1ha2VBcnJheSh0aGlzLm9wdGlvbnMucHJlcGVuZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKCQuaXNBcnJheSh0aGlzLnByZXBlbmREYXRhKSAmJiAkLmlzQXJyYXkodGhpcy5zb3VyY2VEYXRhKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zb3VyY2VEYXRhID0gdGhpcy5wcmVwZW5kRGF0YS5jb25jYXQodGhpcy5zb3VyY2VEYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIHJlbmRlcnMgaW5wdXQgbGlzdFxyXG4gICAgICAgICovXHJcbiAgICAgICAgcmVuZGVyTGlzdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMgbWV0aG9kIHNob3VsZCBiZSBvdmVyd3JpdHRlbiBpbiBjaGlsZCBjbGFzc1xyXG4gICAgICAgIH0sXHJcbiAgICAgICBcclxuICAgICAgICAgLypcclxuICAgICAgICAgc2V0IGVsZW1lbnQncyBodG1sIGJ5IHZhbHVlXHJcbiAgICAgICAgKi9cclxuICAgICAgICB2YWx1ZTJodG1sRmluYWw6IGZ1bmN0aW9uKHZhbHVlLCBlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMgbWV0aG9kIHNob3VsZCBiZSBvdmVyd3JpdHRlbiBpbiBjaGlsZCBjbGFzc1xyXG4gICAgICAgIH0sICAgICAgICBcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgKiBjb252ZXJ0IGRhdGEgdG8gYXJyYXkgc3VpdGFibGUgZm9yIHNvdXJjZURhdGEsIGUuZy4gW3t2YWx1ZTogMSwgdGV4dDogJ2FiYyd9LCB7Li4ufV1cclxuICAgICAgICAqL1xyXG4gICAgICAgIG1ha2VBcnJheTogZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgY291bnQsIG9iaiwgcmVzdWx0ID0gW10sIGl0ZW0sIGl0ZXJhdGVJdGVtO1xyXG4gICAgICAgICAgICBpZighZGF0YSB8fCB0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsOyBcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYoJC5pc0FycmF5KGRhdGEpKSB7IC8vYXJyYXlcclxuICAgICAgICAgICAgICAgIC8qIFxyXG4gICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gdG8gaXRlcmF0ZSBpbnNpZGUgaXRlbSBvZiBhcnJheSBpZiBpdGVtIGlzIG9iamVjdC5cclxuICAgICAgICAgICAgICAgICAgIENhY2x1bGF0ZXMgY291bnQgb2Yga2V5cyBpbiBpdGVtIGFuZCBzdG9yZSBpbiBvYmouIFxyXG4gICAgICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgICAgIGl0ZXJhdGVJdGVtID0gZnVuY3Rpb24gKGssIHYpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmogPSB7dmFsdWU6IGssIHRleHQ6IHZ9O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGNvdW50KysgPj0gMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7Ly8gZXhpdCBmcm9tIGBlYWNoYCBpZiBpdGVtIGhhcyBtb3JlIHRoYW4gb25lIGtleS5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGRhdGFbaV07IFxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBpdGVtID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudCA9IDA7IC8vY291bnQgb2Yga2V5cyBpbnNpZGUgaXRlbVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goaXRlbSwgaXRlcmF0ZUl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2Nhc2U6IFt7dmFsMTogJ3RleHQxJ30sIHt2YWwyOiAndGV4dDJ9IC4uLl1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoY291bnQgPT09IDEpIHsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChvYmopOyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY2FzZTogW3t2YWx1ZTogMSwgdGV4dDogJ3RleHQxJ30sIHt2YWx1ZTogMiwgdGV4dDogJ3RleHQyJ30sIC4uLl1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKGNvdW50ID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9yZW1vdmVkIGNoZWNrIG9mIGV4aXN0YW5jZTogaXRlbS5oYXNPd25Qcm9wZXJ0eSgndmFsdWUnKSAmJiBpdGVtLmhhc093blByb3BlcnR5KCd0ZXh0JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0uY2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmNoaWxkcmVuID0gdGhpcy5tYWtlQXJyYXkoaXRlbS5jaGlsZHJlbik7ICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY2FzZTogWyd0ZXh0MScsICd0ZXh0MicgLi4uXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7dmFsdWU6IGl0ZW0sIHRleHQ6IGl0ZW19KTsgXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgeyAgLy9jYXNlOiB7dmFsMTogJ3RleHQxJywgdmFsMjogJ3RleHQyLCAuLi59XHJcbiAgICAgICAgICAgICAgICAkLmVhY2goZGF0YSwgZnVuY3Rpb24gKGssIHYpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7dmFsdWU6IGssIHRleHQ6IHZ9KTtcclxuICAgICAgICAgICAgICAgIH0pOyAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIG9wdGlvbjogZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnNba2V5XSA9IHZhbHVlO1xyXG4gICAgICAgICAgICBpZihrZXkgPT09ICdzb3VyY2UnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZURhdGEgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKGtleSA9PT0gJ3ByZXBlbmQnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByZXBlbmREYXRhID0gbnVsbDtcclxuICAgICAgICAgICAgfSAgICAgICAgICAgIFxyXG4gICAgICAgIH0gICAgICAgIFxyXG5cclxuICAgIH0pOyAgICAgIFxyXG5cclxuICAgIExpc3QuZGVmYXVsdHMgPSAkLmV4dGVuZCh7fSwgJC5mbi5lZGl0YWJsZXR5cGVzLmFic3RyYWN0aW5wdXQuZGVmYXVsdHMsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICBTb3VyY2UgZGF0YSBmb3IgbGlzdC4gIFxyXG4gICAgICAgIElmICoqYXJyYXkqKiAtIGl0IHNob3VsZCBiZSBpbiBmb3JtYXQ6IGBbe3ZhbHVlOiAxLCB0ZXh0OiBcInRleHQxXCJ9LCB7dmFsdWU6IDIsIHRleHQ6IFwidGV4dDJcIn0sIC4uLl1gICBcclxuICAgICAgICBGb3IgY29tcGFiaWxpdHksIG9iamVjdCBmb3JtYXQgaXMgYWxzbyBzdXBwb3J0ZWQ6IGB7XCIxXCI6IFwidGV4dDFcIiwgXCIyXCI6IFwidGV4dDJcIiAuLi59YCBidXQgaXQgZG9lcyBub3QgZ3VhcmFudGVlIGVsZW1lbnRzIG9yZGVyLlxyXG4gICAgICAgIFxyXG4gICAgICAgIElmICoqc3RyaW5nKiogLSBjb25zaWRlcmVkIGFqYXggdXJsIHRvIGxvYWQgaXRlbXMuIEluIHRoYXQgY2FzZSByZXN1bHRzIHdpbGwgYmUgY2FjaGVkIGZvciBmaWVsZHMgd2l0aCB0aGUgc2FtZSBzb3VyY2UgYW5kIG5hbWUuIFNlZSBhbHNvIGBzb3VyY2VDYWNoZWAgb3B0aW9uLlxyXG4gICAgICAgICAgXHJcbiAgICAgICAgSWYgKipmdW5jdGlvbioqLCBpdCBzaG91bGQgcmV0dXJuIGRhdGEgaW4gZm9ybWF0IGFib3ZlIChzaW5jZSAxLjQuMCkuXHJcbiAgICAgICAgXHJcbiAgICAgICAgU2luY2UgMS40LjEga2V5IGBjaGlsZHJlbmAgc3VwcG9ydGVkIHRvIHJlbmRlciBPUFRHUk9VUCAoZm9yICoqc2VsZWN0KiogaW5wdXQgb25seSkuICBcclxuICAgICAgICBgW3t0ZXh0OiBcImdyb3VwMVwiLCBjaGlsZHJlbjogW3t2YWx1ZTogMSwgdGV4dDogXCJ0ZXh0MVwifSwge3ZhbHVlOiAyLCB0ZXh0OiBcInRleHQyXCJ9XX0sIC4uLl1gIFxyXG5cclxuXHRcdFxyXG4gICAgICAgIEBwcm9wZXJ0eSBzb3VyY2UgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nIHwgYXJyYXkgfCBvYmplY3QgfCBmdW5jdGlvblxyXG4gICAgICAgIEBkZWZhdWx0IG51bGxcclxuICAgICAgICAqKi8gICAgICAgICBcclxuICAgICAgICBzb3VyY2U6IG51bGwsIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIERhdGEgYXV0b21hdGljYWxseSBwcmVwZW5kZWQgdG8gdGhlIGJlZ2lubmluZyBvZiBkcm9wZG93biBsaXN0LlxyXG4gICAgICAgIFxyXG4gICAgICAgIEBwcm9wZXJ0eSBwcmVwZW5kIFxyXG4gICAgICAgIEB0eXBlIHN0cmluZyB8IGFycmF5IHwgb2JqZWN0IHwgZnVuY3Rpb25cclxuICAgICAgICBAZGVmYXVsdCBmYWxzZVxyXG4gICAgICAgICoqLyAgICAgICAgIFxyXG4gICAgICAgIHByZXBlbmQ6IGZhbHNlLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEVycm9yIG1lc3NhZ2Ugd2hlbiBsaXN0IGNhbm5vdCBiZSBsb2FkZWQgKGUuZy4gYWpheCBlcnJvcilcclxuICAgICAgICBcclxuICAgICAgICBAcHJvcGVydHkgc291cmNlRXJyb3IgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nXHJcbiAgICAgICAgQGRlZmF1bHQgRXJyb3Igd2hlbiBsb2FkaW5nIGxpc3RcclxuICAgICAgICAqKi8gICAgICAgICAgXHJcbiAgICAgICAgc291cmNlRXJyb3I6ICdFcnJvciB3aGVuIGxvYWRpbmcgbGlzdCcsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgaWYgPGNvZGU+dHJ1ZTwvY29kZT4gYW5kIHNvdXJjZSBpcyAqKnN0cmluZyB1cmwqKiAtIHJlc3VsdHMgd2lsbCBiZSBjYWNoZWQgZm9yIGZpZWxkcyB3aXRoIHRoZSBzYW1lIHNvdXJjZS4gICAgXHJcbiAgICAgICAgVXNlZnVsbCBmb3IgZWRpdGFibGUgY29sdW1uIGluIGdyaWQgdG8gcHJldmVudCBleHRyYSByZXF1ZXN0cy5cclxuICAgICAgICBcclxuICAgICAgICBAcHJvcGVydHkgc291cmNlQ2FjaGUgXHJcbiAgICAgICAgQHR5cGUgYm9vbGVhblxyXG4gICAgICAgIEBkZWZhdWx0IHRydWVcclxuICAgICAgICBAc2luY2UgMS4yLjBcclxuICAgICAgICAqKi8gICAgICAgIFxyXG4gICAgICAgIHNvdXJjZUNhY2hlOiB0cnVlLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEFkZGl0aW9uYWwgYWpheCBvcHRpb25zIHRvIGJlIHVzZWQgaW4gJC5hamF4KCkgd2hlbiBsb2FkaW5nIGxpc3QgZnJvbSBzZXJ2ZXIuXHJcbiAgICAgICAgVXNlZnVsIHRvIHNlbmQgZXh0cmEgcGFyYW1ldGVycyAoYGRhdGFgIGtleSkgb3IgY2hhbmdlIHJlcXVlc3QgbWV0aG9kIChgdHlwZWAga2V5KS5cclxuICAgICAgICBcclxuICAgICAgICBAcHJvcGVydHkgc291cmNlT3B0aW9ucyBcclxuICAgICAgICBAdHlwZSBvYmplY3R8ZnVuY3Rpb25cclxuICAgICAgICBAZGVmYXVsdCBudWxsXHJcbiAgICAgICAgQHNpbmNlIDEuNS4wXHJcbiAgICAgICAgKiovICAgICAgICBcclxuICAgICAgICBzb3VyY2VPcHRpb25zOiBudWxsXHJcbiAgICB9KTtcclxuXHJcbiAgICAkLmZuLmVkaXRhYmxldHlwZXMubGlzdCA9IExpc3Q7ICAgICAgXHJcblxyXG59KHdpbmRvdy5qUXVlcnkpKTtcclxuXHJcbi8qKlxyXG5UZXh0IGlucHV0XHJcblxyXG5AY2xhc3MgdGV4dFxyXG5AZXh0ZW5kcyBhYnN0cmFjdGlucHV0XHJcbkBmaW5hbFxyXG5AZXhhbXBsZVxyXG48YSBocmVmPVwiI1wiIGlkPVwidXNlcm5hbWVcIiBkYXRhLXR5cGU9XCJ0ZXh0XCIgZGF0YS1waz1cIjFcIj5hd2Vzb21lPC9hPlxyXG48c2NyaXB0PlxyXG4kKGZ1bmN0aW9uKCl7XHJcbiAgICAkKCcjdXNlcm5hbWUnKS5lZGl0YWJsZSh7XHJcbiAgICAgICAgdXJsOiAnL3Bvc3QnLFxyXG4gICAgICAgIHRpdGxlOiAnRW50ZXIgdXNlcm5hbWUnXHJcbiAgICB9KTtcclxufSk7XHJcbjwvc2NyaXB0PlxyXG4qKi9cclxuKGZ1bmN0aW9uICgkKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIFxyXG4gICAgdmFyIFRleHQgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgICAgIHRoaXMuaW5pdCgndGV4dCcsIG9wdGlvbnMsIFRleHQuZGVmYXVsdHMpO1xyXG4gICAgfTtcclxuXHJcbiAgICAkLmZuLmVkaXRhYmxldXRpbHMuaW5oZXJpdChUZXh0LCAkLmZuLmVkaXRhYmxldHlwZXMuYWJzdHJhY3RpbnB1dCk7XHJcblxyXG4gICAgJC5leHRlbmQoVGV4dC5wcm90b3R5cGUsIHtcclxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgIHRoaXMucmVuZGVyQ2xlYXIoKTtcclxuICAgICAgICAgICB0aGlzLnNldENsYXNzKCk7XHJcbiAgICAgICAgICAgdGhpcy5zZXRBdHRyKCdwbGFjZWhvbGRlcicpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAgYWN0aXZhdGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZih0aGlzLiRpbnB1dC5pcygnOnZpc2libGUnKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICQuZm4uZWRpdGFibGV1dGlscy5zZXRDdXJzb3JQb3NpdGlvbih0aGlzLiRpbnB1dC5nZXQoMCksIHRoaXMuJGlucHV0LnZhbCgpLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnRvZ2dsZUNsZWFyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b2dnbGVDbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICAvL3JlbmRlciBjbGVhciBidXR0b25cclxuICAgICAgICByZW5kZXJDbGVhcjogIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY2xlYXIpIHtcclxuICAgICAgICAgICAgICAgdGhpcy4kY2xlYXIgPSAkKCc8c3BhbiBjbGFzcz1cImVkaXRhYmxlLWNsZWFyLXhcIj48L3NwYW4+Jyk7XHJcbiAgICAgICAgICAgICAgIHRoaXMuJGlucHV0LmFmdGVyKHRoaXMuJGNsZWFyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoJ3BhZGRpbmctcmlnaHQnLCAyNClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAua2V5dXAoJC5wcm94eShmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vYXJyb3dzLCBlbnRlciwgdGFiLCBldGNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYofiQuaW5BcnJheShlLmtleUNvZGUsIFs0MCwzOCw5LDEzLDI3XSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQudG9nZ2xlQ2xlYXIoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC5wYXJlbnQoKS5jc3MoJ3Bvc2l0aW9uJywgJ3JlbGF0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgIHRoaXMuJGNsZWFyLmNsaWNrKCQucHJveHkodGhpcy5jbGVhciwgdGhpcykpOyAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgfSAgICAgICAgICAgIFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAgcG9zdHJlbmRlcjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8qXHJcbiAgICAgICAgICAgIC8vbm93IGBjbGVhcmAgaXMgcG9zaXRpb25lZCB2aWEgY3NzXHJcbiAgICAgICAgICAgIGlmKHRoaXMuJGNsZWFyKSB7XHJcbiAgICAgICAgICAgICAgICAvL2NhbiBwb3NpdGlvbiBjbGVhciBidXR0b24gb25seSBoZXJlLCB3aGVuIGZvcm0gaXMgc2hvd24gYW5kIGhlaWdodCBjYW4gYmUgY2FsY3VsYXRlZFxyXG4vLyAgICAgICAgICAgICAgICB2YXIgaCA9IHRoaXMuJGlucHV0Lm91dGVySGVpZ2h0KHRydWUpIHx8IDIwLFxyXG4gICAgICAgICAgICAgICAgdmFyIGggPSB0aGlzLiRjbGVhci5wYXJlbnQoKS5oZWlnaHQoKSxcclxuICAgICAgICAgICAgICAgICAgICBkZWx0YSA9IChoIC0gdGhpcy4kY2xlYXIuaGVpZ2h0KCkpIC8gMjtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vdGhpcy4kY2xlYXIuY3NzKHtib3R0b206IGRlbHRhLCByaWdodDogZGVsdGF9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAqLyBcclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vc2hvdyAvIGhpZGUgY2xlYXIgYnV0dG9uXHJcbiAgICAgICAgdG9nZ2xlQ2xlYXI6IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgaWYoIXRoaXMuJGNsZWFyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBsZW4gPSB0aGlzLiRpbnB1dC52YWwoKS5sZW5ndGgsXHJcbiAgICAgICAgICAgICAgICB2aXNpYmxlID0gdGhpcy4kY2xlYXIuaXMoJzp2aXNpYmxlJyk7XHJcbiAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKGxlbiAmJiAhdmlzaWJsZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kY2xlYXIuc2hvdygpO1xyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYoIWxlbiAmJiB2aXNpYmxlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRjbGVhci5oaWRlKCk7XHJcbiAgICAgICAgICAgIH0gXHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICBjbGVhcjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgdGhpcy4kY2xlYXIuaGlkZSgpO1xyXG4gICAgICAgICAgIHRoaXMuJGlucHV0LnZhbCgnJykuZm9jdXMoKTtcclxuICAgICAgICB9ICAgICAgICAgIFxyXG4gICAgfSk7XHJcblxyXG4gICAgVGV4dC5kZWZhdWx0cyA9ICQuZXh0ZW5kKHt9LCAkLmZuLmVkaXRhYmxldHlwZXMuYWJzdHJhY3RpbnB1dC5kZWZhdWx0cywge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEBwcm9wZXJ0eSB0cGwgXHJcbiAgICAgICAgQGRlZmF1bHQgPGlucHV0IHR5cGU9XCJ0ZXh0XCI+XHJcbiAgICAgICAgKiovICAgICAgICAgXHJcbiAgICAgICAgdHBsOiAnPGlucHV0IHR5cGU9XCJ0ZXh0XCI+JyxcclxuICAgICAgICAvKipcclxuICAgICAgICBQbGFjZWhvbGRlciBhdHRyaWJ1dGUgb2YgaW5wdXQuIFNob3duIHdoZW4gaW5wdXQgaXMgZW1wdHkuXHJcblxyXG4gICAgICAgIEBwcm9wZXJ0eSBwbGFjZWhvbGRlciBcclxuICAgICAgICBAdHlwZSBzdHJpbmdcclxuICAgICAgICBAZGVmYXVsdCBudWxsXHJcbiAgICAgICAgKiovICAgICAgICAgICAgIFxyXG4gICAgICAgIHBsYWNlaG9sZGVyOiBudWxsLFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIFdoZXRoZXIgdG8gc2hvdyBgY2xlYXJgIGJ1dHRvbiBcclxuICAgICAgICBcclxuICAgICAgICBAcHJvcGVydHkgY2xlYXIgXHJcbiAgICAgICAgQHR5cGUgYm9vbGVhblxyXG4gICAgICAgIEBkZWZhdWx0IHRydWUgICAgICAgIFxyXG4gICAgICAgICoqL1xyXG4gICAgICAgIGNsZWFyOiB0cnVlXHJcbiAgICB9KTtcclxuXHJcbiAgICAkLmZuLmVkaXRhYmxldHlwZXMudGV4dCA9IFRleHQ7XHJcblxyXG59KHdpbmRvdy5qUXVlcnkpKTtcclxuXHJcbi8qKlxyXG5UZXh0YXJlYSBpbnB1dFxyXG5cclxuQGNsYXNzIHRleHRhcmVhXHJcbkBleHRlbmRzIGFic3RyYWN0aW5wdXRcclxuQGZpbmFsXHJcbkBleGFtcGxlXHJcbjxhIGhyZWY9XCIjXCIgaWQ9XCJjb21tZW50c1wiIGRhdGEtdHlwZT1cInRleHRhcmVhXCIgZGF0YS1waz1cIjFcIj5hd2Vzb21lIGNvbW1lbnQhPC9hPlxyXG48c2NyaXB0PlxyXG4kKGZ1bmN0aW9uKCl7XHJcbiAgICAkKCcjY29tbWVudHMnKS5lZGl0YWJsZSh7XHJcbiAgICAgICAgdXJsOiAnL3Bvc3QnLFxyXG4gICAgICAgIHRpdGxlOiAnRW50ZXIgY29tbWVudHMnLFxyXG4gICAgICAgIHJvd3M6IDEwXHJcbiAgICB9KTtcclxufSk7XHJcbjwvc2NyaXB0PlxyXG4qKi9cclxuKGZ1bmN0aW9uICgkKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIFxyXG4gICAgdmFyIFRleHRhcmVhID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLmluaXQoJ3RleHRhcmVhJywgb3B0aW9ucywgVGV4dGFyZWEuZGVmYXVsdHMpO1xyXG4gICAgfTtcclxuXHJcbiAgICAkLmZuLmVkaXRhYmxldXRpbHMuaW5oZXJpdChUZXh0YXJlYSwgJC5mbi5lZGl0YWJsZXR5cGVzLmFic3RyYWN0aW5wdXQpO1xyXG5cclxuICAgICQuZXh0ZW5kKFRleHRhcmVhLnByb3RvdHlwZSwge1xyXG4gICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0aGlzLnNldENsYXNzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QXR0cigncGxhY2Vob2xkZXInKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRBdHRyKCdyb3dzJyk7ICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2N0cmwgKyBlbnRlclxyXG4gICAgICAgICAgICB0aGlzLiRpbnB1dC5rZXlkb3duKGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS5jdHJsS2V5ICYmIGUud2hpY2ggPT09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCdmb3JtJykuc3VibWl0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAvL3VzaW5nIGB3aGl0ZS1zcGFjZTogcHJlLXdyYXBgIHNvbHZlcyBcXG4gIDwtLT4gQlIgY29udmVyc2lvbiB2ZXJ5IGVsZWdhbnQhXHJcbiAgICAgICAvKiBcclxuICAgICAgIHZhbHVlMmh0bWw6IGZ1bmN0aW9uKHZhbHVlLCBlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBodG1sID0gJycsIGxpbmVzO1xyXG4gICAgICAgICAgICBpZih2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgbGluZXMgPSB2YWx1ZS5zcGxpdChcIlxcblwiKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBsaW5lc1tpXSA9ICQoJzxkaXY+JykudGV4dChsaW5lc1tpXSkuaHRtbCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaHRtbCA9IGxpbmVzLmpvaW4oJzxicj4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkKGVsZW1lbnQpLmh0bWwoaHRtbCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgIFxyXG4gICAgICAgIGh0bWwydmFsdWU6IGZ1bmN0aW9uKGh0bWwpIHtcclxuICAgICAgICAgICAgaWYoIWh0bWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cChTdHJpbmcuZnJvbUNoYXJDb2RlKDEwKSwgJ2cnKTtcclxuICAgICAgICAgICAgdmFyIGxpbmVzID0gaHRtbC5zcGxpdCgvPGJyXFxzKlxcLz8+L2kpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9ICQoJzxkaXY+JykuaHRtbChsaW5lc1tpXSkudGV4dCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBuZXdsaW5lIGNoYXJhY3RlcnMgKFxcbikgdG8gYXZvaWQgdGhlbSBiZWluZyBjb252ZXJ0ZWQgYnkgdmFsdWUyaHRtbCgpIG1ldGhvZFxyXG4gICAgICAgICAgICAgICAgLy8gdGh1cyBhZGRpbmcgZXh0cmEgPGJyPiB0YWdzXHJcbiAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKHJlZ2V4LCAnJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGluZXNbaV0gPSB0ZXh0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBsaW5lcy5qb2luKFwiXFxuXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgYWN0aXZhdGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkLmZuLmVkaXRhYmxldHlwZXMudGV4dC5wcm90b3R5cGUuYWN0aXZhdGUuY2FsbCh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBUZXh0YXJlYS5kZWZhdWx0cyA9ICQuZXh0ZW5kKHt9LCAkLmZuLmVkaXRhYmxldHlwZXMuYWJzdHJhY3RpbnB1dC5kZWZhdWx0cywge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEBwcm9wZXJ0eSB0cGxcclxuICAgICAgICBAZGVmYXVsdCA8dGV4dGFyZWE+PC90ZXh0YXJlYT5cclxuICAgICAgICAqKi9cclxuICAgICAgICB0cGw6Jzx0ZXh0YXJlYT48L3RleHRhcmVhPicsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgQHByb3BlcnR5IGlucHV0Y2xhc3NcclxuICAgICAgICBAZGVmYXVsdCBpbnB1dC1sYXJnZVxyXG4gICAgICAgICoqL1xyXG4gICAgICAgIGlucHV0Y2xhc3M6ICdpbnB1dC1sYXJnZScsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgUGxhY2Vob2xkZXIgYXR0cmlidXRlIG9mIGlucHV0LiBTaG93biB3aGVuIGlucHV0IGlzIGVtcHR5LlxyXG5cclxuICAgICAgICBAcHJvcGVydHkgcGxhY2Vob2xkZXJcclxuICAgICAgICBAdHlwZSBzdHJpbmdcclxuICAgICAgICBAZGVmYXVsdCBudWxsXHJcbiAgICAgICAgKiovXHJcbiAgICAgICAgcGxhY2Vob2xkZXI6IG51bGwsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgTnVtYmVyIG9mIHJvd3MgaW4gdGV4dGFyZWFcclxuXHJcbiAgICAgICAgQHByb3BlcnR5IHJvd3NcclxuICAgICAgICBAdHlwZSBpbnRlZ2VyXHJcbiAgICAgICAgQGRlZmF1bHQgN1xyXG4gICAgICAgICoqLyAgICAgICAgXHJcbiAgICAgICAgcm93czogNyAgICAgICAgXHJcbiAgICB9KTtcclxuXHJcbiAgICAkLmZuLmVkaXRhYmxldHlwZXMudGV4dGFyZWEgPSBUZXh0YXJlYTtcclxuXHJcbn0od2luZG93LmpRdWVyeSkpO1xyXG5cclxuLyoqXHJcblNlbGVjdCAoZHJvcGRvd24pXHJcblxyXG5AY2xhc3Mgc2VsZWN0XHJcbkBleHRlbmRzIGxpc3RcclxuQGZpbmFsXHJcbkBleGFtcGxlXHJcbjxhIGhyZWY9XCIjXCIgaWQ9XCJzdGF0dXNcIiBkYXRhLXR5cGU9XCJzZWxlY3RcIiBkYXRhLXBrPVwiMVwiIGRhdGEtdXJsPVwiL3Bvc3RcIiBkYXRhLXRpdGxlPVwiU2VsZWN0IHN0YXR1c1wiPjwvYT5cclxuPHNjcmlwdD5cclxuJChmdW5jdGlvbigpe1xyXG4gICAgJCgnI3N0YXR1cycpLmVkaXRhYmxlKHtcclxuICAgICAgICB2YWx1ZTogMiwgICAgXHJcbiAgICAgICAgc291cmNlOiBbXHJcbiAgICAgICAgICAgICAge3ZhbHVlOiAxLCB0ZXh0OiAnQWN0aXZlJ30sXHJcbiAgICAgICAgICAgICAge3ZhbHVlOiAyLCB0ZXh0OiAnQmxvY2tlZCd9LFxyXG4gICAgICAgICAgICAgIHt2YWx1ZTogMywgdGV4dDogJ0RlbGV0ZWQnfVxyXG4gICAgICAgICAgIF1cclxuICAgIH0pO1xyXG59KTtcclxuPC9zY3JpcHQ+XHJcbioqL1xyXG4oZnVuY3Rpb24gKCQpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgXHJcbiAgICB2YXIgU2VsZWN0ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLmluaXQoJ3NlbGVjdCcsIG9wdGlvbnMsIFNlbGVjdC5kZWZhdWx0cyk7XHJcbiAgICB9O1xyXG5cclxuICAgICQuZm4uZWRpdGFibGV1dGlscy5pbmhlcml0KFNlbGVjdCwgJC5mbi5lZGl0YWJsZXR5cGVzLmxpc3QpO1xyXG5cclxuICAgICQuZXh0ZW5kKFNlbGVjdC5wcm90b3R5cGUsIHtcclxuICAgICAgICByZW5kZXJMaXN0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQuZW1wdHkoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBmaWxsSXRlbXMgPSBmdW5jdGlvbigkZWwsIGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhdHRyO1xyXG4gICAgICAgICAgICAgICAgaWYoJC5pc0FycmF5KGRhdGEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBpPTA7IGk8ZGF0YS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRhdGFbaV0uY2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHIubGFiZWwgPSBkYXRhW2ldLnRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZWwuYXBwZW5kKGZpbGxJdGVtcygkKCc8b3B0Z3JvdXA+JywgYXR0ciksIGRhdGFbaV0uY2hpbGRyZW4pKTsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyLnZhbHVlID0gZGF0YVtpXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRhdGFbaV0uZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlbC5hcHBlbmQoJCgnPG9wdGlvbj4nLCBhdHRyKS50ZXh0KGRhdGFbaV0udGV4dCkpOyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiAkZWw7XHJcbiAgICAgICAgICAgIH07ICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGZpbGxJdGVtcyh0aGlzLiRpbnB1dCwgdGhpcy5zb3VyY2VEYXRhKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2xhc3MoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vZW50ZXIgc3VibWl0XHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0Lm9uKCdrZXlkb3duLmVkaXRhYmxlJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlLndoaWNoID09PSAxMykge1xyXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgnZm9ybScpLnN1Ym1pdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTsgICAgICAgICAgICBcclxuICAgICAgICB9LFxyXG4gICAgICAgXHJcbiAgICAgICAgdmFsdWUyaHRtbEZpbmFsOiBmdW5jdGlvbih2YWx1ZSwgZWxlbWVudCkge1xyXG4gICAgICAgICAgICB2YXIgdGV4dCA9ICcnLCBcclxuICAgICAgICAgICAgICAgIGl0ZW1zID0gJC5mbi5lZGl0YWJsZXV0aWxzLml0ZW1zQnlWYWx1ZSh2YWx1ZSwgdGhpcy5zb3VyY2VEYXRhKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZihpdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRleHQgPSBpdGVtc1swXS50ZXh0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyQoZWxlbWVudCkudGV4dCh0ZXh0KTtcclxuICAgICAgICAgICAgJC5mbi5lZGl0YWJsZXR5cGVzLmFic3RyYWN0aW5wdXQucHJvdG90eXBlLnZhbHVlMmh0bWwuY2FsbCh0aGlzLCB0ZXh0LCBlbGVtZW50KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIGF1dG9zdWJtaXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB0aGlzLiRpbnB1dC5vZmYoJ2tleWRvd24uZWRpdGFibGUnKS5vbignY2hhbmdlLmVkaXRhYmxlJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgnZm9ybScpLnN1Ym1pdCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTsgICAgICBcclxuXHJcbiAgICBTZWxlY3QuZGVmYXVsdHMgPSAkLmV4dGVuZCh7fSwgJC5mbi5lZGl0YWJsZXR5cGVzLmxpc3QuZGVmYXVsdHMsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICBAcHJvcGVydHkgdHBsIFxyXG4gICAgICAgIEBkZWZhdWx0IDxzZWxlY3Q+PC9zZWxlY3Q+XHJcbiAgICAgICAgKiovICAgICAgICAgXHJcbiAgICAgICAgdHBsOic8c2VsZWN0Pjwvc2VsZWN0PidcclxuICAgIH0pO1xyXG5cclxuICAgICQuZm4uZWRpdGFibGV0eXBlcy5zZWxlY3QgPSBTZWxlY3Q7ICAgICAgXHJcblxyXG59KHdpbmRvdy5qUXVlcnkpKTtcclxuXHJcbi8qKlxyXG5MaXN0IG9mIGNoZWNrYm94ZXMuIFxyXG5JbnRlcm5hbGx5IHZhbHVlIHN0b3JlZCBhcyBqYXZhc2NyaXB0IGFycmF5IG9mIHZhbHVlcy5cclxuXHJcbkBjbGFzcyBjaGVja2xpc3RcclxuQGV4dGVuZHMgbGlzdFxyXG5AZmluYWxcclxuQGV4YW1wbGVcclxuPGEgaHJlZj1cIiNcIiBpZD1cIm9wdGlvbnNcIiBkYXRhLXR5cGU9XCJjaGVja2xpc3RcIiBkYXRhLXBrPVwiMVwiIGRhdGEtdXJsPVwiL3Bvc3RcIiBkYXRhLXRpdGxlPVwiU2VsZWN0IG9wdGlvbnNcIj48L2E+XHJcbjxzY3JpcHQ+XHJcbiQoZnVuY3Rpb24oKXtcclxuICAgICQoJyNvcHRpb25zJykuZWRpdGFibGUoe1xyXG4gICAgICAgIHZhbHVlOiBbMiwgM10sICAgIFxyXG4gICAgICAgIHNvdXJjZTogW1xyXG4gICAgICAgICAgICAgIHt2YWx1ZTogMSwgdGV4dDogJ29wdGlvbjEnfSxcclxuICAgICAgICAgICAgICB7dmFsdWU6IDIsIHRleHQ6ICdvcHRpb24yJ30sXHJcbiAgICAgICAgICAgICAge3ZhbHVlOiAzLCB0ZXh0OiAnb3B0aW9uMyd9XHJcbiAgICAgICAgICAgXVxyXG4gICAgfSk7XHJcbn0pO1xyXG48L3NjcmlwdD5cclxuKiovXHJcbihmdW5jdGlvbiAoJCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBcclxuICAgIHZhciBDaGVja2xpc3QgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgICAgIHRoaXMuaW5pdCgnY2hlY2tsaXN0Jywgb3B0aW9ucywgQ2hlY2tsaXN0LmRlZmF1bHRzKTtcclxuICAgIH07XHJcblxyXG4gICAgJC5mbi5lZGl0YWJsZXV0aWxzLmluaGVyaXQoQ2hlY2tsaXN0LCAkLmZuLmVkaXRhYmxldHlwZXMubGlzdCk7XHJcblxyXG4gICAgJC5leHRlbmQoQ2hlY2tsaXN0LnByb3RvdHlwZSwge1xyXG4gICAgICAgIHJlbmRlckxpc3Q6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgJGxhYmVsLCAkZGl2O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy4kdHBsLmVtcHR5KCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZighJC5pc0FycmF5KHRoaXMuc291cmNlRGF0YSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yKHZhciBpPTA7IGk8dGhpcy5zb3VyY2VEYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAkbGFiZWwgPSAkKCc8bGFiZWw+JykuYXBwZW5kKCQoJzxpbnB1dD4nLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY2hlY2tib3gnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuc291cmNlRGF0YVtpXS52YWx1ZSBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8c3Bhbj4nKS50ZXh0KCcgJyt0aGlzLnNvdXJjZURhdGFbaV0udGV4dCkpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAkKCc8ZGl2PicpLmFwcGVuZCgkbGFiZWwpLmFwcGVuZFRvKHRoaXMuJHRwbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0ID0gdGhpcy4kdHBsLmZpbmQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXScpO1xyXG4gICAgICAgICAgICB0aGlzLnNldENsYXNzKCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgIFxyXG4gICAgICAgdmFsdWUyc3RyOiBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICAgIHJldHVybiAkLmlzQXJyYXkodmFsdWUpID8gdmFsdWUuc29ydCgpLmpvaW4oJC50cmltKHRoaXMub3B0aW9ucy5zZXBhcmF0b3IpKSA6ICcnO1xyXG4gICAgICAgfSwgIFxyXG4gICAgICAgXHJcbiAgICAgICAvL3BhcnNlIHNlcGFyYXRlZCBzdHJpbmdcclxuICAgICAgICBzdHIydmFsdWU6IGZ1bmN0aW9uKHN0cikge1xyXG4gICAgICAgICAgIHZhciByZWcsIHZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICBpZih0eXBlb2Ygc3RyID09PSAnc3RyaW5nJyAmJiBzdHIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgIHJlZyA9IG5ldyBSZWdFeHAoJ1xcXFxzKicrJC50cmltKHRoaXMub3B0aW9ucy5zZXBhcmF0b3IpKydcXFxccyonKTtcclxuICAgICAgICAgICAgICAgdmFsdWUgPSBzdHIuc3BsaXQocmVnKTtcclxuICAgICAgICAgICB9IGVsc2UgaWYoJC5pc0FycmF5KHN0cikpIHtcclxuICAgICAgICAgICAgICAgdmFsdWUgPSBzdHI7IFxyXG4gICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgIHZhbHVlID0gW3N0cl07XHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9LCAgICAgICBcclxuICAgICAgIFxyXG4gICAgICAgLy9zZXQgY2hlY2tlZCBvbiByZXF1aXJlZCBjaGVja2JveGVzXHJcbiAgICAgICB2YWx1ZTJpbnB1dDogZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQucHJvcCgnY2hlY2tlZCcsIGZhbHNlKTtcclxuICAgICAgICAgICAgaWYoJC5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQuZWFjaChmdW5jdGlvbihpLCBlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgdmFyICRlbCA9ICQoZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgLy8gY2Fubm90IHVzZSAkLmluQXJyYXkgYXMgaXQgcGVyZm9ybXMgc3RyaWN0IGNvbXBhcmlzb25cclxuICAgICAgICAgICAgICAgICAgICQuZWFjaCh2YWx1ZSwgZnVuY3Rpb24oaiwgdmFsKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAvKmpzbGludCBlcWVxOiB0cnVlKi9cclxuICAgICAgICAgICAgICAgICAgICAgICBpZigkZWwudmFsKCkgPT0gdmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgLypqc2xpbnQgZXFlcTogZmFsc2UqLyAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAkZWwucHJvcCgnY2hlY2tlZCcsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICB9KTsgXHJcbiAgICAgICAgICAgIH0gIFxyXG4gICAgICAgIH0sICBcclxuICAgICAgICBcclxuICAgICAgIGlucHV0MnZhbHVlOiBmdW5jdGlvbigpIHsgXHJcbiAgICAgICAgICAgdmFyIGNoZWNrZWQgPSBbXTtcclxuICAgICAgICAgICB0aGlzLiRpbnB1dC5maWx0ZXIoJzpjaGVja2VkJykuZWFjaChmdW5jdGlvbihpLCBlbCkge1xyXG4gICAgICAgICAgICAgICBjaGVja2VkLnB1c2goJChlbCkudmFsKCkpO1xyXG4gICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgIHJldHVybiBjaGVja2VkO1xyXG4gICAgICAgfSwgICAgICAgICAgICBcclxuICAgICAgICAgIFxyXG4gICAgICAgLy9jb2xsZWN0IHRleHQgb2YgY2hlY2tlZCBib3hlc1xyXG4gICAgICAgIHZhbHVlMmh0bWxGaW5hbDogZnVuY3Rpb24odmFsdWUsIGVsZW1lbnQpIHtcclxuICAgICAgICAgICB2YXIgaHRtbCA9IFtdLFxyXG4gICAgICAgICAgICAgICBjaGVja2VkID0gJC5mbi5lZGl0YWJsZXV0aWxzLml0ZW1zQnlWYWx1ZSh2YWx1ZSwgdGhpcy5zb3VyY2VEYXRhKSxcclxuICAgICAgICAgICAgICAgZXNjYXBlID0gdGhpcy5vcHRpb25zLmVzY2FwZTtcclxuICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgaWYoY2hlY2tlZC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgJC5lYWNoKGNoZWNrZWQsIGZ1bmN0aW9uKGksIHYpIHtcclxuICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gZXNjYXBlID8gJC5mbi5lZGl0YWJsZXV0aWxzLmVzY2FwZSh2LnRleHQpIDogdi50ZXh0OyBcclxuICAgICAgICAgICAgICAgICAgIGh0bWwucHVzaCh0ZXh0KTsgXHJcbiAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAkKGVsZW1lbnQpLmh0bWwoaHRtbC5qb2luKCc8YnI+JykpO1xyXG4gICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICQoZWxlbWVudCkuZW1wdHkoKTsgXHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICBhY3RpdmF0ZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgdGhpcy4kaW5wdXQuZmlyc3QoKS5mb2N1cygpO1xyXG4gICAgICAgfSxcclxuICAgICAgIFxyXG4gICAgICAgYXV0b3N1Ym1pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgdGhpcy4kaW5wdXQub24oJ2tleWRvd24nLCBmdW5jdGlvbihlKXtcclxuICAgICAgICAgICAgICAgaWYgKGUud2hpY2ggPT09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJ2Zvcm0nKS5zdWJtaXQoKTtcclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgIH0pO1xyXG4gICAgICAgfVxyXG4gICAgfSk7ICAgICAgXHJcblxyXG4gICAgQ2hlY2tsaXN0LmRlZmF1bHRzID0gJC5leHRlbmQoe30sICQuZm4uZWRpdGFibGV0eXBlcy5saXN0LmRlZmF1bHRzLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgQHByb3BlcnR5IHRwbCBcclxuICAgICAgICBAZGVmYXVsdCA8ZGl2PjwvZGl2PlxyXG4gICAgICAgICoqLyAgICAgICAgIFxyXG4gICAgICAgIHRwbDonPGRpdiBjbGFzcz1cImVkaXRhYmxlLWNoZWNrbGlzdFwiPjwvZGl2PicsXHJcbiAgICAgICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgQHByb3BlcnR5IGlucHV0Y2xhc3MgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nXHJcbiAgICAgICAgQGRlZmF1bHQgbnVsbFxyXG4gICAgICAgICoqLyAgICAgICAgIFxyXG4gICAgICAgIGlucHV0Y2xhc3M6IG51bGwsICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICBTZXBhcmF0b3Igb2YgdmFsdWVzIHdoZW4gcmVhZGluZyBmcm9tIGBkYXRhLXZhbHVlYCBhdHRyaWJ1dGVcclxuXHJcbiAgICAgICAgQHByb3BlcnR5IHNlcGFyYXRvciBcclxuICAgICAgICBAdHlwZSBzdHJpbmdcclxuICAgICAgICBAZGVmYXVsdCAnLCdcclxuICAgICAgICAqKi8gICAgICAgICBcclxuICAgICAgICBzZXBhcmF0b3I6ICcsJ1xyXG4gICAgfSk7XHJcblxyXG4gICAgJC5mbi5lZGl0YWJsZXR5cGVzLmNoZWNrbGlzdCA9IENoZWNrbGlzdDsgICAgICBcclxuXHJcbn0od2luZG93LmpRdWVyeSkpO1xyXG5cclxuLyoqXHJcbkhUTUw1IGlucHV0IHR5cGVzLlxyXG5Gb2xsb3dpbmcgdHlwZXMgYXJlIHN1cHBvcnRlZDpcclxuXHJcbiogcGFzc3dvcmRcclxuKiBlbWFpbFxyXG4qIHVybFxyXG4qIHRlbFxyXG4qIG51bWJlclxyXG4qIHJhbmdlXHJcbiogdGltZVxyXG5cclxuTGVhcm4gbW9yZSBhYm91dCBodG1sNSBpbnB1dHM6ICBcclxuaHR0cDovL3d3dy53My5vcmcvd2lraS9IVE1MNV9mb3JtX2FkZGl0aW9ucyAgXHJcblRvIGNoZWNrIGJyb3dzZXIgY29tcGF0aWJpbGl0eSBwbGVhc2Ugc2VlOiAgXHJcbmh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvSFRNTC9FbGVtZW50L0lucHV0XHJcbiAgICAgICAgICAgIFxyXG5AY2xhc3MgaHRtbDV0eXBlcyBcclxuQGV4dGVuZHMgdGV4dFxyXG5AZmluYWxcclxuQHNpbmNlIDEuMy4wXHJcbkBleGFtcGxlXHJcbjxhIGhyZWY9XCIjXCIgaWQ9XCJlbWFpbFwiIGRhdGEtdHlwZT1cImVtYWlsXCIgZGF0YS1waz1cIjFcIj5hZG1pbkBleGFtcGxlLmNvbTwvYT5cclxuPHNjcmlwdD5cclxuJChmdW5jdGlvbigpe1xyXG4gICAgJCgnI2VtYWlsJykuZWRpdGFibGUoe1xyXG4gICAgICAgIHVybDogJy9wb3N0JyxcclxuICAgICAgICB0aXRsZTogJ0VudGVyIGVtYWlsJ1xyXG4gICAgfSk7XHJcbn0pO1xyXG48L3NjcmlwdD5cclxuKiovXHJcblxyXG4vKipcclxuQHByb3BlcnR5IHRwbCBcclxuQGRlZmF1bHQgZGVwZW5kcyBvbiB0eXBlXHJcbioqLyBcclxuXHJcbi8qXHJcblBhc3N3b3JkXHJcbiovXHJcbihmdW5jdGlvbiAoJCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBcclxuICAgIHZhciBQYXNzd29yZCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5pbml0KCdwYXNzd29yZCcsIG9wdGlvbnMsIFBhc3N3b3JkLmRlZmF1bHRzKTtcclxuICAgIH07XHJcbiAgICAkLmZuLmVkaXRhYmxldXRpbHMuaW5oZXJpdChQYXNzd29yZCwgJC5mbi5lZGl0YWJsZXR5cGVzLnRleHQpO1xyXG4gICAgJC5leHRlbmQoUGFzc3dvcmQucHJvdG90eXBlLCB7XHJcbiAgICAgICAvL2RvIG5vdCBkaXNwbGF5IHBhc3N3b3JkLCBzaG93ICdbaGlkZGVuXScgaW5zdGVhZFxyXG4gICAgICAgdmFsdWUyaHRtbDogZnVuY3Rpb24odmFsdWUsIGVsZW1lbnQpIHtcclxuICAgICAgICAgICBpZih2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAkKGVsZW1lbnQpLnRleHQoJ1toaWRkZW5dJyk7XHJcbiAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgJChlbGVtZW50KS5lbXB0eSgpOyBcclxuICAgICAgICAgICB9XHJcbiAgICAgICB9LFxyXG4gICAgICAgLy9hcyBwYXNzd29yZCBub3QgZGlzcGxheWVkLCBzaG91bGQgbm90IHNldCB2YWx1ZSBieSBodG1sXHJcbiAgICAgICBodG1sMnZhbHVlOiBmdW5jdGlvbihodG1sKSB7XHJcbiAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICB9ICAgICAgIFxyXG4gICAgfSk7ICAgIFxyXG4gICAgUGFzc3dvcmQuZGVmYXVsdHMgPSAkLmV4dGVuZCh7fSwgJC5mbi5lZGl0YWJsZXR5cGVzLnRleHQuZGVmYXVsdHMsIHtcclxuICAgICAgICB0cGw6ICc8aW5wdXQgdHlwZT1cInBhc3N3b3JkXCI+J1xyXG4gICAgfSk7XHJcbiAgICAkLmZuLmVkaXRhYmxldHlwZXMucGFzc3dvcmQgPSBQYXNzd29yZDtcclxufSh3aW5kb3cualF1ZXJ5KSk7XHJcblxyXG5cclxuLypcclxuRW1haWxcclxuKi9cclxuKGZ1bmN0aW9uICgkKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIFxyXG4gICAgdmFyIEVtYWlsID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLmluaXQoJ2VtYWlsJywgb3B0aW9ucywgRW1haWwuZGVmYXVsdHMpO1xyXG4gICAgfTtcclxuICAgICQuZm4uZWRpdGFibGV1dGlscy5pbmhlcml0KEVtYWlsLCAkLmZuLmVkaXRhYmxldHlwZXMudGV4dCk7XHJcbiAgICBFbWFpbC5kZWZhdWx0cyA9ICQuZXh0ZW5kKHt9LCAkLmZuLmVkaXRhYmxldHlwZXMudGV4dC5kZWZhdWx0cywge1xyXG4gICAgICAgIHRwbDogJzxpbnB1dCB0eXBlPVwiZW1haWxcIj4nXHJcbiAgICB9KTtcclxuICAgICQuZm4uZWRpdGFibGV0eXBlcy5lbWFpbCA9IEVtYWlsO1xyXG59KHdpbmRvdy5qUXVlcnkpKTtcclxuXHJcblxyXG4vKlxyXG5VcmxcclxuKi9cclxuKGZ1bmN0aW9uICgkKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIFxyXG4gICAgdmFyIFVybCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5pbml0KCd1cmwnLCBvcHRpb25zLCBVcmwuZGVmYXVsdHMpO1xyXG4gICAgfTtcclxuICAgICQuZm4uZWRpdGFibGV1dGlscy5pbmhlcml0KFVybCwgJC5mbi5lZGl0YWJsZXR5cGVzLnRleHQpO1xyXG4gICAgVXJsLmRlZmF1bHRzID0gJC5leHRlbmQoe30sICQuZm4uZWRpdGFibGV0eXBlcy50ZXh0LmRlZmF1bHRzLCB7XHJcbiAgICAgICAgdHBsOiAnPGlucHV0IHR5cGU9XCJ1cmxcIj4nXHJcbiAgICB9KTtcclxuICAgICQuZm4uZWRpdGFibGV0eXBlcy51cmwgPSBVcmw7XHJcbn0od2luZG93LmpRdWVyeSkpO1xyXG5cclxuXHJcbi8qXHJcblRlbFxyXG4qL1xyXG4oZnVuY3Rpb24gKCQpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgXHJcbiAgICB2YXIgVGVsID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLmluaXQoJ3RlbCcsIG9wdGlvbnMsIFRlbC5kZWZhdWx0cyk7XHJcbiAgICB9O1xyXG4gICAgJC5mbi5lZGl0YWJsZXV0aWxzLmluaGVyaXQoVGVsLCAkLmZuLmVkaXRhYmxldHlwZXMudGV4dCk7XHJcbiAgICBUZWwuZGVmYXVsdHMgPSAkLmV4dGVuZCh7fSwgJC5mbi5lZGl0YWJsZXR5cGVzLnRleHQuZGVmYXVsdHMsIHtcclxuICAgICAgICB0cGw6ICc8aW5wdXQgdHlwZT1cInRlbFwiPidcclxuICAgIH0pO1xyXG4gICAgJC5mbi5lZGl0YWJsZXR5cGVzLnRlbCA9IFRlbDtcclxufSh3aW5kb3cualF1ZXJ5KSk7XHJcblxyXG5cclxuLypcclxuTnVtYmVyXHJcbiovXHJcbihmdW5jdGlvbiAoJCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBcclxuICAgIHZhciBOdW1iZXJJbnB1dCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5pbml0KCdudW1iZXInLCBvcHRpb25zLCBOdW1iZXJJbnB1dC5kZWZhdWx0cyk7XHJcbiAgICB9O1xyXG4gICAgJC5mbi5lZGl0YWJsZXV0aWxzLmluaGVyaXQoTnVtYmVySW5wdXQsICQuZm4uZWRpdGFibGV0eXBlcy50ZXh0KTtcclxuICAgICQuZXh0ZW5kKE51bWJlcklucHV0LnByb3RvdHlwZSwge1xyXG4gICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgTnVtYmVySW5wdXQuc3VwZXJjbGFzcy5yZW5kZXIuY2FsbCh0aGlzKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRBdHRyKCdtaW4nKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRBdHRyKCdtYXgnKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRBdHRyKCdzdGVwJyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBwb3N0cmVuZGVyOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYodGhpcy4kY2xlYXIpIHtcclxuICAgICAgICAgICAgICAgIC8vaW5jcmVhc2UgcmlnaHQgZmZzZXQgIGZvciB1cC9kb3duIGFycm93c1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kY2xlYXIuY3NzKHtyaWdodDogMjR9KTtcclxuICAgICAgICAgICAgICAgIC8qXHJcbiAgICAgICAgICAgICAgICAvL2NhbiBwb3NpdGlvbiBjbGVhciBidXR0b24gb25seSBoZXJlLCB3aGVuIGZvcm0gaXMgc2hvd24gYW5kIGhlaWdodCBjYW4gYmUgY2FsY3VsYXRlZFxyXG4gICAgICAgICAgICAgICAgdmFyIGggPSB0aGlzLiRpbnB1dC5vdXRlckhlaWdodCh0cnVlKSB8fCAyMCxcclxuICAgICAgICAgICAgICAgICAgICBkZWx0YSA9IChoIC0gdGhpcy4kY2xlYXIuaGVpZ2h0KCkpIC8gMjtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy9hZGQgMTJweCB0byBvZmZzZXQgcmlnaHQgZm9yIHVwL2Rvd24gYXJyb3dzICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy4kY2xlYXIuY3NzKHt0b3A6IGRlbHRhLCByaWdodDogZGVsdGEgKyAxNn0pO1xyXG4gICAgICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgfSBcclxuICAgICAgICB9ICAgICAgICBcclxuICAgIH0pOyAgICAgXHJcbiAgICBOdW1iZXJJbnB1dC5kZWZhdWx0cyA9ICQuZXh0ZW5kKHt9LCAkLmZuLmVkaXRhYmxldHlwZXMudGV4dC5kZWZhdWx0cywge1xyXG4gICAgICAgIHRwbDogJzxpbnB1dCB0eXBlPVwibnVtYmVyXCI+JyxcclxuICAgICAgICBpbnB1dGNsYXNzOiAnaW5wdXQtbWluaScsXHJcbiAgICAgICAgbWluOiBudWxsLFxyXG4gICAgICAgIG1heDogbnVsbCxcclxuICAgICAgICBzdGVwOiBudWxsXHJcbiAgICB9KTtcclxuICAgICQuZm4uZWRpdGFibGV0eXBlcy5udW1iZXIgPSBOdW1iZXJJbnB1dDtcclxufSh3aW5kb3cualF1ZXJ5KSk7XHJcblxyXG5cclxuLypcclxuUmFuZ2UgKGluaGVyaXQgZnJvbSBudW1iZXIpXHJcbiovXHJcbihmdW5jdGlvbiAoJCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBcclxuICAgIHZhciBSYW5nZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5pbml0KCdyYW5nZScsIG9wdGlvbnMsIFJhbmdlLmRlZmF1bHRzKTtcclxuICAgIH07XHJcbiAgICAkLmZuLmVkaXRhYmxldXRpbHMuaW5oZXJpdChSYW5nZSwgJC5mbi5lZGl0YWJsZXR5cGVzLm51bWJlcik7XHJcbiAgICAkLmV4dGVuZChSYW5nZS5wcm90b3R5cGUsIHtcclxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQgPSB0aGlzLiR0cGwuZmlsdGVyKCdpbnB1dCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5zZXRDbGFzcygpO1xyXG4gICAgICAgICAgICB0aGlzLnNldEF0dHIoJ21pbicpO1xyXG4gICAgICAgICAgICB0aGlzLnNldEF0dHIoJ21heCcpO1xyXG4gICAgICAgICAgICB0aGlzLnNldEF0dHIoJ3N0ZXAnKTsgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQub24oJ2lucHV0JywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICQodGhpcykuc2libGluZ3MoJ291dHB1dCcpLnRleHQoJCh0aGlzKS52YWwoKSk7IFxyXG4gICAgICAgICAgICB9KTsgIFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYWN0aXZhdGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB0aGlzLiRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgIH0gICAgICAgICBcclxuICAgIH0pO1xyXG4gICAgUmFuZ2UuZGVmYXVsdHMgPSAkLmV4dGVuZCh7fSwgJC5mbi5lZGl0YWJsZXR5cGVzLm51bWJlci5kZWZhdWx0cywge1xyXG4gICAgICAgIHRwbDogJzxpbnB1dCB0eXBlPVwicmFuZ2VcIj48b3V0cHV0IHN0eWxlPVwid2lkdGg6IDMwcHg7IGRpc3BsYXk6IGlubGluZS1ibG9ja1wiPjwvb3V0cHV0PicsXHJcbiAgICAgICAgaW5wdXRjbGFzczogJ2lucHV0LW1lZGl1bSdcclxuICAgIH0pO1xyXG4gICAgJC5mbi5lZGl0YWJsZXR5cGVzLnJhbmdlID0gUmFuZ2U7XHJcbn0od2luZG93LmpRdWVyeSkpO1xyXG5cclxuLypcclxuVGltZVxyXG4qL1xyXG4oZnVuY3Rpb24gKCQpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBUaW1lID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLmluaXQoJ3RpbWUnLCBvcHRpb25zLCBUaW1lLmRlZmF1bHRzKTtcclxuICAgIH07XHJcbiAgICAvL2luaGVyaXQgZnJvbSBhYnN0cmFjdCwgYXMgaW5oZXJpdGFuY2UgZnJvbSB0ZXh0IGdpdmVzIHNlbGVjdGlvbiBlcnJvci5cclxuICAgICQuZm4uZWRpdGFibGV1dGlscy5pbmhlcml0KFRpbWUsICQuZm4uZWRpdGFibGV0eXBlcy5hYnN0cmFjdGlucHV0KTtcclxuICAgICQuZXh0ZW5kKFRpbWUucHJvdG90eXBlLCB7XHJcbiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICB0aGlzLnNldENsYXNzKCk7XHJcbiAgICAgICAgfSAgICAgICAgXHJcbiAgICB9KTtcclxuICAgIFRpbWUuZGVmYXVsdHMgPSAkLmV4dGVuZCh7fSwgJC5mbi5lZGl0YWJsZXR5cGVzLmFic3RyYWN0aW5wdXQuZGVmYXVsdHMsIHtcclxuICAgICAgICB0cGw6ICc8aW5wdXQgdHlwZT1cInRpbWVcIj4nXHJcbiAgICB9KTtcclxuICAgICQuZm4uZWRpdGFibGV0eXBlcy50aW1lID0gVGltZTtcclxufSh3aW5kb3cualF1ZXJ5KSk7XHJcblxyXG4vKipcclxuU2VsZWN0MiBpbnB1dC4gQmFzZWQgb24gYW1hemluZyB3b3JrIG9mIElnb3IgVmF5bmJlcmcgaHR0cHM6Ly9naXRodWIuY29tL2l2YXluYmVyZy9zZWxlY3QyLiAgXHJcblBsZWFzZSBzZWUgW29yaWdpbmFsIHNlbGVjdDIgZG9jc10oaHR0cDovL2l2YXluYmVyZy5naXRodWIuY29tL3NlbGVjdDIpIGZvciBkZXRhaWxlZCBkZXNjcmlwdGlvbiBhbmQgb3B0aW9ucy4gIFxyXG4gXHJcbllvdSBzaG91bGQgbWFudWFsbHkgZG93bmxvYWQgYW5kIGluY2x1ZGUgc2VsZWN0MiBkaXN0cmlidXRpdmU6ICBcclxuXHJcbiAgICA8bGluayBocmVmPVwic2VsZWN0Mi9zZWxlY3QyLmNzc1wiIHJlbD1cInN0eWxlc2hlZXRcIiB0eXBlPVwidGV4dC9jc3NcIj48L2xpbms+ICBcclxuICAgIDxzY3JpcHQgc3JjPVwic2VsZWN0Mi9zZWxlY3QyLmpzXCI+PC9zY3JpcHQ+ICBcclxuICAgIFxyXG5UbyBtYWtlIGl0ICoqYm9vdHN0cmFwLXN0eWxlZCoqIHlvdSBjYW4gdXNlIGNzcyBmcm9tIFtoZXJlXShodHRwczovL2dpdGh1Yi5jb20vdDBtL3NlbGVjdDItYm9vdHN0cmFwLWNzcyk6IFxyXG5cclxuICAgIDxsaW5rIGhyZWY9XCJzZWxlY3QyLWJvb3RzdHJhcC5jc3NcIiByZWw9XCJzdHlsZXNoZWV0XCIgdHlwZT1cInRleHQvY3NzXCI+PC9saW5rPiAgICBcclxuICAgIFxyXG4qKk5vdGU6KiogY3VycmVudGx5IGBhdXRvdGV4dGAgZmVhdHVyZSBkb2VzIG5vdCB3b3JrIGZvciBzZWxlY3QyIHdpdGggYGFqYXhgIHJlbW90ZSBzb3VyY2UuICAgIFxyXG5Zb3UgbmVlZCBpbml0aWFsbHkgcHV0IGJvdGggYGRhdGEtdmFsdWVgIGFuZCBlbGVtZW50J3MgdGV4dCB5b3VzZWxmOiAgICBcclxuXHJcbiAgICA8YSBocmVmPVwiI1wiIGRhdGEtdHlwZT1cInNlbGVjdDJcIiBkYXRhLXZhbHVlPVwiMVwiPlRleHQxPC9hPlxyXG4gICAgXHJcbiAgICBcclxuQGNsYXNzIHNlbGVjdDJcclxuQGV4dGVuZHMgYWJzdHJhY3RpbnB1dFxyXG5Ac2luY2UgMS40LjFcclxuQGZpbmFsXHJcbkBleGFtcGxlXHJcbjxhIGhyZWY9XCIjXCIgaWQ9XCJjb3VudHJ5XCIgZGF0YS10eXBlPVwic2VsZWN0MlwiIGRhdGEtcGs9XCIxXCIgZGF0YS12YWx1ZT1cInJ1XCIgZGF0YS11cmw9XCIvcG9zdFwiIGRhdGEtdGl0bGU9XCJTZWxlY3QgY291bnRyeVwiPjwvYT5cclxuPHNjcmlwdD5cclxuJChmdW5jdGlvbigpe1xyXG4gICAgLy9sb2NhbCBzb3VyY2VcclxuICAgICQoJyNjb3VudHJ5JykuZWRpdGFibGUoe1xyXG4gICAgICAgIHNvdXJjZTogW1xyXG4gICAgICAgICAgICAgIHtpZDogJ2diJywgdGV4dDogJ0dyZWF0IEJyaXRhaW4nfSxcclxuICAgICAgICAgICAgICB7aWQ6ICd1cycsIHRleHQ6ICdVbml0ZWQgU3RhdGVzJ30sXHJcbiAgICAgICAgICAgICAge2lkOiAncnUnLCB0ZXh0OiAnUnVzc2lhJ31cclxuICAgICAgICAgICBdLFxyXG4gICAgICAgIHNlbGVjdDI6IHtcclxuICAgICAgICAgICBtdWx0aXBsZTogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLy9yZW1vdGUgc291cmNlIChzaW1wbGUpXHJcbiAgICAkKCcjY291bnRyeScpLmVkaXRhYmxlKHtcclxuICAgICAgICBzb3VyY2U6ICcvZ2V0Q291bnRyaWVzJyxcclxuICAgICAgICBzZWxlY3QyOiB7XHJcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAnU2VsZWN0IENvdW50cnknLFxyXG4gICAgICAgICAgICBtaW5pbXVtSW5wdXRMZW5ndGg6IDFcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8vcmVtb3RlIHNvdXJjZSAoYWR2YW5jZWQpXHJcbiAgICAkKCcjY291bnRyeScpLmVkaXRhYmxlKHtcclxuICAgICAgICBzZWxlY3QyOiB7XHJcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAnU2VsZWN0IENvdW50cnknLFxyXG4gICAgICAgICAgICBhbGxvd0NsZWFyOiB0cnVlLFxyXG4gICAgICAgICAgICBtaW5pbXVtSW5wdXRMZW5ndGg6IDMsXHJcbiAgICAgICAgICAgIGlkOiBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uQ291bnRyeUlkO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBhamF4OiB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvZ2V0Q291bnRyaWVzJyxcclxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiBmdW5jdGlvbiAodGVybSwgcGFnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHF1ZXJ5OiB0ZXJtIH07XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVzdWx0czogZnVuY3Rpb24gKGRhdGEsIHBhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4geyByZXN1bHRzOiBkYXRhIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGZvcm1hdFJlc3VsdDogZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLkNvdW50cnlOYW1lO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmb3JtYXRTZWxlY3Rpb246IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5Db3VudHJ5TmFtZTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaW5pdFNlbGVjdGlvbjogZnVuY3Rpb24gKGVsZW1lbnQsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJC5nZXQoJy9nZXRDb3VudHJ5QnlJZCcsIHsgcXVlcnk6IGVsZW1lbnQudmFsKCkgfSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgIH0gIFxyXG4gICAgfSk7XHJcbn0pO1xyXG48L3NjcmlwdD5cclxuKiovXHJcbihmdW5jdGlvbiAoJCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBcclxuICAgIHZhciBDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5pbml0KCdzZWxlY3QyJywgb3B0aW9ucywgQ29uc3RydWN0b3IuZGVmYXVsdHMpO1xyXG5cclxuICAgICAgICBvcHRpb25zLnNlbGVjdDIgPSBvcHRpb25zLnNlbGVjdDIgfHwge307XHJcblxyXG4gICAgICAgIHRoaXMuc291cmNlRGF0YSA9IG51bGw7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy9wbGFjZWhvbGRlclxyXG4gICAgICAgIGlmKG9wdGlvbnMucGxhY2Vob2xkZXIpIHtcclxuICAgICAgICAgICAgb3B0aW9ucy5zZWxlY3QyLnBsYWNlaG9sZGVyID0gb3B0aW9ucy5wbGFjZWhvbGRlcjtcclxuICAgICAgICB9XHJcbiAgICAgICBcclxuICAgICAgICAvL2lmIG5vdCBgdGFnc2AgbW9kZSwgdXNlIHNvdXJjZVxyXG4gICAgICAgIGlmKCFvcHRpb25zLnNlbGVjdDIudGFncyAmJiBvcHRpb25zLnNvdXJjZSkge1xyXG4gICAgICAgICAgICB2YXIgc291cmNlID0gb3B0aW9ucy5zb3VyY2U7XHJcbiAgICAgICAgICAgIC8vaWYgc291cmNlIGlzIGZ1bmN0aW9uLCBjYWxsIGl0IChvbmNlISlcclxuICAgICAgICAgICAgaWYgKCQuaXNGdW5jdGlvbihvcHRpb25zLnNvdXJjZSkpIHtcclxuICAgICAgICAgICAgICAgIHNvdXJjZSA9IG9wdGlvbnMuc291cmNlLmNhbGwob3B0aW9ucy5zY29wZSk7XHJcbiAgICAgICAgICAgIH0gICAgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc291cmNlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5zZWxlY3QyLmFqYXggPSBvcHRpb25zLnNlbGVjdDIuYWpheCB8fCB7fTtcclxuICAgICAgICAgICAgICAgIC8vc29tZSBkZWZhdWx0IGFqYXggcGFyYW1zXHJcbiAgICAgICAgICAgICAgICBpZighb3B0aW9ucy5zZWxlY3QyLmFqYXguZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc2VsZWN0Mi5hamF4LmRhdGEgPSBmdW5jdGlvbih0ZXJtKSB7cmV0dXJuIHsgcXVlcnk6dGVybSB9O307XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZighb3B0aW9ucy5zZWxlY3QyLmFqYXgucmVzdWx0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc2VsZWN0Mi5hamF4LnJlc3VsdHMgPSBmdW5jdGlvbihkYXRhKSB7IHJldHVybiB7cmVzdWx0czpkYXRhIH07fTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG9wdGlvbnMuc2VsZWN0Mi5hamF4LnVybCA9IHNvdXJjZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vY2hlY2sgZm9ybWF0IGFuZCBjb252ZXJ0IHgtZWRpdGFibGUgZm9ybWF0IHRvIHNlbGVjdDIgZm9ybWF0IChpZiBuZWVkZWQpXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZURhdGEgPSB0aGlzLmNvbnZlcnRTb3VyY2Uoc291cmNlKTtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMuc2VsZWN0Mi5kYXRhID0gdGhpcy5zb3VyY2VEYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBcclxuXHJcbiAgICAgICAgLy9vdmVycmlkaW5nIG9iamVjdHMgaW4gY29uZmlnIChhcyBieSBkZWZhdWx0IGpRdWVyeSBleHRlbmQoKSBpcyBub3QgcmVjdXJzaXZlKVxyXG4gICAgICAgIHRoaXMub3B0aW9ucy5zZWxlY3QyID0gJC5leHRlbmQoe30sIENvbnN0cnVjdG9yLmRlZmF1bHRzLnNlbGVjdDIsIG9wdGlvbnMuc2VsZWN0Mik7XHJcblxyXG4gICAgICAgIC8vZGV0ZWN0IHdoZXRoZXIgaXQgaXMgbXVsdGktdmFsdWVkXHJcbiAgICAgICAgdGhpcy5pc011bHRpcGxlID0gdGhpcy5vcHRpb25zLnNlbGVjdDIudGFncyB8fCB0aGlzLm9wdGlvbnMuc2VsZWN0Mi5tdWx0aXBsZTtcclxuICAgICAgICB0aGlzLmlzUmVtb3RlID0gKCdhamF4JyBpbiB0aGlzLm9wdGlvbnMuc2VsZWN0Mik7XHJcblxyXG4gICAgICAgIC8vc3RvcmUgZnVuY3Rpb24gcmV0dXJuaW5nIElEIG9mIGl0ZW1cclxuICAgICAgICAvL3Nob3VsZCBiZSBoZXJlIGFzIHVzZWQgaW5hdXRvdGV4dCBmb3IgbG9jYWwgc291cmNlXHJcbiAgICAgICAgdGhpcy5pZEZ1bmMgPSB0aGlzLm9wdGlvbnMuc2VsZWN0Mi5pZDtcclxuICAgICAgICBpZiAodHlwZW9mKHRoaXMuaWRGdW5jKSAhPT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgICAgIHZhciBpZEtleSA9IHRoaXMuaWRGdW5jIHx8ICdpZCc7XHJcbiAgICAgICAgICAgIHRoaXMuaWRGdW5jID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGVbaWRLZXldOyB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9zdG9yZSBmdW5jdGlvbiB0aGF0IHJlbmRlcnMgdGV4dCBpbiBzZWxlY3QyXHJcbiAgICAgICAgdGhpcy5mb3JtYXRTZWxlY3Rpb24gPSB0aGlzLm9wdGlvbnMuc2VsZWN0Mi5mb3JtYXRTZWxlY3Rpb247XHJcbiAgICAgICAgaWYgKHR5cGVvZih0aGlzLmZvcm1hdFNlbGVjdGlvbikgIT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICB0aGlzLmZvcm1hdFNlbGVjdGlvbiA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLnRleHQ7IH07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAkLmZuLmVkaXRhYmxldXRpbHMuaW5oZXJpdChDb25zdHJ1Y3RvciwgJC5mbi5lZGl0YWJsZXR5cGVzLmFic3RyYWN0aW5wdXQpO1xyXG5cclxuICAgICQuZXh0ZW5kKENvbnN0cnVjdG9yLnByb3RvdHlwZSwge1xyXG4gICAgICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2xhc3MoKTtcclxuXHJcbiAgICAgICAgICAgIC8vY2FuIG5vdCBhcHBseSBzZWxlY3QyIGhlcmUgYXMgaXQgY2FsbHMgaW5pdFNlbGVjdGlvbiBcclxuICAgICAgICAgICAgLy9vdmVyIGlucHV0IHRoYXQgZG9lcyBub3QgaGF2ZSBjb3JyZWN0IHZhbHVlIHlldC5cclxuICAgICAgICAgICAgLy9hcHBseSBzZWxlY3QyIG9ubHkgaW4gdmFsdWUyaW5wdXRcclxuICAgICAgICAgICAgLy90aGlzLiRpbnB1dC5zZWxlY3QyKHRoaXMub3B0aW9ucy5zZWxlY3QyKTtcclxuXHJcbiAgICAgICAgICAgIC8vd2hlbiBkYXRhIGlzIGxvYWRlZCB2aWEgYWpheCwgd2UgbmVlZCB0byBrbm93IHdoZW4gaXQncyBkb25lIHRvIHBvcHVsYXRlIGxpc3REYXRhXHJcbiAgICAgICAgICAgIGlmKHRoaXMuaXNSZW1vdGUpIHtcclxuICAgICAgICAgICAgICAgIC8vbGlzdGVuIHRvIGxvYWRlZCBldmVudCB0byBwb3B1bGF0ZSBkYXRhXHJcbiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5vbignc2VsZWN0Mi1sb2FkZWQnLCAkLnByb3h5KGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZURhdGEgPSBlLml0ZW1zLnJlc3VsdHM7XHJcbiAgICAgICAgICAgICAgICB9LCB0aGlzKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vdHJpZ2dlciByZXNpemUgb2YgZWRpdGFibGVmb3JtIHRvIHJlLXBvc2l0aW9uIGNvbnRhaW5lciBpbiBtdWx0aS12YWx1ZWQgbW9kZVxyXG4gICAgICAgICAgICBpZih0aGlzLmlzTXVsdGlwbGUpIHtcclxuICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCdmb3JtJykucGFyZW50KCkudHJpZ2dlckhhbmRsZXIoJ3Jlc2l6ZScpO1xyXG4gICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgfSxcclxuXHJcbiAgICAgICB2YWx1ZTJodG1sOiBmdW5jdGlvbih2YWx1ZSwgZWxlbWVudCkge1xyXG4gICAgICAgICAgIHZhciB0ZXh0ID0gJycsIGRhdGEsXHJcbiAgICAgICAgICAgICAgIHRoYXQgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICBpZih0aGlzLm9wdGlvbnMuc2VsZWN0Mi50YWdzKSB7IC8vaW4gdGFncyBtb2RlIGp1c3QgYXNzaWduIHZhbHVlXHJcbiAgICAgICAgICAgICAgZGF0YSA9IHZhbHVlOyBcclxuICAgICAgICAgICAgICAvL2RhdGEgPSAkLmZuLmVkaXRhYmxldXRpbHMuaXRlbXNCeVZhbHVlKHZhbHVlLCB0aGlzLm9wdGlvbnMuc2VsZWN0Mi50YWdzLCB0aGlzLmlkRnVuYyk7XHJcbiAgICAgICAgICAgfSBlbHNlIGlmKHRoaXMuc291cmNlRGF0YSkge1xyXG4gICAgICAgICAgICAgIGRhdGEgPSAkLmZuLmVkaXRhYmxldXRpbHMuaXRlbXNCeVZhbHVlKHZhbHVlLCB0aGlzLnNvdXJjZURhdGEsIHRoaXMuaWRGdW5jKTsgXHJcbiAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAvL2NhbiBub3QgZ2V0IGxpc3Qgb2YgcG9zc2libGUgdmFsdWVzIFxyXG4gICAgICAgICAgICAgIC8vKGUuZy4gYXV0b3RleHQgZm9yIHNlbGVjdDIgd2l0aCBhamF4IHNvdXJjZSlcclxuICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgIC8vZGF0YSBtYXkgYmUgYXJyYXkgKHdoZW4gbXVsdGlwbGUgdmFsdWVzIGFsbG93ZWQpXHJcbiAgICAgICAgICAgaWYoJC5pc0FycmF5KGRhdGEpKSB7XHJcbiAgICAgICAgICAgICAgIC8vY29sbGVjdCBzZWxlY3RlZCBkYXRhIGFuZCBzaG93IHdpdGggc2VwYXJhdG9yXHJcbiAgICAgICAgICAgICAgIHRleHQgPSBbXTtcclxuICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEsIGZ1bmN0aW9uKGssIHYpe1xyXG4gICAgICAgICAgICAgICAgICAgdGV4dC5wdXNoKHYgJiYgdHlwZW9mIHYgPT09ICdvYmplY3QnID8gdGhhdC5mb3JtYXRTZWxlY3Rpb24odikgOiB2KTtcclxuICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgfSBlbHNlIGlmKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgdGV4dCA9IHRoYXQuZm9ybWF0U2VsZWN0aW9uKGRhdGEpO1xyXG4gICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgdGV4dCA9ICQuaXNBcnJheSh0ZXh0KSA/IHRleHQuam9pbih0aGlzLm9wdGlvbnMudmlld3NlcGFyYXRvcikgOiB0ZXh0O1xyXG5cclxuICAgICAgICAgICAvLyQoZWxlbWVudCkudGV4dCh0ZXh0KTtcclxuICAgICAgICAgICBDb25zdHJ1Y3Rvci5zdXBlcmNsYXNzLnZhbHVlMmh0bWwuY2FsbCh0aGlzLCB0ZXh0LCBlbGVtZW50KTsgXHJcbiAgICAgICB9LFxyXG5cclxuICAgICAgIGh0bWwydmFsdWU6IGZ1bmN0aW9uKGh0bWwpIHtcclxuICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnNlbGVjdDIudGFncyA/IHRoaXMuc3RyMnZhbHVlKGh0bWwsIHRoaXMub3B0aW9ucy52aWV3c2VwYXJhdG9yKSA6IG51bGw7XHJcbiAgICAgICB9LFxyXG5cclxuICAgICAgIHZhbHVlMmlucHV0OiBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICAgIC8vIGlmIHZhbHVlIGFycmF5ID0+IGpvaW4gaXQgYW55d2F5XHJcbiAgICAgICAgICAgaWYoJC5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuam9pbih0aGlzLmdldFNlcGFyYXRvcigpKTtcclxuICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgIC8vZm9yIHJlbW90ZSBzb3VyY2UganVzdCBzZXQgdmFsdWUsIHRleHQgaXMgdXBkYXRlZCBieSBpbml0U2VsZWN0aW9uXHJcbiAgICAgICAgICAgaWYoIXRoaXMuJGlucHV0LmRhdGEoJ3NlbGVjdDInKSkge1xyXG4gICAgICAgICAgICAgICB0aGlzLiRpbnB1dC52YWwodmFsdWUpO1xyXG4gICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5zZWxlY3QyKHRoaXMub3B0aW9ucy5zZWxlY3QyKTtcclxuICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAvL3NlY29uZCBhcmd1bWVudCBuZWVkZWQgdG8gc2VwYXJhdGUgaW5pdGlhbCBjaGFuZ2UgZnJvbSB1c2VyJ3MgY2xpY2sgKGZvciBhdXRvc3VibWl0KSAgIFxyXG4gICAgICAgICAgICAgICB0aGlzLiRpbnB1dC52YWwodmFsdWUpLnRyaWdnZXIoJ2NoYW5nZScsIHRydWUpOyBcclxuXHJcbiAgICAgICAgICAgICAgIC8vVW5jYXVnaHQgRXJyb3I6IGNhbm5vdCBjYWxsIHZhbCgpIGlmIGluaXRTZWxlY3Rpb24oKSBpcyBub3QgZGVmaW5lZFxyXG4gICAgICAgICAgICAgICAvL3RoaXMuJGlucHV0LnNlbGVjdDIoJ3ZhbCcsIHZhbHVlKTtcclxuICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgIC8vIGlmIGRlZmluZWQgcmVtb3RlIHNvdXJjZSBBTkQgbm8gbXVsdGlwbGUgbW9kZSBBTkQgbm8gdXNlcidzIGluaXRTZWxlY3Rpb24gcHJvdmlkZWQgLS0+IFxyXG4gICAgICAgICAgIC8vIHdlIHNob3VsZCBzb21laG93IGdldCB0ZXh0IGZvciBwcm92aWRlZCBpZC5cclxuICAgICAgICAgICAvLyBUaGUgc29sdXRpb24gaXMgdG8gdXNlIGVsZW1lbnQncyB0ZXh0IGFzIHRleHQgZm9yIHRoYXQgaWQgKGV4Y2x1ZGUgZW1wdHkpXHJcbiAgICAgICAgICAgaWYodGhpcy5pc1JlbW90ZSAmJiAhdGhpcy5pc011bHRpcGxlICYmICF0aGlzLm9wdGlvbnMuc2VsZWN0Mi5pbml0U2VsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgIC8vIGN1c3RvbUlkIGFuZCBjdXN0b21UZXh0IGFyZSBtZXRob2RzIHRvIGV4dHJhY3QgYGlkYCBhbmQgYHRleHRgIGZyb20gZGF0YSBvYmplY3RcclxuICAgICAgICAgICAgICAgLy8gd2UgY2FuIHVzZSB0aGlzIHdvcmthcm91bmQgb25seSBpZiB1c2VyIGRpZCBub3QgZGVmaW5lIHRoZXNlIG1ldGhvZHNcclxuICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHdlIGNhbnQgY29uc3RydWN0IGRhdGEgb2JqZWN0XHJcbiAgICAgICAgICAgICAgIHZhciBjdXN0b21JZCA9IHRoaXMub3B0aW9ucy5zZWxlY3QyLmlkLFxyXG4gICAgICAgICAgICAgICAgICAgY3VzdG9tVGV4dCA9IHRoaXMub3B0aW9ucy5zZWxlY3QyLmZvcm1hdFNlbGVjdGlvbjtcclxuXHJcbiAgICAgICAgICAgICAgIGlmKCFjdXN0b21JZCAmJiAhY3VzdG9tVGV4dCkge1xyXG4gICAgICAgICAgICAgICAgICAgdmFyICRlbCA9ICQodGhpcy5vcHRpb25zLnNjb3BlKTtcclxuICAgICAgICAgICAgICAgICAgIGlmICghJGVsLmRhdGEoJ2VkaXRhYmxlJykuaXNFbXB0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge2lkOiB2YWx1ZSwgdGV4dDogJGVsLnRleHQoKX07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQuc2VsZWN0MignZGF0YScsIGRhdGEpOyBcclxuICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgIH1cclxuICAgICAgIH0sXHJcbiAgICAgICBcclxuICAgICAgIGlucHV0MnZhbHVlOiBmdW5jdGlvbigpIHsgXHJcbiAgICAgICAgICAgcmV0dXJuIHRoaXMuJGlucHV0LnNlbGVjdDIoJ3ZhbCcpO1xyXG4gICAgICAgfSxcclxuXHJcbiAgICAgICBzdHIydmFsdWU6IGZ1bmN0aW9uKHN0ciwgc2VwYXJhdG9yKSB7XHJcbiAgICAgICAgICAgIGlmKHR5cGVvZiBzdHIgIT09ICdzdHJpbmcnIHx8ICF0aGlzLmlzTXVsdGlwbGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdHI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNlcGFyYXRvciA9IHNlcGFyYXRvciB8fCB0aGlzLmdldFNlcGFyYXRvcigpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHZhbCwgaSwgbDtcclxuXHJcbiAgICAgICAgICAgIGlmIChzdHIgPT09IG51bGwgfHwgc3RyLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhbCA9IHN0ci5zcGxpdChzZXBhcmF0b3IpO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBsID0gdmFsLmxlbmd0aDsgaSA8IGw7IGkgPSBpICsgMSkge1xyXG4gICAgICAgICAgICAgICAgdmFsW2ldID0gJC50cmltKHZhbFtpXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB2YWw7XHJcbiAgICAgICB9LFxyXG5cclxuICAgICAgICBhdXRvc3VibWl0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQub24oJ2NoYW5nZScsIGZ1bmN0aW9uKGUsIGlzSW5pdGlhbCl7XHJcbiAgICAgICAgICAgICAgICBpZighaXNJbml0aWFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgnZm9ybScpLnN1Ym1pdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBnZXRTZXBhcmF0b3I6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnNlbGVjdDIuc2VwYXJhdG9yIHx8ICQuZm4uc2VsZWN0Mi5kZWZhdWx0cy5zZXBhcmF0b3I7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICBDb252ZXJ0cyBzb3VyY2UgZnJvbSB4LWVkaXRhYmxlIGZvcm1hdDoge3ZhbHVlOiAxLCB0ZXh0OiBcIjFcIn0gdG9cclxuICAgICAgICBzZWxlY3QyIGZvcm1hdDoge2lkOiAxLCB0ZXh0OiBcIjFcIn1cclxuICAgICAgICAqL1xyXG4gICAgICAgIGNvbnZlcnRTb3VyY2U6IGZ1bmN0aW9uKHNvdXJjZSkge1xyXG4gICAgICAgICAgICBpZigkLmlzQXJyYXkoc291cmNlKSAmJiBzb3VyY2UubGVuZ3RoICYmIHNvdXJjZVswXS52YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpPHNvdXJjZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHNvdXJjZVtpXS52YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVtpXS5pZCA9IHNvdXJjZVtpXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHNvdXJjZVtpXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHNvdXJjZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZih0aGlzLiRpbnB1dC5kYXRhKCdzZWxlY3QyJykpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0LnNlbGVjdDIoJ2Rlc3Ryb3knKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgIH0pO1xyXG5cclxuICAgIENvbnN0cnVjdG9yLmRlZmF1bHRzID0gJC5leHRlbmQoe30sICQuZm4uZWRpdGFibGV0eXBlcy5hYnN0cmFjdGlucHV0LmRlZmF1bHRzLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgQHByb3BlcnR5IHRwbCBcclxuICAgICAgICBAZGVmYXVsdCA8aW5wdXQgdHlwZT1cImhpZGRlblwiPlxyXG4gICAgICAgICoqL1xyXG4gICAgICAgIHRwbDonPGlucHV0IHR5cGU9XCJoaWRkZW5cIj4nLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIENvbmZpZ3VyYXRpb24gb2Ygc2VsZWN0Mi4gW0Z1bGwgbGlzdCBvZiBvcHRpb25zXShodHRwOi8vaXZheW5iZXJnLmdpdGh1Yi5jb20vc2VsZWN0MikuXHJcblxyXG4gICAgICAgIEBwcm9wZXJ0eSBzZWxlY3QyIFxyXG4gICAgICAgIEB0eXBlIG9iamVjdFxyXG4gICAgICAgIEBkZWZhdWx0IG51bGxcclxuICAgICAgICAqKi9cclxuICAgICAgICBzZWxlY3QyOiBudWxsLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIFBsYWNlaG9sZGVyIGF0dHJpYnV0ZSBvZiBzZWxlY3RcclxuXHJcbiAgICAgICAgQHByb3BlcnR5IHBsYWNlaG9sZGVyIFxyXG4gICAgICAgIEB0eXBlIHN0cmluZ1xyXG4gICAgICAgIEBkZWZhdWx0IG51bGxcclxuICAgICAgICAqKi9cclxuICAgICAgICBwbGFjZWhvbGRlcjogbnVsbCxcclxuICAgICAgICAvKipcclxuICAgICAgICBTb3VyY2UgZGF0YSBmb3Igc2VsZWN0LiBJdCB3aWxsIGJlIGFzc2lnbmVkIHRvIHNlbGVjdDIgYGRhdGFgIHByb3BlcnR5IGFuZCBrZXB0IGhlcmUganVzdCBmb3IgY29udmVuaWVuY2UuXHJcbiAgICAgICAgUGxlYXNlIG5vdGUsIHRoYXQgZm9ybWF0IGlzIGRpZmZlcmVudCBmcm9tIHNpbXBsZSBgc2VsZWN0YCBpbnB1dDogdXNlICdpZCcgaW5zdGVhZCBvZiAndmFsdWUnLlxyXG4gICAgICAgIEUuZy4gYFt7aWQ6IDEsIHRleHQ6IFwidGV4dDFcIn0sIHtpZDogMiwgdGV4dDogXCJ0ZXh0MlwifSwgLi4uXWAuXHJcblxyXG4gICAgICAgIEBwcm9wZXJ0eSBzb3VyY2UgXHJcbiAgICAgICAgQHR5cGUgYXJyYXl8c3RyaW5nfGZ1bmN0aW9uXHJcbiAgICAgICAgQGRlZmF1bHQgbnVsbCAgICAgICAgXHJcbiAgICAgICAgKiovXHJcbiAgICAgICAgc291cmNlOiBudWxsLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIFNlcGFyYXRvciB1c2VkIHRvIGRpc3BsYXkgdGFncy5cclxuXHJcbiAgICAgICAgQHByb3BlcnR5IHZpZXdzZXBhcmF0b3IgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nXHJcbiAgICAgICAgQGRlZmF1bHQgJywgJyAgICAgICAgXHJcbiAgICAgICAgKiovXHJcbiAgICAgICAgdmlld3NlcGFyYXRvcjogJywgJ1xyXG4gICAgfSk7XHJcblxyXG4gICAgJC5mbi5lZGl0YWJsZXR5cGVzLnNlbGVjdDIgPSBDb25zdHJ1Y3RvcjtcclxuXHJcbn0od2luZG93LmpRdWVyeSkpO1xyXG5cclxuLyoqXHJcbiogQ29tYm9kYXRlIC0gMS4wLjVcclxuKiBEcm9wZG93biBkYXRlIGFuZCB0aW1lIHBpY2tlci5cclxuKiBDb252ZXJ0cyB0ZXh0IGlucHV0IGludG8gZHJvcGRvd25zIHRvIHBpY2sgZGF5LCBtb250aCwgeWVhciwgaG91ciwgbWludXRlIGFuZCBzZWNvbmQuXHJcbiogVXNlcyBtb21lbnRqcyBhcyBkYXRldGltZSBsaWJyYXJ5IGh0dHA6Ly9tb21lbnRqcy5jb20uXHJcbiogRm9yIGkxOG4gaW5jbHVkZSBjb3JyZXNwb25kaW5nIGZpbGUgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vdGltcndvb2QvbW9tZW50L3RyZWUvbWFzdGVyL2xhbmcgXHJcbipcclxuKiBDb25mdXNpb24gYXQgbm9vbiBhbmQgbWlkbmlnaHQgLSBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS8xMi1ob3VyX2Nsb2NrI0NvbmZ1c2lvbl9hdF9ub29uX2FuZF9taWRuaWdodFxyXG4qIEluIGNvbWJvZGF0ZTogXHJcbiogMTI6MDAgcG0gLS0+IDEyOjAwICgyNC1oIGZvcm1hdCwgbWlkZGF5KVxyXG4qIDEyOjAwIGFtIC0tPiAwMDowMCAoMjQtaCBmb3JtYXQsIG1pZG5pZ2h0LCBzdGFydCBvZiBkYXkpXHJcbiogXHJcbiogRGlmZmVycyBmcm9tIG1vbWVudGpzIHBhcnNlIHJ1bGVzOlxyXG4qIDAwOjAwIHBtLCAxMjowMCBwbSAtLT4gMTI6MDAgKDI0LWggZm9ybWF0LCBkYXkgbm90IGNoYW5nZSlcclxuKiAwMDowMCBhbSwgMTI6MDAgYW0gLS0+IDAwOjAwICgyNC1oIGZvcm1hdCwgZGF5IG5vdCBjaGFuZ2UpXHJcbiogXHJcbiogXHJcbiogQXV0aG9yOiBWaXRhbGl5IFBvdGFwb3ZcclxuKiBQcm9qZWN0IHBhZ2U6IGh0dHA6Ly9naXRodWIuY29tL3ZpdGFsZXRzL2NvbWJvZGF0ZVxyXG4qIENvcHlyaWdodCAoYykgMjAxMiBWaXRhbGl5IFBvdGFwb3YuIFJlbGVhc2VkIHVuZGVyIE1JVCBMaWNlbnNlLlxyXG4qKi9cclxuKGZ1bmN0aW9uICgkKSB7XHJcblxyXG4gICAgdmFyIENvbWJvZGF0ZSA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy4kZWxlbWVudCA9ICQoZWxlbWVudCk7XHJcbiAgICAgICAgaWYoIXRoaXMuJGVsZW1lbnQuaXMoJ2lucHV0JykpIHtcclxuICAgICAgICAgICAgJC5lcnJvcignQ29tYm9kYXRlIHNob3VsZCBiZSBhcHBsaWVkIHRvIElOUFVUIGVsZW1lbnQnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgJC5mbi5jb21ib2RhdGUuZGVmYXVsdHMsIG9wdGlvbnMsIHRoaXMuJGVsZW1lbnQuZGF0YSgpKTtcclxuICAgICAgICB0aGlzLmluaXQoKTsgIFxyXG4gICAgIH07XHJcblxyXG4gICAgQ29tYm9kYXRlLnByb3RvdHlwZSA9IHtcclxuICAgICAgICBjb25zdHJ1Y3RvcjogQ29tYm9kYXRlLCBcclxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWFwID0ge1xyXG4gICAgICAgICAgICAgICAgLy9rZXkgICByZWdleHAgICAgbW9tZW50Lm1ldGhvZFxyXG4gICAgICAgICAgICAgICAgZGF5OiAgICBbJ0QnLCAgICAnZGF0ZSddLCBcclxuICAgICAgICAgICAgICAgIG1vbnRoOiAgWydNJywgICAgJ21vbnRoJ10sIFxyXG4gICAgICAgICAgICAgICAgeWVhcjogICBbJ1knLCAgICAneWVhciddLCBcclxuICAgICAgICAgICAgICAgIGhvdXI6ICAgWydbSGhdJywgJ2hvdXJzJ10sXHJcbiAgICAgICAgICAgICAgICBtaW51dGU6IFsnbScsICAgICdtaW51dGVzJ10sIFxyXG4gICAgICAgICAgICAgICAgc2Vjb25kOiBbJ3MnLCAgICAnc2Vjb25kcyddLFxyXG4gICAgICAgICAgICAgICAgYW1wbTogICBbJ1tBYV0nLCAnJ10gXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLiR3aWRnZXQgPSAkKCc8c3BhbiBjbGFzcz1cImNvbWJvZGF0ZVwiPjwvc3Bhbj4nKS5odG1sKHRoaXMuZ2V0VGVtcGxhdGUoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5pbml0Q29tYm9zKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL3VwZGF0ZSBvcmlnaW5hbCBpbnB1dCBvbiBjaGFuZ2UgXHJcbiAgICAgICAgICAgIHRoaXMuJHdpZGdldC5vbignY2hhbmdlJywgJ3NlbGVjdCcsICQucHJveHkoZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC52YWwodGhpcy5nZXRWYWx1ZSgpKS5jaGFuZ2UoKTtcclxuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBkYXlzIGNvdW50IGlmIG1vbnRoIG9yIHllYXIgY2hhbmdlc1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zbWFydERheXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJChlLnRhcmdldCkuaXMoJy5tb250aCcpIHx8ICQoZS50YXJnZXQpLmlzKCcueWVhcicpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsbENvbWJvKCdkYXknKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRoaXMpKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuJHdpZGdldC5maW5kKCdzZWxlY3QnKS5jc3MoJ3dpZHRoJywgJ2F1dG8nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIGhpZGUgb3JpZ2luYWwgaW5wdXQgYW5kIGluc2VydCB3aWRnZXQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5oaWRlKCkuYWZ0ZXIodGhpcy4kd2lkZ2V0KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIHNldCBpbml0aWFsIHZhbHVlXHJcbiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUodGhpcy4kZWxlbWVudC52YWwoKSB8fCB0aGlzLm9wdGlvbnMudmFsdWUpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAgLypcclxuICAgICAgICAgUmVwbGFjZSB0b2tlbnMgaW4gdGVtcGxhdGUgd2l0aCA8c2VsZWN0PiBlbGVtZW50cyBcclxuICAgICAgICAqLyAgICAgICAgIFxyXG4gICAgICAgIGdldFRlbXBsYXRlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHRwbCA9IHRoaXMub3B0aW9ucy50ZW1wbGF0ZTtcclxuXHJcbiAgICAgICAgICAgIC8vZmlyc3QgcGFzc1xyXG4gICAgICAgICAgICAkLmVhY2godGhpcy5tYXAsIGZ1bmN0aW9uKGssIHYpIHtcclxuICAgICAgICAgICAgICAgIHYgPSB2WzBdOyBcclxuICAgICAgICAgICAgICAgIHZhciByID0gbmV3IFJlZ0V4cCh2KycrJyksXHJcbiAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB2Lmxlbmd0aCA+IDEgPyB2LnN1YnN0cmluZygxLCAyKSA6IHY7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB0cGwgPSB0cGwucmVwbGFjZShyLCAneycrdG9rZW4rJ30nKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvL3JlcGxhY2Ugc3BhY2VzIHdpdGggJm5ic3A7XHJcbiAgICAgICAgICAgIHRwbCA9IHRwbC5yZXBsYWNlKC8gL2csICcmbmJzcDsnKTtcclxuXHJcbiAgICAgICAgICAgIC8vc2Vjb25kIHBhc3NcclxuICAgICAgICAgICAgJC5lYWNoKHRoaXMubWFwLCBmdW5jdGlvbihrLCB2KSB7XHJcbiAgICAgICAgICAgICAgICB2ID0gdlswXTtcclxuICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IHYubGVuZ3RoID4gMSA/IHYuc3Vic3RyaW5nKDEsIDIpIDogdjtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRwbCA9IHRwbC5yZXBsYWNlKCd7Jyt0b2tlbisnfScsICc8c2VsZWN0IGNsYXNzPVwiJytrKydcIj48L3NlbGVjdD4nKTtcclxuICAgICAgICAgICAgfSk7ICAgXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdHBsO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAgLypcclxuICAgICAgICAgSW5pdGlhbGl6ZSBjb21ib3MgdGhhdCBwcmVzZW50cyBpbiB0ZW1wbGF0ZSBcclxuICAgICAgICAqLyAgICAgICAgXHJcbiAgICAgICAgaW5pdENvbWJvczogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGsgaW4gdGhpcy5tYXApIHtcclxuICAgICAgICAgICAgICAgIHZhciAkYyA9IHRoaXMuJHdpZGdldC5maW5kKCcuJytrKTtcclxuICAgICAgICAgICAgICAgIC8vIHNldCBwcm9wZXJ0aWVzIGxpa2UgdGhpcy4kZGF5LCB0aGlzLiRtb250aCBldGMuXHJcbiAgICAgICAgICAgICAgICB0aGlzWyckJytrXSA9ICRjLmxlbmd0aCA/ICRjIDogbnVsbDtcclxuICAgICAgICAgICAgICAgIC8vIGZpbGwgd2l0aCBpdGVtc1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWxsQ29tYm8oayk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICBGaWxsIGNvbWJvIHdpdGggaXRlbXMgXHJcbiAgICAgICAgKi8gICAgICAgIFxyXG4gICAgICAgIGZpbGxDb21ibzogZnVuY3Rpb24oaykge1xyXG4gICAgICAgICAgICB2YXIgJGNvbWJvID0gdGhpc1snJCcra107XHJcbiAgICAgICAgICAgIGlmICghJGNvbWJvKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGRlZmluZSBtZXRob2QgbmFtZSB0byBmaWxsIGl0ZW1zLCBlLmcgYGZpbGxEYXlzYFxyXG4gICAgICAgICAgICB2YXIgZiA9ICdmaWxsJyArIGsuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBrLnNsaWNlKDEpOyBcclxuICAgICAgICAgICAgdmFyIGl0ZW1zID0gdGhpc1tmXSgpO1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSAkY29tYm8udmFsKCk7XHJcblxyXG4gICAgICAgICAgICAkY29tYm8uZW1wdHkoKTtcclxuICAgICAgICAgICAgZm9yKHZhciBpPTA7IGk8aXRlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICRjb21iby5hcHBlbmQoJzxvcHRpb24gdmFsdWU9XCInK2l0ZW1zW2ldWzBdKydcIj4nK2l0ZW1zW2ldWzFdKyc8L29wdGlvbj4nKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJGNvbWJvLnZhbCh2YWx1ZSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgSW5pdGlhbGl6ZSBpdGVtcyBvZiBjb21ib3MuIEhhbmRsZXMgYGZpcnN0SXRlbWAgb3B0aW9uIFxyXG4gICAgICAgICovXHJcbiAgICAgICAgZmlsbENvbW1vbjogZnVuY3Rpb24oa2V5KSB7XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSBbXSxcclxuICAgICAgICAgICAgICAgIHJlbFRpbWU7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLmZpcnN0SXRlbSA9PT0gJ25hbWUnKSB7XHJcbiAgICAgICAgICAgICAgICAvL25lZWQgYm90aCB0byBzdXBwb3J0IG1vbWVudCB2ZXIgPCAyIGFuZCAgPj0gMlxyXG4gICAgICAgICAgICAgICAgcmVsVGltZSA9IG1vbWVudC5yZWxhdGl2ZVRpbWUgfHwgbW9tZW50LmxhbmdEYXRhKCkuX3JlbGF0aXZlVGltZTsgXHJcbiAgICAgICAgICAgICAgICB2YXIgaGVhZGVyID0gdHlwZW9mIHJlbFRpbWVba2V5XSA9PT0gJ2Z1bmN0aW9uJyA/IHJlbFRpbWVba2V5XSgxLCB0cnVlLCBrZXksIGZhbHNlKSA6IHJlbFRpbWVba2V5XTtcclxuICAgICAgICAgICAgICAgIC8vdGFrZSBsYXN0IGVudHJ5IChzZWUgbW9tZW50anMgbGFuZyBmaWxlcyBzdHJ1Y3R1cmUpIFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyID0gaGVhZGVyLnNwbGl0KCcgJykucmV2ZXJzZSgpWzBdOyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKFsnJywgaGVhZGVyXSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZih0aGlzLm9wdGlvbnMuZmlyc3RJdGVtID09PSAnZW1wdHknKSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaChbJycsICcnXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlcztcclxuICAgICAgICB9LCAgXHJcblxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgIGZpbGwgZGF5XHJcbiAgICAgICAgKi9cclxuICAgICAgICBmaWxsRGF5OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy5maWxsQ29tbW9uKCdkJyksIG5hbWUsIGksXHJcbiAgICAgICAgICAgICAgICB0d29EaWdpdCA9IHRoaXMub3B0aW9ucy50ZW1wbGF0ZS5pbmRleE9mKCdERCcpICE9PSAtMSxcclxuICAgICAgICAgICAgICAgIGRheXNDb3VudCA9IDMxO1xyXG5cclxuICAgICAgICAgICAgLy8gZGV0ZWN0IGRheXMgY291bnQgKGRlcGVuZHMgb24gbW9udGggYW5kIHllYXIpXHJcbiAgICAgICAgICAgIC8vIG9yaWdpbmFsbHkgaHR0cHM6Ly9naXRodWIuY29tL3ZpdGFsZXRzL2NvbWJvZGF0ZS9wdWxsLzdcclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zbWFydERheXMgJiYgdGhpcy4kbW9udGggJiYgdGhpcy4keWVhcikge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1vbnRoID0gcGFyc2VJbnQodGhpcy4kbW9udGgudmFsKCksIDEwKTtcclxuICAgICAgICAgICAgICAgIHZhciB5ZWFyID0gcGFyc2VJbnQodGhpcy4keWVhci52YWwoKSwgMTApO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghaXNOYU4obW9udGgpICYmICFpc05hTih5ZWFyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRheXNDb3VudCA9IG1vbWVudChbeWVhciwgbW9udGhdKS5kYXlzSW5Nb250aCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IgKGkgPSAxOyBpIDw9IGRheXNDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBuYW1lID0gdHdvRGlnaXQgPyB0aGlzLmxlYWRaZXJvKGkpIDogaTtcclxuICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goW2ksIG5hbWVdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gaXRlbXM7ICAgICAgICBcclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgZmlsbCBtb250aFxyXG4gICAgICAgICovXHJcbiAgICAgICAgZmlsbE1vbnRoOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy5maWxsQ29tbW9uKCdNJyksIG5hbWUsIGksIFxyXG4gICAgICAgICAgICAgICAgbG9uZ05hbWVzID0gdGhpcy5vcHRpb25zLnRlbXBsYXRlLmluZGV4T2YoJ01NTU0nKSAhPT0gLTEsXHJcbiAgICAgICAgICAgICAgICBzaG9ydE5hbWVzID0gdGhpcy5vcHRpb25zLnRlbXBsYXRlLmluZGV4T2YoJ01NTScpICE9PSAtMSxcclxuICAgICAgICAgICAgICAgIHR3b0RpZ2l0ID0gdGhpcy5vcHRpb25zLnRlbXBsYXRlLmluZGV4T2YoJ01NJykgIT09IC0xO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGZvcihpPTA7IGk8PTExOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmKGxvbmdOYW1lcykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS90aW1yd29vZC9tb21lbnRqcy5jb20vcHVsbC8zNlxyXG4gICAgICAgICAgICAgICAgICAgIG5hbWUgPSBtb21lbnQoKS5kYXRlKDEpLm1vbnRoKGkpLmZvcm1hdCgnTU1NTScpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHNob3J0TmFtZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lID0gbW9tZW50KCkuZGF0ZSgxKS5tb250aChpKS5mb3JtYXQoJ01NTScpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHR3b0RpZ2l0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IHRoaXMubGVhZFplcm8oaSsxKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IGkrMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goW2ksIG5hbWVdKTtcclxuICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zO1xyXG4gICAgICAgIH0sICBcclxuICAgICAgICBcclxuICAgICAgICAvKlxyXG4gICAgICAgIGZpbGwgeWVhclxyXG4gICAgICAgICovXHJcbiAgICAgICAgZmlsbFllYXI6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgaXRlbXMgPSBbXSwgbmFtZSwgaSwgXHJcbiAgICAgICAgICAgICAgICBsb25nTmFtZXMgPSB0aGlzLm9wdGlvbnMudGVtcGxhdGUuaW5kZXhPZignWVlZWScpICE9PSAtMTtcclxuICAgICAgICAgICBcclxuICAgICAgICAgICAgZm9yKGk9dGhpcy5vcHRpb25zLm1heFllYXI7IGk+PXRoaXMub3B0aW9ucy5taW5ZZWFyOyBpLS0pIHtcclxuICAgICAgICAgICAgICAgIG5hbWUgPSBsb25nTmFtZXMgPyBpIDogKGkrJycpLnN1YnN0cmluZygyKTtcclxuICAgICAgICAgICAgICAgIGl0ZW1zW3RoaXMub3B0aW9ucy55ZWFyRGVzY2VuZGluZyA/ICdwdXNoJyA6ICd1bnNoaWZ0J10oW2ksIG5hbWVdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaXRlbXMgPSB0aGlzLmZpbGxDb21tb24oJ3knKS5jb25jYXQoaXRlbXMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zOyAgICAgICAgICAgICAgXHJcbiAgICAgICAgfSwgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLypcclxuICAgICAgICBmaWxsIGhvdXJcclxuICAgICAgICAqL1xyXG4gICAgICAgIGZpbGxIb3VyOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy5maWxsQ29tbW9uKCdoJyksIG5hbWUsIGksXHJcbiAgICAgICAgICAgICAgICBoMTIgPSB0aGlzLm9wdGlvbnMudGVtcGxhdGUuaW5kZXhPZignaCcpICE9PSAtMSxcclxuICAgICAgICAgICAgICAgIGgyNCA9IHRoaXMub3B0aW9ucy50ZW1wbGF0ZS5pbmRleE9mKCdIJykgIT09IC0xLFxyXG4gICAgICAgICAgICAgICAgdHdvRGlnaXQgPSB0aGlzLm9wdGlvbnMudGVtcGxhdGUudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdoaCcpICE9PSAtMSxcclxuICAgICAgICAgICAgICAgIG1pbiA9IGgxMiA/IDEgOiAwLCBcclxuICAgICAgICAgICAgICAgIG1heCA9IGgxMiA/IDEyIDogMjM7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgZm9yKGk9bWluOyBpPD1tYXg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgbmFtZSA9IHR3b0RpZ2l0ID8gdGhpcy5sZWFkWmVybyhpKSA6IGk7XHJcbiAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKFtpLCBuYW1lXSk7XHJcbiAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtczsgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIH0sICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgZmlsbCBtaW51dGVcclxuICAgICAgICAqL1xyXG4gICAgICAgIGZpbGxNaW51dGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLmZpbGxDb21tb24oJ20nKSwgbmFtZSwgaSxcclxuICAgICAgICAgICAgICAgIHR3b0RpZ2l0ID0gdGhpcy5vcHRpb25zLnRlbXBsYXRlLmluZGV4T2YoJ21tJykgIT09IC0xO1xyXG5cclxuICAgICAgICAgICAgZm9yKGk9MDsgaTw9NTk7IGkrPSB0aGlzLm9wdGlvbnMubWludXRlU3RlcCkge1xyXG4gICAgICAgICAgICAgICAgbmFtZSA9IHR3b0RpZ2l0ID8gdGhpcy5sZWFkWmVybyhpKSA6IGk7XHJcbiAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKFtpLCBuYW1lXSk7XHJcbiAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtczsgICAgICAgICAgICAgIFxyXG4gICAgICAgIH0sICBcclxuICAgICAgICBcclxuICAgICAgICAvKlxyXG4gICAgICAgIGZpbGwgc2Vjb25kXHJcbiAgICAgICAgKi9cclxuICAgICAgICBmaWxsU2Vjb25kOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy5maWxsQ29tbW9uKCdzJyksIG5hbWUsIGksXHJcbiAgICAgICAgICAgICAgICB0d29EaWdpdCA9IHRoaXMub3B0aW9ucy50ZW1wbGF0ZS5pbmRleE9mKCdzcycpICE9PSAtMTtcclxuXHJcbiAgICAgICAgICAgIGZvcihpPTA7IGk8PTU5OyBpKz0gdGhpcy5vcHRpb25zLnNlY29uZFN0ZXApIHtcclxuICAgICAgICAgICAgICAgIG5hbWUgPSB0d29EaWdpdCA/IHRoaXMubGVhZFplcm8oaSkgOiBpO1xyXG4gICAgICAgICAgICAgICAgaXRlbXMucHVzaChbaSwgbmFtZV0pO1xyXG4gICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gaXRlbXM7ICAgICAgICAgICAgICBcclxuICAgICAgICB9LCAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLypcclxuICAgICAgICBmaWxsIGFtcG1cclxuICAgICAgICAqL1xyXG4gICAgICAgIGZpbGxBbXBtOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGFtcG1MID0gdGhpcy5vcHRpb25zLnRlbXBsYXRlLmluZGV4T2YoJ2EnKSAhPT0gLTEsXHJcbiAgICAgICAgICAgICAgICBhbXBtVSA9IHRoaXMub3B0aW9ucy50ZW1wbGF0ZS5pbmRleE9mKCdBJykgIT09IC0xLCAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgaXRlbXMgPSBbXHJcbiAgICAgICAgICAgICAgICAgICAgWydhbScsIGFtcG1MID8gJ2FtJyA6ICdBTSddLFxyXG4gICAgICAgICAgICAgICAgICAgIFsncG0nLCBhbXBtTCA/ICdwbScgOiAnUE0nXVxyXG4gICAgICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIH0sICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIFJldHVybnMgY3VycmVudCBkYXRlIHZhbHVlIGZyb20gY29tYm9zLiBcclxuICAgICAgICAgSWYgZm9ybWF0IG5vdCBzcGVjaWZpZWQgLSBgb3B0aW9ucy5mb3JtYXRgIHVzZWQuXHJcbiAgICAgICAgIElmIGZvcm1hdCA9IGBudWxsYCAtIE1vbWVudCBvYmplY3QgcmV0dXJuZWQuXHJcbiAgICAgICAgKi9cclxuICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24oZm9ybWF0KSB7XHJcbiAgICAgICAgICAgIHZhciBkdCwgdmFsdWVzID0ge30sIFxyXG4gICAgICAgICAgICAgICAgdGhhdCA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICBub3RTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vZ2V0dGluZyBzZWxlY3RlZCB2YWx1ZXMgICAgXHJcbiAgICAgICAgICAgICQuZWFjaCh0aGlzLm1hcCwgZnVuY3Rpb24oaywgdikge1xyXG4gICAgICAgICAgICAgICAgaWYoayA9PT0gJ2FtcG0nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIGRlZiA9IGsgPT09ICdkYXknID8gMSA6IDA7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdmFsdWVzW2tdID0gdGhhdFsnJCcra10gPyBwYXJzZUludCh0aGF0WyckJytrXS52YWwoKSwgMTApIDogZGVmOyBcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgaWYoaXNOYU4odmFsdWVzW2tdKSkge1xyXG4gICAgICAgICAgICAgICAgICAgbm90U2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2lmIGF0IGxlYXN0IG9uZSB2aXNpYmxlIGNvbWJvIG5vdCBzZWxlY3RlZCAtIHJldHVybiBlbXB0eSBzdHJpbmdcclxuICAgICAgICAgICAgaWYobm90U2VsZWN0ZWQpIHtcclxuICAgICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2NvbnZlcnQgaG91cnMgMTJoIC0tPiAyNGggXHJcbiAgICAgICAgICAgIGlmKHRoaXMuJGFtcG0pIHtcclxuICAgICAgICAgICAgICAgIC8vMTI6MDAgcG0gLS0+IDEyOjAwICgyNC1oIGZvcm1hdCwgbWlkZGF5KSwgMTI6MDAgYW0gLS0+IDAwOjAwICgyNC1oIGZvcm1hdCwgbWlkbmlnaHQsIHN0YXJ0IG9mIGRheSlcclxuICAgICAgICAgICAgICAgIGlmKHZhbHVlcy5ob3VyID09PSAxMikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlcy5ob3VyID0gdGhpcy4kYW1wbS52YWwoKSA9PT0gJ2FtJyA/IDAgOiAxMjsgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZXMuaG91ciA9IHRoaXMuJGFtcG0udmFsKCkgPT09ICdhbScgPyB2YWx1ZXMuaG91ciA6IHZhbHVlcy5ob3VyKzEyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZHQgPSBtb21lbnQoW3ZhbHVlcy55ZWFyLCB2YWx1ZXMubW9udGgsIHZhbHVlcy5kYXksIHZhbHVlcy5ob3VyLCB2YWx1ZXMubWludXRlLCB2YWx1ZXMuc2Vjb25kXSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2hpZ2hsaWdodCBpbnZhbGlkIGRhdGVcclxuICAgICAgICAgICAgdGhpcy5oaWdobGlnaHQoZHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgZm9ybWF0ID0gZm9ybWF0ID09PSB1bmRlZmluZWQgPyB0aGlzLm9wdGlvbnMuZm9ybWF0IDogZm9ybWF0O1xyXG4gICAgICAgICAgICBpZihmb3JtYXQgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgcmV0dXJuIGR0LmlzVmFsaWQoKSA/IGR0IDogbnVsbDsgXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgIHJldHVybiBkdC5pc1ZhbGlkKCkgPyBkdC5mb3JtYXQoZm9ybWF0KSA6ICcnOyBcclxuICAgICAgICAgICAgfSAgICAgICAgICAgXHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICAgICAgaWYoIXZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBkdCA9IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyBtb21lbnQodmFsdWUsIHRoaXMub3B0aW9ucy5mb3JtYXQpIDogbW9tZW50KHZhbHVlKSxcclxuICAgICAgICAgICAgICAgIHRoYXQgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgdmFsdWVzID0ge307XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2Z1bmN0aW9uIHRvIGZpbmQgbmVhcmVzdCB2YWx1ZSBpbiBzZWxlY3Qgb3B0aW9uc1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXROZWFyZXN0KCRzZWxlY3QsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVsdGEgPSB7fTtcclxuICAgICAgICAgICAgICAgICRzZWxlY3QuY2hpbGRyZW4oJ29wdGlvbicpLmVhY2goZnVuY3Rpb24oaSwgb3B0KXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb3B0VmFsdWUgPSAkKG9wdCkuYXR0cigndmFsdWUnKSxcclxuICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYob3B0VmFsdWUgPT09ICcnKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBNYXRoLmFicyhvcHRWYWx1ZSAtIHZhbHVlKTsgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIGRlbHRhLmRpc3RhbmNlID09PSAndW5kZWZpbmVkJyB8fCBkaXN0YW5jZSA8IGRlbHRhLmRpc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbHRhID0ge3ZhbHVlOiBvcHRWYWx1ZSwgZGlzdGFuY2U6IGRpc3RhbmNlfTtcclxuICAgICAgICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICAgICAgfSk7IFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlbHRhLnZhbHVlO1xyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYoZHQuaXNWYWxpZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAvL3JlYWQgdmFsdWVzIGZyb20gZGF0ZSBvYmplY3RcclxuICAgICAgICAgICAgICAgICQuZWFjaCh0aGlzLm1hcCwgZnVuY3Rpb24oaywgdikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGsgPT09ICdhbXBtJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsgXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1trXSA9IGR0W3ZbMV1dKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLiRhbXBtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8xMjowMCBwbSAtLT4gMTI6MDAgKDI0LWggZm9ybWF0LCBtaWRkYXkpLCAxMjowMCBhbSAtLT4gMDA6MDAgKDI0LWggZm9ybWF0LCBtaWRuaWdodCwgc3RhcnQgb2YgZGF5KVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlcy5ob3VyID49IDEyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcy5hbXBtID0gJ3BtJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWVzLmhvdXIgPiAxMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzLmhvdXIgLT0gMTI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMuYW1wbSA9ICdhbSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlcy5ob3VyID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMuaG91ciA9IDEyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAkLmVhY2godmFsdWVzLCBmdW5jdGlvbihrLCB2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9jYWxsIHZhbCgpIGZvciBlYWNoIGV4aXN0aW5nIGNvbWJvLCBlLmcuIHRoaXMuJGhvdXIudmFsKClcclxuICAgICAgICAgICAgICAgICAgICBpZih0aGF0WyckJytrXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihrID09PSAnbWludXRlJyAmJiB0aGF0Lm9wdGlvbnMubWludXRlU3RlcCA+IDEgJiYgdGhhdC5vcHRpb25zLnJvdW5kVGltZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gZ2V0TmVhcmVzdCh0aGF0WyckJytrXSwgdik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoayA9PT0gJ3NlY29uZCcgJiYgdGhhdC5vcHRpb25zLnNlY29uZFN0ZXAgPiAxICYmIHRoYXQub3B0aW9ucy5yb3VuZFRpbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdiA9IGdldE5lYXJlc3QodGhhdFsnJCcra10sIHYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdFsnJCcra10udmFsKHYpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBkYXlzIGNvdW50XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNtYXJ0RGF5cykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsbENvbWJvKCdkYXknKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQudmFsKGR0LmZvcm1hdCh0aGlzLm9wdGlvbnMuZm9ybWF0KSkuY2hhbmdlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIGhpZ2hsaWdodCBjb21ib3MgaWYgZGF0ZSBpcyBpbnZhbGlkXHJcbiAgICAgICAgKi9cclxuICAgICAgICBoaWdobGlnaHQ6IGZ1bmN0aW9uKGR0KSB7XHJcbiAgICAgICAgICAgIGlmKCFkdC5pc1ZhbGlkKCkpIHtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMub3B0aW9ucy5lcnJvckNsYXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kd2lkZ2V0LmFkZENsYXNzKHRoaXMub3B0aW9ucy5lcnJvckNsYXNzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9zdG9yZSBvcmlnaW5hbCBib3JkZXIgY29sb3JcclxuICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5ib3JkZXJDb2xvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJvcmRlckNvbG9yID0gdGhpcy4kd2lkZ2V0LmZpbmQoJ3NlbGVjdCcpLmNzcygnYm9yZGVyLWNvbG9yJyk7IFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR3aWRnZXQuZmluZCgnc2VsZWN0JykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7XHJcbiAgICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLmVycm9yQ2xhc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR3aWRnZXQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmVycm9yQ2xhc3MpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR3aWRnZXQuZmluZCgnc2VsZWN0JykuY3NzKCdib3JkZXItY29sb3InLCB0aGlzLmJvcmRlckNvbG9yKTtcclxuICAgICAgICAgICAgICAgIH0gIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICBsZWFkWmVybzogZnVuY3Rpb24odikge1xyXG4gICAgICAgICAgICByZXR1cm4gdiA8PSA5ID8gJzAnICsgdiA6IHY7IFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHRoaXMuJHdpZGdldC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5yZW1vdmVEYXRhKCdjb21ib2RhdGUnKS5zaG93KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vdG9kbzogY2xlYXIgbWV0aG9kICAgICAgICBcclxuICAgIH07XHJcblxyXG4gICAgJC5mbi5jb21ib2RhdGUgPSBmdW5jdGlvbiAoIG9wdGlvbiApIHtcclxuICAgICAgICB2YXIgZCwgYXJncyA9IEFycmF5LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgYXJncy5zaGlmdCgpO1xyXG5cclxuICAgICAgICAvL2dldFZhbHVlIHJldHVybnMgZGF0ZSBhcyBzdHJpbmcgLyBvYmplY3QgKG5vdCBqUXVlcnkgb2JqZWN0KVxyXG4gICAgICAgIGlmKG9wdGlvbiA9PT0gJ2dldFZhbHVlJyAmJiB0aGlzLmxlbmd0aCAmJiAoZCA9IHRoaXMuZXEoMCkuZGF0YSgnY29tYm9kYXRlJykpKSB7XHJcbiAgICAgICAgICByZXR1cm4gZC5nZXRWYWx1ZS5hcHBseShkLCBhcmdzKTtcclxuICAgICAgICB9ICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSxcclxuICAgICAgICAgICAgZGF0YSA9ICR0aGlzLmRhdGEoJ2NvbWJvZGF0ZScpLFxyXG4gICAgICAgICAgICBvcHRpb25zID0gdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb247XHJcbiAgICAgICAgICAgIGlmICghZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJHRoaXMuZGF0YSgnY29tYm9kYXRlJywgKGRhdGEgPSBuZXcgQ29tYm9kYXRlKHRoaXMsIG9wdGlvbnMpKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycgJiYgdHlwZW9mIGRhdGFbb3B0aW9uXSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhW29wdGlvbl0uYXBwbHkoZGF0YSwgYXJncyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07ICBcclxuICAgIFxyXG4gICAgJC5mbi5jb21ib2RhdGUuZGVmYXVsdHMgPSB7XHJcbiAgICAgICAgIC8vaW4gdGhpcyBmb3JtYXQgdmFsdWUgc3RvcmVkIGluIG9yaWdpbmFsIGlucHV0XHJcbiAgICAgICAgZm9ybWF0OiAnREQtTU0tWVlZWSBISDptbScsICAgICAgXHJcbiAgICAgICAgLy9pbiB0aGlzIGZvcm1hdCBpdGVtcyBpbiBkcm9wZG93bnMgYXJlIGRpc3BsYXllZFxyXG4gICAgICAgIHRlbXBsYXRlOiAnRCAvIE1NTSAvIFlZWVkgICBIIDogbW0nLFxyXG4gICAgICAgIC8vaW5pdGlhbCB2YWx1ZSwgY2FuIGJlIGBuZXcgRGF0ZSgpYCAgICBcclxuICAgICAgICB2YWx1ZTogbnVsbCwgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIG1pblllYXI6IDE5NzAsXHJcbiAgICAgICAgbWF4WWVhcjogMjAxNSxcclxuICAgICAgICB5ZWFyRGVzY2VuZGluZzogdHJ1ZSxcclxuICAgICAgICBtaW51dGVTdGVwOiA1LFxyXG4gICAgICAgIHNlY29uZFN0ZXA6IDEsXHJcbiAgICAgICAgZmlyc3RJdGVtOiAnZW1wdHknLCAvLyduYW1lJywgJ2VtcHR5JywgJ25vbmUnXHJcbiAgICAgICAgZXJyb3JDbGFzczogbnVsbCxcclxuICAgICAgICByb3VuZFRpbWU6IHRydWUsIC8vIHdoZXRoZXIgdG8gcm91bmQgbWludXRlcyBhbmQgc2Vjb25kcyBpZiBzdGVwID4gMVxyXG4gICAgICAgIHNtYXJ0RGF5czogZmFsc2UgLy8gd2hldGhlciBkYXlzIGluIGNvbWJvIGRlcGVuZCBvbiBzZWxlY3RlZCBtb250aDogMzEsIDMwLCAyOFxyXG4gICAgfTtcclxuXHJcbn0od2luZG93LmpRdWVyeSkpO1xyXG4vKipcclxuQ29tYm9kYXRlIGlucHV0IC0gZHJvcGRvd24gZGF0ZSBhbmQgdGltZSBwaWNrZXIuICAgIFxyXG5CYXNlZCBvbiBbY29tYm9kYXRlXShodHRwOi8vdml0YWxldHMuZ2l0aHViLmNvbS9jb21ib2RhdGUpIHBsdWdpbiAoaW5jbHVkZWQpLiBUbyB1c2UgaXQgeW91IHNob3VsZCBtYW51YWxseSBpbmNsdWRlIFttb21lbnRqc10oaHR0cDovL21vbWVudGpzLmNvbSkuXHJcblxyXG4gICAgPHNjcmlwdCBzcmM9XCJqcy9tb21lbnQubWluLmpzXCI+PC9zY3JpcHQ+XHJcbiAgIFxyXG5BbGxvd3MgdG8gaW5wdXQ6XHJcblxyXG4qIG9ubHkgZGF0ZVxyXG4qIG9ubHkgdGltZSBcclxuKiBib3RoIGRhdGUgYW5kIHRpbWUgIFxyXG5cclxuUGxlYXNlIG5vdGUsIHRoYXQgZm9ybWF0IGlzIHRha2VuIGZyb20gbW9tZW50anMgYW5kICoqbm90IGNvbXBhdGlibGUqKiB3aXRoIGJvb3RzdHJhcC1kYXRlcGlja2VyIC8ganF1ZXJ5IFVJIGRhdGVwaWNrZXIuICBcclxuSW50ZXJuYWxseSB2YWx1ZSBzdG9yZWQgYXMgYG1vbWVudGpzYCBvYmplY3QuIFxyXG5cclxuQGNsYXNzIGNvbWJvZGF0ZVxyXG5AZXh0ZW5kcyBhYnN0cmFjdGlucHV0XHJcbkBmaW5hbFxyXG5Ac2luY2UgMS40LjBcclxuQGV4YW1wbGVcclxuPGEgaHJlZj1cIiNcIiBpZD1cImRvYlwiIGRhdGEtdHlwZT1cImNvbWJvZGF0ZVwiIGRhdGEtcGs9XCIxXCIgZGF0YS11cmw9XCIvcG9zdFwiIGRhdGEtdmFsdWU9XCIxOTg0LTA1LTE1XCIgZGF0YS10aXRsZT1cIlNlbGVjdCBkYXRlXCI+PC9hPlxyXG48c2NyaXB0PlxyXG4kKGZ1bmN0aW9uKCl7XHJcbiAgICAkKCcjZG9iJykuZWRpdGFibGUoe1xyXG4gICAgICAgIGZvcm1hdDogJ1lZWVktTU0tREQnLCAgICBcclxuICAgICAgICB2aWV3Zm9ybWF0OiAnREQuTU0uWVlZWScsICAgIFxyXG4gICAgICAgIHRlbXBsYXRlOiAnRCAvIE1NTU0gLyBZWVlZJywgICAgXHJcbiAgICAgICAgY29tYm9kYXRlOiB7XHJcbiAgICAgICAgICAgICAgICBtaW5ZZWFyOiAyMDAwLFxyXG4gICAgICAgICAgICAgICAgbWF4WWVhcjogMjAxNSxcclxuICAgICAgICAgICAgICAgIG1pbnV0ZVN0ZXA6IDFcclxuICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pO1xyXG48L3NjcmlwdD5cclxuKiovXHJcblxyXG4vKmdsb2JhbCBtb21lbnQqL1xyXG5cclxuKGZ1bmN0aW9uICgkKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIFxyXG4gICAgdmFyIENvbnN0cnVjdG9yID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLmluaXQoJ2NvbWJvZGF0ZScsIG9wdGlvbnMsIENvbnN0cnVjdG9yLmRlZmF1bHRzKTtcclxuICAgICAgICBcclxuICAgICAgICAvL2J5IGRlZmF1bHQgdmlld2Zvcm1hdCBlcXVhbHMgdG8gZm9ybWF0XHJcbiAgICAgICAgaWYoIXRoaXMub3B0aW9ucy52aWV3Zm9ybWF0KSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy52aWV3Zm9ybWF0ID0gdGhpcy5vcHRpb25zLmZvcm1hdDtcclxuICAgICAgICB9ICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICAvL3RyeSBwYXJzZSBjb21ib2RhdGUgY29uZmlnIGRlZmluZWQgYXMganNvbiBzdHJpbmcgaW4gZGF0YS1jb21ib2RhdGVcclxuICAgICAgICBvcHRpb25zLmNvbWJvZGF0ZSA9ICQuZm4uZWRpdGFibGV1dGlscy50cnlQYXJzZUpzb24ob3B0aW9ucy5jb21ib2RhdGUsIHRydWUpO1xyXG5cclxuICAgICAgICAvL292ZXJyaWRpbmcgY29tYm9kYXRlIGNvbmZpZyAoYXMgYnkgZGVmYXVsdCBqUXVlcnkgZXh0ZW5kKCkgaXMgbm90IHJlY3Vyc2l2ZSlcclxuICAgICAgICB0aGlzLm9wdGlvbnMuY29tYm9kYXRlID0gJC5leHRlbmQoe30sIENvbnN0cnVjdG9yLmRlZmF1bHRzLmNvbWJvZGF0ZSwgb3B0aW9ucy5jb21ib2RhdGUsIHtcclxuICAgICAgICAgICAgZm9ybWF0OiB0aGlzLm9wdGlvbnMuZm9ybWF0LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogdGhpcy5vcHRpb25zLnRlbXBsYXRlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgICQuZm4uZWRpdGFibGV1dGlscy5pbmhlcml0KENvbnN0cnVjdG9yLCAkLmZuLmVkaXRhYmxldHlwZXMuYWJzdHJhY3RpbnB1dCk7ICAgIFxyXG4gICAgXHJcbiAgICAkLmV4dGVuZChDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHtcclxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQuY29tYm9kYXRlKHRoaXMub3B0aW9ucy5jb21ib2RhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZigkLmZuLmVkaXRhYmxlZm9ybS5lbmdpbmUgPT09ICdiczMnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5zaWJsaW5ncygpLmZpbmQoJ3NlbGVjdCcpLmFkZENsYXNzKCdmb3JtLWNvbnRyb2wnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLmlucHV0Y2xhc3MpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0LnNpYmxpbmdzKCkuZmluZCgnc2VsZWN0JykuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmlucHV0Y2xhc3MpO1xyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vXCJjbGVhclwiIGxpbmtcclxuICAgICAgICAgICAgLypcclxuICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLmNsZWFyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRjbGVhciA9ICQoJzxhIGhyZWY9XCIjXCI+PC9hPicpLmh0bWwodGhpcy5vcHRpb25zLmNsZWFyKS5jbGljaygkLnByb3h5KGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIH0sIHRoaXMpKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy4kdHBsLnBhcmVudCgpLmFwcGVuZCgkKCc8ZGl2IGNsYXNzPVwiZWRpdGFibGUtY2xlYXJcIj4nKS5hcHBlbmQodGhpcy4kY2xlYXIpKTsgIFxyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICAqLyAgICAgICAgICAgICAgIFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFsdWUyaHRtbDogZnVuY3Rpb24odmFsdWUsIGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdmFyIHRleHQgPSB2YWx1ZSA/IHZhbHVlLmZvcm1hdCh0aGlzLm9wdGlvbnMudmlld2Zvcm1hdCkgOiAnJztcclxuICAgICAgICAgICAgLy8kKGVsZW1lbnQpLnRleHQodGV4dCk7XHJcbiAgICAgICAgICAgIENvbnN0cnVjdG9yLnN1cGVyY2xhc3MudmFsdWUyaHRtbC5jYWxsKHRoaXMsIHRleHQsIGVsZW1lbnQpOyAgXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgaHRtbDJ2YWx1ZTogZnVuY3Rpb24oaHRtbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaHRtbCA/IG1vbWVudChodG1sLCB0aGlzLm9wdGlvbnMudmlld2Zvcm1hdCkgOiBudWxsO1xyXG4gICAgICAgIH0sICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFsdWUyc3RyOiBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUgPyB2YWx1ZS5mb3JtYXQodGhpcy5vcHRpb25zLmZvcm1hdCkgOiAnJztcclxuICAgICAgIH0sIFxyXG4gICAgICAgXHJcbiAgICAgICBzdHIydmFsdWU6IGZ1bmN0aW9uKHN0cikge1xyXG4gICAgICAgICAgIHJldHVybiBzdHIgPyBtb21lbnQoc3RyLCB0aGlzLm9wdGlvbnMuZm9ybWF0KSA6IG51bGw7XHJcbiAgICAgICB9LCBcclxuICAgICAgIFxyXG4gICAgICAgdmFsdWUyc3VibWl0OiBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlMnN0cih2YWx1ZSk7XHJcbiAgICAgICB9LCAgICAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgdmFsdWUyaW5wdXQ6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgICAgdGhpcy4kaW5wdXQuY29tYm9kYXRlKCdzZXRWYWx1ZScsIHZhbHVlKTtcclxuICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICBpbnB1dDJ2YWx1ZTogZnVuY3Rpb24oKSB7IFxyXG4gICAgICAgICAgIHJldHVybiB0aGlzLiRpbnB1dC5jb21ib2RhdGUoJ2dldFZhbHVlJywgbnVsbCk7XHJcbiAgICAgICB9LCAgICAgICBcclxuICAgICAgIFxyXG4gICAgICAgYWN0aXZhdGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgIHRoaXMuJGlucHV0LnNpYmxpbmdzKCcuY29tYm9kYXRlJykuZmluZCgnc2VsZWN0JykuZXEoMCkuZm9jdXMoKTtcclxuICAgICAgIH0sXHJcbiAgICAgICBcclxuICAgICAgIC8qXHJcbiAgICAgICBjbGVhcjogIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgdGhpcy4kaW5wdXQuZGF0YSgnZGF0ZXBpY2tlcicpLmRhdGUgPSBudWxsO1xyXG4gICAgICAgICAgdGhpcy4kaW5wdXQuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgIH0sXHJcbiAgICAgICAqL1xyXG4gICAgICAgXHJcbiAgICAgICBhdXRvc3VibWl0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICBcclxuICAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgQ29uc3RydWN0b3IuZGVmYXVsdHMgPSAkLmV4dGVuZCh7fSwgJC5mbi5lZGl0YWJsZXR5cGVzLmFic3RyYWN0aW5wdXQuZGVmYXVsdHMsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICBAcHJvcGVydHkgdHBsIFxyXG4gICAgICAgIEBkZWZhdWx0IDxpbnB1dCB0eXBlPVwidGV4dFwiPlxyXG4gICAgICAgICoqLyAgICAgICAgIFxyXG4gICAgICAgIHRwbDonPGlucHV0IHR5cGU9XCJ0ZXh0XCI+JyxcclxuICAgICAgICAvKipcclxuICAgICAgICBAcHJvcGVydHkgaW5wdXRjbGFzcyBcclxuICAgICAgICBAZGVmYXVsdCBudWxsXHJcbiAgICAgICAgKiovICAgICAgICAgXHJcbiAgICAgICAgaW5wdXRjbGFzczogbnVsbCxcclxuICAgICAgICAvKipcclxuICAgICAgICBGb3JtYXQgdXNlZCBmb3Igc2VuZGluZyB2YWx1ZSB0byBzZXJ2ZXIuIEFsc28gYXBwbGllZCB3aGVuIGNvbnZlcnRpbmcgZGF0ZSBmcm9tIDxjb2RlPmRhdGEtdmFsdWU8L2NvZGU+IGF0dHJpYnV0ZS48YnI+XHJcbiAgICAgICAgU2VlIGxpc3Qgb2YgdG9rZW5zIGluIFttb21lbnRqcyBkb2NzXShodHRwOi8vbW9tZW50anMuY29tL2RvY3MvIy9wYXJzaW5nL3N0cmluZy1mb3JtYXQpICBcclxuICAgICAgICBcclxuICAgICAgICBAcHJvcGVydHkgZm9ybWF0IFxyXG4gICAgICAgIEB0eXBlIHN0cmluZ1xyXG4gICAgICAgIEBkZWZhdWx0IFlZWVktTU0tRERcclxuICAgICAgICAqKi8gICAgICAgICBcclxuICAgICAgICBmb3JtYXQ6J1lZWVktTU0tREQnLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEZvcm1hdCB1c2VkIGZvciBkaXNwbGF5aW5nIGRhdGUuIEFsc28gYXBwbGllZCB3aGVuIGNvbnZlcnRpbmcgZGF0ZSBmcm9tIGVsZW1lbnQncyB0ZXh0IG9uIGluaXQuICAgXHJcbiAgICAgICAgSWYgbm90IHNwZWNpZmllZCBlcXVhbHMgdG8gYGZvcm1hdGAuXHJcbiAgICAgICAgXHJcbiAgICAgICAgQHByb3BlcnR5IHZpZXdmb3JtYXQgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nXHJcbiAgICAgICAgQGRlZmF1bHQgbnVsbFxyXG4gICAgICAgICoqLyAgICAgICAgICBcclxuICAgICAgICB2aWV3Zm9ybWF0OiBudWxsLCAgICAgICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgVGVtcGxhdGUgdXNlZCBmb3IgZGlzcGxheWluZyBkcm9wZG93bnMuXHJcbiAgICAgICAgXHJcbiAgICAgICAgQHByb3BlcnR5IHRlbXBsYXRlIFxyXG4gICAgICAgIEB0eXBlIHN0cmluZ1xyXG4gICAgICAgIEBkZWZhdWx0IEQgLyBNTU0gLyBZWVlZXHJcbiAgICAgICAgKiovICAgICAgICAgIFxyXG4gICAgICAgIHRlbXBsYXRlOiAnRCAvIE1NTSAvIFlZWVknLCAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgQ29uZmlndXJhdGlvbiBvZiBjb21ib2RhdGUuXHJcbiAgICAgICAgRnVsbCBsaXN0IG9mIG9wdGlvbnM6IGh0dHA6Ly92aXRhbGV0cy5naXRodWIuY29tL2NvbWJvZGF0ZS8jZG9jc1xyXG4gICAgICAgIFxyXG4gICAgICAgIEBwcm9wZXJ0eSBjb21ib2RhdGUgXHJcbiAgICAgICAgQHR5cGUgb2JqZWN0XHJcbiAgICAgICAgQGRlZmF1bHQgbnVsbFxyXG4gICAgICAgICoqL1xyXG4gICAgICAgIGNvbWJvZGF0ZTogbnVsbFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgKG5vdCBpbXBsZW1lbnRlZCB5ZXQpXHJcbiAgICAgICAgVGV4dCBzaG93biBhcyBjbGVhciBkYXRlIGJ1dHRvbi4gXHJcbiAgICAgICAgSWYgPGNvZGU+ZmFsc2U8L2NvZGU+IGNsZWFyIGJ1dHRvbiB3aWxsIG5vdCBiZSByZW5kZXJlZC5cclxuICAgICAgICBcclxuICAgICAgICBAcHJvcGVydHkgY2xlYXIgXHJcbiAgICAgICAgQHR5cGUgYm9vbGVhbnxzdHJpbmdcclxuICAgICAgICBAZGVmYXVsdCAneCBjbGVhcicgICAgICAgICBcclxuICAgICAgICAqL1xyXG4gICAgICAgIC8vY2xlYXI6ICcmdGltZXM7IGNsZWFyJ1xyXG4gICAgfSk7ICAgXHJcblxyXG4gICAgJC5mbi5lZGl0YWJsZXR5cGVzLmNvbWJvZGF0ZSA9IENvbnN0cnVjdG9yO1xyXG5cclxufSh3aW5kb3cualF1ZXJ5KSk7XHJcblxyXG4vKlxyXG5FZGl0YWJsZWZvcm0gYmFzZWQgb24gVHdpdHRlciBCb290c3RyYXAgM1xyXG4qL1xyXG4oZnVuY3Rpb24gKCQpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgXHJcbiAgICAvL3N0b3JlIHBhcmVudCBtZXRob2RzXHJcbiAgICB2YXIgcEluaXRJbnB1dCA9ICQuZm4uZWRpdGFibGVmb3JtLkNvbnN0cnVjdG9yLnByb3RvdHlwZS5pbml0SW5wdXQ7XHJcbiAgICBcclxuICAgICQuZXh0ZW5kKCQuZm4uZWRpdGFibGVmb3JtLkNvbnN0cnVjdG9yLnByb3RvdHlwZSwge1xyXG4gICAgICAgIGluaXRUZW1wbGF0ZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHRoaXMuJGZvcm0gPSAkKCQuZm4uZWRpdGFibGVmb3JtLnRlbXBsYXRlKTsgXHJcbiAgICAgICAgICAgIHRoaXMuJGZvcm0uZmluZCgnLmNvbnRyb2wtZ3JvdXAnKS5hZGRDbGFzcygnZm9ybS1ncm91cCcpO1xyXG4gICAgICAgICAgICB0aGlzLiRmb3JtLmZpbmQoJy5lZGl0YWJsZS1lcnJvci1ibG9jaycpLmFkZENsYXNzKCdoZWxwLWJsb2NrJyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBpbml0SW5wdXQ6IGZ1bmN0aW9uKCkgeyAgXHJcbiAgICAgICAgICAgIHBJbml0SW5wdXQuYXBwbHkodGhpcyk7XHJcblxyXG4gICAgICAgICAgICAvL2ZvciBiczMgc2V0IGRlZmF1bHQgY2xhc3MgYGlucHV0LXNtYCB0byBzdGFuZGFyZCBpbnB1dHNcclxuICAgICAgICAgICAgdmFyIGVtcHR5SW5wdXRDbGFzcyA9IHRoaXMuaW5wdXQub3B0aW9ucy5pbnB1dGNsYXNzID09PSBudWxsIHx8IHRoaXMuaW5wdXQub3B0aW9ucy5pbnB1dGNsYXNzID09PSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyIGRlZmF1bHRDbGFzcyA9ICdpbnB1dC1zbSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2JzMyBhZGQgYGZvcm0tY29udHJvbGAgY2xhc3MgdG8gc3RhbmRhcmQgaW5wdXRzXHJcbiAgICAgICAgICAgIHZhciBzdGR0eXBlcyA9ICd0ZXh0LHNlbGVjdCx0ZXh0YXJlYSxwYXNzd29yZCxlbWFpbCx1cmwsdGVsLG51bWJlcixyYW5nZSx0aW1lLHR5cGVhaGVhZGpzJy5zcGxpdCgnLCcpOyBcclxuICAgICAgICAgICAgaWYofiQuaW5BcnJheSh0aGlzLmlucHV0LnR5cGUsIHN0ZHR5cGVzKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dC4kaW5wdXQuYWRkQ2xhc3MoJ2Zvcm0tY29udHJvbCcpO1xyXG4gICAgICAgICAgICAgICAgaWYoZW1wdHlJbnB1dENsYXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5vcHRpb25zLmlucHV0Y2xhc3MgPSBkZWZhdWx0Q2xhc3M7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC4kaW5wdXQuYWRkQ2xhc3MoZGVmYXVsdENsYXNzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSAgICAgICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICAgICAgLy9hcHBseSBiczMgc2l6ZSBjbGFzcyBhbHNvIHRvIGJ1dHRvbnMgKHRvIGZpdCBzaXplIG9mIGNvbnRyb2wpXHJcbiAgICAgICAgICAgIHZhciAkYnRuID0gdGhpcy4kZm9ybS5maW5kKCcuZWRpdGFibGUtYnV0dG9ucycpO1xyXG4gICAgICAgICAgICB2YXIgY2xhc3NlcyA9IGVtcHR5SW5wdXRDbGFzcyA/IFtkZWZhdWx0Q2xhc3NdIDogdGhpcy5pbnB1dC5vcHRpb25zLmlucHV0Y2xhc3Muc3BsaXQoJyAnKTtcclxuICAgICAgICAgICAgZm9yKHZhciBpPTA7IGk8Y2xhc3Nlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgLy8gYGJ0bi1zbWAgaXMgZGVmYXVsdCBub3dcclxuICAgICAgICAgICAgICAgIC8qXHJcbiAgICAgICAgICAgICAgICBpZihjbGFzc2VzW2ldLnRvTG93ZXJDYXNlKCkgPT09ICdpbnB1dC1zbScpIHsgXHJcbiAgICAgICAgICAgICAgICAgICAgJGJ0bi5maW5kKCdidXR0b24nKS5hZGRDbGFzcygnYnRuLXNtJyk7ICBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICBpZihjbGFzc2VzW2ldLnRvTG93ZXJDYXNlKCkgPT09ICdpbnB1dC1sZycpIHtcclxuICAgICAgICAgICAgICAgICAgICAkYnRuLmZpbmQoJ2J1dHRvbicpLnJlbW92ZUNsYXNzKCdidG4tc20nKS5hZGRDbGFzcygnYnRuLWxnJyk7IFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7ICAgIFxyXG4gICAgXHJcbiAgICAvL2J1dHRvbnNcclxuICAgICQuZm4uZWRpdGFibGVmb3JtLmJ1dHRvbnMgPSBcclxuICAgICAgJzxidXR0b24gdHlwZT1cInN1Ym1pdFwiIGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5IGJ0bi1zbSBlZGl0YWJsZS1zdWJtaXRcIj4nK1xyXG4gICAgICAgICc8aSBjbGFzcz1cImdseXBoaWNvbiBnbHlwaGljb24tb2tcIj48L2k+JytcclxuICAgICAgJzwvYnV0dG9uPicrXHJcbiAgICAgICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0biBidG4tZGVmYXVsdCBidG4tc20gZWRpdGFibGUtY2FuY2VsXCI+JytcclxuICAgICAgICAnPGkgY2xhc3M9XCJnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZVwiPjwvaT4nK1xyXG4gICAgICAnPC9idXR0b24+JzsgICAgICAgICBcclxuICAgIFxyXG4gICAgLy9lcnJvciBjbGFzc2VzXHJcbiAgICAkLmZuLmVkaXRhYmxlZm9ybS5lcnJvckdyb3VwQ2xhc3MgPSAnaGFzLWVycm9yJztcclxuICAgICQuZm4uZWRpdGFibGVmb3JtLmVycm9yQmxvY2tDbGFzcyA9IG51bGw7ICBcclxuICAgIC8vZW5naW5lXHJcbiAgICAkLmZuLmVkaXRhYmxlZm9ybS5lbmdpbmUgPSAnYnMzJzsgIFxyXG59KHdpbmRvdy5qUXVlcnkpKTtcclxuLyoqXHJcbiogRWRpdGFibGUgUG9wb3ZlcjMgKGZvciBCb290c3RyYXAgMykgXHJcbiogLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiogcmVxdWlyZXMgYm9vdHN0cmFwLXBvcG92ZXIuanNcclxuKi9cclxuKGZ1bmN0aW9uICgkKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICAvL2V4dGVuZCBtZXRob2RzXHJcbiAgICAkLmV4dGVuZCgkLmZuLmVkaXRhYmxlQ29udGFpbmVyLlBvcHVwLnByb3RvdHlwZSwge1xyXG4gICAgICAgIGNvbnRhaW5lck5hbWU6ICdwb3BvdmVyJyxcclxuICAgICAgICBjb250YWluZXJEYXRhTmFtZTogJ2JzLnBvcG92ZXInLFxyXG4gICAgICAgIGlubmVyQ3NzOiAnLnBvcG92ZXItY29udGVudCcsXHJcbiAgICAgICAgZGVmYXVsdHM6ICQuZm4ucG9wb3Zlci5Db25zdHJ1Y3Rvci5ERUZBVUxUUyxcclxuXHJcbiAgICAgICAgaW5pdENvbnRhaW5lcjogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgJC5leHRlbmQodGhpcy5jb250YWluZXJPcHRpb25zLCB7XHJcbiAgICAgICAgICAgICAgICB0cmlnZ2VyOiAnbWFudWFsJyxcclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICcgJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiB0aGlzLmRlZmF1bHRzLnRlbXBsYXRlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9hcyB0ZW1wbGF0ZSBwcm9wZXJ0eSBpcyB1c2VkIGluIGlucHV0cywgaGlkZSBpdCBmcm9tIHBvcG92ZXJcclxuICAgICAgICAgICAgdmFyIHQ7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuJGVsZW1lbnQuZGF0YSgndGVtcGxhdGUnKSkge1xyXG4gICAgICAgICAgICAgICB0ID0gdGhpcy4kZWxlbWVudC5kYXRhKCd0ZW1wbGF0ZScpO1xyXG4gICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50LnJlbW92ZURhdGEoJ3RlbXBsYXRlJyk7ICBcclxuICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuY2FsbCh0aGlzLmNvbnRhaW5lck9wdGlvbnMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYodCkge1xyXG4gICAgICAgICAgICAgICAvL3Jlc3RvcmUgZGF0YSgndGVtcGxhdGUnKVxyXG4gICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50LmRhdGEoJ3RlbXBsYXRlJywgdCk7IFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLyogc2hvdyAqL1xyXG4gICAgICAgIGlubmVyU2hvdzogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0aGlzLmNhbGwoJ3Nob3cnKTsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgfSwgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qIGhpZGUgKi9cclxuICAgICAgICBpbm5lckhpZGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdGhpcy5jYWxsKCdoaWRlJyk7ICAgICAgIFxyXG4gICAgICAgIH0sIFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qIGRlc3Ryb3kgKi9cclxuICAgICAgICBpbm5lckRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB0aGlzLmNhbGwoJ2Rlc3Ryb3knKTtcclxuICAgICAgICB9LCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICBzZXRDb250YWluZXJPcHRpb246IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIoKS5vcHRpb25zW2tleV0gPSB2YWx1ZTsgXHJcbiAgICAgICAgfSwgICAgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgKiBtb3ZlIHBvcG92ZXIgdG8gbmV3IHBvc2l0aW9uLiBUaGlzIGZ1bmN0aW9uIG1haW5seSBjb3BpZWQgZnJvbSBib290c3RyYXAtcG9wb3Zlci5cclxuICAgICAgICAqL1xyXG4gICAgICAgIC8qanNoaW50IGxheGNvbW1hOiB0cnVlLCBlcWVxZXE6IGZhbHNlKi9cclxuICAgICAgICBzZXRQb3NpdGlvbjogZnVuY3Rpb24gKCkgeyBcclxuXHJcbiAgICAgICAgICAgIChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLyogICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgJHRpcCA9IHRoaXMudGlwKClcclxuICAgICAgICAgICAgICAgICwgaW5zaWRlXHJcbiAgICAgICAgICAgICAgICAsIHBvc1xyXG4gICAgICAgICAgICAgICAgLCBhY3R1YWxXaWR0aFxyXG4gICAgICAgICAgICAgICAgLCBhY3R1YWxIZWlnaHRcclxuICAgICAgICAgICAgICAgICwgcGxhY2VtZW50XHJcbiAgICAgICAgICAgICAgICAsIHRwXHJcbiAgICAgICAgICAgICAgICAsIHRwdFxyXG4gICAgICAgICAgICAgICAgLCB0cGJcclxuICAgICAgICAgICAgICAgICwgdHBsXHJcbiAgICAgICAgICAgICAgICAsIHRwcjtcclxuXHJcbiAgICAgICAgICAgICAgICBwbGFjZW1lbnQgPSB0eXBlb2YgdGhpcy5vcHRpb25zLnBsYWNlbWVudCA9PT0gJ2Z1bmN0aW9uJyA/XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMucGxhY2VtZW50LmNhbGwodGhpcywgJHRpcFswXSwgdGhpcy4kZWxlbWVudFswXSkgOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnBsYWNlbWVudDtcclxuXHJcbiAgICAgICAgICAgICAgICBpbnNpZGUgPSAvaW4vLnRlc3QocGxhY2VtZW50KTtcclxuICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAkdGlwXHJcbiAgICAgICAgICAgICAgLy8gIC5kZXRhY2goKVxyXG4gICAgICAgICAgICAgIC8vdml0YWxldHM6IHJlbW92ZSBhbnkgcGxhY2VtZW50IGNsYXNzIGJlY2F1c2Ugb3RoZXJ3aXNlIHRoZXkgZG9udCBpbmZsdWVuY2Ugb24gcmUtcG9zaXRpb25pbmcgb2YgdmlzaWJsZSBwb3BvdmVyXHJcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3RvcCByaWdodCBib3R0b20gbGVmdCcpXHJcbiAgICAgICAgICAgICAgICAuY3NzKHsgdG9wOiAwLCBsZWZ0OiAwLCBkaXNwbGF5OiAnYmxvY2snIH0pO1xyXG4gICAgICAgICAgICAgIC8vICAuaW5zZXJ0QWZ0ZXIodGhpcy4kZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgcG9zID0gdGhpcy5nZXRQb3NpdGlvbihpbnNpZGUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGFjdHVhbFdpZHRoID0gJHRpcFswXS5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgICAgIGFjdHVhbEhlaWdodCA9ICR0aXBbMF0ub2Zmc2V0SGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9IGluc2lkZSA/IHBsYWNlbWVudC5zcGxpdCgnICcpWzFdIDogcGxhY2VtZW50O1xyXG5cclxuICAgICAgICAgICAgICAgIHRwYiA9IHt0b3A6IHBvcy50b3AgKyBwb3MuaGVpZ2h0LCBsZWZ0OiBwb3MubGVmdCArIHBvcy53aWR0aCAvIDIgLSBhY3R1YWxXaWR0aCAvIDJ9O1xyXG4gICAgICAgICAgICAgICAgdHB0ID0ge3RvcDogcG9zLnRvcCAtIGFjdHVhbEhlaWdodCwgbGVmdDogcG9zLmxlZnQgKyBwb3Mud2lkdGggLyAyIC0gYWN0dWFsV2lkdGggLyAyfTtcclxuICAgICAgICAgICAgICAgIHRwbCA9IHt0b3A6IHBvcy50b3AgKyBwb3MuaGVpZ2h0IC8gMiAtIGFjdHVhbEhlaWdodCAvIDIsIGxlZnQ6IHBvcy5sZWZ0IC0gYWN0dWFsV2lkdGh9O1xyXG4gICAgICAgICAgICAgICAgdHByID0ge3RvcDogcG9zLnRvcCArIHBvcy5oZWlnaHQgLyAyIC0gYWN0dWFsSGVpZ2h0IC8gMiwgbGVmdDogcG9zLmxlZnQgKyBwb3Mud2lkdGh9O1xyXG5cclxuICAgICAgICAgICAgICAgIHN3aXRjaCAocGxhY2VtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm90dG9tJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh0cGIudG9wICsgYWN0dWFsSGVpZ2h0KSA+ICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkgKyAkKHdpbmRvdykuaGVpZ2h0KCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHB0LnRvcCA+ICQod2luZG93KS5zY3JvbGxUb3AoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9ICd0b3AnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgodHByLmxlZnQgKyBhY3R1YWxXaWR0aCkgPCAoJCh3aW5kb3cpLnNjcm9sbExlZnQoKSArICQod2luZG93KS53aWR0aCgpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9ICdyaWdodCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRwbC5sZWZ0ID4gJCh3aW5kb3cpLnNjcm9sbExlZnQoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9ICdsZWZ0JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gJ3JpZ2h0JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICd0b3AnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHB0LnRvcCA8ICQod2luZG93KS5zY3JvbGxUb3AoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh0cGIudG9wICsgYWN0dWFsSGVpZ2h0KSA8ICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkgKyAkKHdpbmRvdykuaGVpZ2h0KCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gJ2JvdHRvbSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCh0cHIubGVmdCArIGFjdHVhbFdpZHRoKSA8ICgkKHdpbmRvdykuc2Nyb2xsTGVmdCgpICsgJCh3aW5kb3cpLndpZHRoKCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gJ3JpZ2h0JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHBsLmxlZnQgPiAkKHdpbmRvdykuc2Nyb2xsTGVmdCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gJ2xlZnQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQgPSAncmlnaHQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHBsLmxlZnQgPCAkKHdpbmRvdykuc2Nyb2xsTGVmdCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHRwci5sZWZ0ICsgYWN0dWFsV2lkdGgpIDwgKCQod2luZG93KS5zY3JvbGxMZWZ0KCkgKyAkKHdpbmRvdykud2lkdGgoKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQgPSAncmlnaHQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0cHQudG9wID4gJCh3aW5kb3cpLnNjcm9sbFRvcCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gJ3RvcCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRwdC50b3AgPiAkKHdpbmRvdykuc2Nyb2xsVG9wKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQgPSAnYm90dG9tJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gJ3JpZ2h0JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodHByLmxlZnQgKyBhY3R1YWxXaWR0aCkgPiAoJCh3aW5kb3cpLnNjcm9sbExlZnQoKSArICQod2luZG93KS53aWR0aCgpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRwbC5sZWZ0ID4gJCh3aW5kb3cpLnNjcm9sbExlZnQoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9ICdsZWZ0JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHB0LnRvcCA+ICQod2luZG93KS5zY3JvbGxUb3AoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9ICd0b3AnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0cHQudG9wID4gJCh3aW5kb3cpLnNjcm9sbFRvcCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gJ2JvdHRvbSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChwbGFjZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdib3R0b20nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cCA9IHRwYjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndG9wJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHAgPSB0cHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cCA9IHRwbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cCA9IHRwcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHRpcFxyXG4gICAgICAgICAgICAgICAgLm9mZnNldCh0cClcclxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhwbGFjZW1lbnQpXHJcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2luJyk7XHJcbiAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciAkdGlwID0gdGhpcy50aXAoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBwbGFjZW1lbnQgPSB0eXBlb2YgdGhpcy5vcHRpb25zLnBsYWNlbWVudCA9PSAnZnVuY3Rpb24nID9cclxuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5wbGFjZW1lbnQuY2FsbCh0aGlzLCAkdGlwWzBdLCB0aGlzLiRlbGVtZW50WzBdKSA6XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMucGxhY2VtZW50OyAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgdmFyIGF1dG9Ub2tlbiA9IC9cXHM/YXV0bz9cXHM/L2k7XHJcbiAgICAgICAgICAgIHZhciBhdXRvUGxhY2UgPSBhdXRvVG9rZW4udGVzdChwbGFjZW1lbnQpO1xyXG4gICAgICAgICAgICBpZiAoYXV0b1BsYWNlKSB7XHJcbiAgICAgICAgICAgICAgICBwbGFjZW1lbnQgPSBwbGFjZW1lbnQucmVwbGFjZShhdXRvVG9rZW4sICcnKSB8fCAndG9wJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBwb3MgPSB0aGlzLmdldFBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIHZhciBhY3R1YWxXaWR0aCA9ICR0aXBbMF0ub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgIHZhciBhY3R1YWxIZWlnaHQgPSAkdGlwWzBdLm9mZnNldEhlaWdodDtcclxuXHJcbiAgICAgICAgICAgIGlmIChhdXRvUGxhY2UpIHtcclxuICAgICAgICAgICAgICAgIHZhciAkcGFyZW50ID0gdGhpcy4kZWxlbWVudC5wYXJlbnQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgb3JnUGxhY2VtZW50ID0gcGxhY2VtZW50O1xyXG4gICAgICAgICAgICAgICAgdmFyIGRvY1Njcm9sbCAgICA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50V2lkdGggID0gdGhpcy5vcHRpb25zLmNvbnRhaW5lciA9PSAnYm9keScgPyB3aW5kb3cuaW5uZXJXaWR0aCAgOiAkcGFyZW50Lm91dGVyV2lkdGgoKTtcclxuICAgICAgICAgICAgICAgIHZhciBwYXJlbnRIZWlnaHQgPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyID09ICdib2R5JyA/IHdpbmRvdy5pbm5lckhlaWdodCA6ICRwYXJlbnQub3V0ZXJIZWlnaHQoKTtcclxuICAgICAgICAgICAgICAgIHZhciBwYXJlbnRMZWZ0ICAgPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyID09ICdib2R5JyA/IDAgOiAkcGFyZW50Lm9mZnNldCgpLmxlZnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gcGxhY2VtZW50ID09ICdib3R0b20nICYmIHBvcy50b3AgICArIHBvcy5oZWlnaHQgICsgYWN0dWFsSGVpZ2h0IC0gZG9jU2Nyb2xsID4gcGFyZW50SGVpZ2h0ICA/ICd0b3AnICAgIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9PSAndG9wJyAgICAmJiBwb3MudG9wICAgLSBkb2NTY3JvbGwgICAtIGFjdHVhbEhlaWdodCA8IDAgICAgICAgICAgICAgICAgICAgICAgICAgPyAnYm90dG9tJyA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQgPT0gJ3JpZ2h0JyAgJiYgcG9zLnJpZ2h0ICsgYWN0dWFsV2lkdGggPiBwYXJlbnRXaWR0aCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gJ2xlZnQnICAgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID09ICdsZWZ0JyAgICYmIHBvcy5sZWZ0ICAtIGFjdHVhbFdpZHRoIDwgcGFyZW50TGVmdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICdyaWdodCcgIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudDtcclxuXHJcbiAgICAgICAgICAgICAgICAkdGlwXHJcbiAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhvcmdQbGFjZW1lbnQpXHJcbiAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhwbGFjZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgdmFyIGNhbGN1bGF0ZWRPZmZzZXQgPSB0aGlzLmdldENhbGN1bGF0ZWRPZmZzZXQocGxhY2VtZW50LCBwb3MsIGFjdHVhbFdpZHRoLCBhY3R1YWxIZWlnaHQpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5hcHBseVBsYWNlbWVudChjYWxjdWxhdGVkT2Zmc2V0LCBwbGFjZW1lbnQpOyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9KS5jYWxsKHRoaXMuY29udGFpbmVyKCkpO1xyXG4gICAgICAgICAgLypqc2hpbnQgbGF4Y29tbWE6IGZhbHNlLCBlcWVxZXE6IHRydWUqLyAgXHJcbiAgICAgICAgfSAgICAgICAgICAgIFxyXG4gICAgfSk7XHJcblxyXG59KHdpbmRvdy5qUXVlcnkpKTtcclxuXHJcbi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gKiBib290c3RyYXAtZGF0ZXBpY2tlci5qc1xyXG4gKiBodHRwOi8vd3d3LmV5ZWNvbi5yby9ib290c3RyYXAtZGF0ZXBpY2tlclxyXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICogQ29weXJpZ2h0IDIwMTIgU3RlZmFuIFBldHJlXHJcbiAqIEltcHJvdmVtZW50cyBieSBBbmRyZXcgUm93bHNcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXHJcblxyXG4oZnVuY3Rpb24oICQgKSB7XHJcblxyXG5cdGZ1bmN0aW9uIFVUQ0RhdGUoKXtcclxuXHRcdHJldHVybiBuZXcgRGF0ZShEYXRlLlVUQy5hcHBseShEYXRlLCBhcmd1bWVudHMpKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gVVRDVG9kYXkoKXtcclxuXHRcdHZhciB0b2RheSA9IG5ldyBEYXRlKCk7XHJcblx0XHRyZXR1cm4gVVRDRGF0ZSh0b2RheS5nZXRVVENGdWxsWWVhcigpLCB0b2RheS5nZXRVVENNb250aCgpLCB0b2RheS5nZXRVVENEYXRlKCkpO1xyXG5cdH1cclxuXHJcblx0Ly8gUGlja2VyIG9iamVjdFxyXG5cclxuXHR2YXIgRGF0ZXBpY2tlciA9IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdGlvbnMpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHR0aGlzLl9wcm9jZXNzX29wdGlvbnMob3B0aW9ucyk7XHJcblxyXG5cdFx0dGhpcy5lbGVtZW50ID0gJChlbGVtZW50KTtcclxuXHRcdHRoaXMuaXNJbmxpbmUgPSBmYWxzZTtcclxuXHRcdHRoaXMuaXNJbnB1dCA9IHRoaXMuZWxlbWVudC5pcygnaW5wdXQnKTtcclxuXHRcdHRoaXMuY29tcG9uZW50ID0gdGhpcy5lbGVtZW50LmlzKCcuZGF0ZScpID8gdGhpcy5lbGVtZW50LmZpbmQoJy5hZGQtb24sIC5idG4nKSA6IGZhbHNlO1xyXG5cdFx0dGhpcy5oYXNJbnB1dCA9IHRoaXMuY29tcG9uZW50ICYmIHRoaXMuZWxlbWVudC5maW5kKCdpbnB1dCcpLmxlbmd0aDtcclxuXHRcdGlmKHRoaXMuY29tcG9uZW50ICYmIHRoaXMuY29tcG9uZW50Lmxlbmd0aCA9PT0gMClcclxuXHRcdFx0dGhpcy5jb21wb25lbnQgPSBmYWxzZTtcclxuXHJcblx0XHR0aGlzLnBpY2tlciA9ICQoRFBHbG9iYWwudGVtcGxhdGUpO1xyXG5cdFx0dGhpcy5fYnVpbGRFdmVudHMoKTtcclxuXHRcdHRoaXMuX2F0dGFjaEV2ZW50cygpO1xyXG5cclxuXHRcdGlmKHRoaXMuaXNJbmxpbmUpIHtcclxuXHRcdFx0dGhpcy5waWNrZXIuYWRkQ2xhc3MoJ2RhdGVwaWNrZXItaW5saW5lJykuYXBwZW5kVG8odGhpcy5lbGVtZW50KTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMucGlja2VyLmFkZENsYXNzKCdkYXRlcGlja2VyLWRyb3Bkb3duIGRyb3Bkb3duLW1lbnUnKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAodGhpcy5vLnJ0bCl7XHJcblx0XHRcdHRoaXMucGlja2VyLmFkZENsYXNzKCdkYXRlcGlja2VyLXJ0bCcpO1xyXG5cdFx0XHR0aGlzLnBpY2tlci5maW5kKCcucHJldiBpLCAubmV4dCBpJylcclxuXHRcdFx0XHRcdFx0LnRvZ2dsZUNsYXNzKCdpY29uLWFycm93LWxlZnQgaWNvbi1hcnJvdy1yaWdodCcpO1xyXG5cdFx0fVxyXG5cclxuXHJcblx0XHR0aGlzLnZpZXdNb2RlID0gdGhpcy5vLnN0YXJ0VmlldztcclxuXHJcblx0XHRpZiAodGhpcy5vLmNhbGVuZGFyV2Vla3MpXHJcblx0XHRcdHRoaXMucGlja2VyLmZpbmQoJ3Rmb290IHRoLnRvZGF5JylcclxuXHRcdFx0XHRcdFx0LmF0dHIoJ2NvbHNwYW4nLCBmdW5jdGlvbihpLCB2YWwpe1xyXG5cdFx0XHRcdFx0XHRcdHJldHVybiBwYXJzZUludCh2YWwpICsgMTtcclxuXHRcdFx0XHRcdFx0fSk7XHJcblxyXG5cdFx0dGhpcy5fYWxsb3dfdXBkYXRlID0gZmFsc2U7XHJcblxyXG5cdFx0dGhpcy5zZXRTdGFydERhdGUodGhpcy5vLnN0YXJ0RGF0ZSk7XHJcblx0XHR0aGlzLnNldEVuZERhdGUodGhpcy5vLmVuZERhdGUpO1xyXG5cdFx0dGhpcy5zZXREYXlzT2ZXZWVrRGlzYWJsZWQodGhpcy5vLmRheXNPZldlZWtEaXNhYmxlZCk7XHJcblxyXG5cdFx0dGhpcy5maWxsRG93KCk7XHJcblx0XHR0aGlzLmZpbGxNb250aHMoKTtcclxuXHJcblx0XHR0aGlzLl9hbGxvd191cGRhdGUgPSB0cnVlO1xyXG5cclxuXHRcdHRoaXMudXBkYXRlKCk7XHJcblx0XHR0aGlzLnNob3dNb2RlKCk7XHJcblxyXG5cdFx0aWYodGhpcy5pc0lubGluZSkge1xyXG5cdFx0XHR0aGlzLnNob3coKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHREYXRlcGlja2VyLnByb3RvdHlwZSA9IHtcclxuXHRcdGNvbnN0cnVjdG9yOiBEYXRlcGlja2VyLFxyXG5cclxuXHRcdF9wcm9jZXNzX29wdGlvbnM6IGZ1bmN0aW9uKG9wdHMpe1xyXG5cdFx0XHQvLyBTdG9yZSByYXcgb3B0aW9ucyBmb3IgcmVmZXJlbmNlXHJcblx0XHRcdHRoaXMuX28gPSAkLmV4dGVuZCh7fSwgdGhpcy5fbywgb3B0cyk7XHJcblx0XHRcdC8vIFByb2Nlc3NlZCBvcHRpb25zXHJcblx0XHRcdHZhciBvID0gdGhpcy5vID0gJC5leHRlbmQoe30sIHRoaXMuX28pO1xyXG5cclxuXHRcdFx0Ly8gQ2hlY2sgaWYgXCJkZS1ERVwiIHN0eWxlIGRhdGUgaXMgYXZhaWxhYmxlLCBpZiBub3QgbGFuZ3VhZ2Ugc2hvdWxkXHJcblx0XHRcdC8vIGZhbGxiYWNrIHRvIDIgbGV0dGVyIGNvZGUgZWcgXCJkZVwiXHJcblx0XHRcdHZhciBsYW5nID0gby5sYW5ndWFnZTtcclxuXHRcdFx0aWYgKCFkYXRlc1tsYW5nXSkge1xyXG5cdFx0XHRcdGxhbmcgPSBsYW5nLnNwbGl0KCctJylbMF07XHJcblx0XHRcdFx0aWYgKCFkYXRlc1tsYW5nXSlcclxuXHRcdFx0XHRcdGxhbmcgPSBkZWZhdWx0cy5sYW5ndWFnZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRvLmxhbmd1YWdlID0gbGFuZztcclxuXHJcblx0XHRcdHN3aXRjaChvLnN0YXJ0Vmlldyl7XHJcblx0XHRcdFx0Y2FzZSAyOlxyXG5cdFx0XHRcdGNhc2UgJ2RlY2FkZSc6XHJcblx0XHRcdFx0XHRvLnN0YXJ0VmlldyA9IDI7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRjYXNlIDE6XHJcblx0XHRcdFx0Y2FzZSAneWVhcic6XHJcblx0XHRcdFx0XHRvLnN0YXJ0VmlldyA9IDE7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRkZWZhdWx0OlxyXG5cdFx0XHRcdFx0by5zdGFydFZpZXcgPSAwO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRzd2l0Y2ggKG8ubWluVmlld01vZGUpIHtcclxuXHRcdFx0XHRjYXNlIDE6XHJcblx0XHRcdFx0Y2FzZSAnbW9udGhzJzpcclxuXHRcdFx0XHRcdG8ubWluVmlld01vZGUgPSAxO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0Y2FzZSAyOlxyXG5cdFx0XHRcdGNhc2UgJ3llYXJzJzpcclxuXHRcdFx0XHRcdG8ubWluVmlld01vZGUgPSAyO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0ZGVmYXVsdDpcclxuXHRcdFx0XHRcdG8ubWluVmlld01vZGUgPSAwO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRvLnN0YXJ0VmlldyA9IE1hdGgubWF4KG8uc3RhcnRWaWV3LCBvLm1pblZpZXdNb2RlKTtcclxuXHJcblx0XHRcdG8ud2Vla1N0YXJ0ICU9IDc7XHJcblx0XHRcdG8ud2Vla0VuZCA9ICgoby53ZWVrU3RhcnQgKyA2KSAlIDcpO1xyXG5cclxuXHRcdFx0dmFyIGZvcm1hdCA9IERQR2xvYmFsLnBhcnNlRm9ybWF0KG8uZm9ybWF0KVxyXG5cdFx0XHRpZiAoby5zdGFydERhdGUgIT09IC1JbmZpbml0eSkge1xyXG5cdFx0XHRcdG8uc3RhcnREYXRlID0gRFBHbG9iYWwucGFyc2VEYXRlKG8uc3RhcnREYXRlLCBmb3JtYXQsIG8ubGFuZ3VhZ2UpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChvLmVuZERhdGUgIT09IEluZmluaXR5KSB7XHJcblx0XHRcdFx0by5lbmREYXRlID0gRFBHbG9iYWwucGFyc2VEYXRlKG8uZW5kRGF0ZSwgZm9ybWF0LCBvLmxhbmd1YWdlKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0by5kYXlzT2ZXZWVrRGlzYWJsZWQgPSBvLmRheXNPZldlZWtEaXNhYmxlZHx8W107XHJcblx0XHRcdGlmICghJC5pc0FycmF5KG8uZGF5c09mV2Vla0Rpc2FibGVkKSlcclxuXHRcdFx0XHRvLmRheXNPZldlZWtEaXNhYmxlZCA9IG8uZGF5c09mV2Vla0Rpc2FibGVkLnNwbGl0KC9bLFxcc10qLyk7XHJcblx0XHRcdG8uZGF5c09mV2Vla0Rpc2FibGVkID0gJC5tYXAoby5kYXlzT2ZXZWVrRGlzYWJsZWQsIGZ1bmN0aW9uIChkKSB7XHJcblx0XHRcdFx0cmV0dXJuIHBhcnNlSW50KGQsIDEwKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9LFxyXG5cdFx0X2V2ZW50czogW10sXHJcblx0XHRfc2Vjb25kYXJ5RXZlbnRzOiBbXSxcclxuXHRcdF9hcHBseUV2ZW50czogZnVuY3Rpb24oZXZzKXtcclxuXHRcdFx0Zm9yICh2YXIgaT0wLCBlbCwgZXY7IGk8ZXZzLmxlbmd0aDsgaSsrKXtcclxuXHRcdFx0XHRlbCA9IGV2c1tpXVswXTtcclxuXHRcdFx0XHRldiA9IGV2c1tpXVsxXTtcclxuXHRcdFx0XHRlbC5vbihldik7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRfdW5hcHBseUV2ZW50czogZnVuY3Rpb24oZXZzKXtcclxuXHRcdFx0Zm9yICh2YXIgaT0wLCBlbCwgZXY7IGk8ZXZzLmxlbmd0aDsgaSsrKXtcclxuXHRcdFx0XHRlbCA9IGV2c1tpXVswXTtcclxuXHRcdFx0XHRldiA9IGV2c1tpXVsxXTtcclxuXHRcdFx0XHRlbC5vZmYoZXYpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0X2J1aWxkRXZlbnRzOiBmdW5jdGlvbigpe1xyXG5cdFx0XHRpZiAodGhpcy5pc0lucHV0KSB7IC8vIHNpbmdsZSBpbnB1dFxyXG5cdFx0XHRcdHRoaXMuX2V2ZW50cyA9IFtcclxuXHRcdFx0XHRcdFt0aGlzLmVsZW1lbnQsIHtcclxuXHRcdFx0XHRcdFx0Zm9jdXM6ICQucHJveHkodGhpcy5zaG93LCB0aGlzKSxcclxuXHRcdFx0XHRcdFx0a2V5dXA6ICQucHJveHkodGhpcy51cGRhdGUsIHRoaXMpLFxyXG5cdFx0XHRcdFx0XHRrZXlkb3duOiAkLnByb3h5KHRoaXMua2V5ZG93biwgdGhpcylcclxuXHRcdFx0XHRcdH1dXHJcblx0XHRcdFx0XTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0aGlzLmNvbXBvbmVudCAmJiB0aGlzLmhhc0lucHV0KXsgLy8gY29tcG9uZW50OiBpbnB1dCArIGJ1dHRvblxyXG5cdFx0XHRcdHRoaXMuX2V2ZW50cyA9IFtcclxuXHRcdFx0XHRcdC8vIEZvciBjb21wb25lbnRzIHRoYXQgYXJlIG5vdCByZWFkb25seSwgYWxsb3cga2V5Ym9hcmQgbmF2XHJcblx0XHRcdFx0XHRbdGhpcy5lbGVtZW50LmZpbmQoJ2lucHV0JyksIHtcclxuXHRcdFx0XHRcdFx0Zm9jdXM6ICQucHJveHkodGhpcy5zaG93LCB0aGlzKSxcclxuXHRcdFx0XHRcdFx0a2V5dXA6ICQucHJveHkodGhpcy51cGRhdGUsIHRoaXMpLFxyXG5cdFx0XHRcdFx0XHRrZXlkb3duOiAkLnByb3h5KHRoaXMua2V5ZG93biwgdGhpcylcclxuXHRcdFx0XHRcdH1dLFxyXG5cdFx0XHRcdFx0W3RoaXMuY29tcG9uZW50LCB7XHJcblx0XHRcdFx0XHRcdGNsaWNrOiAkLnByb3h5KHRoaXMuc2hvdywgdGhpcylcclxuXHRcdFx0XHRcdH1dXHJcblx0XHRcdFx0XTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0aGlzLmVsZW1lbnQuaXMoJ2RpdicpKSB7ICAvLyBpbmxpbmUgZGF0ZXBpY2tlclxyXG5cdFx0XHRcdHRoaXMuaXNJbmxpbmUgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuX2V2ZW50cyA9IFtcclxuXHRcdFx0XHRcdFt0aGlzLmVsZW1lbnQsIHtcclxuXHRcdFx0XHRcdFx0Y2xpY2s6ICQucHJveHkodGhpcy5zaG93LCB0aGlzKVxyXG5cdFx0XHRcdFx0fV1cclxuXHRcdFx0XHRdO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLl9zZWNvbmRhcnlFdmVudHMgPSBbXHJcblx0XHRcdFx0W3RoaXMucGlja2VyLCB7XHJcblx0XHRcdFx0XHRjbGljazogJC5wcm94eSh0aGlzLmNsaWNrLCB0aGlzKVxyXG5cdFx0XHRcdH1dLFxyXG5cdFx0XHRcdFskKHdpbmRvdyksIHtcclxuXHRcdFx0XHRcdHJlc2l6ZTogJC5wcm94eSh0aGlzLnBsYWNlLCB0aGlzKVxyXG5cdFx0XHRcdH1dLFxyXG5cdFx0XHRcdFskKGRvY3VtZW50KSwge1xyXG5cdFx0XHRcdFx0bW91c2Vkb3duOiAkLnByb3h5KGZ1bmN0aW9uIChlKSB7XHJcblx0XHRcdFx0XHRcdC8vIENsaWNrZWQgb3V0c2lkZSB0aGUgZGF0ZXBpY2tlciwgaGlkZSBpdFxyXG5cdFx0XHRcdFx0XHRpZiAoIShcclxuXHRcdFx0XHRcdFx0XHR0aGlzLmVsZW1lbnQuaXMoZS50YXJnZXQpIHx8XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5lbGVtZW50LmZpbmQoZS50YXJnZXQpLnNpemUoKSB8fFxyXG5cdFx0XHRcdFx0XHRcdHRoaXMucGlja2VyLmlzKGUudGFyZ2V0KSB8fFxyXG5cdFx0XHRcdFx0XHRcdHRoaXMucGlja2VyLmZpbmQoZS50YXJnZXQpLnNpemUoKVxyXG5cdFx0XHRcdFx0XHQpKSB7XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5oaWRlKCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH0sIHRoaXMpXHJcblx0XHRcdFx0fV1cclxuXHRcdFx0XTtcclxuXHRcdH0sXHJcblx0XHRfYXR0YWNoRXZlbnRzOiBmdW5jdGlvbigpe1xyXG5cdFx0XHR0aGlzLl9kZXRhY2hFdmVudHMoKTtcclxuXHRcdFx0dGhpcy5fYXBwbHlFdmVudHModGhpcy5fZXZlbnRzKTtcclxuXHRcdH0sXHJcblx0XHRfZGV0YWNoRXZlbnRzOiBmdW5jdGlvbigpe1xyXG5cdFx0XHR0aGlzLl91bmFwcGx5RXZlbnRzKHRoaXMuX2V2ZW50cyk7XHJcblx0XHR9LFxyXG5cdFx0X2F0dGFjaFNlY29uZGFyeUV2ZW50czogZnVuY3Rpb24oKXtcclxuXHRcdFx0dGhpcy5fZGV0YWNoU2Vjb25kYXJ5RXZlbnRzKCk7XHJcblx0XHRcdHRoaXMuX2FwcGx5RXZlbnRzKHRoaXMuX3NlY29uZGFyeUV2ZW50cyk7XHJcblx0XHR9LFxyXG5cdFx0X2RldGFjaFNlY29uZGFyeUV2ZW50czogZnVuY3Rpb24oKXtcclxuXHRcdFx0dGhpcy5fdW5hcHBseUV2ZW50cyh0aGlzLl9zZWNvbmRhcnlFdmVudHMpO1xyXG5cdFx0fSxcclxuXHRcdF90cmlnZ2VyOiBmdW5jdGlvbihldmVudCwgYWx0ZGF0ZSl7XHJcblx0XHRcdHZhciBkYXRlID0gYWx0ZGF0ZSB8fCB0aGlzLmRhdGUsXHJcblx0XHRcdFx0bG9jYWxfZGF0ZSA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpICsgKGRhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSo2MDAwMCkpO1xyXG5cclxuXHRcdFx0dGhpcy5lbGVtZW50LnRyaWdnZXIoe1xyXG5cdFx0XHRcdHR5cGU6IGV2ZW50LFxyXG5cdFx0XHRcdGRhdGU6IGxvY2FsX2RhdGUsXHJcblx0XHRcdFx0Zm9ybWF0OiAkLnByb3h5KGZ1bmN0aW9uKGFsdGZvcm1hdCl7XHJcblx0XHRcdFx0XHR2YXIgZm9ybWF0ID0gYWx0Zm9ybWF0IHx8IHRoaXMuby5mb3JtYXQ7XHJcblx0XHRcdFx0XHRyZXR1cm4gRFBHbG9iYWwuZm9ybWF0RGF0ZShkYXRlLCBmb3JtYXQsIHRoaXMuby5sYW5ndWFnZSk7XHJcblx0XHRcdFx0fSwgdGhpcylcclxuXHRcdFx0fSk7XHJcblx0XHR9LFxyXG5cclxuXHRcdHNob3c6IGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0aWYgKCF0aGlzLmlzSW5saW5lKVxyXG5cdFx0XHRcdHRoaXMucGlja2VyLmFwcGVuZFRvKCdib2R5Jyk7XHJcblx0XHRcdHRoaXMucGlja2VyLnNob3coKTtcclxuXHRcdFx0dGhpcy5oZWlnaHQgPSB0aGlzLmNvbXBvbmVudCA/IHRoaXMuY29tcG9uZW50Lm91dGVySGVpZ2h0KCkgOiB0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKTtcclxuXHRcdFx0dGhpcy5wbGFjZSgpO1xyXG5cdFx0XHR0aGlzLl9hdHRhY2hTZWNvbmRhcnlFdmVudHMoKTtcclxuXHRcdFx0aWYgKGUpIHtcclxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fdHJpZ2dlcignc2hvdycpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRoaWRlOiBmdW5jdGlvbihlKXtcclxuXHRcdFx0aWYodGhpcy5pc0lubGluZSkgcmV0dXJuO1xyXG5cdFx0XHRpZiAoIXRoaXMucGlja2VyLmlzKCc6dmlzaWJsZScpKSByZXR1cm47XHJcblx0XHRcdHRoaXMucGlja2VyLmhpZGUoKS5kZXRhY2goKTtcclxuXHRcdFx0dGhpcy5fZGV0YWNoU2Vjb25kYXJ5RXZlbnRzKCk7XHJcblx0XHRcdHRoaXMudmlld01vZGUgPSB0aGlzLm8uc3RhcnRWaWV3O1xyXG5cdFx0XHR0aGlzLnNob3dNb2RlKCk7XHJcblxyXG5cdFx0XHRpZiAoXHJcblx0XHRcdFx0dGhpcy5vLmZvcmNlUGFyc2UgJiZcclxuXHRcdFx0XHQoXHJcblx0XHRcdFx0XHR0aGlzLmlzSW5wdXQgJiYgdGhpcy5lbGVtZW50LnZhbCgpIHx8XHJcblx0XHRcdFx0XHR0aGlzLmhhc0lucHV0ICYmIHRoaXMuZWxlbWVudC5maW5kKCdpbnB1dCcpLnZhbCgpXHJcblx0XHRcdFx0KVxyXG5cdFx0XHQpXHJcblx0XHRcdFx0dGhpcy5zZXRWYWx1ZSgpO1xyXG5cdFx0XHR0aGlzLl90cmlnZ2VyKCdoaWRlJyk7XHJcblx0XHR9LFxyXG5cclxuXHRcdHJlbW92ZTogZnVuY3Rpb24oKSB7XHJcblx0XHRcdHRoaXMuaGlkZSgpO1xyXG5cdFx0XHR0aGlzLl9kZXRhY2hFdmVudHMoKTtcclxuXHRcdFx0dGhpcy5fZGV0YWNoU2Vjb25kYXJ5RXZlbnRzKCk7XHJcblx0XHRcdHRoaXMucGlja2VyLnJlbW92ZSgpO1xyXG5cdFx0XHRkZWxldGUgdGhpcy5lbGVtZW50LmRhdGEoKS5kYXRlcGlja2VyO1xyXG5cdFx0XHRpZiAoIXRoaXMuaXNJbnB1dCkge1xyXG5cdFx0XHRcdGRlbGV0ZSB0aGlzLmVsZW1lbnQuZGF0YSgpLmRhdGU7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0RGF0ZTogZnVuY3Rpb24oKSB7XHJcblx0XHRcdHZhciBkID0gdGhpcy5nZXRVVENEYXRlKCk7XHJcblx0XHRcdHJldHVybiBuZXcgRGF0ZShkLmdldFRpbWUoKSArIChkLmdldFRpbWV6b25lT2Zmc2V0KCkqNjAwMDApKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0VVRDRGF0ZTogZnVuY3Rpb24oKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmRhdGU7XHJcblx0XHR9LFxyXG5cclxuXHRcdHNldERhdGU6IGZ1bmN0aW9uKGQpIHtcclxuXHRcdFx0dGhpcy5zZXRVVENEYXRlKG5ldyBEYXRlKGQuZ2V0VGltZSgpIC0gKGQuZ2V0VGltZXpvbmVPZmZzZXQoKSo2MDAwMCkpKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0c2V0VVRDRGF0ZTogZnVuY3Rpb24oZCkge1xyXG5cdFx0XHR0aGlzLmRhdGUgPSBkO1xyXG5cdFx0XHR0aGlzLnNldFZhbHVlKCk7XHJcblx0XHR9LFxyXG5cclxuXHRcdHNldFZhbHVlOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0dmFyIGZvcm1hdHRlZCA9IHRoaXMuZ2V0Rm9ybWF0dGVkRGF0ZSgpO1xyXG5cdFx0XHRpZiAoIXRoaXMuaXNJbnB1dCkge1xyXG5cdFx0XHRcdGlmICh0aGlzLmNvbXBvbmVudCl7XHJcblx0XHRcdFx0XHR0aGlzLmVsZW1lbnQuZmluZCgnaW5wdXQnKS52YWwoZm9ybWF0dGVkKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5lbGVtZW50LnZhbChmb3JtYXR0ZWQpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldEZvcm1hdHRlZERhdGU6IGZ1bmN0aW9uKGZvcm1hdCkge1xyXG5cdFx0XHRpZiAoZm9ybWF0ID09PSB1bmRlZmluZWQpXHJcblx0XHRcdFx0Zm9ybWF0ID0gdGhpcy5vLmZvcm1hdDtcclxuXHRcdFx0cmV0dXJuIERQR2xvYmFsLmZvcm1hdERhdGUodGhpcy5kYXRlLCBmb3JtYXQsIHRoaXMuby5sYW5ndWFnZSk7XHJcblx0XHR9LFxyXG5cclxuXHRcdHNldFN0YXJ0RGF0ZTogZnVuY3Rpb24oc3RhcnREYXRlKXtcclxuXHRcdFx0dGhpcy5fcHJvY2Vzc19vcHRpb25zKHtzdGFydERhdGU6IHN0YXJ0RGF0ZX0pO1xyXG5cdFx0XHR0aGlzLnVwZGF0ZSgpO1xyXG5cdFx0XHR0aGlzLnVwZGF0ZU5hdkFycm93cygpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRzZXRFbmREYXRlOiBmdW5jdGlvbihlbmREYXRlKXtcclxuXHRcdFx0dGhpcy5fcHJvY2Vzc19vcHRpb25zKHtlbmREYXRlOiBlbmREYXRlfSk7XHJcblx0XHRcdHRoaXMudXBkYXRlKCk7XHJcblx0XHRcdHRoaXMudXBkYXRlTmF2QXJyb3dzKCk7XHJcblx0XHR9LFxyXG5cclxuXHRcdHNldERheXNPZldlZWtEaXNhYmxlZDogZnVuY3Rpb24oZGF5c09mV2Vla0Rpc2FibGVkKXtcclxuXHRcdFx0dGhpcy5fcHJvY2Vzc19vcHRpb25zKHtkYXlzT2ZXZWVrRGlzYWJsZWQ6IGRheXNPZldlZWtEaXNhYmxlZH0pO1xyXG5cdFx0XHR0aGlzLnVwZGF0ZSgpO1xyXG5cdFx0XHR0aGlzLnVwZGF0ZU5hdkFycm93cygpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRwbGFjZTogZnVuY3Rpb24oKXtcclxuXHRcdFx0XHRcdFx0aWYodGhpcy5pc0lubGluZSkgcmV0dXJuO1xyXG5cdFx0XHR2YXIgekluZGV4ID0gcGFyc2VJbnQodGhpcy5lbGVtZW50LnBhcmVudHMoKS5maWx0ZXIoZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuICQodGhpcykuY3NzKCd6LWluZGV4JykgIT0gJ2F1dG8nO1xyXG5cdFx0XHRcdFx0XHR9KS5maXJzdCgpLmNzcygnei1pbmRleCcpKSsxMDtcclxuXHRcdFx0dmFyIG9mZnNldCA9IHRoaXMuY29tcG9uZW50ID8gdGhpcy5jb21wb25lbnQucGFyZW50KCkub2Zmc2V0KCkgOiB0aGlzLmVsZW1lbnQub2Zmc2V0KCk7XHJcblx0XHRcdHZhciBoZWlnaHQgPSB0aGlzLmNvbXBvbmVudCA/IHRoaXMuY29tcG9uZW50Lm91dGVySGVpZ2h0KHRydWUpIDogdGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KHRydWUpO1xyXG5cdFx0XHR0aGlzLnBpY2tlci5jc3Moe1xyXG5cdFx0XHRcdHRvcDogb2Zmc2V0LnRvcCArIGhlaWdodCxcclxuXHRcdFx0XHRsZWZ0OiBvZmZzZXQubGVmdCxcclxuXHRcdFx0XHR6SW5kZXg6IHpJbmRleFxyXG5cdFx0XHR9KTtcclxuXHRcdH0sXHJcblxyXG5cdFx0X2FsbG93X3VwZGF0ZTogdHJ1ZSxcclxuXHRcdHVwZGF0ZTogZnVuY3Rpb24oKXtcclxuXHRcdFx0aWYgKCF0aGlzLl9hbGxvd191cGRhdGUpIHJldHVybjtcclxuXHJcblx0XHRcdHZhciBkYXRlLCBmcm9tQXJncyA9IGZhbHNlO1xyXG5cdFx0XHRpZihhcmd1bWVudHMgJiYgYXJndW1lbnRzLmxlbmd0aCAmJiAodHlwZW9mIGFyZ3VtZW50c1swXSA9PT0gJ3N0cmluZycgfHwgYXJndW1lbnRzWzBdIGluc3RhbmNlb2YgRGF0ZSkpIHtcclxuXHRcdFx0XHRkYXRlID0gYXJndW1lbnRzWzBdO1xyXG5cdFx0XHRcdGZyb21BcmdzID0gdHJ1ZTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRkYXRlID0gdGhpcy5pc0lucHV0ID8gdGhpcy5lbGVtZW50LnZhbCgpIDogdGhpcy5lbGVtZW50LmRhdGEoJ2RhdGUnKSB8fCB0aGlzLmVsZW1lbnQuZmluZCgnaW5wdXQnKS52YWwoKTtcclxuXHRcdFx0XHRkZWxldGUgdGhpcy5lbGVtZW50LmRhdGEoKS5kYXRlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLmRhdGUgPSBEUEdsb2JhbC5wYXJzZURhdGUoZGF0ZSwgdGhpcy5vLmZvcm1hdCwgdGhpcy5vLmxhbmd1YWdlKTtcclxuXHJcblx0XHRcdGlmKGZyb21BcmdzKSB0aGlzLnNldFZhbHVlKCk7XHJcblxyXG5cdFx0XHRpZiAodGhpcy5kYXRlIDwgdGhpcy5vLnN0YXJ0RGF0ZSkge1xyXG5cdFx0XHRcdHRoaXMudmlld0RhdGUgPSBuZXcgRGF0ZSh0aGlzLm8uc3RhcnREYXRlKTtcclxuXHRcdFx0fSBlbHNlIGlmICh0aGlzLmRhdGUgPiB0aGlzLm8uZW5kRGF0ZSkge1xyXG5cdFx0XHRcdHRoaXMudmlld0RhdGUgPSBuZXcgRGF0ZSh0aGlzLm8uZW5kRGF0ZSk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dGhpcy52aWV3RGF0ZSA9IG5ldyBEYXRlKHRoaXMuZGF0ZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5maWxsKCk7XHJcblx0XHR9LFxyXG5cclxuXHRcdGZpbGxEb3c6IGZ1bmN0aW9uKCl7XHJcblx0XHRcdHZhciBkb3dDbnQgPSB0aGlzLm8ud2Vla1N0YXJ0LFxyXG5cdFx0XHRodG1sID0gJzx0cj4nO1xyXG5cdFx0XHRpZih0aGlzLm8uY2FsZW5kYXJXZWVrcyl7XHJcblx0XHRcdFx0dmFyIGNlbGwgPSAnPHRoIGNsYXNzPVwiY3dcIj4mbmJzcDs8L3RoPic7XHJcblx0XHRcdFx0aHRtbCArPSBjZWxsO1xyXG5cdFx0XHRcdHRoaXMucGlja2VyLmZpbmQoJy5kYXRlcGlja2VyLWRheXMgdGhlYWQgdHI6Zmlyc3QtY2hpbGQnKS5wcmVwZW5kKGNlbGwpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHdoaWxlIChkb3dDbnQgPCB0aGlzLm8ud2Vla1N0YXJ0ICsgNykge1xyXG5cdFx0XHRcdGh0bWwgKz0gJzx0aCBjbGFzcz1cImRvd1wiPicrZGF0ZXNbdGhpcy5vLmxhbmd1YWdlXS5kYXlzTWluWyhkb3dDbnQrKyklN10rJzwvdGg+JztcclxuXHRcdFx0fVxyXG5cdFx0XHRodG1sICs9ICc8L3RyPic7XHJcblx0XHRcdHRoaXMucGlja2VyLmZpbmQoJy5kYXRlcGlja2VyLWRheXMgdGhlYWQnKS5hcHBlbmQoaHRtbCk7XHJcblx0XHR9LFxyXG5cclxuXHRcdGZpbGxNb250aHM6IGZ1bmN0aW9uKCl7XHJcblx0XHRcdHZhciBodG1sID0gJycsXHJcblx0XHRcdGkgPSAwO1xyXG5cdFx0XHR3aGlsZSAoaSA8IDEyKSB7XHJcblx0XHRcdFx0aHRtbCArPSAnPHNwYW4gY2xhc3M9XCJtb250aFwiPicrZGF0ZXNbdGhpcy5vLmxhbmd1YWdlXS5tb250aHNTaG9ydFtpKytdKyc8L3NwYW4+JztcclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLnBpY2tlci5maW5kKCcuZGF0ZXBpY2tlci1tb250aHMgdGQnKS5odG1sKGh0bWwpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRzZXRSYW5nZTogZnVuY3Rpb24ocmFuZ2Upe1xyXG5cdFx0XHRpZiAoIXJhbmdlIHx8ICFyYW5nZS5sZW5ndGgpXHJcblx0XHRcdFx0ZGVsZXRlIHRoaXMucmFuZ2U7XHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHR0aGlzLnJhbmdlID0gJC5tYXAocmFuZ2UsIGZ1bmN0aW9uKGQpeyByZXR1cm4gZC52YWx1ZU9mKCk7IH0pO1xyXG5cdFx0XHR0aGlzLmZpbGwoKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0Q2xhc3NOYW1lczogZnVuY3Rpb24oZGF0ZSl7XHJcblx0XHRcdHZhciBjbHMgPSBbXSxcclxuXHRcdFx0XHR5ZWFyID0gdGhpcy52aWV3RGF0ZS5nZXRVVENGdWxsWWVhcigpLFxyXG5cdFx0XHRcdG1vbnRoID0gdGhpcy52aWV3RGF0ZS5nZXRVVENNb250aCgpLFxyXG5cdFx0XHRcdGN1cnJlbnREYXRlID0gdGhpcy5kYXRlLnZhbHVlT2YoKSxcclxuXHRcdFx0XHR0b2RheSA9IG5ldyBEYXRlKCk7XHJcblx0XHRcdGlmIChkYXRlLmdldFVUQ0Z1bGxZZWFyKCkgPCB5ZWFyIHx8IChkYXRlLmdldFVUQ0Z1bGxZZWFyKCkgPT0geWVhciAmJiBkYXRlLmdldFVUQ01vbnRoKCkgPCBtb250aCkpIHtcclxuXHRcdFx0XHRjbHMucHVzaCgnb2xkJyk7XHJcblx0XHRcdH0gZWxzZSBpZiAoZGF0ZS5nZXRVVENGdWxsWWVhcigpID4geWVhciB8fCAoZGF0ZS5nZXRVVENGdWxsWWVhcigpID09IHllYXIgJiYgZGF0ZS5nZXRVVENNb250aCgpID4gbW9udGgpKSB7XHJcblx0XHRcdFx0Y2xzLnB1c2goJ25ldycpO1xyXG5cdFx0XHR9XHJcblx0XHRcdC8vIENvbXBhcmUgaW50ZXJuYWwgVVRDIGRhdGUgd2l0aCBsb2NhbCB0b2RheSwgbm90IFVUQyB0b2RheVxyXG5cdFx0XHRpZiAodGhpcy5vLnRvZGF5SGlnaGxpZ2h0ICYmXHJcblx0XHRcdFx0ZGF0ZS5nZXRVVENGdWxsWWVhcigpID09IHRvZGF5LmdldEZ1bGxZZWFyKCkgJiZcclxuXHRcdFx0XHRkYXRlLmdldFVUQ01vbnRoKCkgPT0gdG9kYXkuZ2V0TW9udGgoKSAmJlxyXG5cdFx0XHRcdGRhdGUuZ2V0VVRDRGF0ZSgpID09IHRvZGF5LmdldERhdGUoKSkge1xyXG5cdFx0XHRcdGNscy5wdXNoKCd0b2RheScpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChjdXJyZW50RGF0ZSAmJiBkYXRlLnZhbHVlT2YoKSA9PSBjdXJyZW50RGF0ZSkge1xyXG5cdFx0XHRcdGNscy5wdXNoKCdhY3RpdmUnKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoZGF0ZS52YWx1ZU9mKCkgPCB0aGlzLm8uc3RhcnREYXRlIHx8IGRhdGUudmFsdWVPZigpID4gdGhpcy5vLmVuZERhdGUgfHxcclxuXHRcdFx0XHQkLmluQXJyYXkoZGF0ZS5nZXRVVENEYXkoKSwgdGhpcy5vLmRheXNPZldlZWtEaXNhYmxlZCkgIT09IC0xKSB7XHJcblx0XHRcdFx0Y2xzLnB1c2goJ2Rpc2FibGVkJyk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHRoaXMucmFuZ2Upe1xyXG5cdFx0XHRcdGlmIChkYXRlID4gdGhpcy5yYW5nZVswXSAmJiBkYXRlIDwgdGhpcy5yYW5nZVt0aGlzLnJhbmdlLmxlbmd0aC0xXSl7XHJcblx0XHRcdFx0XHRjbHMucHVzaCgncmFuZ2UnKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKCQuaW5BcnJheShkYXRlLnZhbHVlT2YoKSwgdGhpcy5yYW5nZSkgIT0gLTEpe1xyXG5cdFx0XHRcdFx0Y2xzLnB1c2goJ3NlbGVjdGVkJyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBjbHM7XHJcblx0XHR9LFxyXG5cclxuXHRcdGZpbGw6IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR2YXIgZCA9IG5ldyBEYXRlKHRoaXMudmlld0RhdGUpLFxyXG5cdFx0XHRcdHllYXIgPSBkLmdldFVUQ0Z1bGxZZWFyKCksXHJcblx0XHRcdFx0bW9udGggPSBkLmdldFVUQ01vbnRoKCksXHJcblx0XHRcdFx0c3RhcnRZZWFyID0gdGhpcy5vLnN0YXJ0RGF0ZSAhPT0gLUluZmluaXR5ID8gdGhpcy5vLnN0YXJ0RGF0ZS5nZXRVVENGdWxsWWVhcigpIDogLUluZmluaXR5LFxyXG5cdFx0XHRcdHN0YXJ0TW9udGggPSB0aGlzLm8uc3RhcnREYXRlICE9PSAtSW5maW5pdHkgPyB0aGlzLm8uc3RhcnREYXRlLmdldFVUQ01vbnRoKCkgOiAtSW5maW5pdHksXHJcblx0XHRcdFx0ZW5kWWVhciA9IHRoaXMuby5lbmREYXRlICE9PSBJbmZpbml0eSA/IHRoaXMuby5lbmREYXRlLmdldFVUQ0Z1bGxZZWFyKCkgOiBJbmZpbml0eSxcclxuXHRcdFx0XHRlbmRNb250aCA9IHRoaXMuby5lbmREYXRlICE9PSBJbmZpbml0eSA/IHRoaXMuby5lbmREYXRlLmdldFVUQ01vbnRoKCkgOiBJbmZpbml0eSxcclxuXHRcdFx0XHRjdXJyZW50RGF0ZSA9IHRoaXMuZGF0ZSAmJiB0aGlzLmRhdGUudmFsdWVPZigpLFxyXG5cdFx0XHRcdHRvb2x0aXA7XHJcblx0XHRcdHRoaXMucGlja2VyLmZpbmQoJy5kYXRlcGlja2VyLWRheXMgdGhlYWQgdGguZGF0ZXBpY2tlci1zd2l0Y2gnKVxyXG5cdFx0XHRcdFx0XHQudGV4dChkYXRlc1t0aGlzLm8ubGFuZ3VhZ2VdLm1vbnRoc1ttb250aF0rJyAnK3llYXIpO1xyXG5cdFx0XHR0aGlzLnBpY2tlci5maW5kKCd0Zm9vdCB0aC50b2RheScpXHJcblx0XHRcdFx0XHRcdC50ZXh0KGRhdGVzW3RoaXMuby5sYW5ndWFnZV0udG9kYXkpXHJcblx0XHRcdFx0XHRcdC50b2dnbGUodGhpcy5vLnRvZGF5QnRuICE9PSBmYWxzZSk7XHJcblx0XHRcdHRoaXMucGlja2VyLmZpbmQoJ3Rmb290IHRoLmNsZWFyJylcclxuXHRcdFx0XHRcdFx0LnRleHQoZGF0ZXNbdGhpcy5vLmxhbmd1YWdlXS5jbGVhcilcclxuXHRcdFx0XHRcdFx0LnRvZ2dsZSh0aGlzLm8uY2xlYXJCdG4gIT09IGZhbHNlKTtcclxuXHRcdFx0dGhpcy51cGRhdGVOYXZBcnJvd3MoKTtcclxuXHRcdFx0dGhpcy5maWxsTW9udGhzKCk7XHJcblx0XHRcdHZhciBwcmV2TW9udGggPSBVVENEYXRlKHllYXIsIG1vbnRoLTEsIDI4LDAsMCwwLDApLFxyXG5cdFx0XHRcdGRheSA9IERQR2xvYmFsLmdldERheXNJbk1vbnRoKHByZXZNb250aC5nZXRVVENGdWxsWWVhcigpLCBwcmV2TW9udGguZ2V0VVRDTW9udGgoKSk7XHJcblx0XHRcdHByZXZNb250aC5zZXRVVENEYXRlKGRheSk7XHJcblx0XHRcdHByZXZNb250aC5zZXRVVENEYXRlKGRheSAtIChwcmV2TW9udGguZ2V0VVRDRGF5KCkgLSB0aGlzLm8ud2Vla1N0YXJ0ICsgNyklNyk7XHJcblx0XHRcdHZhciBuZXh0TW9udGggPSBuZXcgRGF0ZShwcmV2TW9udGgpO1xyXG5cdFx0XHRuZXh0TW9udGguc2V0VVRDRGF0ZShuZXh0TW9udGguZ2V0VVRDRGF0ZSgpICsgNDIpO1xyXG5cdFx0XHRuZXh0TW9udGggPSBuZXh0TW9udGgudmFsdWVPZigpO1xyXG5cdFx0XHR2YXIgaHRtbCA9IFtdO1xyXG5cdFx0XHR2YXIgY2xzTmFtZTtcclxuXHRcdFx0d2hpbGUocHJldk1vbnRoLnZhbHVlT2YoKSA8IG5leHRNb250aCkge1xyXG5cdFx0XHRcdGlmIChwcmV2TW9udGguZ2V0VVRDRGF5KCkgPT0gdGhpcy5vLndlZWtTdGFydCkge1xyXG5cdFx0XHRcdFx0aHRtbC5wdXNoKCc8dHI+Jyk7XHJcblx0XHRcdFx0XHRpZih0aGlzLm8uY2FsZW5kYXJXZWVrcyl7XHJcblx0XHRcdFx0XHRcdC8vIElTTyA4NjAxOiBGaXJzdCB3ZWVrIGNvbnRhaW5zIGZpcnN0IHRodXJzZGF5LlxyXG5cdFx0XHRcdFx0XHQvLyBJU08gYWxzbyBzdGF0ZXMgd2VlayBzdGFydHMgb24gTW9uZGF5LCBidXQgd2UgY2FuIGJlIG1vcmUgYWJzdHJhY3QgaGVyZS5cclxuXHRcdFx0XHRcdFx0dmFyXHJcblx0XHRcdFx0XHRcdFx0Ly8gU3RhcnQgb2YgY3VycmVudCB3ZWVrOiBiYXNlZCBvbiB3ZWVrc3RhcnQvY3VycmVudCBkYXRlXHJcblx0XHRcdFx0XHRcdFx0d3MgPSBuZXcgRGF0ZSgrcHJldk1vbnRoICsgKHRoaXMuby53ZWVrU3RhcnQgLSBwcmV2TW9udGguZ2V0VVRDRGF5KCkgLSA3KSAlIDcgKiA4NjRlNSksXHJcblx0XHRcdFx0XHRcdFx0Ly8gVGh1cnNkYXkgb2YgdGhpcyB3ZWVrXHJcblx0XHRcdFx0XHRcdFx0dGggPSBuZXcgRGF0ZSgrd3MgKyAoNyArIDQgLSB3cy5nZXRVVENEYXkoKSkgJSA3ICogODY0ZTUpLFxyXG5cdFx0XHRcdFx0XHRcdC8vIEZpcnN0IFRodXJzZGF5IG9mIHllYXIsIHllYXIgZnJvbSB0aHVyc2RheVxyXG5cdFx0XHRcdFx0XHRcdHl0aCA9IG5ldyBEYXRlKCsoeXRoID0gVVRDRGF0ZSh0aC5nZXRVVENGdWxsWWVhcigpLCAwLCAxKSkgKyAoNyArIDQgLSB5dGguZ2V0VVRDRGF5KCkpJTcqODY0ZTUpLFxyXG5cdFx0XHRcdFx0XHRcdC8vIENhbGVuZGFyIHdlZWs6IG1zIGJldHdlZW4gdGh1cnNkYXlzLCBkaXYgbXMgcGVyIGRheSwgZGl2IDcgZGF5c1xyXG5cdFx0XHRcdFx0XHRcdGNhbFdlZWsgPSAgKHRoIC0geXRoKSAvIDg2NGU1IC8gNyArIDE7XHJcblx0XHRcdFx0XHRcdGh0bWwucHVzaCgnPHRkIGNsYXNzPVwiY3dcIj4nKyBjYWxXZWVrICsnPC90ZD4nKTtcclxuXHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGNsc05hbWUgPSB0aGlzLmdldENsYXNzTmFtZXMocHJldk1vbnRoKTtcclxuXHRcdFx0XHRjbHNOYW1lLnB1c2goJ2RheScpO1xyXG5cclxuXHRcdFx0XHR2YXIgYmVmb3JlID0gdGhpcy5vLmJlZm9yZVNob3dEYXkocHJldk1vbnRoKTtcclxuXHRcdFx0XHRpZiAoYmVmb3JlID09PSB1bmRlZmluZWQpXHJcblx0XHRcdFx0XHRiZWZvcmUgPSB7fTtcclxuXHRcdFx0XHRlbHNlIGlmICh0eXBlb2YoYmVmb3JlKSA9PT0gJ2Jvb2xlYW4nKVxyXG5cdFx0XHRcdFx0YmVmb3JlID0ge2VuYWJsZWQ6IGJlZm9yZX07XHJcblx0XHRcdFx0ZWxzZSBpZiAodHlwZW9mKGJlZm9yZSkgPT09ICdzdHJpbmcnKVxyXG5cdFx0XHRcdFx0YmVmb3JlID0ge2NsYXNzZXM6IGJlZm9yZX07XHJcblx0XHRcdFx0aWYgKGJlZm9yZS5lbmFibGVkID09PSBmYWxzZSlcclxuXHRcdFx0XHRcdGNsc05hbWUucHVzaCgnZGlzYWJsZWQnKTtcclxuXHRcdFx0XHRpZiAoYmVmb3JlLmNsYXNzZXMpXHJcblx0XHRcdFx0XHRjbHNOYW1lID0gY2xzTmFtZS5jb25jYXQoYmVmb3JlLmNsYXNzZXMuc3BsaXQoL1xccysvKSk7XHJcblx0XHRcdFx0aWYgKGJlZm9yZS50b29sdGlwKVxyXG5cdFx0XHRcdFx0dG9vbHRpcCA9IGJlZm9yZS50b29sdGlwO1xyXG5cclxuXHRcdFx0XHRjbHNOYW1lID0gJC51bmlxdWUoY2xzTmFtZSk7XHJcblx0XHRcdFx0aHRtbC5wdXNoKCc8dGQgY2xhc3M9XCInK2Nsc05hbWUuam9pbignICcpKydcIicgKyAodG9vbHRpcCA/ICcgdGl0bGU9XCInK3Rvb2x0aXArJ1wiJyA6ICcnKSArICc+JytwcmV2TW9udGguZ2V0VVRDRGF0ZSgpICsgJzwvdGQ+Jyk7XHJcblx0XHRcdFx0aWYgKHByZXZNb250aC5nZXRVVENEYXkoKSA9PSB0aGlzLm8ud2Vla0VuZCkge1xyXG5cdFx0XHRcdFx0aHRtbC5wdXNoKCc8L3RyPicpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRwcmV2TW9udGguc2V0VVRDRGF0ZShwcmV2TW9udGguZ2V0VVRDRGF0ZSgpKzEpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMucGlja2VyLmZpbmQoJy5kYXRlcGlja2VyLWRheXMgdGJvZHknKS5lbXB0eSgpLmFwcGVuZChodG1sLmpvaW4oJycpKTtcclxuXHRcdFx0dmFyIGN1cnJlbnRZZWFyID0gdGhpcy5kYXRlICYmIHRoaXMuZGF0ZS5nZXRVVENGdWxsWWVhcigpO1xyXG5cclxuXHRcdFx0dmFyIG1vbnRocyA9IHRoaXMucGlja2VyLmZpbmQoJy5kYXRlcGlja2VyLW1vbnRocycpXHJcblx0XHRcdFx0XHRcdC5maW5kKCd0aDplcSgxKScpXHJcblx0XHRcdFx0XHRcdFx0LnRleHQoeWVhcilcclxuXHRcdFx0XHRcdFx0XHQuZW5kKClcclxuXHRcdFx0XHRcdFx0LmZpbmQoJ3NwYW4nKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcblx0XHRcdGlmIChjdXJyZW50WWVhciAmJiBjdXJyZW50WWVhciA9PSB5ZWFyKSB7XHJcblx0XHRcdFx0bW9udGhzLmVxKHRoaXMuZGF0ZS5nZXRVVENNb250aCgpKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHllYXIgPCBzdGFydFllYXIgfHwgeWVhciA+IGVuZFllYXIpIHtcclxuXHRcdFx0XHRtb250aHMuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHllYXIgPT0gc3RhcnRZZWFyKSB7XHJcblx0XHRcdFx0bW9udGhzLnNsaWNlKDAsIHN0YXJ0TW9udGgpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh5ZWFyID09IGVuZFllYXIpIHtcclxuXHRcdFx0XHRtb250aHMuc2xpY2UoZW5kTW9udGgrMSkuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGh0bWwgPSAnJztcclxuXHRcdFx0eWVhciA9IHBhcnNlSW50KHllYXIvMTAsIDEwKSAqIDEwO1xyXG5cdFx0XHR2YXIgeWVhckNvbnQgPSB0aGlzLnBpY2tlci5maW5kKCcuZGF0ZXBpY2tlci15ZWFycycpXHJcblx0XHRcdFx0XHRcdFx0XHQuZmluZCgndGg6ZXEoMSknKVxyXG5cdFx0XHRcdFx0XHRcdFx0XHQudGV4dCh5ZWFyICsgJy0nICsgKHllYXIgKyA5KSlcclxuXHRcdFx0XHRcdFx0XHRcdFx0LmVuZCgpXHJcblx0XHRcdFx0XHRcdFx0XHQuZmluZCgndGQnKTtcclxuXHRcdFx0eWVhciAtPSAxO1xyXG5cdFx0XHRmb3IgKHZhciBpID0gLTE7IGkgPCAxMTsgaSsrKSB7XHJcblx0XHRcdFx0aHRtbCArPSAnPHNwYW4gY2xhc3M9XCJ5ZWFyJysoaSA9PSAtMSA/ICcgb2xkJyA6IGkgPT0gMTAgPyAnIG5ldycgOiAnJykrKGN1cnJlbnRZZWFyID09IHllYXIgPyAnIGFjdGl2ZScgOiAnJykrKHllYXIgPCBzdGFydFllYXIgfHwgeWVhciA+IGVuZFllYXIgPyAnIGRpc2FibGVkJyA6ICcnKSsnXCI+Jyt5ZWFyKyc8L3NwYW4+JztcclxuXHRcdFx0XHR5ZWFyICs9IDE7XHJcblx0XHRcdH1cclxuXHRcdFx0eWVhckNvbnQuaHRtbChodG1sKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0dXBkYXRlTmF2QXJyb3dzOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0aWYgKCF0aGlzLl9hbGxvd191cGRhdGUpIHJldHVybjtcclxuXHJcblx0XHRcdHZhciBkID0gbmV3IERhdGUodGhpcy52aWV3RGF0ZSksXHJcblx0XHRcdFx0eWVhciA9IGQuZ2V0VVRDRnVsbFllYXIoKSxcclxuXHRcdFx0XHRtb250aCA9IGQuZ2V0VVRDTW9udGgoKTtcclxuXHRcdFx0c3dpdGNoICh0aGlzLnZpZXdNb2RlKSB7XHJcblx0XHRcdFx0Y2FzZSAwOlxyXG5cdFx0XHRcdFx0aWYgKHRoaXMuby5zdGFydERhdGUgIT09IC1JbmZpbml0eSAmJiB5ZWFyIDw9IHRoaXMuby5zdGFydERhdGUuZ2V0VVRDRnVsbFllYXIoKSAmJiBtb250aCA8PSB0aGlzLm8uc3RhcnREYXRlLmdldFVUQ01vbnRoKCkpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5waWNrZXIuZmluZCgnLnByZXYnKS5jc3Moe3Zpc2liaWxpdHk6ICdoaWRkZW4nfSk7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR0aGlzLnBpY2tlci5maW5kKCcucHJldicpLmNzcyh7dmlzaWJpbGl0eTogJ3Zpc2libGUnfSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAodGhpcy5vLmVuZERhdGUgIT09IEluZmluaXR5ICYmIHllYXIgPj0gdGhpcy5vLmVuZERhdGUuZ2V0VVRDRnVsbFllYXIoKSAmJiBtb250aCA+PSB0aGlzLm8uZW5kRGF0ZS5nZXRVVENNb250aCgpKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMucGlja2VyLmZpbmQoJy5uZXh0JykuY3NzKHt2aXNpYmlsaXR5OiAnaGlkZGVuJ30pO1xyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5waWNrZXIuZmluZCgnLm5leHQnKS5jc3Moe3Zpc2liaWxpdHk6ICd2aXNpYmxlJ30pO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0Y2FzZSAxOlxyXG5cdFx0XHRcdGNhc2UgMjpcclxuXHRcdFx0XHRcdGlmICh0aGlzLm8uc3RhcnREYXRlICE9PSAtSW5maW5pdHkgJiYgeWVhciA8PSB0aGlzLm8uc3RhcnREYXRlLmdldFVUQ0Z1bGxZZWFyKCkpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5waWNrZXIuZmluZCgnLnByZXYnKS5jc3Moe3Zpc2liaWxpdHk6ICdoaWRkZW4nfSk7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR0aGlzLnBpY2tlci5maW5kKCcucHJldicpLmNzcyh7dmlzaWJpbGl0eTogJ3Zpc2libGUnfSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAodGhpcy5vLmVuZERhdGUgIT09IEluZmluaXR5ICYmIHllYXIgPj0gdGhpcy5vLmVuZERhdGUuZ2V0VVRDRnVsbFllYXIoKSkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLnBpY2tlci5maW5kKCcubmV4dCcpLmNzcyh7dmlzaWJpbGl0eTogJ2hpZGRlbid9KTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdHRoaXMucGlja2VyLmZpbmQoJy5uZXh0JykuY3NzKHt2aXNpYmlsaXR5OiAndmlzaWJsZSd9KTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdGNsaWNrOiBmdW5jdGlvbihlKSB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0dmFyIHRhcmdldCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJ3NwYW4sIHRkLCB0aCcpO1xyXG5cdFx0XHRpZiAodGFyZ2V0Lmxlbmd0aCA9PSAxKSB7XHJcblx0XHRcdFx0c3dpdGNoKHRhcmdldFswXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKSB7XHJcblx0XHRcdFx0XHRjYXNlICd0aCc6XHJcblx0XHRcdFx0XHRcdHN3aXRjaCh0YXJnZXRbMF0uY2xhc3NOYW1lKSB7XHJcblx0XHRcdFx0XHRcdFx0Y2FzZSAnZGF0ZXBpY2tlci1zd2l0Y2gnOlxyXG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5zaG93TW9kZSgxKTtcclxuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdGNhc2UgJ3ByZXYnOlxyXG5cdFx0XHRcdFx0XHRcdGNhc2UgJ25leHQnOlxyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIGRpciA9IERQR2xvYmFsLm1vZGVzW3RoaXMudmlld01vZGVdLm5hdlN0ZXAgKiAodGFyZ2V0WzBdLmNsYXNzTmFtZSA9PSAncHJldicgPyAtMSA6IDEpO1xyXG5cdFx0XHRcdFx0XHRcdFx0c3dpdGNoKHRoaXMudmlld01vZGUpe1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRjYXNlIDA6XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0dGhpcy52aWV3RGF0ZSA9IHRoaXMubW92ZU1vbnRoKHRoaXMudmlld0RhdGUsIGRpcik7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgMTpcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSAyOlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRoaXMudmlld0RhdGUgPSB0aGlzLm1vdmVZZWFyKHRoaXMudmlld0RhdGUsIGRpcik7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHR0aGlzLmZpbGwoKTtcclxuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdGNhc2UgJ3RvZGF5JzpcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBkYXRlID0gbmV3IERhdGUoKTtcclxuXHRcdFx0XHRcdFx0XHRcdGRhdGUgPSBVVENEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgZGF0ZS5nZXRNb250aCgpLCBkYXRlLmdldERhdGUoKSwgMCwgMCwgMCk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5zaG93TW9kZSgtMik7XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgd2hpY2ggPSB0aGlzLm8udG9kYXlCdG4gPT0gJ2xpbmtlZCcgPyBudWxsIDogJ3ZpZXcnO1xyXG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5fc2V0RGF0ZShkYXRlLCB3aGljaCk7XHJcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0XHRjYXNlICdjbGVhcic6XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgZWxlbWVudDtcclxuXHRcdFx0XHRcdFx0XHRcdGlmICh0aGlzLmlzSW5wdXQpXHJcblx0XHRcdFx0XHRcdFx0XHRcdGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XHJcblx0XHRcdFx0XHRcdFx0XHRlbHNlIGlmICh0aGlzLmNvbXBvbmVudClcclxuXHRcdFx0XHRcdFx0XHRcdFx0ZWxlbWVudCA9IHRoaXMuZWxlbWVudC5maW5kKCdpbnB1dCcpO1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKGVsZW1lbnQpXHJcblx0XHRcdFx0XHRcdFx0XHRcdGVsZW1lbnQudmFsKFwiXCIpLmNoYW5nZSgpO1xyXG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5fdHJpZ2dlcignY2hhbmdlRGF0ZScpO1xyXG5cdFx0XHRcdFx0XHRcdFx0dGhpcy51cGRhdGUoKTtcclxuXHRcdFx0XHRcdFx0XHRcdGlmICh0aGlzLm8uYXV0b2Nsb3NlKVxyXG5cdFx0XHRcdFx0XHRcdFx0XHR0aGlzLmhpZGUoKTtcclxuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0Y2FzZSAnc3Bhbic6XHJcblx0XHRcdFx0XHRcdGlmICghdGFyZ2V0LmlzKCcuZGlzYWJsZWQnKSkge1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMudmlld0RhdGUuc2V0VVRDRGF0ZSgxKTtcclxuXHRcdFx0XHRcdFx0XHRpZiAodGFyZ2V0LmlzKCcubW9udGgnKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIGRheSA9IDE7XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgbW9udGggPSB0YXJnZXQucGFyZW50KCkuZmluZCgnc3BhbicpLmluZGV4KHRhcmdldCk7XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgeWVhciA9IHRoaXMudmlld0RhdGUuZ2V0VVRDRnVsbFllYXIoKTtcclxuXHRcdFx0XHRcdFx0XHRcdHRoaXMudmlld0RhdGUuc2V0VVRDTW9udGgobW9udGgpO1xyXG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5fdHJpZ2dlcignY2hhbmdlTW9udGgnLCB0aGlzLnZpZXdEYXRlKTtcclxuXHRcdFx0XHRcdFx0XHRcdGlmICh0aGlzLm8ubWluVmlld01vZGUgPT09IDEpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dGhpcy5fc2V0RGF0ZShVVENEYXRlKHllYXIsIG1vbnRoLCBkYXksMCwwLDAsMCkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgeWVhciA9IHBhcnNlSW50KHRhcmdldC50ZXh0KCksIDEwKXx8MDtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBkYXkgPSAxO1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIG1vbnRoID0gMDtcclxuXHRcdFx0XHRcdFx0XHRcdHRoaXMudmlld0RhdGUuc2V0VVRDRnVsbFllYXIoeWVhcik7XHJcblx0XHRcdFx0XHRcdFx0XHR0aGlzLl90cmlnZ2VyKCdjaGFuZ2VZZWFyJywgdGhpcy52aWV3RGF0ZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAodGhpcy5vLm1pblZpZXdNb2RlID09PSAyKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHRoaXMuX3NldERhdGUoVVRDRGF0ZSh5ZWFyLCBtb250aCwgZGF5LDAsMCwwLDApKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5zaG93TW9kZSgtMSk7XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5maWxsKCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRjYXNlICd0ZCc6XHJcblx0XHRcdFx0XHRcdGlmICh0YXJnZXQuaXMoJy5kYXknKSAmJiAhdGFyZ2V0LmlzKCcuZGlzYWJsZWQnKSl7XHJcblx0XHRcdFx0XHRcdFx0dmFyIGRheSA9IHBhcnNlSW50KHRhcmdldC50ZXh0KCksIDEwKXx8MTtcclxuXHRcdFx0XHRcdFx0XHR2YXIgeWVhciA9IHRoaXMudmlld0RhdGUuZ2V0VVRDRnVsbFllYXIoKSxcclxuXHRcdFx0XHRcdFx0XHRcdG1vbnRoID0gdGhpcy52aWV3RGF0ZS5nZXRVVENNb250aCgpO1xyXG5cdFx0XHRcdFx0XHRcdGlmICh0YXJnZXQuaXMoJy5vbGQnKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKG1vbnRoID09PSAwKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdG1vbnRoID0gMTE7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHllYXIgLT0gMTtcclxuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdG1vbnRoIC09IDE7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0YXJnZXQuaXMoJy5uZXcnKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKG1vbnRoID09IDExKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdG1vbnRoID0gMDtcclxuXHRcdFx0XHRcdFx0XHRcdFx0eWVhciArPSAxO1xyXG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0bW9udGggKz0gMTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5fc2V0RGF0ZShVVENEYXRlKHllYXIsIG1vbnRoLCBkYXksMCwwLDAsMCkpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRfc2V0RGF0ZTogZnVuY3Rpb24oZGF0ZSwgd2hpY2gpe1xyXG5cdFx0XHRpZiAoIXdoaWNoIHx8IHdoaWNoID09ICdkYXRlJylcclxuXHRcdFx0XHR0aGlzLmRhdGUgPSBuZXcgRGF0ZShkYXRlKTtcclxuXHRcdFx0aWYgKCF3aGljaCB8fCB3aGljaCAgPT0gJ3ZpZXcnKVxyXG5cdFx0XHRcdHRoaXMudmlld0RhdGUgPSBuZXcgRGF0ZShkYXRlKTtcclxuXHRcdFx0dGhpcy5maWxsKCk7XHJcblx0XHRcdHRoaXMuc2V0VmFsdWUoKTtcclxuXHRcdFx0dGhpcy5fdHJpZ2dlcignY2hhbmdlRGF0ZScpO1xyXG5cdFx0XHR2YXIgZWxlbWVudDtcclxuXHRcdFx0aWYgKHRoaXMuaXNJbnB1dCkge1xyXG5cdFx0XHRcdGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XHJcblx0XHRcdH0gZWxzZSBpZiAodGhpcy5jb21wb25lbnQpe1xyXG5cdFx0XHRcdGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQuZmluZCgnaW5wdXQnKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoZWxlbWVudCkge1xyXG5cdFx0XHRcdGVsZW1lbnQuY2hhbmdlKCk7XHJcblx0XHRcdFx0aWYgKHRoaXMuby5hdXRvY2xvc2UgJiYgKCF3aGljaCB8fCB3aGljaCA9PSAnZGF0ZScpKSB7XHJcblx0XHRcdFx0XHR0aGlzLmhpZGUoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0bW92ZU1vbnRoOiBmdW5jdGlvbihkYXRlLCBkaXIpe1xyXG5cdFx0XHRpZiAoIWRpcikgcmV0dXJuIGRhdGU7XHJcblx0XHRcdHZhciBuZXdfZGF0ZSA9IG5ldyBEYXRlKGRhdGUudmFsdWVPZigpKSxcclxuXHRcdFx0XHRkYXkgPSBuZXdfZGF0ZS5nZXRVVENEYXRlKCksXHJcblx0XHRcdFx0bW9udGggPSBuZXdfZGF0ZS5nZXRVVENNb250aCgpLFxyXG5cdFx0XHRcdG1hZyA9IE1hdGguYWJzKGRpciksXHJcblx0XHRcdFx0bmV3X21vbnRoLCB0ZXN0O1xyXG5cdFx0XHRkaXIgPSBkaXIgPiAwID8gMSA6IC0xO1xyXG5cdFx0XHRpZiAobWFnID09IDEpe1xyXG5cdFx0XHRcdHRlc3QgPSBkaXIgPT0gLTFcclxuXHRcdFx0XHRcdC8vIElmIGdvaW5nIGJhY2sgb25lIG1vbnRoLCBtYWtlIHN1cmUgbW9udGggaXMgbm90IGN1cnJlbnQgbW9udGhcclxuXHRcdFx0XHRcdC8vIChlZywgTWFyIDMxIC0+IEZlYiAzMSA9PSBGZWIgMjgsIG5vdCBNYXIgMDIpXHJcblx0XHRcdFx0XHQ/IGZ1bmN0aW9uKCl7IHJldHVybiBuZXdfZGF0ZS5nZXRVVENNb250aCgpID09IG1vbnRoOyB9XHJcblx0XHRcdFx0XHQvLyBJZiBnb2luZyBmb3J3YXJkIG9uZSBtb250aCwgbWFrZSBzdXJlIG1vbnRoIGlzIGFzIGV4cGVjdGVkXHJcblx0XHRcdFx0XHQvLyAoZWcsIEphbiAzMSAtPiBGZWIgMzEgPT0gRmViIDI4LCBub3QgTWFyIDAyKVxyXG5cdFx0XHRcdFx0OiBmdW5jdGlvbigpeyByZXR1cm4gbmV3X2RhdGUuZ2V0VVRDTW9udGgoKSAhPSBuZXdfbW9udGg7IH07XHJcblx0XHRcdFx0bmV3X21vbnRoID0gbW9udGggKyBkaXI7XHJcblx0XHRcdFx0bmV3X2RhdGUuc2V0VVRDTW9udGgobmV3X21vbnRoKTtcclxuXHRcdFx0XHQvLyBEZWMgLT4gSmFuICgxMikgb3IgSmFuIC0+IERlYyAoLTEpIC0tIGxpbWl0IGV4cGVjdGVkIGRhdGUgdG8gMC0xMVxyXG5cdFx0XHRcdGlmIChuZXdfbW9udGggPCAwIHx8IG5ld19tb250aCA+IDExKVxyXG5cdFx0XHRcdFx0bmV3X21vbnRoID0gKG5ld19tb250aCArIDEyKSAlIDEyO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdC8vIEZvciBtYWduaXR1ZGVzID4xLCBtb3ZlIG9uZSBtb250aCBhdCBhIHRpbWUuLi5cclxuXHRcdFx0XHRmb3IgKHZhciBpPTA7IGk8bWFnOyBpKyspXHJcblx0XHRcdFx0XHQvLyAuLi53aGljaCBtaWdodCBkZWNyZWFzZSB0aGUgZGF5IChlZywgSmFuIDMxIHRvIEZlYiAyOCwgZXRjKS4uLlxyXG5cdFx0XHRcdFx0bmV3X2RhdGUgPSB0aGlzLm1vdmVNb250aChuZXdfZGF0ZSwgZGlyKTtcclxuXHRcdFx0XHQvLyAuLi50aGVuIHJlc2V0IHRoZSBkYXksIGtlZXBpbmcgaXQgaW4gdGhlIG5ldyBtb250aFxyXG5cdFx0XHRcdG5ld19tb250aCA9IG5ld19kYXRlLmdldFVUQ01vbnRoKCk7XHJcblx0XHRcdFx0bmV3X2RhdGUuc2V0VVRDRGF0ZShkYXkpO1xyXG5cdFx0XHRcdHRlc3QgPSBmdW5jdGlvbigpeyByZXR1cm4gbmV3X21vbnRoICE9IG5ld19kYXRlLmdldFVUQ01vbnRoKCk7IH07XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gQ29tbW9uIGRhdGUtcmVzZXR0aW5nIGxvb3AgLS0gaWYgZGF0ZSBpcyBiZXlvbmQgZW5kIG9mIG1vbnRoLCBtYWtlIGl0XHJcblx0XHRcdC8vIGVuZCBvZiBtb250aFxyXG5cdFx0XHR3aGlsZSAodGVzdCgpKXtcclxuXHRcdFx0XHRuZXdfZGF0ZS5zZXRVVENEYXRlKC0tZGF5KTtcclxuXHRcdFx0XHRuZXdfZGF0ZS5zZXRVVENNb250aChuZXdfbW9udGgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBuZXdfZGF0ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0bW92ZVllYXI6IGZ1bmN0aW9uKGRhdGUsIGRpcil7XHJcblx0XHRcdHJldHVybiB0aGlzLm1vdmVNb250aChkYXRlLCBkaXIqMTIpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRkYXRlV2l0aGluUmFuZ2U6IGZ1bmN0aW9uKGRhdGUpe1xyXG5cdFx0XHRyZXR1cm4gZGF0ZSA+PSB0aGlzLm8uc3RhcnREYXRlICYmIGRhdGUgPD0gdGhpcy5vLmVuZERhdGU7XHJcblx0XHR9LFxyXG5cclxuXHRcdGtleWRvd246IGZ1bmN0aW9uKGUpe1xyXG5cdFx0XHRpZiAodGhpcy5waWNrZXIuaXMoJzpub3QoOnZpc2libGUpJykpe1xyXG5cdFx0XHRcdGlmIChlLmtleUNvZGUgPT0gMjcpIC8vIGFsbG93IGVzY2FwZSB0byBoaWRlIGFuZCByZS1zaG93IHBpY2tlclxyXG5cdFx0XHRcdFx0dGhpcy5zaG93KCk7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblx0XHRcdHZhciBkYXRlQ2hhbmdlZCA9IGZhbHNlLFxyXG5cdFx0XHRcdGRpciwgZGF5LCBtb250aCxcclxuXHRcdFx0XHRuZXdEYXRlLCBuZXdWaWV3RGF0ZTtcclxuXHRcdFx0c3dpdGNoKGUua2V5Q29kZSl7XHJcblx0XHRcdFx0Y2FzZSAyNzogLy8gZXNjYXBlXHJcblx0XHRcdFx0XHR0aGlzLmhpZGUoKTtcclxuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGNhc2UgMzc6IC8vIGxlZnRcclxuXHRcdFx0XHRjYXNlIDM5OiAvLyByaWdodFxyXG5cdFx0XHRcdFx0aWYgKCF0aGlzLm8ua2V5Ym9hcmROYXZpZ2F0aW9uKSBicmVhaztcclxuXHRcdFx0XHRcdGRpciA9IGUua2V5Q29kZSA9PSAzNyA/IC0xIDogMTtcclxuXHRcdFx0XHRcdGlmIChlLmN0cmxLZXkpe1xyXG5cdFx0XHRcdFx0XHRuZXdEYXRlID0gdGhpcy5tb3ZlWWVhcih0aGlzLmRhdGUsIGRpcik7XHJcblx0XHRcdFx0XHRcdG5ld1ZpZXdEYXRlID0gdGhpcy5tb3ZlWWVhcih0aGlzLnZpZXdEYXRlLCBkaXIpO1xyXG5cdFx0XHRcdFx0fSBlbHNlIGlmIChlLnNoaWZ0S2V5KXtcclxuXHRcdFx0XHRcdFx0bmV3RGF0ZSA9IHRoaXMubW92ZU1vbnRoKHRoaXMuZGF0ZSwgZGlyKTtcclxuXHRcdFx0XHRcdFx0bmV3Vmlld0RhdGUgPSB0aGlzLm1vdmVNb250aCh0aGlzLnZpZXdEYXRlLCBkaXIpO1xyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0bmV3RGF0ZSA9IG5ldyBEYXRlKHRoaXMuZGF0ZSk7XHJcblx0XHRcdFx0XHRcdG5ld0RhdGUuc2V0VVRDRGF0ZSh0aGlzLmRhdGUuZ2V0VVRDRGF0ZSgpICsgZGlyKTtcclxuXHRcdFx0XHRcdFx0bmV3Vmlld0RhdGUgPSBuZXcgRGF0ZSh0aGlzLnZpZXdEYXRlKTtcclxuXHRcdFx0XHRcdFx0bmV3Vmlld0RhdGUuc2V0VVRDRGF0ZSh0aGlzLnZpZXdEYXRlLmdldFVUQ0RhdGUoKSArIGRpcik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAodGhpcy5kYXRlV2l0aGluUmFuZ2UobmV3RGF0ZSkpe1xyXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUgPSBuZXdEYXRlO1xyXG5cdFx0XHRcdFx0XHR0aGlzLnZpZXdEYXRlID0gbmV3Vmlld0RhdGU7XHJcblx0XHRcdFx0XHRcdHRoaXMuc2V0VmFsdWUoKTtcclxuXHRcdFx0XHRcdFx0dGhpcy51cGRhdGUoKTtcclxuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdFx0XHRkYXRlQ2hhbmdlZCA9IHRydWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRjYXNlIDM4OiAvLyB1cFxyXG5cdFx0XHRcdGNhc2UgNDA6IC8vIGRvd25cclxuXHRcdFx0XHRcdGlmICghdGhpcy5vLmtleWJvYXJkTmF2aWdhdGlvbikgYnJlYWs7XHJcblx0XHRcdFx0XHRkaXIgPSBlLmtleUNvZGUgPT0gMzggPyAtMSA6IDE7XHJcblx0XHRcdFx0XHRpZiAoZS5jdHJsS2V5KXtcclxuXHRcdFx0XHRcdFx0bmV3RGF0ZSA9IHRoaXMubW92ZVllYXIodGhpcy5kYXRlLCBkaXIpO1xyXG5cdFx0XHRcdFx0XHRuZXdWaWV3RGF0ZSA9IHRoaXMubW92ZVllYXIodGhpcy52aWV3RGF0ZSwgZGlyKTtcclxuXHRcdFx0XHRcdH0gZWxzZSBpZiAoZS5zaGlmdEtleSl7XHJcblx0XHRcdFx0XHRcdG5ld0RhdGUgPSB0aGlzLm1vdmVNb250aCh0aGlzLmRhdGUsIGRpcik7XHJcblx0XHRcdFx0XHRcdG5ld1ZpZXdEYXRlID0gdGhpcy5tb3ZlTW9udGgodGhpcy52aWV3RGF0ZSwgZGlyKTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdG5ld0RhdGUgPSBuZXcgRGF0ZSh0aGlzLmRhdGUpO1xyXG5cdFx0XHRcdFx0XHRuZXdEYXRlLnNldFVUQ0RhdGUodGhpcy5kYXRlLmdldFVUQ0RhdGUoKSArIGRpciAqIDcpO1xyXG5cdFx0XHRcdFx0XHRuZXdWaWV3RGF0ZSA9IG5ldyBEYXRlKHRoaXMudmlld0RhdGUpO1xyXG5cdFx0XHRcdFx0XHRuZXdWaWV3RGF0ZS5zZXRVVENEYXRlKHRoaXMudmlld0RhdGUuZ2V0VVRDRGF0ZSgpICsgZGlyICogNyk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAodGhpcy5kYXRlV2l0aGluUmFuZ2UobmV3RGF0ZSkpe1xyXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUgPSBuZXdEYXRlO1xyXG5cdFx0XHRcdFx0XHR0aGlzLnZpZXdEYXRlID0gbmV3Vmlld0RhdGU7XHJcblx0XHRcdFx0XHRcdHRoaXMuc2V0VmFsdWUoKTtcclxuXHRcdFx0XHRcdFx0dGhpcy51cGRhdGUoKTtcclxuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdFx0XHRkYXRlQ2hhbmdlZCA9IHRydWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRjYXNlIDEzOiAvLyBlbnRlclxyXG5cdFx0XHRcdFx0dGhpcy5oaWRlKCk7XHJcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRjYXNlIDk6IC8vIHRhYlxyXG5cdFx0XHRcdFx0dGhpcy5oaWRlKCk7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoZGF0ZUNoYW5nZWQpe1xyXG5cdFx0XHRcdHRoaXMuX3RyaWdnZXIoJ2NoYW5nZURhdGUnKTtcclxuXHRcdFx0XHR2YXIgZWxlbWVudDtcclxuXHRcdFx0XHRpZiAodGhpcy5pc0lucHV0KSB7XHJcblx0XHRcdFx0XHRlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xyXG5cdFx0XHRcdH0gZWxzZSBpZiAodGhpcy5jb21wb25lbnQpe1xyXG5cdFx0XHRcdFx0ZWxlbWVudCA9IHRoaXMuZWxlbWVudC5maW5kKCdpbnB1dCcpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAoZWxlbWVudCkge1xyXG5cdFx0XHRcdFx0ZWxlbWVudC5jaGFuZ2UoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0c2hvd01vZGU6IGZ1bmN0aW9uKGRpcikge1xyXG5cdFx0XHRpZiAoZGlyKSB7XHJcblx0XHRcdFx0dGhpcy52aWV3TW9kZSA9IE1hdGgubWF4KHRoaXMuby5taW5WaWV3TW9kZSwgTWF0aC5taW4oMiwgdGhpcy52aWV3TW9kZSArIGRpcikpO1xyXG5cdFx0XHR9XHJcblx0XHRcdC8qXHJcblx0XHRcdFx0dml0YWxldHM6IGZpeGluZyBidWcgb2YgdmVyeSBzcGVjaWFsIGNvbmRpdGlvbnM6XHJcblx0XHRcdFx0anF1ZXJ5IDEuNy4xICsgd2Via2l0ICsgc2hvdyBpbmxpbmUgZGF0ZXBpY2tlciBpbiBib290c3RyYXAgcG9wb3Zlci5cclxuXHRcdFx0XHRNZXRob2Qgc2hvdygpIGRvZXMgbm90IHNldCBkaXNwbGF5IGNzcyBjb3JyZWN0bHkgYW5kIGRhdGVwaWNrZXIgaXMgbm90IHNob3duLlxyXG5cdFx0XHRcdENoYW5nZWQgdG8gLmNzcygnZGlzcGxheScsICdibG9jaycpIHNvbHZlIHRoZSBwcm9ibGVtLlxyXG5cdFx0XHRcdFNlZSBodHRwczovL2dpdGh1Yi5jb20vdml0YWxldHMveC1lZGl0YWJsZS9pc3N1ZXMvMzdcclxuXHJcblx0XHRcdFx0SW4ganF1ZXJ5IDEuNy4yKyBldmVyeXRoaW5nIHdvcmtzIGZpbmUuXHJcblx0XHRcdCovXHJcblx0XHRcdC8vdGhpcy5waWNrZXIuZmluZCgnPmRpdicpLmhpZGUoKS5maWx0ZXIoJy5kYXRlcGlja2VyLScrRFBHbG9iYWwubW9kZXNbdGhpcy52aWV3TW9kZV0uY2xzTmFtZSkuc2hvdygpO1xyXG5cdFx0XHR0aGlzLnBpY2tlci5maW5kKCc+ZGl2JykuaGlkZSgpLmZpbHRlcignLmRhdGVwaWNrZXItJytEUEdsb2JhbC5tb2Rlc1t0aGlzLnZpZXdNb2RlXS5jbHNOYW1lKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcclxuXHRcdFx0dGhpcy51cGRhdGVOYXZBcnJvd3MoKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHR2YXIgRGF0ZVJhbmdlUGlja2VyID0gZnVuY3Rpb24oZWxlbWVudCwgb3B0aW9ucyl7XHJcblx0XHR0aGlzLmVsZW1lbnQgPSAkKGVsZW1lbnQpO1xyXG5cdFx0dGhpcy5pbnB1dHMgPSAkLm1hcChvcHRpb25zLmlucHV0cywgZnVuY3Rpb24oaSl7IHJldHVybiBpLmpxdWVyeSA/IGlbMF0gOiBpOyB9KTtcclxuXHRcdGRlbGV0ZSBvcHRpb25zLmlucHV0cztcclxuXHJcblx0XHQkKHRoaXMuaW5wdXRzKVxyXG5cdFx0XHQuZGF0ZXBpY2tlcihvcHRpb25zKVxyXG5cdFx0XHQuYmluZCgnY2hhbmdlRGF0ZScsICQucHJveHkodGhpcy5kYXRlVXBkYXRlZCwgdGhpcykpO1xyXG5cclxuXHRcdHRoaXMucGlja2VycyA9ICQubWFwKHRoaXMuaW5wdXRzLCBmdW5jdGlvbihpKXsgcmV0dXJuICQoaSkuZGF0YSgnZGF0ZXBpY2tlcicpOyB9KTtcclxuXHRcdHRoaXMudXBkYXRlRGF0ZXMoKTtcclxuXHR9O1xyXG5cdERhdGVSYW5nZVBpY2tlci5wcm90b3R5cGUgPSB7XHJcblx0XHR1cGRhdGVEYXRlczogZnVuY3Rpb24oKXtcclxuXHRcdFx0dGhpcy5kYXRlcyA9ICQubWFwKHRoaXMucGlja2VycywgZnVuY3Rpb24oaSl7IHJldHVybiBpLmRhdGU7IH0pO1xyXG5cdFx0XHR0aGlzLnVwZGF0ZVJhbmdlcygpO1xyXG5cdFx0fSxcclxuXHRcdHVwZGF0ZVJhbmdlczogZnVuY3Rpb24oKXtcclxuXHRcdFx0dmFyIHJhbmdlID0gJC5tYXAodGhpcy5kYXRlcywgZnVuY3Rpb24oZCl7IHJldHVybiBkLnZhbHVlT2YoKTsgfSk7XHJcblx0XHRcdCQuZWFjaCh0aGlzLnBpY2tlcnMsIGZ1bmN0aW9uKGksIHApe1xyXG5cdFx0XHRcdHAuc2V0UmFuZ2UocmFuZ2UpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH0sXHJcblx0XHRkYXRlVXBkYXRlZDogZnVuY3Rpb24oZSl7XHJcblx0XHRcdHZhciBkcCA9ICQoZS50YXJnZXQpLmRhdGEoJ2RhdGVwaWNrZXInKSxcclxuXHRcdFx0XHRuZXdfZGF0ZSA9IGRwLmdldFVUQ0RhdGUoKSxcclxuXHRcdFx0XHRpID0gJC5pbkFycmF5KGUudGFyZ2V0LCB0aGlzLmlucHV0cyksXHJcblx0XHRcdFx0bCA9IHRoaXMuaW5wdXRzLmxlbmd0aDtcclxuXHRcdFx0aWYgKGkgPT0gLTEpIHJldHVybjtcclxuXHJcblx0XHRcdGlmIChuZXdfZGF0ZSA8IHRoaXMuZGF0ZXNbaV0pe1xyXG5cdFx0XHRcdC8vIERhdGUgYmVpbmcgbW92ZWQgZWFybGllci9sZWZ0XHJcblx0XHRcdFx0d2hpbGUgKGk+PTAgJiYgbmV3X2RhdGUgPCB0aGlzLmRhdGVzW2ldKXtcclxuXHRcdFx0XHRcdHRoaXMucGlja2Vyc1tpLS1dLnNldFVUQ0RhdGUobmV3X2RhdGUpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChuZXdfZGF0ZSA+IHRoaXMuZGF0ZXNbaV0pe1xyXG5cdFx0XHRcdC8vIERhdGUgYmVpbmcgbW92ZWQgbGF0ZXIvcmlnaHRcclxuXHRcdFx0XHR3aGlsZSAoaTxsICYmIG5ld19kYXRlID4gdGhpcy5kYXRlc1tpXSl7XHJcblx0XHRcdFx0XHR0aGlzLnBpY2tlcnNbaSsrXS5zZXRVVENEYXRlKG5ld19kYXRlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy51cGRhdGVEYXRlcygpO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZTogZnVuY3Rpb24oKXtcclxuXHRcdFx0JC5tYXAodGhpcy5waWNrZXJzLCBmdW5jdGlvbihwKXsgcC5yZW1vdmUoKTsgfSk7XHJcblx0XHRcdGRlbGV0ZSB0aGlzLmVsZW1lbnQuZGF0YSgpLmRhdGVwaWNrZXI7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0ZnVuY3Rpb24gb3B0c19mcm9tX2VsKGVsLCBwcmVmaXgpe1xyXG5cdFx0Ly8gRGVyaXZlIG9wdGlvbnMgZnJvbSBlbGVtZW50IGRhdGEtYXR0cnNcclxuXHRcdHZhciBkYXRhID0gJChlbCkuZGF0YSgpLFxyXG5cdFx0XHRvdXQgPSB7fSwgaW5rZXksXHJcblx0XHRcdHJlcGxhY2UgPSBuZXcgUmVnRXhwKCdeJyArIHByZWZpeC50b0xvd2VyQ2FzZSgpICsgJyhbQS1aXSknKSxcclxuXHRcdFx0cHJlZml4ID0gbmV3IFJlZ0V4cCgnXicgKyBwcmVmaXgudG9Mb3dlckNhc2UoKSk7XHJcblx0XHRmb3IgKHZhciBrZXkgaW4gZGF0YSlcclxuXHRcdFx0aWYgKHByZWZpeC50ZXN0KGtleSkpe1xyXG5cdFx0XHRcdGlua2V5ID0ga2V5LnJlcGxhY2UocmVwbGFjZSwgZnVuY3Rpb24oXyxhKXsgcmV0dXJuIGEudG9Mb3dlckNhc2UoKTsgfSk7XHJcblx0XHRcdFx0b3V0W2lua2V5XSA9IGRhdGFba2V5XTtcclxuXHRcdFx0fVxyXG5cdFx0cmV0dXJuIG91dDtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIG9wdHNfZnJvbV9sb2NhbGUobGFuZyl7XHJcblx0XHQvLyBEZXJpdmUgb3B0aW9ucyBmcm9tIGxvY2FsZSBwbHVnaW5zXHJcblx0XHR2YXIgb3V0ID0ge307XHJcblx0XHQvLyBDaGVjayBpZiBcImRlLURFXCIgc3R5bGUgZGF0ZSBpcyBhdmFpbGFibGUsIGlmIG5vdCBsYW5ndWFnZSBzaG91bGRcclxuXHRcdC8vIGZhbGxiYWNrIHRvIDIgbGV0dGVyIGNvZGUgZWcgXCJkZVwiXHJcblx0XHRpZiAoIWRhdGVzW2xhbmddKSB7XHJcblx0XHRcdGxhbmcgPSBsYW5nLnNwbGl0KCctJylbMF1cclxuXHRcdFx0aWYgKCFkYXRlc1tsYW5nXSlcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHR2YXIgZCA9IGRhdGVzW2xhbmddO1xyXG5cdFx0JC5lYWNoKGxvY2FsZV9vcHRzLCBmdW5jdGlvbihpLGspe1xyXG5cdFx0XHRpZiAoayBpbiBkKVxyXG5cdFx0XHRcdG91dFtrXSA9IGRba107XHJcblx0XHR9KTtcclxuXHRcdHJldHVybiBvdXQ7XHJcblx0fVxyXG5cclxuXHR2YXIgb2xkID0gJC5mbi5kYXRlcGlja2VyO1xyXG5cdHZhciBkYXRlcGlja2VyID0gJC5mbi5kYXRlcGlja2VyID0gZnVuY3Rpb24gKCBvcHRpb24gKSB7XHJcblx0XHR2YXIgYXJncyA9IEFycmF5LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XHJcblx0XHRhcmdzLnNoaWZ0KCk7XHJcblx0XHR2YXIgaW50ZXJuYWxfcmV0dXJuLFxyXG5cdFx0XHR0aGlzX3JldHVybjtcclxuXHRcdHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHZhciAkdGhpcyA9ICQodGhpcyksXHJcblx0XHRcdFx0ZGF0YSA9ICR0aGlzLmRhdGEoJ2RhdGVwaWNrZXInKSxcclxuXHRcdFx0XHRvcHRpb25zID0gdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb247XHJcblx0XHRcdGlmICghZGF0YSkge1xyXG5cdFx0XHRcdHZhciBlbG9wdHMgPSBvcHRzX2Zyb21fZWwodGhpcywgJ2RhdGUnKSxcclxuXHRcdFx0XHRcdC8vIFByZWxpbWluYXJ5IG90aW9uc1xyXG5cdFx0XHRcdFx0eG9wdHMgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdHMsIGVsb3B0cywgb3B0aW9ucyksXHJcblx0XHRcdFx0XHRsb2NvcHRzID0gb3B0c19mcm9tX2xvY2FsZSh4b3B0cy5sYW5ndWFnZSksXHJcblx0XHRcdFx0XHQvLyBPcHRpb25zIHByaW9yaXR5OiBqcyBhcmdzLCBkYXRhLWF0dHJzLCBsb2NhbGVzLCBkZWZhdWx0c1xyXG5cdFx0XHRcdFx0b3B0cyA9ICQuZXh0ZW5kKHt9LCBkZWZhdWx0cywgbG9jb3B0cywgZWxvcHRzLCBvcHRpb25zKTtcclxuXHRcdFx0XHRpZiAoJHRoaXMuaXMoJy5pbnB1dC1kYXRlcmFuZ2UnKSB8fCBvcHRzLmlucHV0cyl7XHJcblx0XHRcdFx0XHR2YXIgcm9wdHMgPSB7XHJcblx0XHRcdFx0XHRcdGlucHV0czogb3B0cy5pbnB1dHMgfHwgJHRoaXMuZmluZCgnaW5wdXQnKS50b0FycmF5KClcclxuXHRcdFx0XHRcdH07XHJcblx0XHRcdFx0XHQkdGhpcy5kYXRhKCdkYXRlcGlja2VyJywgKGRhdGEgPSBuZXcgRGF0ZVJhbmdlUGlja2VyKHRoaXMsICQuZXh0ZW5kKG9wdHMsIHJvcHRzKSkpKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZXtcclxuXHRcdFx0XHRcdCR0aGlzLmRhdGEoJ2RhdGVwaWNrZXInLCAoZGF0YSA9IG5ldyBEYXRlcGlja2VyKHRoaXMsIG9wdHMpKSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnICYmIHR5cGVvZiBkYXRhW29wdGlvbl0gPT0gJ2Z1bmN0aW9uJykge1xyXG5cdFx0XHRcdGludGVybmFsX3JldHVybiA9IGRhdGFbb3B0aW9uXS5hcHBseShkYXRhLCBhcmdzKTtcclxuXHRcdFx0XHRpZiAoaW50ZXJuYWxfcmV0dXJuICE9PSB1bmRlZmluZWQpXHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdFx0aWYgKGludGVybmFsX3JldHVybiAhPT0gdW5kZWZpbmVkKVxyXG5cdFx0XHRyZXR1cm4gaW50ZXJuYWxfcmV0dXJuO1xyXG5cdFx0ZWxzZVxyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHR9O1xyXG5cclxuXHR2YXIgZGVmYXVsdHMgPSAkLmZuLmRhdGVwaWNrZXIuZGVmYXVsdHMgPSB7XHJcblx0XHRhdXRvY2xvc2U6IGZhbHNlLFxyXG5cdFx0YmVmb3JlU2hvd0RheTogJC5ub29wLFxyXG5cdFx0Y2FsZW5kYXJXZWVrczogZmFsc2UsXHJcblx0XHRjbGVhckJ0bjogZmFsc2UsXHJcblx0XHRkYXlzT2ZXZWVrRGlzYWJsZWQ6IFtdLFxyXG5cdFx0ZW5kRGF0ZTogSW5maW5pdHksXHJcblx0XHRmb3JjZVBhcnNlOiB0cnVlLFxyXG5cdFx0Zm9ybWF0OiAnbW0vZGQveXl5eScsXHJcblx0XHRrZXlib2FyZE5hdmlnYXRpb246IHRydWUsXHJcblx0XHRsYW5ndWFnZTogJ2VuJyxcclxuXHRcdG1pblZpZXdNb2RlOiAwLFxyXG5cdFx0cnRsOiBmYWxzZSxcclxuXHRcdHN0YXJ0RGF0ZTogLUluZmluaXR5LFxyXG5cdFx0c3RhcnRWaWV3OiAwLFxyXG5cdFx0dG9kYXlCdG46IGZhbHNlLFxyXG5cdFx0dG9kYXlIaWdobGlnaHQ6IGZhbHNlLFxyXG5cdFx0d2Vla1N0YXJ0OiAwXHJcblx0fTtcclxuXHR2YXIgbG9jYWxlX29wdHMgPSAkLmZuLmRhdGVwaWNrZXIubG9jYWxlX29wdHMgPSBbXHJcblx0XHQnZm9ybWF0JyxcclxuXHRcdCdydGwnLFxyXG5cdFx0J3dlZWtTdGFydCdcclxuXHRdO1xyXG5cdCQuZm4uZGF0ZXBpY2tlci5Db25zdHJ1Y3RvciA9IERhdGVwaWNrZXI7XHJcblx0dmFyIGRhdGVzID0gJC5mbi5kYXRlcGlja2VyLmRhdGVzID0ge1xyXG5cdFx0ZW46IHtcclxuXHRcdFx0ZGF5czogW1wiU3VuZGF5XCIsIFwiTW9uZGF5XCIsIFwiVHVlc2RheVwiLCBcIldlZG5lc2RheVwiLCBcIlRodXJzZGF5XCIsIFwiRnJpZGF5XCIsIFwiU2F0dXJkYXlcIiwgXCJTdW5kYXlcIl0sXHJcblx0XHRcdGRheXNTaG9ydDogW1wiU3VuXCIsIFwiTW9uXCIsIFwiVHVlXCIsIFwiV2VkXCIsIFwiVGh1XCIsIFwiRnJpXCIsIFwiU2F0XCIsIFwiU3VuXCJdLFxyXG5cdFx0XHRkYXlzTWluOiBbXCJTdVwiLCBcIk1vXCIsIFwiVHVcIiwgXCJXZVwiLCBcIlRoXCIsIFwiRnJcIiwgXCJTYVwiLCBcIlN1XCJdLFxyXG5cdFx0XHRtb250aHM6IFtcIkphbnVhcnlcIiwgXCJGZWJydWFyeVwiLCBcIk1hcmNoXCIsIFwiQXByaWxcIiwgXCJNYXlcIiwgXCJKdW5lXCIsIFwiSnVseVwiLCBcIkF1Z3VzdFwiLCBcIlNlcHRlbWJlclwiLCBcIk9jdG9iZXJcIiwgXCJOb3ZlbWJlclwiLCBcIkRlY2VtYmVyXCJdLFxyXG5cdFx0XHRtb250aHNTaG9ydDogW1wiSmFuXCIsIFwiRmViXCIsIFwiTWFyXCIsIFwiQXByXCIsIFwiTWF5XCIsIFwiSnVuXCIsIFwiSnVsXCIsIFwiQXVnXCIsIFwiU2VwXCIsIFwiT2N0XCIsIFwiTm92XCIsIFwiRGVjXCJdLFxyXG5cdFx0XHR0b2RheTogXCJUb2RheVwiLFxyXG5cdFx0XHRjbGVhcjogXCJDbGVhclwiXHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0dmFyIERQR2xvYmFsID0ge1xyXG5cdFx0bW9kZXM6IFtcclxuXHRcdFx0e1xyXG5cdFx0XHRcdGNsc05hbWU6ICdkYXlzJyxcclxuXHRcdFx0XHRuYXZGbmM6ICdNb250aCcsXHJcblx0XHRcdFx0bmF2U3RlcDogMVxyXG5cdFx0XHR9LFxyXG5cdFx0XHR7XHJcblx0XHRcdFx0Y2xzTmFtZTogJ21vbnRocycsXHJcblx0XHRcdFx0bmF2Rm5jOiAnRnVsbFllYXInLFxyXG5cdFx0XHRcdG5hdlN0ZXA6IDFcclxuXHRcdFx0fSxcclxuXHRcdFx0e1xyXG5cdFx0XHRcdGNsc05hbWU6ICd5ZWFycycsXHJcblx0XHRcdFx0bmF2Rm5jOiAnRnVsbFllYXInLFxyXG5cdFx0XHRcdG5hdlN0ZXA6IDEwXHJcblx0XHR9XSxcclxuXHRcdGlzTGVhcFllYXI6IGZ1bmN0aW9uICh5ZWFyKSB7XHJcblx0XHRcdHJldHVybiAoKCh5ZWFyICUgNCA9PT0gMCkgJiYgKHllYXIgJSAxMDAgIT09IDApKSB8fCAoeWVhciAlIDQwMCA9PT0gMCkpO1xyXG5cdFx0fSxcclxuXHRcdGdldERheXNJbk1vbnRoOiBmdW5jdGlvbiAoeWVhciwgbW9udGgpIHtcclxuXHRcdFx0cmV0dXJuIFszMSwgKERQR2xvYmFsLmlzTGVhcFllYXIoeWVhcikgPyAyOSA6IDI4KSwgMzEsIDMwLCAzMSwgMzAsIDMxLCAzMSwgMzAsIDMxLCAzMCwgMzFdW21vbnRoXTtcclxuXHRcdH0sXHJcblx0XHR2YWxpZFBhcnRzOiAvZGQ/fEREP3xtbT98TU0/fHl5KD86eXkpPy9nLFxyXG5cdFx0bm9ucHVuY3R1YXRpb246IC9bXiAtXFwvOi1AXFxbXFx1MzQwMC1cXHU5ZmZmLWB7LX5cXHRcXG5cXHJdKy9nLFxyXG5cdFx0cGFyc2VGb3JtYXQ6IGZ1bmN0aW9uKGZvcm1hdCl7XHJcblx0XHRcdC8vIElFIHRyZWF0cyBcXDAgYXMgYSBzdHJpbmcgZW5kIGluIGlucHV0cyAodHJ1bmNhdGluZyB0aGUgdmFsdWUpLFxyXG5cdFx0XHQvLyBzbyBpdCdzIGEgYmFkIGZvcm1hdCBkZWxpbWl0ZXIsIGFueXdheVxyXG5cdFx0XHR2YXIgc2VwYXJhdG9ycyA9IGZvcm1hdC5yZXBsYWNlKHRoaXMudmFsaWRQYXJ0cywgJ1xcMCcpLnNwbGl0KCdcXDAnKSxcclxuXHRcdFx0XHRwYXJ0cyA9IGZvcm1hdC5tYXRjaCh0aGlzLnZhbGlkUGFydHMpO1xyXG5cdFx0XHRpZiAoIXNlcGFyYXRvcnMgfHwgIXNlcGFyYXRvcnMubGVuZ3RoIHx8ICFwYXJ0cyB8fCBwYXJ0cy5sZW5ndGggPT09IDApe1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgZGF0ZSBmb3JtYXQuXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB7c2VwYXJhdG9yczogc2VwYXJhdG9ycywgcGFydHM6IHBhcnRzfTtcclxuXHRcdH0sXHJcblx0XHRwYXJzZURhdGU6IGZ1bmN0aW9uKGRhdGUsIGZvcm1hdCwgbGFuZ3VhZ2UpIHtcclxuXHRcdFx0aWYgKGRhdGUgaW5zdGFuY2VvZiBEYXRlKSByZXR1cm4gZGF0ZTtcclxuXHRcdFx0aWYgKHR5cGVvZiBmb3JtYXQgPT09ICdzdHJpbmcnKVxyXG5cdFx0XHRcdGZvcm1hdCA9IERQR2xvYmFsLnBhcnNlRm9ybWF0KGZvcm1hdCk7XHJcblx0XHRcdGlmICgvXltcXC0rXVxcZCtbZG13eV0oW1xccyxdK1tcXC0rXVxcZCtbZG13eV0pKiQvLnRlc3QoZGF0ZSkpIHtcclxuXHRcdFx0XHR2YXIgcGFydF9yZSA9IC8oW1xcLStdXFxkKykoW2Rtd3ldKS8sXHJcblx0XHRcdFx0XHRwYXJ0cyA9IGRhdGUubWF0Y2goLyhbXFwtK11cXGQrKShbZG13eV0pL2cpLFxyXG5cdFx0XHRcdFx0cGFydCwgZGlyO1xyXG5cdFx0XHRcdGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG5cdFx0XHRcdGZvciAodmFyIGk9MDsgaTxwYXJ0cy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0cGFydCA9IHBhcnRfcmUuZXhlYyhwYXJ0c1tpXSk7XHJcblx0XHRcdFx0XHRkaXIgPSBwYXJzZUludChwYXJ0WzFdKTtcclxuXHRcdFx0XHRcdHN3aXRjaChwYXJ0WzJdKXtcclxuXHRcdFx0XHRcdFx0Y2FzZSAnZCc6XHJcblx0XHRcdFx0XHRcdFx0ZGF0ZS5zZXRVVENEYXRlKGRhdGUuZ2V0VVRDRGF0ZSgpICsgZGlyKTtcclxuXHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0Y2FzZSAnbSc6XHJcblx0XHRcdFx0XHRcdFx0ZGF0ZSA9IERhdGVwaWNrZXIucHJvdG90eXBlLm1vdmVNb250aC5jYWxsKERhdGVwaWNrZXIucHJvdG90eXBlLCBkYXRlLCBkaXIpO1xyXG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRjYXNlICd3JzpcclxuXHRcdFx0XHRcdFx0XHRkYXRlLnNldFVUQ0RhdGUoZGF0ZS5nZXRVVENEYXRlKCkgKyBkaXIgKiA3KTtcclxuXHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0Y2FzZSAneSc6XHJcblx0XHRcdFx0XHRcdFx0ZGF0ZSA9IERhdGVwaWNrZXIucHJvdG90eXBlLm1vdmVZZWFyLmNhbGwoRGF0ZXBpY2tlci5wcm90b3R5cGUsIGRhdGUsIGRpcik7XHJcblx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHJldHVybiBVVENEYXRlKGRhdGUuZ2V0VVRDRnVsbFllYXIoKSwgZGF0ZS5nZXRVVENNb250aCgpLCBkYXRlLmdldFVUQ0RhdGUoKSwgMCwgMCwgMCk7XHJcblx0XHRcdH1cclxuXHRcdFx0dmFyIHBhcnRzID0gZGF0ZSAmJiBkYXRlLm1hdGNoKHRoaXMubm9ucHVuY3R1YXRpb24pIHx8IFtdLFxyXG5cdFx0XHRcdGRhdGUgPSBuZXcgRGF0ZSgpLFxyXG5cdFx0XHRcdHBhcnNlZCA9IHt9LFxyXG5cdFx0XHRcdHNldHRlcnNfb3JkZXIgPSBbJ3l5eXknLCAneXknLCAnTScsICdNTScsICdtJywgJ21tJywgJ2QnLCAnZGQnXSxcclxuXHRcdFx0XHRzZXR0ZXJzX21hcCA9IHtcclxuXHRcdFx0XHRcdHl5eXk6IGZ1bmN0aW9uKGQsdil7IHJldHVybiBkLnNldFVUQ0Z1bGxZZWFyKHYpOyB9LFxyXG5cdFx0XHRcdFx0eXk6IGZ1bmN0aW9uKGQsdil7IHJldHVybiBkLnNldFVUQ0Z1bGxZZWFyKDIwMDArdik7IH0sXHJcblx0XHRcdFx0XHRtOiBmdW5jdGlvbihkLHYpe1xyXG5cdFx0XHRcdFx0XHR2IC09IDE7XHJcblx0XHRcdFx0XHRcdHdoaWxlICh2PDApIHYgKz0gMTI7XHJcblx0XHRcdFx0XHRcdHYgJT0gMTI7XHJcblx0XHRcdFx0XHRcdGQuc2V0VVRDTW9udGgodik7XHJcblx0XHRcdFx0XHRcdHdoaWxlIChkLmdldFVUQ01vbnRoKCkgIT0gdilcclxuXHRcdFx0XHRcdFx0XHRkLnNldFVUQ0RhdGUoZC5nZXRVVENEYXRlKCktMSk7XHJcblx0XHRcdFx0XHRcdHJldHVybiBkO1xyXG5cdFx0XHRcdFx0fSxcclxuXHRcdFx0XHRcdGQ6IGZ1bmN0aW9uKGQsdil7IHJldHVybiBkLnNldFVUQ0RhdGUodik7IH1cclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdHZhbCwgZmlsdGVyZWQsIHBhcnQ7XHJcblx0XHRcdHNldHRlcnNfbWFwWydNJ10gPSBzZXR0ZXJzX21hcFsnTU0nXSA9IHNldHRlcnNfbWFwWydtbSddID0gc2V0dGVyc19tYXBbJ20nXTtcclxuXHRcdFx0c2V0dGVyc19tYXBbJ2RkJ10gPSBzZXR0ZXJzX21hcFsnZCddO1xyXG5cdFx0XHRkYXRlID0gVVRDRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSwgZGF0ZS5nZXREYXRlKCksIDAsIDAsIDApO1xyXG5cdFx0XHR2YXIgZnBhcnRzID0gZm9ybWF0LnBhcnRzLnNsaWNlKCk7XHJcblx0XHRcdC8vIFJlbW92ZSBub29wIHBhcnRzXHJcblx0XHRcdGlmIChwYXJ0cy5sZW5ndGggIT0gZnBhcnRzLmxlbmd0aCkge1xyXG5cdFx0XHRcdGZwYXJ0cyA9ICQoZnBhcnRzKS5maWx0ZXIoZnVuY3Rpb24oaSxwKXtcclxuXHRcdFx0XHRcdHJldHVybiAkLmluQXJyYXkocCwgc2V0dGVyc19vcmRlcikgIT09IC0xO1xyXG5cdFx0XHRcdH0pLnRvQXJyYXkoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBQcm9jZXNzIHJlbWFpbmRlclxyXG5cdFx0XHRpZiAocGFydHMubGVuZ3RoID09IGZwYXJ0cy5sZW5ndGgpIHtcclxuXHRcdFx0XHRmb3IgKHZhciBpPTAsIGNudCA9IGZwYXJ0cy5sZW5ndGg7IGkgPCBjbnQ7IGkrKykge1xyXG5cdFx0XHRcdFx0dmFsID0gcGFyc2VJbnQocGFydHNbaV0sIDEwKTtcclxuXHRcdFx0XHRcdHBhcnQgPSBmcGFydHNbaV07XHJcblx0XHRcdFx0XHRpZiAoaXNOYU4odmFsKSkge1xyXG5cdFx0XHRcdFx0XHRzd2l0Y2gocGFydCkge1xyXG5cdFx0XHRcdFx0XHRcdGNhc2UgJ01NJzpcclxuXHRcdFx0XHRcdFx0XHRcdGZpbHRlcmVkID0gJChkYXRlc1tsYW5ndWFnZV0ubW9udGhzKS5maWx0ZXIoZnVuY3Rpb24oKXtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIG0gPSB0aGlzLnNsaWNlKDAsIHBhcnRzW2ldLmxlbmd0aCksXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0cCA9IHBhcnRzW2ldLnNsaWNlKDAsIG0ubGVuZ3RoKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIG0gPT0gcDtcclxuXHRcdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFsID0gJC5pbkFycmF5KGZpbHRlcmVkWzBdLCBkYXRlc1tsYW5ndWFnZV0ubW9udGhzKSArIDE7XHJcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0XHRjYXNlICdNJzpcclxuXHRcdFx0XHRcdFx0XHRcdGZpbHRlcmVkID0gJChkYXRlc1tsYW5ndWFnZV0ubW9udGhzU2hvcnQpLmZpbHRlcihmdW5jdGlvbigpe1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgbSA9IHRoaXMuc2xpY2UoMCwgcGFydHNbaV0ubGVuZ3RoKSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRwID0gcGFydHNbaV0uc2xpY2UoMCwgbS5sZW5ndGgpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gbSA9PSBwO1xyXG5cdFx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdFx0XHR2YWwgPSAkLmluQXJyYXkoZmlsdGVyZWRbMF0sIGRhdGVzW2xhbmd1YWdlXS5tb250aHNTaG9ydCkgKyAxO1xyXG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHBhcnNlZFtwYXJ0XSA9IHZhbDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Zm9yICh2YXIgaT0wLCBzOyBpPHNldHRlcnNfb3JkZXIubGVuZ3RoOyBpKyspe1xyXG5cdFx0XHRcdFx0cyA9IHNldHRlcnNfb3JkZXJbaV07XHJcblx0XHRcdFx0XHRpZiAocyBpbiBwYXJzZWQgJiYgIWlzTmFOKHBhcnNlZFtzXSkpXHJcblx0XHRcdFx0XHRcdHNldHRlcnNfbWFwW3NdKGRhdGUsIHBhcnNlZFtzXSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBkYXRlO1xyXG5cdFx0fSxcclxuXHRcdGZvcm1hdERhdGU6IGZ1bmN0aW9uKGRhdGUsIGZvcm1hdCwgbGFuZ3VhZ2Upe1xyXG5cdFx0XHRpZiAodHlwZW9mIGZvcm1hdCA9PT0gJ3N0cmluZycpXHJcblx0XHRcdFx0Zm9ybWF0ID0gRFBHbG9iYWwucGFyc2VGb3JtYXQoZm9ybWF0KTtcclxuXHRcdFx0dmFyIHZhbCA9IHtcclxuXHRcdFx0XHRkOiBkYXRlLmdldFVUQ0RhdGUoKSxcclxuXHRcdFx0XHREOiBkYXRlc1tsYW5ndWFnZV0uZGF5c1Nob3J0W2RhdGUuZ2V0VVRDRGF5KCldLFxyXG5cdFx0XHRcdEREOiBkYXRlc1tsYW5ndWFnZV0uZGF5c1tkYXRlLmdldFVUQ0RheSgpXSxcclxuXHRcdFx0XHRtOiBkYXRlLmdldFVUQ01vbnRoKCkgKyAxLFxyXG5cdFx0XHRcdE06IGRhdGVzW2xhbmd1YWdlXS5tb250aHNTaG9ydFtkYXRlLmdldFVUQ01vbnRoKCldLFxyXG5cdFx0XHRcdE1NOiBkYXRlc1tsYW5ndWFnZV0ubW9udGhzW2RhdGUuZ2V0VVRDTW9udGgoKV0sXHJcblx0XHRcdFx0eXk6IGRhdGUuZ2V0VVRDRnVsbFllYXIoKS50b1N0cmluZygpLnN1YnN0cmluZygyKSxcclxuXHRcdFx0XHR5eXl5OiBkYXRlLmdldFVUQ0Z1bGxZZWFyKClcclxuXHRcdFx0fTtcclxuXHRcdFx0dmFsLmRkID0gKHZhbC5kIDwgMTAgPyAnMCcgOiAnJykgKyB2YWwuZDtcclxuXHRcdFx0dmFsLm1tID0gKHZhbC5tIDwgMTAgPyAnMCcgOiAnJykgKyB2YWwubTtcclxuXHRcdFx0dmFyIGRhdGUgPSBbXSxcclxuXHRcdFx0XHRzZXBzID0gJC5leHRlbmQoW10sIGZvcm1hdC5zZXBhcmF0b3JzKTtcclxuXHRcdFx0Zm9yICh2YXIgaT0wLCBjbnQgPSBmb3JtYXQucGFydHMubGVuZ3RoOyBpIDw9IGNudDsgaSsrKSB7XHJcblx0XHRcdFx0aWYgKHNlcHMubGVuZ3RoKVxyXG5cdFx0XHRcdFx0ZGF0ZS5wdXNoKHNlcHMuc2hpZnQoKSk7XHJcblx0XHRcdFx0ZGF0ZS5wdXNoKHZhbFtmb3JtYXQucGFydHNbaV1dKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gZGF0ZS5qb2luKCcnKTtcclxuXHRcdH0sXHJcblx0XHRoZWFkVGVtcGxhdGU6ICc8dGhlYWQ+JytcclxuXHRcdFx0XHRcdFx0XHQnPHRyPicrXHJcblx0XHRcdFx0XHRcdFx0XHQnPHRoIGNsYXNzPVwicHJldlwiPjxpIGNsYXNzPVwiaWNvbi1hcnJvdy1sZWZ0XCIvPjwvdGg+JytcclxuXHRcdFx0XHRcdFx0XHRcdCc8dGggY29sc3Bhbj1cIjVcIiBjbGFzcz1cImRhdGVwaWNrZXItc3dpdGNoXCI+PC90aD4nK1xyXG5cdFx0XHRcdFx0XHRcdFx0Jzx0aCBjbGFzcz1cIm5leHRcIj48aSBjbGFzcz1cImljb24tYXJyb3ctcmlnaHRcIi8+PC90aD4nK1xyXG5cdFx0XHRcdFx0XHRcdCc8L3RyPicrXHJcblx0XHRcdFx0XHRcdCc8L3RoZWFkPicsXHJcblx0XHRjb250VGVtcGxhdGU6ICc8dGJvZHk+PHRyPjx0ZCBjb2xzcGFuPVwiN1wiPjwvdGQ+PC90cj48L3Rib2R5PicsXHJcblx0XHRmb290VGVtcGxhdGU6ICc8dGZvb3Q+PHRyPjx0aCBjb2xzcGFuPVwiN1wiIGNsYXNzPVwidG9kYXlcIj48L3RoPjwvdHI+PHRyPjx0aCBjb2xzcGFuPVwiN1wiIGNsYXNzPVwiY2xlYXJcIj48L3RoPjwvdHI+PC90Zm9vdD4nXHJcblx0fTtcclxuXHREUEdsb2JhbC50ZW1wbGF0ZSA9ICc8ZGl2IGNsYXNzPVwiZGF0ZXBpY2tlclwiPicrXHJcblx0XHRcdFx0XHRcdFx0JzxkaXYgY2xhc3M9XCJkYXRlcGlja2VyLWRheXNcIj4nK1xyXG5cdFx0XHRcdFx0XHRcdFx0Jzx0YWJsZSBjbGFzcz1cIiB0YWJsZS1jb25kZW5zZWRcIj4nK1xyXG5cdFx0XHRcdFx0XHRcdFx0XHREUEdsb2JhbC5oZWFkVGVtcGxhdGUrXHJcblx0XHRcdFx0XHRcdFx0XHRcdCc8dGJvZHk+PC90Ym9keT4nK1xyXG5cdFx0XHRcdFx0XHRcdFx0XHREUEdsb2JhbC5mb290VGVtcGxhdGUrXHJcblx0XHRcdFx0XHRcdFx0XHQnPC90YWJsZT4nK1xyXG5cdFx0XHRcdFx0XHRcdCc8L2Rpdj4nK1xyXG5cdFx0XHRcdFx0XHRcdCc8ZGl2IGNsYXNzPVwiZGF0ZXBpY2tlci1tb250aHNcIj4nK1xyXG5cdFx0XHRcdFx0XHRcdFx0Jzx0YWJsZSBjbGFzcz1cInRhYmxlLWNvbmRlbnNlZFwiPicrXHJcblx0XHRcdFx0XHRcdFx0XHRcdERQR2xvYmFsLmhlYWRUZW1wbGF0ZStcclxuXHRcdFx0XHRcdFx0XHRcdFx0RFBHbG9iYWwuY29udFRlbXBsYXRlK1xyXG5cdFx0XHRcdFx0XHRcdFx0XHREUEdsb2JhbC5mb290VGVtcGxhdGUrXHJcblx0XHRcdFx0XHRcdFx0XHQnPC90YWJsZT4nK1xyXG5cdFx0XHRcdFx0XHRcdCc8L2Rpdj4nK1xyXG5cdFx0XHRcdFx0XHRcdCc8ZGl2IGNsYXNzPVwiZGF0ZXBpY2tlci15ZWFyc1wiPicrXHJcblx0XHRcdFx0XHRcdFx0XHQnPHRhYmxlIGNsYXNzPVwidGFibGUtY29uZGVuc2VkXCI+JytcclxuXHRcdFx0XHRcdFx0XHRcdFx0RFBHbG9iYWwuaGVhZFRlbXBsYXRlK1xyXG5cdFx0XHRcdFx0XHRcdFx0XHREUEdsb2JhbC5jb250VGVtcGxhdGUrXHJcblx0XHRcdFx0XHRcdFx0XHRcdERQR2xvYmFsLmZvb3RUZW1wbGF0ZStcclxuXHRcdFx0XHRcdFx0XHRcdCc8L3RhYmxlPicrXHJcblx0XHRcdFx0XHRcdFx0JzwvZGl2PicrXHJcblx0XHRcdFx0XHRcdCc8L2Rpdj4nO1xyXG5cclxuXHQkLmZuLmRhdGVwaWNrZXIuRFBHbG9iYWwgPSBEUEdsb2JhbDtcclxuXHJcblxyXG5cdC8qIERBVEVQSUNLRVIgTk8gQ09ORkxJQ1RcclxuXHQqID09PT09PT09PT09PT09PT09PT0gKi9cclxuXHJcblx0JC5mbi5kYXRlcGlja2VyLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpe1xyXG5cdFx0JC5mbi5kYXRlcGlja2VyID0gb2xkO1xyXG5cdFx0cmV0dXJuIHRoaXM7XHJcblx0fTtcclxuXHJcblxyXG5cdC8qIERBVEVQSUNLRVIgREFUQS1BUElcclxuXHQqID09PT09PT09PT09PT09PT09PSAqL1xyXG5cclxuXHQkKGRvY3VtZW50KS5vbihcclxuXHRcdCdmb2N1cy5kYXRlcGlja2VyLmRhdGEtYXBpIGNsaWNrLmRhdGVwaWNrZXIuZGF0YS1hcGknLFxyXG5cdFx0J1tkYXRhLXByb3ZpZGU9XCJkYXRlcGlja2VyXCJdJyxcclxuXHRcdGZ1bmN0aW9uKGUpe1xyXG5cdFx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpO1xyXG5cdFx0XHRpZiAoJHRoaXMuZGF0YSgnZGF0ZXBpY2tlcicpKSByZXR1cm47XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0Ly8gY29tcG9uZW50IGNsaWNrIHJlcXVpcmVzIHVzIHRvIGV4cGxpY2l0bHkgc2hvdyBpdFxyXG5cdFx0XHRkYXRlcGlja2VyLmNhbGwoJHRoaXMsICdzaG93Jyk7XHJcblx0XHR9XHJcblx0KTtcclxuXHQkKGZ1bmN0aW9uKCl7XHJcblx0XHQvLyQoJ1tkYXRhLXByb3ZpZGU9XCJkYXRlcGlja2VyLWlubGluZVwiXScpLmRhdGVwaWNrZXIoKTtcclxuICAgICAgICAvL3ZpdDogY2hhbmdlZCB0byBzdXBwb3J0IG5vQ29uZmxpY3QoKVxyXG4gICAgICAgIGRhdGVwaWNrZXIuY2FsbCgkKCdbZGF0YS1wcm92aWRlPVwiZGF0ZXBpY2tlci1pbmxpbmVcIl0nKSk7XHJcblx0fSk7XHJcblxyXG59KCB3aW5kb3cualF1ZXJ5ICkpO1xyXG5cclxuLyoqXHJcbkJvb3RzdHJhcC1kYXRlcGlja2VyLiAgXHJcbkRlc2NyaXB0aW9uIGFuZCBleGFtcGxlczogaHR0cHM6Ly9naXRodWIuY29tL2V0ZXJuaWNvZGUvYm9vdHN0cmFwLWRhdGVwaWNrZXIuICBcclxuRm9yICoqaTE4bioqIHlvdSBzaG91bGQgaW5jbHVkZSBqcyBmaWxlIGZyb20gaGVyZTogaHR0cHM6Ly9naXRodWIuY29tL2V0ZXJuaWNvZGUvYm9vdHN0cmFwLWRhdGVwaWNrZXIvdHJlZS9tYXN0ZXIvanMvbG9jYWxlc1xyXG5hbmQgc2V0IGBsYW5ndWFnZWAgb3B0aW9uLiAgXHJcblNpbmNlIDEuNC4wIGRhdGUgaGFzIGRpZmZlcmVudCBhcHBlYXJhbmNlIGluICoqcG9wdXAqKiBhbmQgKippbmxpbmUqKiBtb2Rlcy4gXHJcblxyXG5AY2xhc3MgZGF0ZVxyXG5AZXh0ZW5kcyBhYnN0cmFjdGlucHV0XHJcbkBmaW5hbFxyXG5AZXhhbXBsZVxyXG48YSBocmVmPVwiI1wiIGlkPVwiZG9iXCIgZGF0YS10eXBlPVwiZGF0ZVwiIGRhdGEtcGs9XCIxXCIgZGF0YS11cmw9XCIvcG9zdFwiIGRhdGEtdGl0bGU9XCJTZWxlY3QgZGF0ZVwiPjE1LzA1LzE5ODQ8L2E+XHJcbjxzY3JpcHQ+XHJcbiQoZnVuY3Rpb24oKXtcclxuICAgICQoJyNkb2InKS5lZGl0YWJsZSh7XHJcbiAgICAgICAgZm9ybWF0OiAneXl5eS1tbS1kZCcsICAgIFxyXG4gICAgICAgIHZpZXdmb3JtYXQ6ICdkZC9tbS95eXl5JywgICAgXHJcbiAgICAgICAgZGF0ZXBpY2tlcjoge1xyXG4gICAgICAgICAgICAgICAgd2Vla1N0YXJ0OiAxXHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59KTtcclxuPC9zY3JpcHQ+XHJcbioqL1xyXG4oZnVuY3Rpb24gKCQpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgXHJcbiAgICAvL3N0b3JlIGJvb3RzdHJhcC1kYXRlcGlja2VyIGFzIGJkYXRlaWNrZXIgdG8gZXhjbHVkZSBjb25mbGljdCB3aXRoIGpRdWVyeSBVSSBvbmVcclxuICAgICQuZm4uYmRhdGVwaWNrZXIgPSAkLmZuLmRhdGVwaWNrZXIubm9Db25mbGljdCgpO1xyXG4gICAgaWYoISQuZm4uZGF0ZXBpY2tlcikgeyAvL2lmIHRoZXJlIHdlcmUgbm8gb3RoZXIgZGF0ZXBpY2tlcnMsIGtlZXAgYWxzbyBvcmlnaW5hbCBuYW1lXHJcbiAgICAgICAgJC5mbi5kYXRlcGlja2VyID0gJC5mbi5iZGF0ZXBpY2tlcjsgICAgXHJcbiAgICB9ICAgIFxyXG4gICAgXHJcbiAgICB2YXIgRGF0ZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5pbml0KCdkYXRlJywgb3B0aW9ucywgRGF0ZS5kZWZhdWx0cyk7XHJcbiAgICAgICAgdGhpcy5pbml0UGlja2VyKG9wdGlvbnMsIERhdGUuZGVmYXVsdHMpO1xyXG4gICAgfTtcclxuXHJcbiAgICAkLmZuLmVkaXRhYmxldXRpbHMuaW5oZXJpdChEYXRlLCAkLmZuLmVkaXRhYmxldHlwZXMuYWJzdHJhY3RpbnB1dCk7ICAgIFxyXG4gICAgXHJcbiAgICAkLmV4dGVuZChEYXRlLnByb3RvdHlwZSwge1xyXG4gICAgICAgIGluaXRQaWNrZXI6IGZ1bmN0aW9uKG9wdGlvbnMsIGRlZmF1bHRzKSB7XHJcbiAgICAgICAgICAgIC8vJ2Zvcm1hdCcgaXMgc2V0IGRpcmVjdGx5IGZyb20gc2V0dGluZ3Mgb3IgZGF0YS0qIGF0dHJpYnV0ZXNcclxuXHJcbiAgICAgICAgICAgIC8vYnkgZGVmYXVsdCB2aWV3Zm9ybWF0IGVxdWFscyB0byBmb3JtYXRcclxuICAgICAgICAgICAgaWYoIXRoaXMub3B0aW9ucy52aWV3Zm9ybWF0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMudmlld2Zvcm1hdCA9IHRoaXMub3B0aW9ucy5mb3JtYXQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vdHJ5IHBhcnNlIGRhdGVwaWNrZXIgY29uZmlnIGRlZmluZWQgYXMganNvbiBzdHJpbmcgaW4gZGF0YS1kYXRlcGlja2VyXHJcbiAgICAgICAgICAgIG9wdGlvbnMuZGF0ZXBpY2tlciA9ICQuZm4uZWRpdGFibGV1dGlscy50cnlQYXJzZUpzb24ob3B0aW9ucy5kYXRlcGlja2VyLCB0cnVlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vb3ZlcnJpZGluZyBkYXRlcGlja2VyIGNvbmZpZyAoYXMgYnkgZGVmYXVsdCBqUXVlcnkgZXh0ZW5kKCkgaXMgbm90IHJlY3Vyc2l2ZSlcclxuICAgICAgICAgICAgLy9zaW5jZSAxLjQgZGF0ZXBpY2tlciBpbnRlcm5hbGx5IHVzZXMgdmlld2Zvcm1hdCBpbnN0ZWFkIG9mIGZvcm1hdC4gRm9ybWF0IGlzIGZvciBzdWJtaXQgb25seVxyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuZGF0ZXBpY2tlciA9ICQuZXh0ZW5kKHt9LCBkZWZhdWx0cy5kYXRlcGlja2VyLCBvcHRpb25zLmRhdGVwaWNrZXIsIHtcclxuICAgICAgICAgICAgICAgIGZvcm1hdDogdGhpcy5vcHRpb25zLnZpZXdmb3JtYXRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2xhbmd1YWdlXHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5kYXRlcGlja2VyLmxhbmd1YWdlID0gdGhpcy5vcHRpb25zLmRhdGVwaWNrZXIubGFuZ3VhZ2UgfHwgJ2VuJzsgXHJcblxyXG4gICAgICAgICAgICAvL3N0b3JlIERQZ2xvYmFsXHJcbiAgICAgICAgICAgIHRoaXMuZHBnID0gJC5mbi5iZGF0ZXBpY2tlci5EUEdsb2JhbDsgXHJcblxyXG4gICAgICAgICAgICAvL3N0b3JlIHBhcnNlZCBmb3JtYXRzXHJcbiAgICAgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0ID0gdGhpcy5kcGcucGFyc2VGb3JtYXQodGhpcy5vcHRpb25zLmZvcm1hdCk7XHJcbiAgICAgICAgICAgIHRoaXMucGFyc2VkVmlld0Zvcm1hdCA9IHRoaXMuZHBnLnBhcnNlRm9ybWF0KHRoaXMub3B0aW9ucy52aWV3Zm9ybWF0KTsgICAgICAgICAgICBcclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0aGlzLiRpbnB1dC5iZGF0ZXBpY2tlcih0aGlzLm9wdGlvbnMuZGF0ZXBpY2tlcik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL1wiY2xlYXJcIiBsaW5rXHJcbiAgICAgICAgICAgIGlmKHRoaXMub3B0aW9ucy5jbGVhcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kY2xlYXIgPSAkKCc8YSBocmVmPVwiI1wiPjwvYT4nKS5odG1sKHRoaXMub3B0aW9ucy5jbGVhcikuY2xpY2soJC5wcm94eShmdW5jdGlvbihlKXtcclxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICB9LCB0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuJHRwbC5wYXJlbnQoKS5hcHBlbmQoJCgnPGRpdiBjbGFzcz1cImVkaXRhYmxlLWNsZWFyXCI+JykuYXBwZW5kKHRoaXMuJGNsZWFyKSk7ICBcclxuICAgICAgICAgICAgfSAgICAgICAgICAgICAgICBcclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIHZhbHVlMmh0bWw6IGZ1bmN0aW9uKHZhbHVlLCBlbGVtZW50KSB7XHJcbiAgICAgICAgICAgdmFyIHRleHQgPSB2YWx1ZSA/IHRoaXMuZHBnLmZvcm1hdERhdGUodmFsdWUsIHRoaXMucGFyc2VkVmlld0Zvcm1hdCwgdGhpcy5vcHRpb25zLmRhdGVwaWNrZXIubGFuZ3VhZ2UpIDogJyc7XHJcbiAgICAgICAgICAgRGF0ZS5zdXBlcmNsYXNzLnZhbHVlMmh0bWwuY2FsbCh0aGlzLCB0ZXh0LCBlbGVtZW50KTsgXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgaHRtbDJ2YWx1ZTogZnVuY3Rpb24oaHRtbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZURhdGUoaHRtbCwgdGhpcy5wYXJzZWRWaWV3Rm9ybWF0KTtcclxuICAgICAgICB9LCAgIFxyXG5cclxuICAgICAgICB2YWx1ZTJzdHI6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA/IHRoaXMuZHBnLmZvcm1hdERhdGUodmFsdWUsIHRoaXMucGFyc2VkRm9ybWF0LCB0aGlzLm9wdGlvbnMuZGF0ZXBpY2tlci5sYW5ndWFnZSkgOiAnJztcclxuICAgICAgICB9LCBcclxuXHJcbiAgICAgICAgc3RyMnZhbHVlOiBmdW5jdGlvbihzdHIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VEYXRlKHN0ciwgdGhpcy5wYXJzZWRGb3JtYXQpO1xyXG4gICAgICAgIH0sIFxyXG5cclxuICAgICAgICB2YWx1ZTJzdWJtaXQ6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlMnN0cih2YWx1ZSk7XHJcbiAgICAgICAgfSwgICAgICAgICAgICAgICAgICAgIFxyXG5cclxuICAgICAgICB2YWx1ZTJpbnB1dDogZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQuYmRhdGVwaWNrZXIoJ3VwZGF0ZScsIHZhbHVlKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBpbnB1dDJ2YWx1ZTogZnVuY3Rpb24oKSB7IFxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kaW5wdXQuZGF0YSgnZGF0ZXBpY2tlcicpLmRhdGU7XHJcbiAgICAgICAgfSwgICAgICAgXHJcblxyXG4gICAgICAgIGFjdGl2YXRlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBjbGVhcjogIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB0aGlzLiRpbnB1dC5kYXRhKCdkYXRlcGlja2VyJykuZGF0ZSA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0LmZpbmQoJy5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIGlmKCF0aGlzLm9wdGlvbnMuc2hvd2J1dHRvbnMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0LmNsb3Nlc3QoJ2Zvcm0nKS5zdWJtaXQoKTsgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBhdXRvc3VibWl0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQub24oJ21vdXNldXAnLCAnLmRheScsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgICAgICAgICAgaWYoJChlLmN1cnJlbnRUYXJnZXQpLmlzKCcub2xkJykgfHwgJChlLmN1cnJlbnRUYXJnZXQpLmlzKCcubmV3JykpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgJGZvcm0gPSAkKHRoaXMpLmNsb3Nlc3QoJ2Zvcm0nKTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGZvcm0uc3VibWl0KCk7XHJcbiAgICAgICAgICAgICAgICB9LCAyMDApO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAvL2NoYW5nZWRhdGUgaXMgbm90IHN1aXRhYmxlIGFzIGl0IHRyaWdnZXJlZCB3aGVuIHNob3dpbmcgZGF0ZXBpY2tlci4gc2VlICMxNDlcclxuICAgICAgICAgICAvKlxyXG4gICAgICAgICAgIHRoaXMuJGlucHV0Lm9uKCdjaGFuZ2VEYXRlJywgZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgICAgICAgIHZhciAkZm9ybSA9ICQodGhpcykuY2xvc2VzdCgnZm9ybScpO1xyXG4gICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgJGZvcm0uc3VibWl0KCk7XHJcbiAgICAgICAgICAgICAgIH0sIDIwMCk7XHJcbiAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgKi9cclxuICAgICAgIH0sXHJcbiAgICAgICBcclxuICAgICAgIC8qXHJcbiAgICAgICAgRm9yIGluY29ycmVjdCBkYXRlIGJvb3RzdHJhcC1kYXRlcGlja2VyIHJldHVybnMgY3VycmVudCBkYXRlIHRoYXQgaXMgbm90IHN1aXRhYmxlXHJcbiAgICAgICAgZm9yIGRhdGVmaWVsZC5cclxuICAgICAgICBUaGlzIGZ1bmN0aW9uIHJldHVybnMgbnVsbCBmb3IgaW5jb3JyZWN0IGRhdGUuICBcclxuICAgICAgICovXHJcbiAgICAgICBwYXJzZURhdGU6IGZ1bmN0aW9uKHN0ciwgZm9ybWF0KSB7XHJcbiAgICAgICAgICAgdmFyIGRhdGUgPSBudWxsLCBmb3JtYXR0ZWRCYWNrO1xyXG4gICAgICAgICAgIGlmKHN0cikge1xyXG4gICAgICAgICAgICAgICBkYXRlID0gdGhpcy5kcGcucGFyc2VEYXRlKHN0ciwgZm9ybWF0LCB0aGlzLm9wdGlvbnMuZGF0ZXBpY2tlci5sYW5ndWFnZSk7XHJcbiAgICAgICAgICAgICAgIGlmKHR5cGVvZiBzdHIgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRCYWNrID0gdGhpcy5kcGcuZm9ybWF0RGF0ZShkYXRlLCBmb3JtYXQsIHRoaXMub3B0aW9ucy5kYXRlcGlja2VyLmxhbmd1YWdlKTtcclxuICAgICAgICAgICAgICAgICAgIGlmKHN0ciAhPT0gZm9ybWF0dGVkQmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIGRhdGUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgICAgIHJldHVybiBkYXRlO1xyXG4gICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxuICAgIERhdGUuZGVmYXVsdHMgPSAkLmV4dGVuZCh7fSwgJC5mbi5lZGl0YWJsZXR5cGVzLmFic3RyYWN0aW5wdXQuZGVmYXVsdHMsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICBAcHJvcGVydHkgdHBsIFxyXG4gICAgICAgIEBkZWZhdWx0IDxkaXY+PC9kaXY+XHJcbiAgICAgICAgKiovICAgICAgICAgXHJcbiAgICAgICAgdHBsOic8ZGl2IGNsYXNzPVwiZWRpdGFibGUtZGF0ZSB3ZWxsXCI+PC9kaXY+JyxcclxuICAgICAgICAvKipcclxuICAgICAgICBAcHJvcGVydHkgaW5wdXRjbGFzcyBcclxuICAgICAgICBAZGVmYXVsdCBudWxsXHJcbiAgICAgICAgKiovXHJcbiAgICAgICAgaW5wdXRjbGFzczogbnVsbCxcclxuICAgICAgICAvKipcclxuICAgICAgICBGb3JtYXQgdXNlZCBmb3Igc2VuZGluZyB2YWx1ZSB0byBzZXJ2ZXIuIEFsc28gYXBwbGllZCB3aGVuIGNvbnZlcnRpbmcgZGF0ZSBmcm9tIDxjb2RlPmRhdGEtdmFsdWU8L2NvZGU+IGF0dHJpYnV0ZS48YnI+XHJcbiAgICAgICAgUG9zc2libGUgdG9rZW5zIGFyZTogPGNvZGU+ZCwgZGQsIG0sIG1tLCB5eSwgeXl5eTwvY29kZT4gIFxyXG5cclxuICAgICAgICBAcHJvcGVydHkgZm9ybWF0IFxyXG4gICAgICAgIEB0eXBlIHN0cmluZ1xyXG4gICAgICAgIEBkZWZhdWx0IHl5eXktbW0tZGRcclxuICAgICAgICAqKi9cclxuICAgICAgICBmb3JtYXQ6J3l5eXktbW0tZGQnLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEZvcm1hdCB1c2VkIGZvciBkaXNwbGF5aW5nIGRhdGUuIEFsc28gYXBwbGllZCB3aGVuIGNvbnZlcnRpbmcgZGF0ZSBmcm9tIGVsZW1lbnQncyB0ZXh0IG9uIGluaXQuICAgXHJcbiAgICAgICAgSWYgbm90IHNwZWNpZmllZCBlcXVhbHMgdG8gPGNvZGU+Zm9ybWF0PC9jb2RlPlxyXG5cclxuICAgICAgICBAcHJvcGVydHkgdmlld2Zvcm1hdCBcclxuICAgICAgICBAdHlwZSBzdHJpbmdcclxuICAgICAgICBAZGVmYXVsdCBudWxsXHJcbiAgICAgICAgKiovXHJcbiAgICAgICAgdmlld2Zvcm1hdDogbnVsbCxcclxuICAgICAgICAvKipcclxuICAgICAgICBDb25maWd1cmF0aW9uIG9mIGRhdGVwaWNrZXIuXHJcbiAgICAgICAgRnVsbCBsaXN0IG9mIG9wdGlvbnM6IGh0dHA6Ly9ib290c3RyYXAtZGF0ZXBpY2tlci5yZWFkdGhlZG9jcy5vcmcvZW4vbGF0ZXN0L29wdGlvbnMuaHRtbFxyXG5cclxuICAgICAgICBAcHJvcGVydHkgZGF0ZXBpY2tlciBcclxuICAgICAgICBAdHlwZSBvYmplY3RcclxuICAgICAgICBAZGVmYXVsdCB7XHJcbiAgICAgICAgICAgIHdlZWtTdGFydDogMCxcclxuICAgICAgICAgICAgc3RhcnRWaWV3OiAwLFxyXG4gICAgICAgICAgICBtaW5WaWV3TW9kZTogMCxcclxuICAgICAgICAgICAgYXV0b2Nsb3NlOiBmYWxzZVxyXG4gICAgICAgIH1cclxuICAgICAgICAqKi9cclxuICAgICAgICBkYXRlcGlja2VyOntcclxuICAgICAgICAgICAgd2Vla1N0YXJ0OiAwLFxyXG4gICAgICAgICAgICBzdGFydFZpZXc6IDAsXHJcbiAgICAgICAgICAgIG1pblZpZXdNb2RlOiAwLFxyXG4gICAgICAgICAgICBhdXRvY2xvc2U6IGZhbHNlXHJcbiAgICAgICAgfSxcclxuICAgICAgICAvKipcclxuICAgICAgICBUZXh0IHNob3duIGFzIGNsZWFyIGRhdGUgYnV0dG9uLiBcclxuICAgICAgICBJZiA8Y29kZT5mYWxzZTwvY29kZT4gY2xlYXIgYnV0dG9uIHdpbGwgbm90IGJlIHJlbmRlcmVkLlxyXG5cclxuICAgICAgICBAcHJvcGVydHkgY2xlYXIgXHJcbiAgICAgICAgQHR5cGUgYm9vbGVhbnxzdHJpbmdcclxuICAgICAgICBAZGVmYXVsdCAneCBjbGVhcidcclxuICAgICAgICAqKi9cclxuICAgICAgICBjbGVhcjogJyZ0aW1lczsgY2xlYXInXHJcbiAgICB9KTtcclxuXHJcbiAgICAkLmZuLmVkaXRhYmxldHlwZXMuZGF0ZSA9IERhdGU7XHJcblxyXG59KHdpbmRvdy5qUXVlcnkpKTtcclxuXHJcbi8qKlxyXG5Cb290c3RyYXAgZGF0ZWZpZWxkIGlucHV0IC0gbW9kaWZpY2F0aW9uIGZvciBpbmxpbmUgbW9kZS5cclxuU2hvd3Mgbm9ybWFsIDxpbnB1dCB0eXBlPVwidGV4dFwiPiBhbmQgYmluZHMgcG9wdXAgZGF0ZXBpY2tlci4gIFxyXG5BdXRvbWF0aWNhbGx5IHNob3duIGluIGlubGluZSBtb2RlLlxyXG5cclxuQGNsYXNzIGRhdGVmaWVsZFxyXG5AZXh0ZW5kcyBkYXRlXHJcblxyXG5Ac2luY2UgMS40LjBcclxuKiovXHJcbihmdW5jdGlvbiAoJCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBcclxuICAgIHZhciBEYXRlRmllbGQgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgICAgIHRoaXMuaW5pdCgnZGF0ZWZpZWxkJywgb3B0aW9ucywgRGF0ZUZpZWxkLmRlZmF1bHRzKTtcclxuICAgICAgICB0aGlzLmluaXRQaWNrZXIob3B0aW9ucywgRGF0ZUZpZWxkLmRlZmF1bHRzKTtcclxuICAgIH07XHJcblxyXG4gICAgJC5mbi5lZGl0YWJsZXV0aWxzLmluaGVyaXQoRGF0ZUZpZWxkLCAkLmZuLmVkaXRhYmxldHlwZXMuZGF0ZSk7ICAgIFxyXG4gICAgXHJcbiAgICAkLmV4dGVuZChEYXRlRmllbGQucHJvdG90eXBlLCB7XHJcbiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0ID0gdGhpcy4kdHBsLmZpbmQoJ2lucHV0Jyk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2xhc3MoKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRBdHRyKCdwbGFjZWhvbGRlcicpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8vYm9vdHN0cmFwLWRhdGVwaWNrZXIgaXMgc2V0IGBiZGF0ZWlja2VyYCB0byBleGNsdWRlIGNvbmZsaWN0IHdpdGggalF1ZXJ5IFVJIG9uZS4gKGluIGRhdGUuanMpICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy4kdHBsLmJkYXRlcGlja2VyKHRoaXMub3B0aW9ucy5kYXRlcGlja2VyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vbmVlZCB0byBkaXNhYmxlIG9yaWdpbmFsIGV2ZW50IGhhbmRsZXJzXHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0Lm9mZignZm9jdXMga2V5ZG93bicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy91cGRhdGUgdmFsdWUgb2YgZGF0ZXBpY2tlclxyXG4gICAgICAgICAgICB0aGlzLiRpbnB1dC5rZXl1cCgkLnByb3h5KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgIHRoaXMuJHRwbC5yZW1vdmVEYXRhKCdkYXRlJyk7XHJcbiAgICAgICAgICAgICAgIHRoaXMuJHRwbC5iZGF0ZXBpY2tlcigndXBkYXRlJyk7XHJcbiAgICAgICAgICAgIH0sIHRoaXMpKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfSwgICBcclxuICAgICAgICBcclxuICAgICAgIHZhbHVlMmlucHV0OiBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICAgIHRoaXMuJGlucHV0LnZhbCh2YWx1ZSA/IHRoaXMuZHBnLmZvcm1hdERhdGUodmFsdWUsIHRoaXMucGFyc2VkVmlld0Zvcm1hdCwgdGhpcy5vcHRpb25zLmRhdGVwaWNrZXIubGFuZ3VhZ2UpIDogJycpO1xyXG4gICAgICAgICAgIHRoaXMuJHRwbC5iZGF0ZXBpY2tlcigndXBkYXRlJyk7XHJcbiAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgaW5wdXQydmFsdWU6IGZ1bmN0aW9uKCkgeyBcclxuICAgICAgICAgICByZXR1cm4gdGhpcy5odG1sMnZhbHVlKHRoaXMuJGlucHV0LnZhbCgpKTtcclxuICAgICAgIH0sICAgICAgICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgIGFjdGl2YXRlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAkLmZuLmVkaXRhYmxldHlwZXMudGV4dC5wcm90b3R5cGUuYWN0aXZhdGUuY2FsbCh0aGlzKTtcclxuICAgICAgIH0sXHJcbiAgICAgICBcclxuICAgICAgIGF1dG9zdWJtaXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAvL3Jlc2V0IGF1dG9zdWJtaXQgdG8gZW1wdHkgIFxyXG4gICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIERhdGVGaWVsZC5kZWZhdWx0cyA9ICQuZXh0ZW5kKHt9LCAkLmZuLmVkaXRhYmxldHlwZXMuZGF0ZS5kZWZhdWx0cywge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEBwcm9wZXJ0eSB0cGwgXHJcbiAgICAgICAgKiovICAgICAgICAgXHJcbiAgICAgICAgdHBsOic8ZGl2IGNsYXNzPVwiaW5wdXQtYXBwZW5kIGRhdGVcIj48aW5wdXQgdHlwZT1cInRleHRcIi8+PHNwYW4gY2xhc3M9XCJhZGQtb25cIj48aSBjbGFzcz1cImljb24tdGhcIj48L2k+PC9zcGFuPjwvZGl2PicsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgQHByb3BlcnR5IGlucHV0Y2xhc3MgXHJcbiAgICAgICAgQGRlZmF1bHQgJ2lucHV0LXNtYWxsJ1xyXG4gICAgICAgICoqLyAgICAgICAgIFxyXG4gICAgICAgIGlucHV0Y2xhc3M6ICdpbnB1dC1zbWFsbCcsXHJcbiAgICAgICAgXHJcbiAgICAgICAgLyogZGF0ZXBpY2tlciBjb25maWcgKi9cclxuICAgICAgICBkYXRlcGlja2VyOiB7XHJcbiAgICAgICAgICAgIHdlZWtTdGFydDogMCxcclxuICAgICAgICAgICAgc3RhcnRWaWV3OiAwLFxyXG4gICAgICAgICAgICBtaW5WaWV3TW9kZTogMCxcclxuICAgICAgICAgICAgYXV0b2Nsb3NlOiB0cnVlXHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgICQuZm4uZWRpdGFibGV0eXBlcy5kYXRlZmllbGQgPSBEYXRlRmllbGQ7XHJcblxyXG59KHdpbmRvdy5qUXVlcnkpKTtcclxuLyoqXHJcbkJvb3RzdHJhcC1kYXRldGltZXBpY2tlci4gIFxyXG5CYXNlZCBvbiBbc21hbG90IGJvb3RzdHJhcC1kYXRldGltZXBpY2tlciBwbHVnaW5dKGh0dHBzOi8vZ2l0aHViLmNvbS9zbWFsb3QvYm9vdHN0cmFwLWRhdGV0aW1lcGlja2VyKS4gXHJcbkJlZm9yZSB1c2FnZSB5b3Ugc2hvdWxkIG1hbnVhbGx5IGluY2x1ZGUgZGVwZW5kZW50IGpzIGFuZCBjc3M6XHJcblxyXG4gICAgPGxpbmsgaHJlZj1cImNzcy9kYXRldGltZXBpY2tlci5jc3NcIiByZWw9XCJzdHlsZXNoZWV0XCIgdHlwZT1cInRleHQvY3NzXCI+PC9saW5rPiBcclxuICAgIDxzY3JpcHQgc3JjPVwianMvYm9vdHN0cmFwLWRhdGV0aW1lcGlja2VyLmpzXCI+PC9zY3JpcHQ+XHJcblxyXG5Gb3IgKippMThuKiogeW91IHNob3VsZCBpbmNsdWRlIGpzIGZpbGUgZnJvbSBoZXJlOiBodHRwczovL2dpdGh1Yi5jb20vc21hbG90L2Jvb3RzdHJhcC1kYXRldGltZXBpY2tlci90cmVlL21hc3Rlci9qcy9sb2NhbGVzXHJcbmFuZCBzZXQgYGxhbmd1YWdlYCBvcHRpb24uICBcclxuXHJcbkBjbGFzcyBkYXRldGltZVxyXG5AZXh0ZW5kcyBhYnN0cmFjdGlucHV0XHJcbkBmaW5hbFxyXG5Ac2luY2UgMS40LjRcclxuQGV4YW1wbGVcclxuPGEgaHJlZj1cIiNcIiBpZD1cImxhc3Rfc2VlblwiIGRhdGEtdHlwZT1cImRhdGV0aW1lXCIgZGF0YS1waz1cIjFcIiBkYXRhLXVybD1cIi9wb3N0XCIgdGl0bGU9XCJTZWxlY3QgZGF0ZSAmIHRpbWVcIj4xNS8wMy8yMDEzIDEyOjQ1PC9hPlxyXG48c2NyaXB0PlxyXG4kKGZ1bmN0aW9uKCl7XHJcbiAgICAkKCcjbGFzdF9zZWVuJykuZWRpdGFibGUoe1xyXG4gICAgICAgIGZvcm1hdDogJ3l5eXktbW0tZGQgaGg6aWknLCAgICBcclxuICAgICAgICB2aWV3Zm9ybWF0OiAnZGQvbW0veXl5eSBoaDppaScsICAgIFxyXG4gICAgICAgIGRhdGV0aW1lcGlja2VyOiB7XHJcbiAgICAgICAgICAgICAgICB3ZWVrU3RhcnQ6IDFcclxuICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pO1xyXG48L3NjcmlwdD5cclxuKiovXHJcbihmdW5jdGlvbiAoJCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIERhdGVUaW1lID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLmluaXQoJ2RhdGV0aW1lJywgb3B0aW9ucywgRGF0ZVRpbWUuZGVmYXVsdHMpO1xyXG4gICAgICAgIHRoaXMuaW5pdFBpY2tlcihvcHRpb25zLCBEYXRlVGltZS5kZWZhdWx0cyk7XHJcbiAgICB9O1xyXG5cclxuICAgICQuZm4uZWRpdGFibGV1dGlscy5pbmhlcml0KERhdGVUaW1lLCAkLmZuLmVkaXRhYmxldHlwZXMuYWJzdHJhY3RpbnB1dCk7XHJcblxyXG4gICAgJC5leHRlbmQoRGF0ZVRpbWUucHJvdG90eXBlLCB7XHJcbiAgICAgICAgaW5pdFBpY2tlcjogZnVuY3Rpb24ob3B0aW9ucywgZGVmYXVsdHMpIHtcclxuICAgICAgICAgICAgLy8nZm9ybWF0JyBpcyBzZXQgZGlyZWN0bHkgZnJvbSBzZXR0aW5ncyBvciBkYXRhLSogYXR0cmlidXRlc1xyXG5cclxuICAgICAgICAgICAgLy9ieSBkZWZhdWx0IHZpZXdmb3JtYXQgZXF1YWxzIHRvIGZvcm1hdFxyXG4gICAgICAgICAgICBpZighdGhpcy5vcHRpb25zLnZpZXdmb3JtYXQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy52aWV3Zm9ybWF0ID0gdGhpcy5vcHRpb25zLmZvcm1hdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy90cnkgcGFyc2UgZGF0ZXRpbWVwaWNrZXIgY29uZmlnIGRlZmluZWQgYXMganNvbiBzdHJpbmcgaW4gZGF0YS1kYXRldGltZXBpY2tlclxyXG4gICAgICAgICAgICBvcHRpb25zLmRhdGV0aW1lcGlja2VyID0gJC5mbi5lZGl0YWJsZXV0aWxzLnRyeVBhcnNlSnNvbihvcHRpb25zLmRhdGV0aW1lcGlja2VyLCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIC8vb3ZlcnJpZGluZyBkYXRldGltZXBpY2tlciBjb25maWcgKGFzIGJ5IGRlZmF1bHQgalF1ZXJ5IGV4dGVuZCgpIGlzIG5vdCByZWN1cnNpdmUpXHJcbiAgICAgICAgICAgIC8vc2luY2UgMS40IGRhdGV0aW1lcGlja2VyIGludGVybmFsbHkgdXNlcyB2aWV3Zm9ybWF0IGluc3RlYWQgb2YgZm9ybWF0LiBGb3JtYXQgaXMgZm9yIHN1Ym1pdCBvbmx5XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5kYXRldGltZXBpY2tlciA9ICQuZXh0ZW5kKHt9LCBkZWZhdWx0cy5kYXRldGltZXBpY2tlciwgb3B0aW9ucy5kYXRldGltZXBpY2tlciwge1xyXG4gICAgICAgICAgICAgICAgZm9ybWF0OiB0aGlzLm9wdGlvbnMudmlld2Zvcm1hdFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vbGFuZ3VhZ2VcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmRhdGV0aW1lcGlja2VyLmxhbmd1YWdlID0gdGhpcy5vcHRpb25zLmRhdGV0aW1lcGlja2VyLmxhbmd1YWdlIHx8ICdlbic7IFxyXG5cclxuICAgICAgICAgICAgLy9zdG9yZSBEUGdsb2JhbFxyXG4gICAgICAgICAgICB0aGlzLmRwZyA9ICQuZm4uZGF0ZXRpbWVwaWNrZXIuRFBHbG9iYWw7IFxyXG5cclxuICAgICAgICAgICAgLy9zdG9yZSBwYXJzZWQgZm9ybWF0c1xyXG4gICAgICAgICAgICB0aGlzLnBhcnNlZEZvcm1hdCA9IHRoaXMuZHBnLnBhcnNlRm9ybWF0KHRoaXMub3B0aW9ucy5mb3JtYXQsIHRoaXMub3B0aW9ucy5mb3JtYXRUeXBlKTtcclxuICAgICAgICAgICAgdGhpcy5wYXJzZWRWaWV3Rm9ybWF0ID0gdGhpcy5kcGcucGFyc2VGb3JtYXQodGhpcy5vcHRpb25zLnZpZXdmb3JtYXQsIHRoaXMub3B0aW9ucy5mb3JtYXRUeXBlKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQuZGF0ZXRpbWVwaWNrZXIodGhpcy5vcHRpb25zLmRhdGV0aW1lcGlja2VyKTtcclxuXHJcbiAgICAgICAgICAgIC8vYWRqdXN0IGNvbnRhaW5lciBwb3NpdGlvbiB3aGVuIHZpZXdNb2RlIGNoYW5nZXNcclxuICAgICAgICAgICAgLy9zZWUgaHR0cHM6Ly9naXRodWIuY29tL3NtYWxvdC9ib290c3RyYXAtZGF0ZXRpbWVwaWNrZXIvcHVsbC84MFxyXG4gICAgICAgICAgICB0aGlzLiRpbnB1dC5vbignY2hhbmdlTW9kZScsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBmID0gJCh0aGlzKS5jbG9zZXN0KCdmb3JtJykucGFyZW50KCk7XHJcbiAgICAgICAgICAgICAgICAvL3RpbWVvdXQgaGVyZSwgb3RoZXJ3aXNlIGNvbnRhaW5lciBjaGFuZ2VzIHBvc2l0aW9uIGJlZm9yZSBmb3JtIGhhcyBuZXcgc2l6ZVxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIGYudHJpZ2dlckhhbmRsZXIoJ3Jlc2l6ZScpO1xyXG4gICAgICAgICAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy9cImNsZWFyXCIgbGlua1xyXG4gICAgICAgICAgICBpZih0aGlzLm9wdGlvbnMuY2xlYXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGNsZWFyID0gJCgnPGEgaHJlZj1cIiNcIj48L2E+JykuaHRtbCh0aGlzLm9wdGlvbnMuY2xlYXIpLmNsaWNrKCQucHJveHkoZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgfSwgdGhpcykpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuJHRwbC5wYXJlbnQoKS5hcHBlbmQoJCgnPGRpdiBjbGFzcz1cImVkaXRhYmxlLWNsZWFyXCI+JykuYXBwZW5kKHRoaXMuJGNsZWFyKSk7ICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHZhbHVlMmh0bWw6IGZ1bmN0aW9uKHZhbHVlLCBlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIC8vZm9ybWF0RGF0ZSB3b3JrcyB3aXRoIFVUQ0RhdGUhXHJcbiAgICAgICAgICAgIHZhciB0ZXh0ID0gdmFsdWUgPyB0aGlzLmRwZy5mb3JtYXREYXRlKHRoaXMudG9VVEModmFsdWUpLCB0aGlzLnBhcnNlZFZpZXdGb3JtYXQsIHRoaXMub3B0aW9ucy5kYXRldGltZXBpY2tlci5sYW5ndWFnZSwgdGhpcy5vcHRpb25zLmZvcm1hdFR5cGUpIDogJyc7XHJcbiAgICAgICAgICAgIGlmKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIERhdGVUaW1lLnN1cGVyY2xhc3MudmFsdWUyaHRtbC5jYWxsKHRoaXMsIHRleHQsIGVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBodG1sMnZhbHVlOiBmdW5jdGlvbihodG1sKSB7XHJcbiAgICAgICAgICAgIC8vcGFyc2VEYXRlIHJldHVybiB1dGMgZGF0ZSFcclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5wYXJzZURhdGUoaHRtbCwgdGhpcy5wYXJzZWRWaWV3Rm9ybWF0KTsgXHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA/IHRoaXMuZnJvbVVUQyh2YWx1ZSkgOiBudWxsO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHZhbHVlMnN0cjogZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICAgICAgLy9mb3JtYXREYXRlIHdvcmtzIHdpdGggVVRDRGF0ZSFcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlID8gdGhpcy5kcGcuZm9ybWF0RGF0ZSh0aGlzLnRvVVRDKHZhbHVlKSwgdGhpcy5wYXJzZWRGb3JtYXQsIHRoaXMub3B0aW9ucy5kYXRldGltZXBpY2tlci5sYW5ndWFnZSwgdGhpcy5vcHRpb25zLmZvcm1hdFR5cGUpIDogJyc7XHJcbiAgICAgICB9LFxyXG5cclxuICAgICAgIHN0cjJ2YWx1ZTogZnVuY3Rpb24oc3RyKSB7XHJcbiAgICAgICAgICAgLy9wYXJzZURhdGUgcmV0dXJuIHV0YyBkYXRlIVxyXG4gICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMucGFyc2VEYXRlKHN0ciwgdGhpcy5wYXJzZWRGb3JtYXQpO1xyXG4gICAgICAgICAgIHJldHVybiB2YWx1ZSA/IHRoaXMuZnJvbVVUQyh2YWx1ZSkgOiBudWxsO1xyXG4gICAgICAgfSxcclxuXHJcbiAgICAgICB2YWx1ZTJzdWJtaXQ6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUyc3RyKHZhbHVlKTtcclxuICAgICAgIH0sXHJcblxyXG4gICAgICAgdmFsdWUyaW5wdXQ6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgICAgaWYodmFsdWUpIHtcclxuICAgICAgICAgICAgIHRoaXMuJGlucHV0LmRhdGEoJ2RhdGV0aW1lcGlja2VyJykuc2V0RGF0ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgfSxcclxuXHJcbiAgICAgICBpbnB1dDJ2YWx1ZTogZnVuY3Rpb24oKSB7IFxyXG4gICAgICAgICAgIC8vZGF0ZSBtYXkgYmUgY2xlYXJlZCwgaW4gdGhhdCBjYXNlIGdldERhdGUoKSB0cmlnZ2VycyBlcnJvclxyXG4gICAgICAgICAgIHZhciBkdCA9IHRoaXMuJGlucHV0LmRhdGEoJ2RhdGV0aW1lcGlja2VyJyk7XHJcbiAgICAgICAgICAgcmV0dXJuIGR0LmRhdGUgPyBkdC5nZXREYXRlKCkgOiBudWxsO1xyXG4gICAgICAgfSxcclxuXHJcbiAgICAgICBhY3RpdmF0ZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICB9LFxyXG5cclxuICAgICAgIGNsZWFyOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgIHRoaXMuJGlucHV0LmRhdGEoJ2RhdGV0aW1lcGlja2VyJykuZGF0ZSA9IG51bGw7XHJcbiAgICAgICAgICB0aGlzLiRpbnB1dC5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgaWYoIXRoaXMub3B0aW9ucy5zaG93YnV0dG9ucykge1xyXG4gICAgICAgICAgICAgdGhpcy4kaW5wdXQuY2xvc2VzdCgnZm9ybScpLnN1Ym1pdCgpOyBcclxuICAgICAgICAgIH0gICAgICAgICAgXHJcbiAgICAgICB9LFxyXG5cclxuICAgICAgIGF1dG9zdWJtaXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgIHRoaXMuJGlucHV0Lm9uKCdtb3VzZXVwJywgJy5taW51dGUnLCBmdW5jdGlvbihlKXtcclxuICAgICAgICAgICAgICAgdmFyICRmb3JtID0gJCh0aGlzKS5jbG9zZXN0KCdmb3JtJyk7XHJcbiAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAkZm9ybS5zdWJtaXQoKTtcclxuICAgICAgICAgICAgICAgfSwgMjAwKTtcclxuICAgICAgICAgICB9KTtcclxuICAgICAgIH0sXHJcblxyXG4gICAgICAgLy9jb252ZXJ0IGRhdGUgZnJvbSBsb2NhbCB0byB1dGNcclxuICAgICAgIHRvVVRDOiBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICByZXR1cm4gdmFsdWUgPyBuZXcgRGF0ZSh2YWx1ZS52YWx1ZU9mKCkgLSB2YWx1ZS5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApIDogdmFsdWU7ICBcclxuICAgICAgIH0sXHJcblxyXG4gICAgICAgLy9jb252ZXJ0IGRhdGUgZnJvbSB1dGMgdG8gbG9jYWxcclxuICAgICAgIGZyb21VVEM6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgIHJldHVybiB2YWx1ZSA/IG5ldyBEYXRlKHZhbHVlLnZhbHVlT2YoKSArIHZhbHVlLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCkgOiB2YWx1ZTsgIFxyXG4gICAgICAgfSxcclxuXHJcbiAgICAgICAvKlxyXG4gICAgICAgIEZvciBpbmNvcnJlY3QgZGF0ZSBib290c3RyYXAtZGF0ZXRpbWVwaWNrZXIgcmV0dXJucyBjdXJyZW50IGRhdGUgdGhhdCBpcyBub3Qgc3VpdGFibGVcclxuICAgICAgICBmb3IgZGF0ZXRpbWVmaWVsZC5cclxuICAgICAgICBUaGlzIGZ1bmN0aW9uIHJldHVybnMgbnVsbCBmb3IgaW5jb3JyZWN0IGRhdGUuICBcclxuICAgICAgICovXHJcbiAgICAgICBwYXJzZURhdGU6IGZ1bmN0aW9uKHN0ciwgZm9ybWF0KSB7XHJcbiAgICAgICAgICAgdmFyIGRhdGUgPSBudWxsLCBmb3JtYXR0ZWRCYWNrO1xyXG4gICAgICAgICAgIGlmKHN0cikge1xyXG4gICAgICAgICAgICAgICBkYXRlID0gdGhpcy5kcGcucGFyc2VEYXRlKHN0ciwgZm9ybWF0LCB0aGlzLm9wdGlvbnMuZGF0ZXRpbWVwaWNrZXIubGFuZ3VhZ2UsIHRoaXMub3B0aW9ucy5mb3JtYXRUeXBlKTtcclxuICAgICAgICAgICAgICAgaWYodHlwZW9mIHN0ciA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZEJhY2sgPSB0aGlzLmRwZy5mb3JtYXREYXRlKGRhdGUsIGZvcm1hdCwgdGhpcy5vcHRpb25zLmRhdGV0aW1lcGlja2VyLmxhbmd1YWdlLCB0aGlzLm9wdGlvbnMuZm9ybWF0VHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICBpZihzdHIgIT09IGZvcm1hdHRlZEJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICB9XHJcbiAgICAgICAgICAgcmV0dXJuIGRhdGU7XHJcbiAgICAgICB9XHJcblxyXG4gICAgfSk7XHJcblxyXG4gICAgRGF0ZVRpbWUuZGVmYXVsdHMgPSAkLmV4dGVuZCh7fSwgJC5mbi5lZGl0YWJsZXR5cGVzLmFic3RyYWN0aW5wdXQuZGVmYXVsdHMsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICBAcHJvcGVydHkgdHBsIFxyXG4gICAgICAgIEBkZWZhdWx0IDxkaXY+PC9kaXY+XHJcbiAgICAgICAgKiovICAgICAgICAgXHJcbiAgICAgICAgdHBsOic8ZGl2IGNsYXNzPVwiZWRpdGFibGUtZGF0ZSB3ZWxsXCI+PC9kaXY+JyxcclxuICAgICAgICAvKipcclxuICAgICAgICBAcHJvcGVydHkgaW5wdXRjbGFzcyBcclxuICAgICAgICBAZGVmYXVsdCBudWxsXHJcbiAgICAgICAgKiovXHJcbiAgICAgICAgaW5wdXRjbGFzczogbnVsbCxcclxuICAgICAgICAvKipcclxuICAgICAgICBGb3JtYXQgdXNlZCBmb3Igc2VuZGluZyB2YWx1ZSB0byBzZXJ2ZXIuIEFsc28gYXBwbGllZCB3aGVuIGNvbnZlcnRpbmcgZGF0ZSBmcm9tIDxjb2RlPmRhdGEtdmFsdWU8L2NvZGU+IGF0dHJpYnV0ZS48YnI+XHJcbiAgICAgICAgUG9zc2libGUgdG9rZW5zIGFyZTogPGNvZGU+ZCwgZGQsIG0sIG1tLCB5eSwgeXl5eSwgaCwgaTwvY29kZT4gIFxyXG4gICAgICAgIFxyXG4gICAgICAgIEBwcm9wZXJ0eSBmb3JtYXQgXHJcbiAgICAgICAgQHR5cGUgc3RyaW5nXHJcbiAgICAgICAgQGRlZmF1bHQgeXl5eS1tbS1kZCBoaDppaVxyXG4gICAgICAgICoqLyAgICAgICAgIFxyXG4gICAgICAgIGZvcm1hdDoneXl5eS1tbS1kZCBoaDppaScsXHJcbiAgICAgICAgZm9ybWF0VHlwZTonc3RhbmRhcmQnLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEZvcm1hdCB1c2VkIGZvciBkaXNwbGF5aW5nIGRhdGUuIEFsc28gYXBwbGllZCB3aGVuIGNvbnZlcnRpbmcgZGF0ZSBmcm9tIGVsZW1lbnQncyB0ZXh0IG9uIGluaXQuICAgXHJcbiAgICAgICAgSWYgbm90IHNwZWNpZmllZCBlcXVhbHMgdG8gPGNvZGU+Zm9ybWF0PC9jb2RlPlxyXG4gICAgICAgIFxyXG4gICAgICAgIEBwcm9wZXJ0eSB2aWV3Zm9ybWF0IFxyXG4gICAgICAgIEB0eXBlIHN0cmluZ1xyXG4gICAgICAgIEBkZWZhdWx0IG51bGxcclxuICAgICAgICAqKi9cclxuICAgICAgICB2aWV3Zm9ybWF0OiBudWxsLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIENvbmZpZ3VyYXRpb24gb2YgZGF0ZXRpbWVwaWNrZXIuXHJcbiAgICAgICAgRnVsbCBsaXN0IG9mIG9wdGlvbnM6IGh0dHBzOi8vZ2l0aHViLmNvbS9zbWFsb3QvYm9vdHN0cmFwLWRhdGV0aW1lcGlja2VyXHJcblxyXG4gICAgICAgIEBwcm9wZXJ0eSBkYXRldGltZXBpY2tlciBcclxuICAgICAgICBAdHlwZSBvYmplY3RcclxuICAgICAgICBAZGVmYXVsdCB7IH1cclxuICAgICAgICAqKi9cclxuICAgICAgICBkYXRldGltZXBpY2tlcjp7XHJcbiAgICAgICAgICAgIHRvZGF5SGlnaGxpZ2h0OiBmYWxzZSxcclxuICAgICAgICAgICAgYXV0b2Nsb3NlOiBmYWxzZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgVGV4dCBzaG93biBhcyBjbGVhciBkYXRlIGJ1dHRvbi4gXHJcbiAgICAgICAgSWYgPGNvZGU+ZmFsc2U8L2NvZGU+IGNsZWFyIGJ1dHRvbiB3aWxsIG5vdCBiZSByZW5kZXJlZC5cclxuXHJcbiAgICAgICAgQHByb3BlcnR5IGNsZWFyIFxyXG4gICAgICAgIEB0eXBlIGJvb2xlYW58c3RyaW5nXHJcbiAgICAgICAgQGRlZmF1bHQgJ3ggY2xlYXInXHJcbiAgICAgICAgKiovXHJcbiAgICAgICAgY2xlYXI6ICcmdGltZXM7IGNsZWFyJ1xyXG4gICAgfSk7XHJcblxyXG4gICAgJC5mbi5lZGl0YWJsZXR5cGVzLmRhdGV0aW1lID0gRGF0ZVRpbWU7XHJcblxyXG59KHdpbmRvdy5qUXVlcnkpKTtcclxuLyoqXHJcbkJvb3RzdHJhcCBkYXRldGltZWZpZWxkIGlucHV0IC0gZGF0ZXRpbWUgaW5wdXQgZm9yIGlubGluZSBtb2RlLlxyXG5TaG93cyBub3JtYWwgPGlucHV0IHR5cGU9XCJ0ZXh0XCI+IGFuZCBiaW5kcyBwb3B1cCBkYXRldGltZXBpY2tlci4gIFxyXG5BdXRvbWF0aWNhbGx5IHNob3duIGluIGlubGluZSBtb2RlLlxyXG5cclxuQGNsYXNzIGRhdGV0aW1lZmllbGRcclxuQGV4dGVuZHMgZGF0ZXRpbWVcclxuXHJcbioqL1xyXG4oZnVuY3Rpb24gKCQpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgXHJcbiAgICB2YXIgRGF0ZVRpbWVGaWVsZCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5pbml0KCdkYXRldGltZWZpZWxkJywgb3B0aW9ucywgRGF0ZVRpbWVGaWVsZC5kZWZhdWx0cyk7XHJcbiAgICAgICAgdGhpcy5pbml0UGlja2VyKG9wdGlvbnMsIERhdGVUaW1lRmllbGQuZGVmYXVsdHMpO1xyXG4gICAgfTtcclxuXHJcbiAgICAkLmZuLmVkaXRhYmxldXRpbHMuaW5oZXJpdChEYXRlVGltZUZpZWxkLCAkLmZuLmVkaXRhYmxldHlwZXMuZGF0ZXRpbWUpO1xyXG4gICAgXHJcbiAgICAkLmV4dGVuZChEYXRlVGltZUZpZWxkLnByb3RvdHlwZSwge1xyXG4gICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0aGlzLiRpbnB1dCA9IHRoaXMuJHRwbC5maW5kKCdpbnB1dCcpO1xyXG4gICAgICAgICAgICB0aGlzLnNldENsYXNzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QXR0cigncGxhY2Vob2xkZXInKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuJHRwbC5kYXRldGltZXBpY2tlcih0aGlzLm9wdGlvbnMuZGF0ZXRpbWVwaWNrZXIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9uZWVkIHRvIGRpc2FibGUgb3JpZ2luYWwgZXZlbnQgaGFuZGxlcnNcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQub2ZmKCdmb2N1cyBrZXlkb3duJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL3VwZGF0ZSB2YWx1ZSBvZiBkYXRlcGlja2VyXHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0LmtleXVwKCQucHJveHkoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgdGhpcy4kdHBsLnJlbW92ZURhdGEoJ2RhdGUnKTtcclxuICAgICAgICAgICAgICAgdGhpcy4kdHBsLmRhdGV0aW1lcGlja2VyKCd1cGRhdGUnKTtcclxuICAgICAgICAgICAgfSwgdGhpcykpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9LCAgIFxyXG4gICAgICBcclxuICAgICAgIHZhbHVlMmlucHV0OiBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICAgIHRoaXMuJGlucHV0LnZhbCh0aGlzLnZhbHVlMmh0bWwodmFsdWUpKTtcclxuICAgICAgICAgICB0aGlzLiR0cGwuZGF0ZXRpbWVwaWNrZXIoJ3VwZGF0ZScpO1xyXG4gICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgIGlucHV0MnZhbHVlOiBmdW5jdGlvbigpIHsgXHJcbiAgICAgICAgICAgcmV0dXJuIHRoaXMuaHRtbDJ2YWx1ZSh0aGlzLiRpbnB1dC52YWwoKSk7XHJcbiAgICAgICB9LCAgICAgICAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICBhY3RpdmF0ZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgJC5mbi5lZGl0YWJsZXR5cGVzLnRleHQucHJvdG90eXBlLmFjdGl2YXRlLmNhbGwodGhpcyk7XHJcbiAgICAgICB9LFxyXG4gICAgICAgXHJcbiAgICAgICBhdXRvc3VibWl0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgLy9yZXNldCBhdXRvc3VibWl0IHRvIGVtcHR5ICBcclxuICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBEYXRlVGltZUZpZWxkLmRlZmF1bHRzID0gJC5leHRlbmQoe30sICQuZm4uZWRpdGFibGV0eXBlcy5kYXRldGltZS5kZWZhdWx0cywge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgIEBwcm9wZXJ0eSB0cGwgXHJcbiAgICAgICAgKiovICAgICAgICAgXHJcbiAgICAgICAgdHBsOic8ZGl2IGNsYXNzPVwiaW5wdXQtYXBwZW5kIGRhdGVcIj48aW5wdXQgdHlwZT1cInRleHRcIi8+PHNwYW4gY2xhc3M9XCJhZGQtb25cIj48aSBjbGFzcz1cImljb24tdGhcIj48L2k+PC9zcGFuPjwvZGl2PicsXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgQHByb3BlcnR5IGlucHV0Y2xhc3MgXHJcbiAgICAgICAgQGRlZmF1bHQgJ2lucHV0LW1lZGl1bSdcclxuICAgICAgICAqKi8gICAgICAgICBcclxuICAgICAgICBpbnB1dGNsYXNzOiAnaW5wdXQtbWVkaXVtJyxcclxuICAgICAgICBcclxuICAgICAgICAvKiBkYXRldGltZXBpY2tlciBjb25maWcgKi9cclxuICAgICAgICBkYXRldGltZXBpY2tlcjp7XHJcbiAgICAgICAgICAgIHRvZGF5SGlnaGxpZ2h0OiBmYWxzZSxcclxuICAgICAgICAgICAgYXV0b2Nsb3NlOiB0cnVlXHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgICQuZm4uZWRpdGFibGV0eXBlcy5kYXRldGltZWZpZWxkID0gRGF0ZVRpbWVGaWVsZDtcclxuXHJcbn0od2luZG93LmpRdWVyeSkpOyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./Modules/Translation/node_modules/x-editable/dist/bootstrap3-editable/js/bootstrap-editable.js\n");

/***/ }),

/***/ 17:
/*!*********************************************************************!*\
  !*** multi ./Modules/Translation/Resources/assets/admin/js/main.js ***!
  \*********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(/*! D:\xampp\htdocs\ecom\Modules\Translation\Resources\assets\admin\js\main.js */"./Modules/Translation/Resources/assets/admin/js/main.js");


/***/ })

/******/ });